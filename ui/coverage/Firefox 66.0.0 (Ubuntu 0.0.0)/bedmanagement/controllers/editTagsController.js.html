<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for bedmanagement/controllers/editTagsController.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">bedmanagement/controllers/editTagsController.js</span></h1>
    <h2>
        Statements: <span class="metric">91.89% <small>(68 / 74)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">50% <small>(6 / 12)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">88.89% <small>(24 / 27)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">91.89% <small>(68 / 74)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">bedmanagement/controllers/</a> &#187; editTagsController.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">14</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
angular.module('bahmni.ipd').controller('editTagsController', ['$scope', '$rootScope', '$q', 'ngDialog', 'spinner', 'messagingService', 'bedTagMapService',
    function ($scope, $rootScope, $q, ngDialog, spinner, messagingService, bedTagMapService) {
        $scope.allTags = [];
        var assignedTags = [];
        var unAssignedTags = [];
        var deltaDeSelected = [];
        var selectedValues = [];
        var deltaSelected = [];
        $scope.values = [];
&nbsp;
        var getTagsInfo = function () {
            var bedTagMaps = _.map($rootScope.selectedBedInfo.bed.bedTagMaps, function (tagMap) {
                return {
                    tagMapUuid: tagMap.uuid,
                    id: tagMap.bedTag.id,
                    name: tagMap.bedTag.name,
                    uuid: tagMap.bedTag.uuid
                };
            });
            return bedTagMaps;
        };
&nbsp;
        var init = function () {
            assignedTags = getTagsInfo();
            bedTagMapService.getAllBedTags().then(function (response) {
                $scope.allTags = response.data.results;
                selectedValues = getTagsInfo();
                unAssignedTags = _.xorBy($scope.allTags, assignedTags, 'uuid');
                $scope.values = selectedValues;
            });
        };
&nbsp;
        $scope.search = function (query) {
            var matchingAnswers = [];
            var unselectedValues = _.xorBy($scope.allTags, selectedValues, 'uuid');
            _.forEach(unselectedValues, function (answer) {
                <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof answer.name != "object" &amp;&amp; answer.name.toLowerCase().indexOf(query.toLowerCase()) !== -1) {
                    matchingAnswers.push(answer);
                }
            });
            return _.uniqBy(matchingAnswers, 'uuid');
        };
        $scope.focusOnTheTest = <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >            var autoSelectInput = $("input.input");</span>
<span class="cstat-no" title="statement not covered" >            autoSelectInput[0].focus();</span>
        };
        $scope.addItem = function (item) {
            var find = _.find(unAssignedTags, {uuid: item.uuid});
            var itemList = find ? [find] : <span class="branch-1 cbranch-no" title="branch not covered" >[];</span>
            deltaSelected = _.xorBy(deltaSelected, itemList, 'uuid');
            selectedValues = _.union(assignedTags, deltaSelected, 'uuid');
            deltaDeSelected = _.remove(deltaDeSelected, <span class="fstat-no" title="function not covered" >function (value) {</span>
<span class="cstat-no" title="statement not covered" >                return value.uuid !== item.uuid;</span>
            });
            selectedValues = _.xorBy(selectedValues, deltaDeSelected, 'uuid');
        };
&nbsp;
        $scope.removeItem = function (item) {
            var find = _.find(assignedTags, {uuid: item.uuid});
            var itemList = find ? [find] : <span class="branch-1 cbranch-no" title="branch not covered" >[];</span>
            deltaDeSelected = _.xorBy(deltaDeSelected, itemList, 'uuid');
            deltaSelected = _.filter(deltaSelected, function (value) {
                return value.uuid !== item.uuid;
            });
            selectedValues = _.filter(selectedValues, function (value) {
                return value.uuid !== item.uuid;
            });
        };
&nbsp;
        $scope.removeFreeTextItem = <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >            var value = $("input.input").val();</span>
<span class="cstat-no" title="statement not covered" >            if (_.isEmpty($scope.search(value))) {</span>
<span class="cstat-no" title="statement not covered" >                $("input.input").val("");</span>
            }
        };
&nbsp;
        var assignTagsToBed = function () {
            _.each(deltaSelected, function (bedTag) {
                bedTagMapService.assignTagToABed(bedTag.id, $rootScope.selectedBedInfo.bed.bedId).then(function (response) {
                    var bedTags = $rootScope.selectedBedInfo.bed.bedTagMaps || <span class="branch-1 cbranch-no" title="branch not covered" >[];</span>
                    var bedTagMapEntry = {uuid: response.data.uuid, bedTag: bedTag};
                    bedTags.push(bedTagMapEntry);
                });
            });
            ngDialog.close();
        };
        var unAssignTagsFromBed = function () {
            _.each(deltaDeSelected, function (bedTag) {
                bedTagMapService.unAssignTagFromTheBed(bedTag.tagMapUuid).then(function () {
                    $rootScope.selectedBedInfo.bed.bedTagMaps = _.filter($rootScope.selectedBedInfo.bed.bedTagMaps, function (bedTagMap) {
                        return bedTagMap.bedTag.uuid !== bedTag.uuid;
                    });
                });
            });
        };
        $scope.updateTagsForTheSelectedBed = function () {
            spinner.forPromise($q.all(unAssignTagsFromBed(), assignTagsToBed()).then(function () {
                messagingService.showMessage('info', "Tags Updated Successfully");
            }));
        };
&nbsp;
        $scope.cancelConfirmationDialog = function () {
            ngDialog.close();
        };
&nbsp;
        $scope.disableTagButton = function (tag) {
            var selectedTag = _.filter($scope.values, function (tagEntry) {
                return _.isMatch(tagEntry, {uuid: tag.uuid});
            });
            return selectedTag.length &gt; 0;
        };
&nbsp;
        $scope.onClickingTheTag = function (tag) {
            $scope.addItem(tag);
            $scope.values = selectedValues;
        };
&nbsp;
        init();
    }]);
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue May 14 2019 13:02:29 GMT+0530 (IST)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
