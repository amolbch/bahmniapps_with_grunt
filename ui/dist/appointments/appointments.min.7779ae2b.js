"use strict";(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},function(){var hostUrl=localStorage.getItem("host")?"https://"+localStorage.getItem("host"):"",rootDir=localStorage.getItem("rootDir")||"",RESTWS_V1=hostUrl+"/openmrs/ws/rest/v1",BAHMNI_CORE=RESTWS_V1+"/bahmnicore",EMRAPI=hostUrl+"/openmrs/ws/rest"+"/emrapi",BACTERIOLOGY=RESTWS_V1,BASE_URL=hostUrl+"/bahmni_config/openmrs/apps/",CUSTOM_URL=hostUrl+"/implementation_config/openmrs/apps/",authenticatedReferenceDataMap={"/openmrs/ws/rest/v1/idgen/identifiertype":"IdentifierTypes","/openmrs/module/addresshierarchy/ajax/getOrderedAddressHierarchyLevels.form":"AddressHierarchyLevels","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=mrs.genders":"Genders","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=bahmni.encountersession.duration":"encounterSessionDuration","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=bahmni.relationshipTypeMap":"RelationshipTypeMap","/openmrs/ws/rest/v1/bahmnicore/config/bahmniencounter?callerContext=REGISTRATION_CONCEPTS":"RegistrationConcepts","/openmrs/ws/rest/v1/relationshiptype?v=custom:(aIsToB,bIsToA,uuid)":"RelationshipType","/openmrs/ws/rest/v1/personattributetype?v=custom:(uuid,name,sortWeight,description,format,concept)":"PersonAttributeType","/openmrs/ws/rest/v1/entitymapping?mappingType=loginlocation_visittype&s=byEntityAndMappingType":"LoginLocationToVisitTypeMapping","/openmrs/ws/rest/v1/bahmnicore/config/patient":"PatientConfig","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Consultation+Note&v=custom:(uuid,name,answers)":"ConsultationNote","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Lab+Order+Notes&v=custom:(uuid,name)":"LabOrderNotes","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Impression&v=custom:(uuid,name)":"RadiologyImpressionConfig","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=All_Tests_and_Panels&v=custom:(uuid,name:(uuid,name),setMembers:(uuid,name:(uuid,name)))":"AllTestsAndPanelsConcept","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Dosage+Frequency&v=custom:(uuid,name,answers)":"DosageFrequencyConfig","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Dosage+Instructions&v=custom:(uuid,name,answers)":"DosageInstructionConfig","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=bahmni.encounterType.default":"DefaultEncounterType","/openmrs/ws/rest/v1/concept?s=byFullySpecifiedName&name=Stopped+Order+Reason&v=custom:(uuid,name,answers)":"StoppedOrderReasonConfig","/openmrs/ws/rest/v1/ordertype":"OrderType","/openmrs/ws/rest/v1/bahmnicore/config/drugOrders":"DrugOrderConfig","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=drugOrder.drugOther":"NonCodedDrugConcept"};authenticatedReferenceDataMap["/openmrs/ws/rest/v1/entitymapping?mappingType=location_encountertype&s=byEntityAndMappingType&entityUuid="+(localStorage.getItem("LoginInformation")?JSON.parse(localStorage.getItem("LoginInformation")).currentLocation.uuid:"")]="LoginLocationToEncounterTypeMapping",Bahmni.Common.Constants={hostURL:hostUrl,dateFormat:"dd/mm/yyyy",dateDisplayFormat:"DD-MMM-YYYY",timeDisplayFormat:"hh:mm",emrapiDiagnosisUrl:EMRAPI+"/diagnosis",bahmniDiagnosisUrl:BAHMNI_CORE+"/diagnosis/search",bahmniDeleteDiagnosisUrl:BAHMNI_CORE+"/diagnosis/delete",diseaseTemplateUrl:BAHMNI_CORE+"/diseaseTemplates",AllDiseaseTemplateUrl:BAHMNI_CORE+"/diseaseTemplate",emrapiConceptUrl:EMRAPI+"/concept",emrapiConditionConceptUrl:EMRAPI+"/conditionconcept",emrapiAllergyConceptUrl:EMRAPI+"/allergyconcept",encounterConfigurationUrl:BAHMNI_CORE+"/config/bahmniencounter",patientConfigurationUrl:BAHMNI_CORE+"/config/patient",drugOrderConfigurationUrl:BAHMNI_CORE+"/config/drugOrders",emrEncounterUrl:EMRAPI+"/encounter",encounterUrl:RESTWS_V1+"/encounter",locationUrl:RESTWS_V1+"/location",bahmniVisitLocationUrl:BAHMNI_CORE+"/visitLocation",bahmniOrderUrl:BAHMNI_CORE+"/orders",bahmniDrugOrderUrl:BAHMNI_CORE+"/drugOrders",bahmniDispositionByVisitUrl:BAHMNI_CORE+"/disposition/visit",bahmniDispositionByPatientUrl:BAHMNI_CORE+"/disposition/patient",bahmniSearchUrl:BAHMNI_CORE+"/search",bahmniDuplicateSearchUrl:BAHMNI_CORE+"/duplicatesearch",bahmniStatusBasedSearchUrl:BAHMNI_CORE+"/patientStatusBasedSearch",bahmniLabOrderResultsUrl:BAHMNI_CORE+"/labOrderResults",bahmniEncounterUrl:BAHMNI_CORE+"/bahmniencounter",conceptUrl:RESTWS_V1+"/concept",bahmniConceptAnswerUrl:RESTWS_V1+"/bahmniconceptanswer",conceptSearchByFullNameUrl:RESTWS_V1+"/concept?s=byFullySpecifiedName",visitUrl:RESTWS_V1+"/visit",endVisitUrl:BAHMNI_CORE+"/visit/endVisit",endVisitAndCreateEncounterUrl:BAHMNI_CORE+"/visit/endVisitAndCreateEncounter",visitTypeUrl:RESTWS_V1+"/visittype",patientImageUrlByPatientUuid:RESTWS_V1+"/patientImage?patientUuid=",labResultUploadedFileNameUrl:"/uploaded_results/",visitSummaryUrl:BAHMNI_CORE+"/visit/summary",encounterModifierUrl:BAHMNI_CORE+"/bahmniencountermodifier",openmrsUrl:hostUrl+"/openmrs",loggingUrl:hostUrl+"/log/",idgenConfigurationURL:RESTWS_V1+"/idgen/identifiertype",bahmniRESTBaseURL:BAHMNI_CORE+"",observationsUrl:BAHMNI_CORE+"/observations",obsRelationshipUrl:BAHMNI_CORE+"/obsrelationships",encounterImportUrl:BAHMNI_CORE+"/admin/upload/encounter",programImportUrl:BAHMNI_CORE+"/admin/upload/program",conceptImportUrl:BAHMNI_CORE+"/admin/upload/concept",conceptSetImportUrl:BAHMNI_CORE+"/admin/upload/conceptset",drugImportUrl:BAHMNI_CORE+"/admin/upload/drug",labResultsImportUrl:BAHMNI_CORE+"/admin/upload/labResults",referenceTermsImportUrl:BAHMNI_CORE+"/admin/upload/referenceterms",relationshipImportUrl:BAHMNI_CORE+"/admin/upload/relationship",conceptSetExportUrl:BAHMNI_CORE+"/admin/export/conceptset?conceptName=:conceptName",patientImportUrl:BAHMNI_CORE+"/admin/upload/patient",adminImportStatusUrl:BAHMNI_CORE+"/admin/upload/status",programUrl:RESTWS_V1+"/program",programEnrollPatientUrl:RESTWS_V1+"/bahmniprogramenrollment",programStateDeletionUrl:RESTWS_V1+"/programenrollment",programEnrollmentDefaultInformation:"default",programEnrollmentFullInformation:"full",programAttributeTypes:RESTWS_V1+"/programattributetype",relationshipTypesUrl:RESTWS_V1+"/relationshiptype",personAttributeTypeUrl:RESTWS_V1+"/personattributetype",diseaseSummaryPivotUrl:BAHMNI_CORE+"/diseaseSummaryData",allTestsAndPanelsConceptName:"All_Tests_and_Panels",dosageFrequencyConceptName:"Dosage Frequency",whoStageConceptName:"HTC, WHO Staging",dosageInstructionConceptName:"Dosage Instructions",stoppedOrderReasonConceptName:"Stopped Order Reason",consultationNoteConceptName:"Consultation Note",diagnosisConceptSet:"Diagnosis Concept Set",radiologyOrderType:"Radiology Order",radiologyResultConceptName:"Radiology Result",investigationEncounterType:"INVESTIGATION",validationNotesEncounterType:"VALIDATION NOTES",labOrderNotesConcept:"Lab Order Notes",impressionConcept:"Impression",qualifiedByRelationshipType:"qualified-by",dispositionConcept:"Disposition",dispositionGroupConcept:"Disposition Set",dispositionNoteConcept:"Disposition Note",ruledOutDiagnosisConceptName:"Ruled Out Diagnosis",emrapiConceptMappingSource:"org.openmrs.module.emrapi",abbreviationConceptMappingSource:"Abbreviation",includeAllObservations:!1,openmrsObsUrl:RESTWS_V1+"/obs",openmrsObsRepresentation:"custom:(uuid,obsDatetime,value:(uuid,name:(uuid,name)))",admissionCode:"ADMIT",dischargeCode:"DISCHARGE",transferCode:"TRANSFER",undoDischargeCode:"UNDO_DISCHARGE",vitalsConceptName:"Vitals",heightConceptName:"HEIGHT",weightConceptName:"WEIGHT",bmiConceptName:"BMI",bmiStatusConceptName:"BMI STATUS",abnormalObservationConceptName:"IS_ABNORMAL",documentsPath:"/document_images",documentsConceptName:"Document",miscConceptClassName:"Misc",abnormalConceptClassName:"Abnormal",unknownConceptClassName:"Unknown",durationConceptClassName:"Duration",conceptDetailsClassName:"Concept Details",admissionEncounterTypeName:"ADMISSION",dischargeEncounterTypeName:"DISCHARGE",imageClassName:"Image",videoClassName:"Video",locationCookieName:"bahmni.user.location",retrospectiveEntryEncounterDateCookieName:"bahmni.clinical.retrospectiveEncounterDate",JSESSIONID:"JSESSIONID",rootScopeRetrospectiveEntry:"retrospectiveEntry.encounterDate",patientFileConceptName:"Patient file",serverErrorMessages:[{serverMessage:"{{::'MEDICATION_ERROR_CAN_NOT_HAVE_MORE_THAN' | translate}}",clientMessage:"{{::'MEDICATION_ERROR_ONE_OR_MORE' | translate}}"},{serverMessage:"[Order.cannot.have.more.than.one]",clientMessage:"{{::'MEDICATION_ERROR_ONE_OR_MORE' | translate}}"}],currentUser:"bahmni.user",retrospectivePrivilege:"app:clinical:retrospective",locationPickerPrivilege:"app:clinical:locationpicker",onBehalfOfPrivilege:"app:clinical:onbehalf",nutritionalConceptName:"Nutritional Values",messageForNoObservation:"NO_OBSERVATIONS_CAPTURED",messageForNoDisposition:"NO_DISPOSTIONS_AVAILABLE_MESSAGE_KEY",messageForNoFulfillment:"NO_FULFILMENT_MESSAGE",reportsUrl:"/bahmnireports",uploadReportTemplateUrl:"/bahmnireports/upload",ruledOutdiagnosisStatus:"Ruled Out Diagnosis",registartionConsultationPrivilege:"app:common:registration_consultation_link",manageIdentifierSequencePrivilege:"Manage Identifier Sequence",closeVisitPrivilege:"app:common:closeVisit",deleteDiagnosisPrivilege:"app:clinical:deleteDiagnosis",viewPatientsPrivilege:"View Patients",editPatientsPrivilege:"Edit Patients",addVisitsPrivilege:"Add Visits",deleteVisitsPrivilege:"Delete Visits",grantProviderAccess:"app:clinical:grantProviderAccess",grantProviderAccessDataCookieName:"app.clinical.grantProviderAccessData",globalPropertyUrl:BAHMNI_CORE+"/sql/globalproperty",passwordPolicyUrl:BAHMNI_CORE+"/globalProperty/passwordPolicyProperties",fulfillmentConfiguration:"fulfillment",fulfillmentFormSuffix:" Fulfillment Form",noNavigationLinksMessage:"NO_NAVIGATION_LINKS_AVAILABLE_MESSAGE",conceptSetRepresentationForOrderFulfillmentConfig:"custom:(uuid,name,names,conceptClass,setMembers:(uuid,name,names,conceptClass,setMembers:(uuid,name,names,conceptClass,setMembers:(uuid,name,names,conceptClass))))",entityMappingUrl:RESTWS_V1+"/entitymapping",encounterTypeUrl:RESTWS_V1+"/encountertype",defaultExtensionName:"default",orderSetMemberAttributeTypeUrl:RESTWS_V1+"/ordersetmemberattributetype",orderSetUrl:RESTWS_V1+"/bahmniorderset",primaryOrderSetMemberAttributeTypeName:"Primary",bahmniBacteriologyResultsUrl:BACTERIOLOGY+"/specimen",bedFromVisit:RESTWS_V1+"/beds",ordersUrl:RESTWS_V1+"/order",formDataUrl:RESTWS_V1+"/obs",providerUrl:RESTWS_V1+"/provider",drugUrl:RESTWS_V1+"/drug",orderTypeUrl:RESTWS_V1+"/ordertype",userUrl:RESTWS_V1+"/user",passwordUrl:RESTWS_V1+"/password",formUrl:RESTWS_V1+"/form",allFormsUrl:RESTWS_V1+"/bahmniie/form/allForms",latestPublishedForms:RESTWS_V1+"/bahmniie/form/latestPublishedForms",formTranslationsUrl:RESTWS_V1+"/bahmniie/form/translations",sqlUrl:BAHMNI_CORE+"/sql",patientAttributeDateFieldFormat:"org.openmrs.util.AttributableDate",platform:"user.platform",RESTWS_V1:RESTWS_V1,baseUrl:BASE_URL,customUrl:CUSTOM_URL,faviconUrl:hostUrl+"/bahmni/favicon.ico",platformType:{other:"other"},numericDataType:"Numeric",encryptionType:{SHA3:"SHA3"},LoginInformation:"LoginInformation",ServerDateTimeFormat:"YYYY-MM-DDTHH:mm:ssZZ",calculateDose:BAHMNI_CORE+"/calculateDose",unAuthenticatedReferenceDataMap:{"/openmrs/ws/rest/v1/location?tags=Login+Location&s=byTags&v=default":"LoginLocations","/openmrs/ws/rest/v1/bahmnicore/sql/globalproperty?property=locale.allowed.list":"LocaleList"},authenticatedReferenceDataMap:authenticatedReferenceDataMap,rootDir:rootDir,dischargeUrl:BAHMNI_CORE+"/discharge",uuidRegex:"[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}",eventlogFilterUrl:hostUrl+"/openmrs/ws/rest/v1/eventlog/filter",bahmniConnectMetaDataDb:"metaData",serverDateTimeUrl:"/cgi-bin/systemdate",loginText:"/bahmni_config/openmrs/apps/home/whiteLabel.json",auditLogUrl:RESTWS_V1+"/auditlog",appointmentServiceUrl:RESTWS_V1+"/appointmentService",conditionUrl:EMRAPI+"/condition",allergyUrl:EMRAPI+"/allergy",dispenseDrugOrderUrl:EMRAPI+"/dispensedrugorder",conditionHistoryUrl:EMRAPI+"/conditionhistory",allergyHistoryUrl:EMRAPI+"/allergyhistory",followUpConditionConcept:"Follow-up Condition",localeLangs:"/bahmni_config/openmrs/apps/home/locale_languages.json",privilegeRequiredErrorMessage:"PRIVILEGE_REQUIRED",defaultPossibleRelativeSearchLimit:10}}(),angular.module("bahmni.common.routeErrorHandler",["ui.router"]).run(["$rootScope",function($rootScope){$rootScope.$on("$stateChangeError",function(event){event.preventDefault()})}]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.Util=Bahmni.Common.Util||{},angular.module("bahmni.common.util",[]).provider("$bahmniCookieStore",[function(){var self=this;self.defaultOptions={};self.setDefaultOptions=function(options){self.defaultOptions=options},self.$get=function(){return{get:function(name){var jsonCookie=$.cookie(name);return jsonCookie?angular.fromJson(decodeURIComponent(jsonCookie)):null},put:function(name,value,options){var str;options=$.extend({},self.defaultOptions,options),$.cookie.raw=!0,$.cookie(name,(str=angular.toJson(value),encodeURIComponent(str).replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16)})),options)},remove:function(name,options){options=$.extend({},self.defaultOptions,options),$.removeCookie(name,options)}}}}]),Bahmni.Common.Util.DateUtil={diffInDays:function(dateFrom,dateTo){return Math.floor((this.parse(dateTo)-this.parse(dateFrom))/864e5)},diffInMinutes:function(dateFrom,dateTo){return moment(dateTo).diff(moment(dateFrom),"minutes")},diffInSeconds:function(dateFrom,dateTo){return moment(dateFrom).diff(moment(dateTo),"seconds")},isInvalid:function(date){return"Invalid Date"==date},diffInDaysRegardlessOfTime:function(dateFrom,dateTo){var from=new Date(dateFrom),to=new Date(dateTo);return from.setHours(0,0,0,0),to.setHours(0,0,0,0),Math.floor((to-from)/864e5)},addSeconds:function(date,seconds){return moment(date).add(seconds,"seconds").toDate()},addMinutes:function(date,minutes){return this.addSeconds(date,60*minutes)},addDays:function(date,days){return moment(date).add(days,"day").toDate()},addMonths:function(date,months){return moment(date).add(months,"month").toDate()},addYears:function(date,years){return moment(date).add(years,"year").toDate()},subtractSeconds:function(date,seconds){return moment(date).subtract(seconds,"seconds").toDate()},subtractDays:function(date,days){return this.addDays(date,-1*days)},subtractMonths:function(date,months){return this.addMonths(date,-1*months)},subtractYears:function(date,years){return this.addYears(date,-1*years)},createDays:function(startDate,endDate){startDate=this.getDate(startDate),endDate=this.getDate(endDate);for(var numberOfDays=this.diffInDays(startDate,endDate),days=[],i=0;i<=numberOfDays;i++)days.push({dayNumber:i+1,date:this.addDays(startDate,i)});return days},getDayNumber:function(referenceDate,date){return this.diffInDays(this.getDate(referenceDate),this.getDate(date))+1},getDateWithoutTime:function(datetime){return datetime?moment(datetime).format("YYYY-MM-DD"):null},getDateInMonthsAndYears:function(date,format){format=format||"MMM YY";var dateRepresentation=isNaN(Number(date))?date:Number(date);return moment(dateRepresentation).isValid()?dateRepresentation?moment(dateRepresentation).format(format):null:date},formatDateWithTime:function(datetime){var dateRepresentation=isNaN(Number(datetime))?datetime:Number(datetime);return moment(dateRepresentation).isValid()?dateRepresentation?moment(dateRepresentation).format("DD MMM YY HH:mm"):null:datetime},formatDateWithoutTime:function(date){var dateRepresentation=isNaN(Number(date))?date:Number(date);return moment(dateRepresentation).isValid()?dateRepresentation?moment(dateRepresentation).format("DD MMM YY"):null:date},formatDateInStrictMode:function(date){var dateRepresentation=isNaN(Number(date))?date:Number(date);return moment(dateRepresentation,"YYYY-MM-DD",!0).isValid()?moment(dateRepresentation).format("DD MMM YY"):moment(dateRepresentation,"YYYY-MM-DDTHH:mm:ss.SSSZZ",!0).isValid()?moment(dateRepresentation).format("DD MMM YY"):date},formatTime:function(date){var dateRepresentation=isNaN(Number(date))?date:Number(date);return moment(dateRepresentation).isValid()?dateRepresentation?moment(dateRepresentation).format("HH:mm"):null:date},getDate:function(dateTime){return moment(this.parse(dateTime)).startOf("day").toDate()},parse:function(dateString){return dateString?moment(dateString).toDate():null},parseDatetime:function(dateTimeString){return dateTimeString?moment(dateTimeString):null},now:function(){return new Date},today:function(){return this.getDate(this.now())},endOfToday:function(){return moment(this.parse(this.now())).endOf("day").toDate()},getDateWithoutHours:function(dateString){return moment(dateString).toDate().setHours(0,0,0,0)},getDateTimeWithoutSeconds:function(dateString){return moment(dateString).toDate().setSeconds(0,0)},isSameDateTime:function(date1,date2){if(null==date1||null==date2)return!1;var dateOne=this.parse(date1),dateTwo=this.parse(date2);return dateOne.getTime()==dateTwo.getTime()},isBeforeDate:function(date1,date2){return moment(date1).isBefore(moment(date2))},isSameDate:function(date1,date2){if(null==date1||null==date2)return!1;var dateOne=this.parse(date1),dateTwo=this.parse(date2);return dateOne.getFullYear()===dateTwo.getFullYear()&&dateOne.getMonth()===dateTwo.getMonth()&&dateOne.getDate()===dateTwo.getDate()},diffInYearsMonthsDays:function(dateFrom,dateTo){dateFrom=this.parse(dateFrom),dateTo=this.parse(dateTo);var from={d:dateFrom.getDate(),m:dateFrom.getMonth(),y:dateFrom.getFullYear()},to_d=dateTo.getDate(),to_m=dateTo.getMonth(),to_y=dateTo.getFullYear(),age={d:0,m:0,y:0},daysInMonths=[31,to_y%4!=0||to_y%100==0&&to_y%400!=0?28:29,31,30,31,30,31,31,30,31,30,31];return age.y=to_y-from.y,age.m=to_m-from.m,from.m>to_m&&(age.y=age.y-1,age.m=to_m-from.m+12),age.d=to_d-from.d,from.d>to_d&&(age.m=age.m-1,from.m==to_m&&(age.y=age.y-1,age.m=age.m+12),age.d=to_d-from.d+daysInMonths[parseInt(from.m)]),{days:age.d,months:age.m,years:age.y}},convertToUnits:function(minutes){var allUnits={Years:525600,Months:43200,Weeks:10080,Days:1440,Hours:60,Minutes:1},durationRepresentation=function(value,unitName,unitValueInMinutes){return{value:value,unitName:unitName,unitValueInMinutes:unitValueInMinutes,allUnits:allUnits}};for(var unitName in allUnits){var unitValueInMinutes=allUnits[unitName];if((minutes||0!==minutes)&&minutes>=unitValueInMinutes&&minutes%unitValueInMinutes==0)return durationRepresentation(minutes/unitValueInMinutes,unitName,unitValueInMinutes)}return durationRepresentation(void 0,void 0,void 0)},getEndDateFromDuration:function(dateFrom,value,unit){var from={h:(dateFrom=this.parse(dateFrom)).getHours(),d:dateFrom.getDate(),m:dateFrom.getMonth(),y:dateFrom.getFullYear()},to=new Date(from.y,from.m,from.d,from.h);return"Months"===unit?to.setMonth(from.m+value):"Weeks"===unit?to.setDate(from.d+7*value):"Days"===unit?to.setDate(from.d+value):"Hours"===unit&&to.setHours(from.h+value),to},parseLongDateToServerFormat:function(longDate){return longDate?moment(longDate).format("YYYY-MM-DDTHH:mm:ss.SSS"):null},parseServerDateToDate:function(longDate){return longDate?moment(longDate,"YYYY-MM-DDTHH:mm:ss.SSSZZ").toDate():null},getDateTimeInSpecifiedFormat:function(date,format){return date?moment(date).format(format):null},getISOString:function(date){return date?moment(date).toDate().toISOString():null},isBeforeTime:function(time,otherTime){return moment(time,"HH:mm").format("YYYY-MM-DD")}},Bahmni.Common.Util.ArrayUtil={chunk:function(array,chunkSize){for(var chunks=[],i=0;i<array.length;i+=chunkSize)chunks.push(array.slice(i,i+chunkSize));return chunks},groupByPreservingOrder:function(records,groupingFunction,keyName,valueName){var groups=[];return records.forEach(function(record){var recordKey=groupingFunction(record),existingGroup=_.find(groups,function(group){return group[keyName]===recordKey});if(existingGroup)existingGroup[valueName].push(record);else{var newGroup={};newGroup[keyName]=recordKey,newGroup[valueName]=[record],groups.push(newGroup)}}),groups}},angular.module("httpErrorInterceptor",[]).config(["$httpProvider",function($httpProvider){var interceptor=["$rootScope","$q",function($rootScope,$q){var serverErrorMessages=Bahmni.Common.Constants.serverErrorMessages,showError=function(errorMessage){var result=_.find(serverErrorMessages,function(listItem){return listItem.serverMessage===errorMessage});_.isEmpty(result)&&$rootScope.$broadcast("event:serverError",errorMessage)};function getServerError(message){return searchString=":",indexOfFirstColon=(value=message).indexOf(searchString),value.substr(indexOfFirstColon+1).trim();var value,searchString,indexOfFirstColon}return{response:function(response){return response},responseError:function(response){var data=response.data,unexpectedError="There was an unexpected issue on the server. Please try again";if(500===response.status){var errorMessage=data.error&&data.error.message?getServerError(data.error.message):unexpectedError;showError(errorMessage)}else 409===response.status?(errorMessage=data.error&&data.error.message?getServerError(data.error.message):"Duplicate entry error",showError(errorMessage)):0===response.status?showError("Could not connect to the server. Please check your connection and try again"):405===response.status?showError(unexpectedError):400===response.status?((response.data.error.message.includes("Identifier")||response.data.error.message.includes("Identificador"))&&showError(errorMessage="REGISTRATION_DUPLICATE_ENTRY_ERROR"),showError(errorMessage="REGISTRATION_REQUIRED_FIELD")):403===response.status?(errorMessage=data.error&&data.error.message?data.error.message:unexpectedError,!function(response){if((response.data.error?response.data.error.message:response.data).search("HTTP Status 403 - Session timed out")>0)return!0}(response)?showError(errorMessage):$rootScope.$broadcast("event:auth-loginRequired")):404===response.status&&(_.includes(response.config.url,"implementation_config")||_.includes(response.config.url,"locale_")||_.includes(response.config.url,"offlineMetadata")||showError("The requested information does not exist"));return $q.reject(response)}}}];$httpProvider.interceptors.push(interceptor)}]),Modernizr.addTest("ios",function(){return!!navigator.userAgent.match(/(iPad|iPhone|iPod)/i)}),Modernizr.addTest("windowOS",function(){return-1!=navigator.appVersion.indexOf("Win")}),$(function(){Modernizr.ios&&$(document).on("click","label[for]",function(){var $inputElement=$("input#"+$(this).attr("for")),elementType=$inputElement.attr("type");"radio"===elementType?$inputElement.prop("checked",!0):"checkbox"===elementType?$inputElement.prop("checked",!$inputElement.prop("checked")):$inputElement.focus()})}),Bahmni.Common.Util.DateTimeFormatter={getDateWithoutTime:function(datetime){return datetime?moment(datetime).format("YYYY-MM-DD"):null}},(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.Models=Bahmni.Common.Models||{},angular.module("bahmni.common.models",[]),(Bahmni=Bahmni||{}).Auth=Bahmni.Auth||{},angular.module("authentication",["ui.router"]),Bahmni.Auth.User=function(user){angular.extend(this,user),this.userProperties=user.userProperties||{},this.favouriteObsTemplates=this.userProperties.favouriteObsTemplates?this.userProperties.favouriteObsTemplates.split("###"):[],this.favouriteWards=this.userProperties.favouriteWards?this.userProperties.favouriteWards.split("###"):[],this.recentlyViewedPatients=this.userProperties.recentlyViewedPatients?JSON.parse(this.userProperties.recentlyViewedPatients):[],this.toContract=function(){var user=angular.copy(this);return user.userProperties.favouriteObsTemplates=this.favouriteObsTemplates.join("###"),user.userProperties.favouriteWards=this.favouriteWards.join("###"),user.userProperties.recentlyViewedPatients=JSON.stringify(this.recentlyViewedPatients),delete user.favouriteObsTemplates,delete user.favouriteWards,delete user.recentlyViewedPatients,user},this.addDefaultLocale=function(locale){this.userProperties.defaultLocale=locale},this.addToRecentlyViewed=function(patient,maxPatients){_.some(this.recentlyViewedPatients,{uuid:patient.uuid})||(this.recentlyViewedPatients.unshift({uuid:patient.uuid,name:patient.name,identifier:patient.identifier}),_.size(this.recentlyViewedPatients)>=maxPatients&&(this.recentlyViewedPatients=_.take(this.recentlyViewedPatients,maxPatients)))},this.isFavouriteObsTemplate=function(conceptName){return _.includes(this.favouriteObsTemplates,conceptName)},this.toggleFavoriteObsTemplate=function(conceptName){this.isFavouriteObsTemplate(conceptName)?this.favouriteObsTemplates=_.without(this.favouriteObsTemplates,conceptName):this.favouriteObsTemplates.push(conceptName)},this.isFavouriteWard=function(wardName){return _.includes(this.favouriteWards,wardName)},this.toggleFavoriteWard=function(wardName){this.isFavouriteWard(wardName)?this.favouriteWards=_.without(this.favouriteWards,wardName):this.favouriteWards.push(wardName)}},angular.module("authentication").service("userService",["$rootScope","$http","$q",function($rootScope,$http,$q){this.getUser=function(userName){var deferrable=$q.defer();return function(userName){return $http.get(Bahmni.Common.Constants.userUrl,{method:"GET",params:{username:userName,v:"custom:(username,uuid,person:(uuid,names,display),privileges:(name,retired),userProperties)"},cache:!1})}(userName).success(function(data){deferrable.resolve(data)}).error(function(){deferrable.reject("Unable to get user data")}),deferrable.promise},this.savePreferences=function(){var deferrable=$q.defer(),user=$rootScope.currentUser.toContract();return $http.post(Bahmni.Common.Constants.userUrl+"/"+user.uuid,{uuid:user.uuid,userProperties:user.userProperties},{withCredentials:!0}).then(function(response){$rootScope.currentUser.userProperties=response.data.userProperties,deferrable.resolve()}),deferrable.promise};this.getProviderForUser=function(uuid){var deferrable=$q.defer();return function(uuid){return $http.get(Bahmni.Common.Constants.providerUrl,{method:"GET",params:{user:uuid},cache:!1})}(uuid).success(function(data){if(data.results.length>0){var providerName=data.results[0].display.split("-")[1];data.results[0].name=providerName?providerName.trim():providerName,deferrable.resolve(data)}else deferrable.reject("UNABLE_TO_GET_PROVIDER_DATA")}).error(function(){deferrable.reject("UNABLE_TO_GET_PROVIDER_DATA")}),deferrable.promise},this.getPasswordPolicies=function(){return $http.get(Bahmni.Common.Constants.passwordPolicyUrl,{method:"GET",withCredentials:!0})}}]),angular.module("authentication").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$rootScope","$q",function($rootScope,$q){return{response:function(response){return response},responseError:function(response){return 401===response.status&&$rootScope.$broadcast("event:auth-loginRequired"),$q.reject(response)}}}])}]).run(["$rootScope","$window","$timeout",function($rootScope,$window,$timeout){$rootScope.$on("event:auth-loginRequired",function(){$timeout(function(){$window.location="../home/index.html#/login"})})}]).service("sessionService",["$rootScope","$http","$q","$bahmniCookieStore","userService",function($rootScope,$http,$q,$bahmniCookieStore,userService){var sessionResourcePath=Bahmni.Common.Constants.RESTWS_V1+"/session?v=custom:(uuid)";this.resendOTP=function(username,password){var btoa=username+":"+password;return $http.get(sessionResourcePath+"&resendOTP=true",{headers:{Authorization:"Basic "+window.btoa(btoa)},cache:!1})};var createSession=function(username,password,otp){var deferrable=$q.defer();return destroySessionFromServer().success(function(){(function(username,password,otp){var btoa=otp?username+":"+password+":"+otp:username+":"+password;return $http.get(sessionResourcePath,{headers:{Authorization:"Basic "+window.btoa(btoa)},cache:!1})})(username,password,otp).then(function(response){204==response.status&&deferrable.resolve({firstFactAuthorization:!0}),deferrable.resolve(response.data)},function(response){401==response.status?deferrable.reject("LOGIN_LABEL_WRONG_OTP_MESSAGE_KEY"):410==response.status?deferrable.reject("LOGIN_LABEL_OTP_EXPIRED"):429==response.status&&deferrable.reject("LOGIN_LABEL_MAX_FAILED_ATTEMPTS"),deferrable.reject("LOGIN_LABEL_LOGIN_ERROR_MESSAGE_KEY")})}).error(function(){deferrable.reject("LOGIN_LABEL_LOGIN_ERROR_MESSAGE_KEY")}),deferrable.promise},self=this,destroySessionFromServer=function(){return $http.delete(sessionResourcePath)};this.destroy=function(){var deferrable=$q.defer();return destroySessionFromServer().then(function(){$.cookie(Bahmni.Common.Constants.currentUser,null,{path:"/"}),$.cookie(Bahmni.Common.Constants.currentUser,null,{path:"/"}),$.cookie(Bahmni.Common.Constants.retrospectiveEntryEncounterDateCookieName,null,{path:"/"}),$.cookie(Bahmni.Common.Constants.grantProviderAccessDataCookieName,null,{path:"/"}),$rootScope.currentUser=void 0,deferrable.resolve()}),deferrable.promise},this.loginUser=function(username,password,location,otp){var deferrable=$q.defer();return createSession(username,password,otp).then(function(data){data.authenticated?($bahmniCookieStore.put(Bahmni.Common.Constants.currentUser,username,{path:"/",expires:7}),void 0!=location&&($bahmniCookieStore.remove(Bahmni.Common.Constants.locationCookieName),$bahmniCookieStore.put(Bahmni.Common.Constants.locationCookieName,{name:location.display,uuid:location.uuid},{path:"/",expires:7})),deferrable.resolve(data)):data.firstFactAuthorization?deferrable.resolve(data):deferrable.reject("LOGIN_LABEL_LOGIN_ERROR_MESSAGE_KEY")},function(errorInfo){deferrable.reject(errorInfo)}),deferrable.promise},this.get=function(){return $http.get(sessionResourcePath,{cache:!1})},this.loadCredentials=function(){var deferrable=$q.defer(),currentUser=$bahmniCookieStore.get(Bahmni.Common.Constants.currentUser);return currentUser?(this.getHealthFacilityInfo(),userService.getUser(currentUser).then(function(data){userService.getProviderForUser(data.results[0].uuid).then(function(providers){!_.isEmpty(providers.results)&&function(providers){return _.filter(providers,function(provider){return void 0==provider.retired||"false"==provider.retired}).length>0}(providers.results)?($rootScope.currentUser=new Bahmni.Auth.User(data.results[0]),$rootScope.currentUser.currentLocation=$bahmniCookieStore.get(Bahmni.Common.Constants.locationCookieName).name,$rootScope.$broadcast("event:user-credentialsLoaded",data.results[0]),deferrable.resolve(data.results[0])):(self.destroy(),deferrable.reject("YOU_HAVE_NOT_BEEN_SETUP_PROVIDER"))},function(){self.destroy(),deferrable.reject("COULD_NOT_GET_PROVIDER")})},function(){self.destroy(),deferrable.reject("Could not get roles for the current user.")}),deferrable.promise):(this.destroy().finally(function(){$rootScope.$broadcast("event:auth-loginRequired"),deferrable.reject("No User in session. Please login again.")}),deferrable.promise)},this.getLoginLocationUuid=function(){return $bahmniCookieStore.get(Bahmni.Common.Constants.locationCookieName)?$bahmniCookieStore.get(Bahmni.Common.Constants.locationCookieName).uuid:null},this.changePassword=function(currentUserUuid,oldPassword,newPassword){return $http({method:"POST",url:Bahmni.Common.Constants.passwordUrl,data:{oldPassword:oldPassword,newPassword:newPassword},headers:{"Content-Type":"application/json"}})},this.getHealthFacilityInfo=function(){return $http.get(Bahmni.Common.Constants.globalPropertyUrl,{method:"GET",params:{property:"healthFacility.info"},cache:!0}).success(function(data){$rootScope.healthFacility=data})},this.loadProviders=function(userInfo){return $http.get(Bahmni.Common.Constants.providerUrl,{method:"GET",params:{user:userInfo.uuid},cache:!1}).success(function(data){var providerUuid=data.results.length>0?data.results[0].uuid:void 0;$rootScope.currentProvider={uuid:providerUuid}})}}]).factory("authenticator",["$rootScope","$q","$window","sessionService",function($rootScope,$q,$window,sessionService){return{authenticateUser:function(){var defer=$q.defer();return sessionService.get().then(function(response){response.data.authenticated?defer.resolve():(defer.reject("User not authenticated"),$rootScope.$broadcast("event:auth-loginRequired"))}),defer.promise}}}]).directive("logOut",["sessionService","$window","configurationService","auditLogService",function(sessionService,$window,configurationService,auditLogService){return{link:function(scope,element){element.bind("click",function(){scope.$apply(function(){auditLogService.log(void 0,"USER_LOGOUT_SUCCESS",void 0,"MODULE_LABEL_LOGOUT_KEY").then(function(){sessionService.destroy().then(function(){$window.location="../home/index.html#/login"})})})})}}}]).directive("btnUserInfo",[function(){return{restrict:"CA",link:function(scope,elem){elem.bind("click",function(event){$(this).next().toggleClass("active"),event.stopPropagation()}),$(document).find("body").bind("click",function(){$(elem).next().removeClass("active")})}}}]),angular.module("bahmni.common.appFramework",["authentication"]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.AppFramework=Bahmni.Common.AppFramework||{},angular.module("bahmni.common.appFramework").config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|file):/)}]).service("appService",["$http","$q","sessionService","$rootScope","mergeService","loadConfigService","messagingService","$translate",function($http,$q,sessionService,$rootScope,mergeService,loadConfigService,messagingService,$translate){var currentUser=null,baseUrl=Bahmni.Common.Constants.baseUrl,customUrl=Bahmni.Common.Constants.customUrl,appDescriptor=null,loadConfig=function(url){return loadConfigService.loadConfig(url,appDescriptor.contextPath)},setDefinition=function(baseResultData,customResultData){customResultData&&(_.keys(baseResultData).length>0||_.keys(customResultData.length>0))?appDescriptor.setDefinition(baseResultData,customResultData):_.keys(baseResultData).length>0&&appDescriptor.setDefinition(baseResultData)},setExtensions=function(baseResultData,customResultData){customResultData?appDescriptor.setExtensions(baseResultData,customResultData):appDescriptor.setExtensions(baseResultData)},setDefaultPageConfig=function(pageName,baseResultData,customResultData){customResultData&&(_.keys(customResultData).length>0||_.keys(baseResultData).length>0)?appDescriptor.addConfigForPage(pageName,baseResultData,customResultData):_.keys(baseResultData).length>0&&appDescriptor.addConfigForPage(pageName,baseResultData)};this.getAppDescriptor=function(){return appDescriptor},this.configBaseUrl=function(){return baseUrl},this.loadCsvFileFromConfig=function(name){return loadConfig(baseUrl+appDescriptor.contextPath+"/"+name)},this.loadConfig=function(name,shouldMerge){return loadConfig(baseUrl+appDescriptor.contextPath+"/"+name).then(function(baseResponse){return baseResponse.data.shouldOverRideConfig?loadConfig(customUrl+appDescriptor.contextPath+"/"+name).then(function(customResponse){return shouldMerge||void 0===shouldMerge?mergeService.merge(baseResponse.data,customResponse.data):[baseResponse.data,customResponse.data]},function(){return baseResponse.data}):baseResponse.data})},this.loadMandatoryConfig=function(path){return $http.get(path)},this.getAppName=function(){return this.appName},this.checkPrivilege=function(privilegeName){return function(privilegeName){return _.some(currentUser.privileges,{name:privilegeName})}(privilegeName)?$q.when(!0):(messagingService.showMessage("error",$translate.instant(Bahmni.Common.Constants.privilegeRequiredErrorMessage)+" [Privileges required: "+privilegeName+"]"),$q.reject())},this.initApp=function(appName,options,extensionFileSuffix,configPages){this.appName=appName;var appLoader=$q.defer(),extensionFileName=extensionFileSuffix&&"default"!==extensionFileSuffix.toLowerCase()?"/extension-"+extensionFileSuffix+".json":"/extension.json",promises=[],opts=options||{app:!0,extension:!0},inheritAppContext=!opts.inherit||opts.inherit;appDescriptor=new Bahmni.Common.AppFramework.AppDescriptor(appName,inheritAppContext,function(){return currentUser},mergeService);var loadCredentialsPromise=sessionService.loadCredentials(),loadProviderPromise=loadCredentialsPromise.then(sessionService.loadProviders);return promises.push(loadCredentialsPromise),promises.push(loadProviderPromise),opts.extension&&promises.push(function(appDescriptor,extensionFileName){var deferrable=$q.defer();return loadConfig(baseUrl+appDescriptor.extensionPath+extensionFileName).then(function(baseResult){baseResult.data.shouldOverRideConfig?loadConfig(customUrl+appDescriptor.extensionPath+extensionFileName).then(function(customResult){setExtensions(baseResult.data,customResult.data),deferrable.resolve(appDescriptor)},function(){setExtensions(baseResult.data),deferrable.resolve(appDescriptor)}):(setExtensions(baseResult.data),deferrable.resolve(appDescriptor))},function(error){404!==error.status?deferrable.reject(error):deferrable.resolve(appDescriptor)}),deferrable.promise}(appDescriptor,extensionFileName)),opts.template&&promises.push(function(appDescriptor){var deferrable=$q.defer();return loadConfig(baseUrl+appDescriptor.contextPath+"/appTemplate.json").then(function(result){_.keys(result.data).length>0&&appDescriptor.setTemplate(result.data),deferrable.resolve(appDescriptor)},function(error){404!==error.status?deferrable.reject(error):deferrable.resolve(appDescriptor)}),deferrable.promise}(appDescriptor)),opts.app&&promises.push(function(appDescriptor){var deferrable=$q.defer();return loadConfig(baseUrl+appDescriptor.contextPath+"/app.json").then(function(baseResult){baseResult.data.shouldOverRideConfig?loadConfig(customUrl+appDescriptor.contextPath+"/app.json").then(function(customResult){setDefinition(baseResult.data,customResult.data),deferrable.resolve(appDescriptor)},function(){setDefinition(baseResult.data),deferrable.resolve(appDescriptor)}):(setDefinition(baseResult.data),deferrable.resolve(appDescriptor))},function(error){404!==error.status?deferrable.reject(error):deferrable.resolve(appDescriptor)}),deferrable.promise}(appDescriptor)),_.isEmpty(configPages)||configPages.forEach(function(configPage){promises.push(function(pageName,appDescriptor){var deferrable=$q.defer();return loadConfig(baseUrl+appDescriptor.contextPath+"/"+pageName+".json").then(function(baseResult){baseResult.data.shouldOverRideConfig?loadConfig(customUrl+appDescriptor.contextPath+"/"+pageName+".json").then(function(customResult){setDefaultPageConfig(pageName,baseResult.data,customResult.data),deferrable.resolve(appDescriptor)},function(){setDefaultPageConfig(pageName,baseResult.data),deferrable.resolve(appDescriptor)}):(setDefaultPageConfig(pageName,baseResult.data),deferrable.resolve(appDescriptor))},function(error){404!==error.status?(messagingService.showMessage("error","Incorrect Configuration:  "+error.message),deferrable.reject(error)):deferrable.resolve(appDescriptor)}),deferrable.promise}(configPage,appDescriptor))}),$q.all(promises).then(function(results){currentUser=results[0],appLoader.resolve(appDescriptor),$rootScope.$broadcast("event:appExtensions-loaded")},function(errors){appLoader.reject(errors)}),appLoader.promise}}]),angular.module("bahmni.common.appFramework").service("mergeService",[function(){this.merge=function(base,custom){var mergeResult=$.extend(!0,{},base,custom);return deleteNullValuedKeys(mergeResult)};var deleteNullValuedKeys=function(currentObject){return _.forOwn(currentObject,function(value,key){(_.isUndefined(value)||_.isNull(value)||_.isNaN(value)||_.isObject(value)&&_.isNull(deleteNullValuedKeys(value)))&&delete currentObject[key]}),currentObject}}]),angular.module("bahmni.common.appFramework").directive("appExtensionList",["appService",function(appService){var appDescriptor=appService.getAppDescriptor();return{restrict:"EA",template:'<ul><li ng-repeat="appExtn in appExtensions"><a href="{{formatUrl(appExtn.url, extnParams)}}" class="{{appExtn.icon}}"  onclick="return false;" title="{{appExtn.label}}" ng-click="extnLinkClick(appExtn, extnParams)"> <span ng-show="showLabel">{{appExtn.label}}</span></a></li></ul>',scope:{extnPointId:"@",showLabel:"@",onExtensionClick:"&",contextModel:"&"},compile:function(cElement,cAttrs){var extnList=appDescriptor.getExtensions(cAttrs.extnPointId);return function(scope){scope.appExtensions=extnList;var model=scope.contextModel();scope.extnParams=model||{}}},controller:function($scope,$location){$scope.formatUrl=appDescriptor.formatUrl,$scope.extnLinkClick=function(extn,params){var proceedWithDefault=!0,clickHandler=$scope.onExtensionClick(),target=appDescriptor.formatUrl(extn.url,params);clickHandler&&clickHandler({src:extn,target:target,params:params,preventDefault:function(){proceedWithDefault=!1}});proceedWithDefault&&$location.url(target)}}}}]),Bahmni.Common.AppFramework.AppDescriptor=function(context,inheritContext,retrieveUserCallback,mergeService){this.id=null,this.instanceOf=null,this.description=null,this.contextModel=null,this.baseExtensionPoints=[],this.customExtensionPoints=[],this.baseExtensions={},this.customExtensions={},this.customConfigs={},this.baseConfigs={},this.extensionPath=context,this.contextPath=inheritContext?context.split("/")[0]:context;var self=this,setExtensionPointsFromExtensions=function(currentExtensions,currentExtensionPoints){_.values(currentExtensions).forEach(function(extn){extn&&(0===self[currentExtensionPoints].filter(function(ep){return ep.id===extn.extensionPointId}).length&&self[currentExtensionPoints].push({id:extn.extensionPointId,description:extn.description}))})};this.setExtensions=function(baseExtensions,customExtensions){customExtensions&&(setExtensionPointsFromExtensions(customExtensions,"customExtensionPoints"),self.customExtensions=customExtensions),self.baseExtensions=baseExtensions,setExtensionPointsFromExtensions(baseExtensions,"baseExtensionPoints")},this.setTemplate=function(template){self.instanceOf=template.id,self.description=self.description||template.description,self.contextModel=self.contextModel||template.contextModel,template.configOptions&&_.values(template.configOptions).forEach(function(opt){var existing=self.configs.filter(function(cfg){return cfg.name===opt.name});existing.length>0?existing[0].description=opt.description:self.configs.push({name:opt.name,description:opt.description,value:opt.defaultValue})})};var setConfig=function(instance,currentConfig){for(var configName in instance.config){var existingConfig=getConfig(self[currentConfig],configName);existingConfig?existingConfig.value=instance.config[configName]:self[currentConfig][configName]={name:configName,value:instance.config[configName]}}},setDefinitionExtensionPoints=function(extensionPoints,currentExtensionPoints){extensionPoints&&extensionPoints.forEach(function(iep){iep&&(0===self[currentExtensionPoints].filter(function(ep){return ep.id===iep.id}).length&&self[currentExtensionPoints].push(iep))})};this.setDefinition=function(baseInstance,customInstance){self.instanceOf=customInstance&&customInstance.instanceOf?customInstance.instanceOf:baseInstance.instanceOf,self.id=customInstance&&customInstance.id?customInstance.id:baseInstance.id,self.description=customInstance&&customInstance.description?customInstance.description:baseInstance.description,self.contextModel=customInstance&&customInstance.contextModel?customInstance.contextModel:baseInstance.contextModel,setDefinitionExtensionPoints(baseInstance.extensionPoints,"baseExtensionPoints"),setConfig(baseInstance,"baseConfigs"),customInstance&&(setDefinitionExtensionPoints(customInstance.extensionPoints,"customExtensionPoints"),setConfig(customInstance,"customConfigs"))};var getExtensions=function(extPointId,type,extensions){var currentUser=retrieveUserCallback(),currentExtensions=_.values(extensions);if(currentUser&&currentExtensions){var extnType=type||"all",userPrivileges=currentUser.privileges.map(function(priv){return priv.retired?"":priv.name}),appsExtns=currentExtensions.filter(function(extn){return("all"===extnType||extn.type===extnType)&&extn.extensionPointId===extPointId&&(!extn.requiredPrivilege||userPrivileges.indexOf(extn.requiredPrivilege)>=0)});return appsExtns.sort(function(extn1,extn2){return extn1.order-extn2.order}),appsExtns}};this.getExtensions=function(extPointId,type,shouldMerge){if(shouldMerge||void 0===shouldMerge){var mergedExtensions=mergeService.merge(self.baseExtensions,self.customExtensions);return getExtensions(extPointId,type,mergedExtensions)}return[getExtensions(extPointId,type,self.baseExtensions),getExtensions(extPointId,type,self.customExtensions)]},this.getExtensionById=function(id,shouldMerge){return shouldMerge||void 0===shouldMerge?_.values(mergeService.merge(self.baseExtensions,self.customExtensions)).filter(function(extn){return extn.id===id})[0]:[self.baseExtensions.filter(function(extn){return extn.id===id})[0],self.customExtensions.filter(function(extn){return extn.id===id})[0]]};var getConfig=function(config,configName){var cfgList=_.values(config).filter(function(cfg){return cfg.name===configName});return cfgList.length>0?cfgList[0]:null};this.getConfig=function(configName,shouldMerge){return shouldMerge||void 0===shouldMerge?getConfig(mergeService.merge(self.baseConfigs,self.customConfigs),configName):[getConfig(self.baseConfigs,configName),getConfig(self.customConfigs,configName)]},this.getConfigValue=function(configName,shouldMerge){var config=this.getConfig(configName,shouldMerge);return shouldMerge||void 0===shouldMerge?config?config.value:null:config},this.formatUrl=function(url,options,useQueryParams){var matches=url.match(/{{([^}]*)}}/g),replacedString=url,checkQueryParams=useQueryParams||!1,queryParameters=this.parseQueryParams();return matches&&matches.forEach(function(el){var key=el.replace("{{","").replace("}}",""),value=options[key];value||!0!==checkQueryParams||(value=queryParameters[key]||null),replacedString=replacedString.replace(el,value)}),replacedString.trim()},this.parseQueryParams=function(locationSearchString){var urlParams,match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},queryString=locationSearchString||window.location.search.substring(1);for(urlParams={};match=search.exec(queryString);)urlParams[decode(match[1])]=decode(match[2]);return urlParams},this.addConfigForPage=function(pageName,baseConfig,customConfig){self.basePageConfigs=self.basePageConfigs||{},self.basePageConfigs[pageName]=baseConfig,self.customPageConfigs=self.customPageConfigs||{},self.customPageConfigs[pageName]=customConfig},this.getConfigForPage=function(pageName,shouldMerge){return shouldMerge||void 0===shouldMerge?mergeService.merge(self.basePageConfigs[pageName],self.customPageConfigs[pageName]):[_.values(self.basePageConfigs[pageName]),_.values(self.customPageConfigs[pageName])]}},angular.module("bahmni.common.appFramework").service("loadConfigService",["$http",function($http){this.loadConfig=function(url){return $http.get(url,{withCredentials:!0})}}]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.DisplayControl=Bahmni.Common.DisplayControl||{},Bahmni.Common.DisplayControl.PatientProfile=Bahmni.Common.DisplayControl.PatientProfile||{},angular.module("bahmni.common.displaycontrol.patientprofile",[]),angular.module("bahmni.common.displaycontrol.patientprofile").filter("titleCase",function(){return function(input){return(input=input||"").replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}}),angular.module("bahmni.common.config",[]),angular.module("bahmni.common.config").service("configurations",["configurationService",function(configurationService){this.configs={},this.load=function(configNames){var self=this;return configurationService.getConfigurations(_.difference(configNames,Object.keys(this.configs))).then(function(configurations){angular.extend(self.configs,configurations)})},this.dosageInstructionConfig=function(){return this.configs.dosageInstructionConfig||[]},this.stoppedOrderReasonConfig=function(){return this.configs.stoppedOrderReasonConfig||[]},this.dosageFrequencyConfig=function(){return this.configs.dosageFrequencyConfig||[]},this.allTestsAndPanelsConcept=function(){return this.configs.allTestsAndPanelsConcept.results[0]||[]},this.impressionConcept=function(){return this.configs.radiologyImpressionConfig.results[0]||[]},this.labOrderNotesConcept=function(){return this.configs.labOrderNotesConfig.results[0]||[]},this.consultationNoteConcept=function(){return this.configs.consultationNoteConfig.results[0]||[]},this.whoStageConcept=function(){return this.configs.whoStageConfig.results[0]||[]},this.patientConfig=function(){return this.configs.patientConfig||{}},this.encounterConfig=function(){return angular.extend(new EncounterConfig,this.configs.encounterConfig||[])},this.patientAttributesConfig=function(){return this.configs.patientAttributesConfig.results},this.identifierTypesConfig=function(){return this.configs.identifierTypesConfig},this.genderMap=function(){return this.configs.genderMap},this.addressLevels=function(){return this.configs.addressLevels},this.relationshipTypes=function(){return this.configs.relationshipTypeConfig.results||[]},this.relationshipTypeMap=function(){return this.configs.relationshipTypeMap||{}},this.loginLocationToVisitTypeMapping=function(){return this.configs.loginLocationToVisitTypeMapping||{}},this.defaultEncounterType=function(){return this.configs.defaultEncounterType}}]),angular.module("bahmni.common.config").directive("showIfPrivilege",["$rootScope",function($rootScope){return{scope:{showIfPrivilege:"@"},link:function(scope,element){var privileges=scope.showIfPrivilege.split(","),requiredPrivilege=!1;if($rootScope.currentUser){var allTypesPrivileges=_.map($rootScope.currentUser.privileges,_.property("name"));requiredPrivilege=_.intersectionWith(allTypesPrivileges,privileges,_.isEqual).length>0}requiredPrivilege||element.hide()}}}]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.Domain=Bahmni.Common.Domain||{},Bahmni.Common.Domain.Helper=Bahmni.Common.Domain.Helper||{},angular.module("bahmni.common.domain",[]),angular.module("bahmni.common.domain").factory("locationService",["$http","$bahmniCookieStore",function($http,$bahmniCookieStore){var getByUuid=function(locationUuid){return $http.get(Bahmni.Common.Constants.locationUrl+"/"+locationUuid,{cache:!0}).then(function(response){return response.data})};return{getAllByTag:function(tags,operator){return $http.get(Bahmni.Common.Constants.locationUrl,{params:{s:"byTags",tags:tags||"",v:"default",operator:operator||"ALL"},cache:!0})},getLoggedInLocation:function(){var cookie=$bahmniCookieStore.get(Bahmni.Common.Constants.locationCookieName);return getByUuid(cookie.uuid)},getByUuid:getByUuid,getVisitLocation:function(locationUuid){return $http.get(Bahmni.Common.Constants.bahmniVisitLocationUrl+"/"+locationUuid,{headers:{Accept:"application/json"}})}}}]),angular.module("bahmni.common.domain").factory("configurationService",["$http","$q",function($http,$q){var configurationFunctions={encounterConfig:function(){return $http.get(Bahmni.Common.Constants.encounterConfigurationUrl,{params:{callerContext:"REGISTRATION_CONCEPTS"},withCredentials:!0})},patientConfig:function(){return $http.get(Bahmni.Common.Constants.patientConfigurationUrl,{withCredentials:!0})},patientAttributesConfig:function(){return $http.get(Bahmni.Common.Constants.personAttributeTypeUrl,{params:{v:"custom:(uuid,name,sortWeight,description,format,concept)"},withCredentials:!0})},dosageFrequencyConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name,answers)",name:Bahmni.Common.Constants.dosageFrequencyConceptName},withCredentials:!0})},dosageInstructionConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name,answers)",name:Bahmni.Common.Constants.dosageInstructionConceptName},withCredentials:!0})},stoppedOrderReasonConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name,answers)",name:Bahmni.Common.Constants.stoppedOrderReasonConceptName},withCredentials:!0})},consultationNoteConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name,answers)",name:Bahmni.Common.Constants.consultationNoteConceptName},withCredentials:!0})},whoStageConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name,answers,setMembers)",name:Bahmni.Common.Constants.whoStageConceptName},withCredentials:!0})},radiologyObservationConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name)",name:Bahmni.Common.Constants.radiologyResultConceptName},withCredentials:!0})},labOrderNotesConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name)",name:Bahmni.Common.Constants.labOrderNotesConcept},withCredentials:!0})},defaultEncounterType:function(){return $http.get(Bahmni.Common.Constants.globalPropertyUrl,{params:{property:"bahmni.encounterType.default"},withCredentials:!0,transformResponse:[function(data){return data}]})},radiologyImpressionConfig:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name)",name:Bahmni.Common.Constants.impressionConcept},withCredentials:!0})},addressLevels:function(){return $http.get(Bahmni.Common.Constants.openmrsUrl+"/module/addresshierarchy/ajax/getOrderedAddressHierarchyLevels.form",{withCredentials:!0})},allTestsAndPanelsConcept:function(){return $http.get(Bahmni.Common.Constants.conceptSearchByFullNameUrl,{method:"GET",params:{v:"custom:(uuid,name:(uuid,name),setMembers:(uuid,name:(uuid,name)))",name:Bahmni.Common.Constants.allTestsAndPanelsConceptName},withCredentials:!0})},identifierTypesConfig:function(){return $http.get(Bahmni.Common.Constants.idgenConfigurationURL,{withCredentials:!0})},genderMap:function(){return $http.get(Bahmni.Common.Constants.globalPropertyUrl,{method:"GET",params:{property:"mrs.genders"},withCredentials:!0})},relationshipTypeMap:function(){return $http.get(Bahmni.Common.Constants.globalPropertyUrl,{method:"GET",params:{property:"bahmni.relationshipTypeMap"},withCredentials:!0})},relationshipTypeConfig:function(){return $http.get(Bahmni.Common.Constants.relationshipTypesUrl,{withCredentials:!0,params:{v:"custom:(aIsToB,bIsToA,uuid)"}})},loginLocationToVisitTypeMapping:function(){var url=Bahmni.Common.Constants.entityMappingUrl;return $http.get(url,{params:{mappingType:"loginlocation_visittype",s:"byEntityAndMappingType"}})},enableAuditLog:function(){return $http.get(Bahmni.Common.Constants.globalPropertyUrl,{method:"GET",params:{property:"bahmni.enableAuditLog"},withCredentials:!0})}},existingPromises={},configurations={};return{getConfigurations:function(configurationNames){var configurationsPromiseDefer=$q.defer(),promises=[];return configurationNames.forEach(function(configurationName){existingPromises[configurationName]||(existingPromises[configurationName]=configurationFunctions[configurationName]().then(function(response){configurations[configurationName]=response.data}),promises.push(existingPromises[configurationName]))}),$q.all(promises).then(function(){configurationsPromiseDefer.resolve(configurations)}),configurationsPromiseDefer.promise}}}]),angular.module("bahmni.common.domain").factory("providerService",["$http",function($http){return{search:function(fieldValue){return $http.get(Bahmni.Common.Constants.providerUrl,{method:"GET",params:{q:fieldValue,v:"full"},withCredentials:!0})},searchByUuid:function(uuid){return $http.get(Bahmni.Common.Constants.providerUrl,{method:"GET",params:{user:uuid},cache:!1})},list:function(params){return $http.get(Bahmni.Common.Constants.providerUrl,{method:"GET",cache:!1,params:params})}}}]),angular.module("bahmni.common.uiHelper",["ngClipboard"]),angular.module("bahmni.common.uiHelper").factory("spinner",["messagingService","$timeout",function(messagingService,$timeout){var tokens=[],topLevelDiv=function(element){return $(element).find("div").eq(0)},show=function(element){return void 0!==element?function(element){return 0===$(element).find(".dashboard-section-loader").length&&topLevelDiv(element).addClass("spinnable").append('<div class="dashboard-section-loader"></div>'),{element:$(element).find(".dashboard-section-loader")}}(element):function(){var token=Math.random();tokens.push(token),0===$("#overlay").length&&$("body").prepend('<div id="overlay"><div></div></div>');var spinnerElement=$("#overlay");return spinnerElement.stop().show(),{element:spinnerElement,token:token}}()},hide=function(spinner,parentElement){var spinnerElement=spinner.element;spinner.token?(_.pull(tokens,spinner.token),0===tokens.length&&spinnerElement.fadeOut(300)):(topLevelDiv(parentElement).removeClass("spinnable"),spinnerElement&&spinnerElement.remove())};return{forPromise:function(promise,element){return $timeout(function(){var spinner=show(element);return promise.finally(function(){hide(spinner,element)}),promise})},forAjaxPromise:function(promise,element){var spinner=show(element);return promise.always(function(){hide(spinner,element)}),promise},show:show,hide:hide}}]),angular.module("bahmni.common.uiHelper").factory("printer",["$rootScope","$compile","$http","$timeout","$q","spinner",function($rootScope,$compile,$http,$timeout,$q,spinner){var printHtml=function(html){var deferred=$q.defer(),hiddenFrame=$('<iframe style="visibility: hidden"></iframe>').appendTo("body")[0];hiddenFrame.contentWindow.printAndRemove=function(){hiddenFrame.contentWindow.print(),$(hiddenFrame).remove(),deferred.resolve()};var htmlContent='<!doctype html><html><body onload="printAndRemove();">'+html+"</body></html>",doc=hiddenFrame.contentWindow.document.open("text/html","replace");return doc.write(htmlContent),doc.close(),deferred.promise};return{print:function(templateUrl,data){$rootScope.isBeingPrinted=!0,$http.get(templateUrl).then(function(templateData){var template=templateData.data,printScope=$rootScope.$new();angular.extend(printScope,data);var element=$compile($("<div>"+template+"</div>"))(printScope),renderAndPrintPromise=$q.defer(),waitForRenderAndPrint=function(){return printScope.$$phase||$http.pendingRequests.length?$timeout(waitForRenderAndPrint,1e3):(printHtml(element.html()).then(function(){$rootScope.isBeingPrinted=!1,renderAndPrintPromise.resolve()}),printScope.$destroy()),renderAndPrintPromise.promise};spinner.forPromise(waitForRenderAndPrint())})},printFromScope:function(templateUrl,scope,afterPrint){$rootScope.isBeingPrinted=!0,$http.get(templateUrl).then(function(response){var template=response.data,printScope=scope,element=$compile($("<div>"+template+"</div>"))(printScope),renderAndPrintPromise=$q.defer(),waitForRenderAndPrint=function(){return printScope.$$phase||$http.pendingRequests.length?$timeout(waitForRenderAndPrint):printHtml(element.html()).then(function(){$rootScope.isBeingPrinted=!1,afterPrint&&afterPrint(),renderAndPrintPromise.resolve()}),renderAndPrintPromise.promise};spinner.forPromise(waitForRenderAndPrint())})}}}]),angular.module("bahmni.common.uiHelper").service("backlinkService",["$window",function($window){var self=this,urls=[];self.reset=function(){urls=[]},self.setUrls=function(backLinks){self.reset(),angular.forEach(backLinks,function(backLink){self.addUrl(backLink)})},self.addUrl=function(backLink){urls.push(backLink)},self.addBackUrl=function(label){var backLabel=label||"Back";urls.push({label:backLabel,action:$window.history.back})},self.getUrlByLabel=function(label){return urls.filter(function(url){return url.label===label})},self.getAllUrls=function(){return urls}}]),angular.module("bahmni.common.uiHelper").service("stateChangeSpinner",["$rootScope","spinner",function($rootScope,spinner){var showSpinner=function(event,toState){toState.spinnerToken=spinner.show()},hideSpinner=function(event,toState){spinner.hide(toState.spinnerToken)};this.activate=function(){$rootScope.$on("$stateChangeStart",showSpinner),$rootScope.$on("$stateChangeSuccess",hideSpinner),$rootScope.$on("$stateChangeError",hideSpinner)}}]),angular.module("bahmni.common.uiHelper").directive("bmBackLinks",function(){return{template:'<ul><li ng-repeat="backLink in backLinks"><a class="back-btn" ng-if="backLink.action" accesskey="{{backLink.accessKey}}" ng-click="closeAllDialogs();backLink.action()" id="{{backLink.id}}"> <span ng-bind-html="backLink.label"></span> </a><a class="back-btn" ng-class="{\'dashboard-link\':backLink.image}" ng-if="backLink.url" accesskey="{{backLink.accessKey}}" ng-href="{{backLink.url}}" ng-click="closeAllDialogs()" id="{{backLink.id}}"  title="{{backLink.title}}"> <img ng-if="backLink.image" ng-src="{{backLink.image}}" onerror="this.onerror=null; this.src=\'../images/blank-user.gif\'"/><i ng-if="backLink.icon && !backLink.image" class="fa {{backLink.icon}}"></i></a><a class="back-btn" ng-if="backLink.state && !backLink.text" accesskey="{{backLink.accessKey}}" ui-sref="{{backLink.state}}" ng-click="closeAllDialogs()" id="{{backLink.id}}"><i ng-if="backLink.icon" class="fa {{backLink.icon}}"></i></a><a ng-if="backLink.text && backLink.requiredPrivilege" show-if-privilege="{{backLink.requiredPrivilege}}" accesskey="{{backLink.accessKey}}" ui-sref="{{backLink.state}}" id="{{backLink.id}}" class="back-btn-noIcon" ui-sref-active="active"><span>{{backLink.text | translate}}</span>        </a><a ng-if="backLink.text && !backLink.requiredPrivilege" accesskey="{{backLink.accessKey}}" ui-sref="{{backLink.state}}" id="{{backLink.id}}" class="back-btn-noIcon" ui-sref-active="active"><span>{{backLink.text | translate}}</span>        </a></li></ul>',controller:function($scope,backlinkService){$scope.backLinks=backlinkService.getAllUrls(),$scope.$on("$stateChangeSuccess",function(event,state){state.data&&state.data.backLinks&&(backlinkService.setUrls(state.data.backLinks),$scope.backLinks=backlinkService.getAllUrls())}),$scope.$on("$destroy",function(){window.onbeforeunload=void 0})},restrict:"E"}}),angular.module("bahmni.common.uiHelper").controller("MessageController",["$scope","messagingService",function($scope,messagingService){$scope.messages=messagingService.messages,$scope.getMessageText=function(level){var string="";return $scope.messages[level].forEach(function(message){string=string.concat(message.value)}),string},$scope.hideMessage=function(level){messagingService.hideMessages(level)},$scope.isErrorMessagePresent=function(){return $scope.messages.error.length>0},$scope.isInfoMessagePresent=function(){return $scope.messages.info.length>0}}]),angular.module("bahmni.common.uiHelper").service("messagingService",["$rootScope","$timeout",function($rootScope,$timeout){this.messages={error:[],info:[]};var self=this;$rootScope.$on("event:serverError",function(event,errorMessage){self.showMessage("error",errorMessage,"serverError")}),this.showMessage=function(level,message,errorEvent){var messageObject={value:"",isServerError:!1};messageObject.value=message,errorEvent?messageObject.isServerError=!0:"info"==level&&this.createTimeout("info",4e3);var index=_.findIndex(this.messages[level],function(msg){return msg.value==messageObject.value});index>=0&&this.messages[level].splice(index,1),this.messages[level].push(messageObject)},this.createTimeout=function(level,time){$timeout(function(){self.messages[level]=[]},time,!0)},this.hideMessages=function(level){self.messages[level].length=0},this.clearAll=function(){self.messages.error=[],self.messages.info=[]}}]),angular.module("bahmni.common.uiHelper").service("confirmBox",["$rootScope","ngDialog",function($rootScope,ngDialog){var dialog;return function(config){var confirmBoxScope=$rootScope.$new();confirmBoxScope.close=function(){ngDialog.close(dialog.id),confirmBoxScope.$destroy()},confirmBoxScope.scope=config.scope,confirmBoxScope.actions=config.actions,dialog=ngDialog.open({template:"../common/ui-helper/views/confirmBox.html",scope:confirmBoxScope,className:config.className||"ngdialog-theme-default"})}}]),angular.module("bahmni.common.uiHelper").directive("bahmniAutocomplete",["$translate",function($translate){return{link:function(scope,element,attrs,ngModelCtrl){var source=scope.source(),responseMap=scope.responseMap&&scope.responseMap(),onSelect=scope.onSelect(),onEdit=scope.onEdit&&scope.onEdit(),minLength=scope.minLength||2,formElement=element[0],validationMessage=scope.validationMessage||$translate.instant("SELECT_VALUE_FROM_AUTOCOMPLETE_DEFAULT_MESSAGE"),validateIfNeeded=function(value){scope.strictSelect&&(scope.isInvalid=value!==scope.selectedValue,_.isEmpty(value)&&(scope.isInvalid=!1))};scope.$watch("initialValue",function(){scope.initialValue&&(scope.selectedValue=scope.initialValue,scope.isInvalid=!1)}),element.autocomplete({autofocus:!0,minLength:minLength,source:function(request,response){source({elementId:attrs.id,term:request.term,elementType:attrs.type}).then(function(data){var results=responseMap?responseMap(data):data;response(results)})},select:function(event,ui){return scope.selectedValue=ui.item.value,ngModelCtrl.$setViewValue(ui.item.value),null!=onSelect&&onSelect(ui.item),validateIfNeeded(ui.item.value),scope.blurOnSelect&&element.blur(),scope.$apply(),scope.$eval(attrs.ngDisabled),scope.$apply(),!0},search:function(event,ui){null!=onEdit&&onEdit(ui.item);var searchTerm=$.trim(element.val());validateIfNeeded(searchTerm),searchTerm.length<minLength&&event.preventDefault()}});var changeHanlder=function(e){validateIfNeeded(element.val())},keyUpHandler=function(e){validateIfNeeded(element.val()),scope.$apply()};element.on("change",changeHanlder),element.on("keyup",keyUpHandler),scope.$watch("isInvalid",function(){ngModelCtrl.$setValidity("selection",!scope.isInvalid),formElement.setCustomValidity(scope.isInvalid?validationMessage:"")}),scope.$on("$destroy",function(){element.off("change",changeHanlder),element.off("keyup",keyUpHandler)})},require:"ngModel",scope:{source:"&",responseMap:"&?",onSelect:"&",onEdit:"&?",minLength:"=?",blurOnSelect:"=?",strictSelect:"=?",validationMessage:"@",isInvalid:"=?",initialValue:"=?"}}}]),angular.module("bahmni.common.uiHelper").filter("days",function(){return function(startDate,endDate){return Bahmni.Common.Util.DateUtil.diffInDays(startDate,endDate)}}).filter("bahmniDateTime",function(){return function(date){return Bahmni.Common.Util.DateUtil.formatDateWithTime(date)}}).filter("bahmniDate",function(){return function(date){return Bahmni.Common.Util.DateUtil.formatDateWithoutTime(date)}}).filter("bahmniTime",function(){return function(date){return Bahmni.Common.Util.DateUtil.formatTime(date)}}).filter("bahmniDateInStrictMode",function(){return function(date){return Bahmni.Common.Util.DateUtil.formatDateInStrictMode(date)}}),angular.module("bahmni.common.patient",[]),Bahmni.PatientMapper=function(patientConfig,$rootScope,$translate){this.patientConfig=patientConfig,this.map=function(openmrsPatient){var patient=this.mapBasic(openmrsPatient);return this.mapAttributes(patient,openmrsPatient.person.attributes),patient},this.mapBasic=function(openmrsPatient){var patient={},DateUtil=Bahmni.Common.Util.DateUtil,birthDate=Bahmni.Common.Util.DateUtil.parseServerDateToDate(openmrsPatient.person.birthdate),age=DateUtil.diffInYearsMonthsDays(birthDate,DateUtil.now());if(patient.uuid=openmrsPatient.uuid,patient.givenName=openmrsPatient.person.preferredName.givenName,patient.familyName=null===openmrsPatient.person.preferredName.familyName?"":openmrsPatient.person.preferredName.familyName,patient.name=patient.givenName+" "+patient.familyName,patient.age=openmrsPatient.person.age,patient.ageText=calculateAge(birthDate),patient.ageDays=age.days,patient.ageMonths=age.months,patient.gender=openmrsPatient.person.gender,patient.genderText=mapGenderText(patient.gender),patient.address=mapAddress(openmrsPatient.person.preferredAddress),patient.birthdateEstimated=openmrsPatient.person.birthdateEstimated,patient.birthtime=Bahmni.Common.Util.DateUtil.parseServerDateToDate(openmrsPatient.person.birthtime),patient.bloodGroupText=getPatientBloodGroupText(openmrsPatient),openmrsPatient.identifiers){var primaryIdentifier=openmrsPatient.identifiers[0].primaryIdentifier;patient.identifier=primaryIdentifier||openmrsPatient.identifiers[0].identifier}return openmrsPatient.person.birthdate&&(patient.birthdate=parseDate(openmrsPatient.person.birthdate)),openmrsPatient.person.personDateCreated&&(patient.registrationDate=parseDate(openmrsPatient.person.personDateCreated)),patient.image=Bahmni.Common.Constants.patientImageUrlByPatientUuid+openmrsPatient.uuid,patient},this.getPatientConfigByUuid=function(patientConfig,attributeUuid){return this.patientConfig.personAttributeTypes?patientConfig.personAttributeTypes.filter(function(item){return item.uuid===attributeUuid})[0]:{}},this.mapAttributes=function(patient,attributes){var self=this;this.patientConfig&&attributes.forEach(function(attribute){var x=self.getPatientConfigByUuid(patientConfig,attribute.attributeType.uuid);patient[x.name]={label:x.description,value:attribute.value,isDateField:checkIfDateField(x)}})};var calculateAge=function(birthDate){var DateUtil=Bahmni.Common.Util.DateUtil,age=DateUtil.diffInYearsMonthsDays(birthDate,DateUtil.now()),ageInString="";return age.years&&(ageInString+=age.years+" <span> "+$translate.instant("CLINICAL_YEARS_TRANSLATION_KEY")+" </span>"),age.months&&(ageInString+=age.months+"<span>  "+$translate.instant("CLINICAL_MONTHS_TRANSLATION_KEY")+" </span>"),age.days&&(ageInString+=age.days+"<span>  "+$translate.instant("CLINICAL_DAYS_TRANSLATION_KEY")+" </span>"),ageInString},mapAddress=function(preferredAddress){return preferredAddress?{address1:preferredAddress.address1,address2:preferredAddress.address2,address3:preferredAddress.address3,cityVillage:preferredAddress.cityVillage,countyDistrict:null===preferredAddress.countyDistrict?"":preferredAddress.countyDistrict,stateProvince:preferredAddress.stateProvince}:{}},parseDate=function(dateStr){return dateStr?Bahmni.Common.Util.DateUtil.parse(dateStr.substr(0,10)):dateStr},mapGenderText=function(genderChar){return null==genderChar?null:"<span>"+$translate.instant($rootScope.genderMap[angular.uppercase(genderChar)])+"</span>"},getPatientBloodGroupText=function(openmrsPatient){if(openmrsPatient.person.bloodGroup)return"<span>"+openmrsPatient.person.bloodGroup+"</span>";var bloodGroup;if(openmrsPatient.person.attributes&&openmrsPatient.person.attributes.length>0&&(_.forEach(openmrsPatient.person.attributes,function(attribute){"bloodGroup"==attribute.attributeType.display&&(bloodGroup=attribute.display)}),bloodGroup))return"<span>"+bloodGroup+"</span>"},checkIfDateField=function(x){return x.format===Bahmni.Common.Constants.patientAttributeDateFieldFormat}},angular.module("bahmni.common.patient").service("patientService",["$http","sessionService",function($http,sessionService){this.getPatient=function(uuid){return $http.get(Bahmni.Common.Constants.openmrsUrl+"/ws/rest/v1/patient/"+uuid,{method:"GET",params:{v:"full"},withCredentials:!0})},this.getRelationships=function(patientUuid){return $http.get(Bahmni.Common.Constants.openmrsUrl+"/ws/rest/v1/relationship",{method:"GET",params:{person:patientUuid,v:"full"},withCredentials:!0})},this.findPatients=function(params){return $http.get(Bahmni.Common.Constants.sqlUrl,{method:"GET",params:params,withCredentials:!0})},this.getPatientStatusState=function(patientUuid){return $http.get(Bahmni.Common.Constants.openmrsUrl+"/ws/rest/emrapi/patientStatusState?patientUuid="+patientUuid,{method:"GET"})},this.savePatientStatusState=function(patientStatus,patientUuid,creatorUuid,patientState){var url=Bahmni.Common.Constants.hostURL+"/openmrs/ws/rest/emrapi"+"/setPatientStatusState",data={patientUuid:patientUuid,patient_state:patientState,patient_status:patientStatus,creatorUuid:creatorUuid};return $http.post(url,data,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.search=function(query,offset,identifier){offset=offset||0;return $http.get(Bahmni.Common.Constants.bahmniSearchUrl+"/patient",{method:"GET",params:{q:query,startIndex:offset,identifier:identifier,loginLocationUuid:sessionService.getLoginLocationUuid(),patientSearchResultsConfig:["NICK_NAME","PRIMARY_CONTACT_NUMBER_1","PATIENT_STATUS"]},withCredentials:!0})},this.statusBasedSearch=function(query,offset,identifier){return offset=offset||0,$http.get(Bahmni.Common.Constants.bahmniStatusBasedSearchUrl+"/patient",{method:"GET",params:{q:query,startIndex:offset,identifier:identifier,loginLocationUuid:sessionService.getLoginLocationUuid()},withCredentials:!0})},this.getPatientContext=function(patientUuid,programUuid,personAttributes,programAttributes,patientIdentifiers){return $http.get("/openmrs/ws/rest/v1/bahmnicore/patientcontext",{params:{patientUuid:patientUuid,programUuid:programUuid,personAttributes:personAttributes,programAttributes:programAttributes,patientIdentifiers:patientIdentifiers},withCredentials:!0})}}]),angular.module("bahmni.common.patient").filter("gender",["$rootScope",function($rootScope){return function(genderChar){return null==genderChar?"Unknown":$rootScope.genderMap[angular.uppercase(genderChar)]}}]),(Bahmni=Bahmni||{}).ConceptSet=Bahmni.ConceptSet||{},Bahmni.ConceptSet.FormConditions=Bahmni.ConceptSet.FormConditions||{},angular.module("bahmni.common.conceptSet",["bahmni.common.uiHelper","ui.select2","pasvaz.bindonce","ngSanitize","ngTagsInput"]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.PatientSearch=Bahmni.Common.PatientSearch||{},Bahmni.Common.PatientSearch.Constants={searchExtensionTileViewType:"tile",searchExtensionTabularViewType:"tabular",tabularViewIgnoreHeadingsList:["display","uuid","image","$$hashKey","activeVisitUuid","hasBeenAdmitted","forwardUrl","programUuid","enrollment"],identifierHeading:["ID","Id","id","identifier","DQ_COLUMN_TITLE_ACTION"],nameHeading:["NAME","Name","name"],patientTileHeight:100,patientTileWidth:100,printIgnoreHeadingsList:["DQ_COLUMN_TITLE_ACTION"],tileLoadRatio:.5},Bahmni.Common.PatientSearch.Search=function(searchTypes){var self=this;function mapPatient(patient){return(patient.name||patient.givenName||patient.familyName)&&(patient.name=patient.name||patient.givenName+(patient.familyName?" "+patient.familyName:"")),patient.display=_.map(self.searchColumns,function(column){return patient[column]}).join(" - "),patient.image=Bahmni.Common.Constants.patientImageUrlByPatientUuid+patient.uuid,patient}self.searchTypes=searchTypes||[],self.searchType=this.searchTypes[0],self.searchParameter="",self.noResultsMessage=null,self.searchResults=[],self.activePatients=[],self.navigated=!1,self.links=self.searchType&&self.searchType.links?self.searchType.links:[],self.searchColumns=self.searchType&&self.searchType.searchColumns?self.searchType.searchColumns:["identifier","firstName","lastName"],angular.forEach(searchTypes,function(searchType){searchType.patientCount="..."}),self.switchSearchType=function(searchType){self.noResultsMessage=null,self.isSelectedSearch(searchType)||(self.searchParameter="",self.navigated=!0,self.searchType=searchType,self.activePatients=[],self.searchResults=[],self.links=self.searchType&&self.searchType.links?self.searchType.links:[],self.searchColumns=self.searchType&&self.searchType.searchColumns?self.searchType.searchColumns:["identifier","firstName","lastName"]),self.markPatientEntry()},self.markPatientEntry=function(){self.startPatientSearch=!0,window.setTimeout(function(){self.startPatientSearch=!1})},self.patientsCount=function(){return self.activePatients.length},self.updatePatientList=function(patientList){self.activePatients=patientList.map(mapPatient),self.searchResults=self.activePatients},self.updateSearchResults=function(patientList){self.updatePatientList(patientList),0===self.activePatients.length&&""!=self.searchParameter?self.noResultsMessage="NO_RESULTS_FOUND":self.noResultsMessage=null},self.hasSingleActivePatient=function(){return 1===self.activePatients.length},self.filterPatients=function(matchingCriteria){matchingCriteria=matchingCriteria||matchesNameOrId,self.searchResults=self.searchParameter?self.activePatients.filter(matchingCriteria):self.activePatients},self.filterPatientsByIdentifier=function(){self.filterPatients(matchesId)},self.isSelectedSearch=function(searchType){return self.searchType&&self.searchType.id==searchType.id},self.isCurrentSearchLookUp=function(){return self.searchType&&self.searchType.handler},self.isTileView=function(){return self.searchType&&self.searchType.view===Bahmni.Common.PatientSearch.Constants.searchExtensionTileViewType},self.isTabularView=function(){return self.searchType&&self.searchType.view===Bahmni.Common.PatientSearch.Constants.searchExtensionTabularViewType},self.showPatientCountOnSearchParameter=function(searchType){return showPatientCount(searchType)&&self.searchParameter};var matchesNameOrId=function(patient){return-1!==patient.display.toLowerCase().indexOf(self.searchParameter.toLowerCase())},matchesId=function(patient){return-1!==patient.identifier.toLowerCase().indexOf(self.searchParameter.toLowerCase())},showPatientCount=function(searchType){return self.isSelectedSearch(searchType)&&self.isCurrentSearchLookUp()}},angular.module("bahmni.common.patientSearch",["bahmni.common.patient","infinite-scroll"]),(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.I18n=Bahmni.Common.I18n||{},angular.module("bahmni.common.i18n",[]),angular.module("bahmni.common.i18n",["pascalprecht.translate"]).provider("$bahmniTranslate",["$translateProvider",function($translateProvider){this.init=function(options){var preferredLanguage=window.localStorage.NG_TRANSLATE_LANG_KEY||"en";$translateProvider.useLoader("mergeLocaleFilesService",options),$translateProvider.useSanitizeValueStrategy("escaped"),$translateProvider.preferredLanguage(preferredLanguage),$translateProvider.useLocalStorage()},this.$get=[function(){return $translateProvider}]}]).filter("titleTranslate",["$translate",function($translate){return function(input){return input?input.translationKey?$translate.instant(input.translationKey):input.dashboardName?input.dashboardName:input.title?input.title:input.label?input.label:input.display?input.display:$translate.instant(input):input}}]),angular.module("bahmni.common.i18n").service("mergeLocaleFilesService",["$http","$q","mergeService",function($http,$q,mergeService){return function(options){var customLocaleUrl=Bahmni.Common.Constants.rootDir+"/bahmni_config/openmrs/i18n/",loadFile=function(url){return $http.get(url,{withCredentials:!0})};return function(options){var fileURL=options.app+"/locale_"+options.key+".json";return $q.all([loadFile("../i18n/"+fileURL).then(function(result){return result},function(){}),loadFile(customLocaleUrl+fileURL).then(function(result){return result},function(){})]).then(function(result){var baseFileData=result[0]?result[0].data:void 0,customFileData=result[1]?result[1].data:void 0;return options.shouldMerge||void 0===options.shouldMerge?mergeService.merge(baseFileData,customFileData):[baseFileData,customFileData]})}(options)}}]);var Bahmni,debugUiRouter=function($rootScope){$rootScope.$on("$stateChangeStart",function(event,toState,toParams){console.log("$stateChangeStart to "+toState.to+"- fired when the transition begins. toState,toParams : \n",toState,toParams)}),$rootScope.$on("$stateChangeError",function(){console.log("$stateChangeError - fired when an error occurs during transition."),console.log(arguments)}),$rootScope.$on("$stateChangeSuccess",function(event,toState){console.log("$stateChangeSuccess to "+toState.name+"- fired once the state transition is complete.")}),$rootScope.$on("$viewContentLoaded",function(event){console.log("$viewContentLoaded - fired after dom rendered",event)}),$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){console.log("$stateNotFound "+unfoundState.to+"  - fired when a state cannot be found by its name."),console.log(unfoundState,fromState,fromParams)})};(Bahmni=Bahmni||{}).Common=Bahmni.Common||{},Bahmni.Common.Logging=Bahmni.Common.Logging||{},angular.module("bahmni.common.logging",[]),angular.module("bahmni.common.logging").config(["$provide",function($provide){$provide.decorator("$exceptionHandler",function($delegate,$injector,$window,$log){var exposeException=function(exceptionDetails){window.angular_exception=window.angular_exception||[],window.angular_exception.push(exceptionDetails)};return function(exception,cause){$delegate(exception,cause),function(exception,cause){try{var messagingService=$injector.get("messagingService"),loggingService=$injector.get("loggingService"),errorMessage=exception.toString(),stackTrace=printStackTrace({e:exception}),errorDetails={timestamp:new Date,browser:$window.navigator.userAgent,errorUrl:$window.location.href,errorMessage:errorMessage,stackTrace:stackTrace,cause:cause||""};loggingService.log(errorDetails),messagingService.showMessage("error",errorMessage),exposeException(errorDetails)}catch(loggingError){$log.warn("Error logging failed"),$log.log(loggingError)}}(exception,cause)}})}]),angular.module("bahmni.common.logging").service("loggingService",function(){return{log:function(errorDetails){$.ajax({type:"POST",url:"/log",contentType:"application/json",data:angular.toJson(errorDetails)})}}}),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{calendars:{}}).controller("uiCalendarCtrl",["$scope","$locale",function($scope,$locale){var sources=$scope.eventSources,extraEventSignature=$scope.calendarWatchEvent?$scope.calendarWatchEvent:angular.noop,eventSerialId=1;this.eventFingerprint=function(e){e._id||(e._id=eventSerialId++);var extraSignature=extraEventSignature({event:e})||"",start=moment.isMoment(e.start)?e.start.unix():e.start?moment(e.start).unix():"",end=moment.isMoment(e.end)?e.end.unix():e.end?moment(e.end).unix():"";return[e._id,e.id||"",e.title||"",e.url||"",start,end,e.allDay||"",e.className||"",extraSignature].join("")};var sourceSerialId=1,sourceEventsSerialId=1;this.sourceFingerprint=function(source){var fp=""+(source.__id||(source.__id=sourceSerialId++)),events=angular.isObject(source)&&source.events;return events&&(fp=fp+"-"+(events.__id||(events.__id=sourceEventsSerialId++))),fp},this.allEvents=function(){return Array.prototype.concat.apply([],(sources||[]).reduce(function(previous,source){if(angular.isArray(source))previous.push(source);else if(angular.isObject(source)&&angular.isArray(source.events)){var extEvent=Object.keys(source).filter(function(key){return"_id"!==key&&"events"!==key});source.events.forEach(function(event){angular.extend(event,extEvent)}),previous.push(source.events)}return previous},[]))},this.changeWatcher=function(arraySource,tokenFn){var self,getTokens=function(){return((angular.isFunction(arraySource)?arraySource():arraySource)||[]).reduce(function(rslt,el){var token=tokenFn(el);return map[token]=el,rslt.push(token),rslt},[])},subtractAsSets=function(a,b){var obj=(b||[]).reduce(function(rslt,val){return rslt[val]=!0,rslt},Object.create(null));return(a||[]).filter(function(val){return!obj[val]})},map={};return self={subscribe:function(scope,onArrayChanged){scope.$watch(getTokens,function(newTokens,oldTokens){!(onArrayChanged&&!1===onArrayChanged(newTokens,oldTokens))&&function(newTokens,oldTokens){var i,token,replacedTokens={},removedTokens=subtractAsSets(oldTokens,newTokens);for(i=0;i<removedTokens.length;i++){var removedToken=removedTokens[i],el=map[removedToken];delete map[removedToken];var newToken=tokenFn(el);newToken===removedToken?self.onRemoved(el):(replacedTokens[newToken]=removedToken,self.onChanged(el))}var addedTokens=subtractAsSets(newTokens,oldTokens);for(i=0;i<addedTokens.length;i++)replacedTokens[token=addedTokens[i]]||self.onAdded(map[token])}(newTokens,oldTokens)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(calendarSettings,uiCalendarConfig){var config={};return angular.extend(config,uiCalendarConfig),angular.extend(config,calendarSettings),angular.forEach(config,function(value,key){var functionToWrap;"function"==typeof value&&(config[key]=(functionToWrap=config[key],function(){if($scope.$root.$$phase)return functionToWrap.apply(this,arguments);var args=arguments,that=this;return $scope.$root.$apply(function(){return functionToWrap.apply(that,args)})}))}),config},this.getLocaleConfig=function(fullCalendarConfig){if(!fullCalendarConfig.lang||fullCalendarConfig.useNgLocale){var tValues=function(data){return(Object.keys(data)||[]).reduce(function(rslt,el){return rslt.push(data[el]),rslt},[])},dtf=$locale.DATETIME_FORMATS;return{monthNames:tValues(dtf.MONTH),monthNamesShort:tValues(dtf.SHORTMONTH),dayNames:tValues(dtf.DAY),dayNamesShort:tValues(dtf.SHORTDAY)}}return{}}}]).directive("uiCalendar",["uiCalendarConfig",function(uiCalendarConfig){return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(scope,elm,attrs,controller){var calendar,sources=scope.eventSources,sourcesChanged=!1,eventSourcesWatcher=controller.changeWatcher(sources,controller.sourceFingerprint),eventsWatcher=controller.changeWatcher(controller.allEvents,controller.eventFingerprint),options=null;scope.destroyCalendar=function(){calendar&&calendar.fullCalendar&&calendar.fullCalendar("destroy"),calendar=attrs.calendar?uiCalendarConfig.calendars[attrs.calendar]=angular.element(elm).html(""):angular.element(elm).html("")},scope.initCalendar=function(){calendar||(calendar=angular.element(elm).html("")),calendar.fullCalendar(options),attrs.calendar&&(uiCalendarConfig.calendars[attrs.calendar]=calendar)},scope.$on("$destroy",function(){scope.destroyCalendar()}),eventSourcesWatcher.onAdded=function(source){calendar&&calendar.fullCalendar&&(calendar.fullCalendar(options),attrs.calendar&&(uiCalendarConfig.calendars[attrs.calendar]=calendar),calendar.fullCalendar("addEventSource",source),sourcesChanged=!0)},eventSourcesWatcher.onRemoved=function(source){calendar&&calendar.fullCalendar&&(calendar.fullCalendar("removeEventSource",source),sourcesChanged=!0)},eventSourcesWatcher.onChanged=function(){calendar&&calendar.fullCalendar&&(calendar.fullCalendar("refetchEvents"),sourcesChanged=!0)},eventsWatcher.onAdded=function(event){calendar&&calendar.fullCalendar&&calendar.fullCalendar("renderEvent",event,!!event.stick)},eventsWatcher.onRemoved=function(event){calendar&&calendar.fullCalendar&&calendar.fullCalendar("removeEvents",event._id)},eventsWatcher.onChanged=function(event){if(calendar&&calendar.fullCalendar)for(var clientEvents=calendar.fullCalendar("clientEvents",event._id),i=0;i<clientEvents.length;i++){var clientEvent=clientEvents[i];clientEvent=angular.extend(clientEvent,event),calendar.fullCalendar("updateEvent",clientEvent)}},eventSourcesWatcher.subscribe(scope),eventsWatcher.subscribe(scope,function(){if(!0===sourcesChanged)return sourcesChanged=!1,!1}),scope.$watch(function(){var calendarSettings=attrs.uiCalendar?scope.$parent.$eval(attrs.uiCalendar):{},fullCalendarConfig=controller.getFullCalendarConfig(calendarSettings,uiCalendarConfig),localeFullCalendarConfig=controller.getLocaleConfig(fullCalendarConfig);angular.extend(localeFullCalendarConfig,fullCalendarConfig),options={eventSources:sources},angular.extend(options,localeFullCalendarConfig),options.calendars=null;var options2={};for(var o in options)"eventSources"!==o&&(options2[o]=options[o]);return JSON.stringify(options2)},function(newValue,oldValue){newValue!==oldValue?(scope.destroyCalendar(),scope.initCalendar()):newValue&&angular.isUndefined(calendar)&&scope.initCalendar()})}}}]),function(factory){"function"==typeof define&&define.amd?define(["jquery","moment"],factory):"object"==typeof exports?module.exports=factory(require("jquery"),require("moment")):factory(jQuery,moment)}(function($,moment){var FC=$.fullCalendar={version:"2.7.3",internalApiVersion:4},fcViews=FC.views={};$.fn.fullCalendar=function(options){var args=Array.prototype.slice.call(arguments,1),res=this;return this.each(function(i,_element){var singleRes,element=$(_element),calendar=element.data("fullCalendar");"string"==typeof options?calendar&&$.isFunction(calendar[options])&&(singleRes=calendar[options].apply(calendar,args),i||(res=singleRes),"destroy"===options&&element.removeData("fullCalendar")):calendar||(calendar=new Calendar(element,options),element.data("fullCalendar",calendar),calendar.render())}),res};var complexOptions=["header","buttonText","buttonIcons","themeButtonIcons"];function mergeOptions(optionObjs){return mergeProps(optionObjs,complexOptions)}function compensateScroll(rowEls,scrollbarWidths){scrollbarWidths.left&&rowEls.css({"border-left-width":1,"margin-left":scrollbarWidths.left-1}),scrollbarWidths.right&&rowEls.css({"border-right-width":1,"margin-right":scrollbarWidths.right-1})}function uncompensateScroll(rowEls){rowEls.css({"margin-left":"","margin-right":"","border-left-width":"","border-right-width":""})}function disableCursor(){$("body").addClass("fc-not-allowed")}function enableCursor(){$("body").removeClass("fc-not-allowed")}function distributeHeight(els,availableHeight,shouldRedistribute){var minOffset1=Math.floor(availableHeight/els.length),minOffset2=Math.floor(availableHeight-minOffset1*(els.length-1)),flexEls=[],flexOffsets=[],flexHeights=[],usedHeight=0;undistributeHeight(els),els.each(function(i,el){var minOffset=i===els.length-1?minOffset2:minOffset1,naturalOffset=$(el).outerHeight(!0);naturalOffset<minOffset?(flexEls.push(el),flexOffsets.push(naturalOffset),flexHeights.push($(el).height())):usedHeight+=naturalOffset}),shouldRedistribute&&(availableHeight-=usedHeight,minOffset1=Math.floor(availableHeight/flexEls.length),minOffset2=Math.floor(availableHeight-minOffset1*(flexEls.length-1))),$(flexEls).each(function(i,el){var minOffset=i===flexEls.length-1?minOffset2:minOffset1,naturalOffset=flexOffsets[i],newHeight=minOffset-(naturalOffset-flexHeights[i]);naturalOffset<minOffset&&$(el).height(newHeight)})}function undistributeHeight(els){els.height("")}function matchCellWidths(els){var maxInnerWidth=0;return els.find("> span").each(function(i,innerEl){var innerWidth=$(innerEl).outerWidth();innerWidth>maxInnerWidth&&(maxInnerWidth=innerWidth)}),maxInnerWidth++,els.width(maxInnerWidth),maxInnerWidth}function subtractInnerElHeight(outerEl,innerEl){var diff,both=outerEl.add(innerEl);return both.css({position:"relative",left:-1}),diff=outerEl.outerHeight()-innerEl.outerHeight(),both.css({position:"",left:""}),diff}function getScrollParent(el){var position=el.css("position"),scrollParent=el.parents().filter(function(){var parent=$(this);return/(auto|scroll)/.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return"fixed"!==position&&scrollParent.length?scrollParent:$(el[0].ownerDocument||document)}function getOuterRect(el,origin){var offset=el.offset(),left=offset.left-(origin?origin.left:0),top=offset.top-(origin?origin.top:0);return{left:left,right:left+el.outerWidth(),top:top,bottom:top+el.outerHeight()}}function getClientRect(el,origin){var offset=el.offset(),scrollbarWidths=getScrollbarWidths(el),left=offset.left+getCssFloat(el,"border-left-width")+scrollbarWidths.left-(origin?origin.left:0),top=offset.top+getCssFloat(el,"border-top-width")+scrollbarWidths.top-(origin?origin.top:0);return{left:left,right:left+el[0].clientWidth,top:top,bottom:top+el[0].clientHeight}}function getScrollbarWidths(el){var leftRightWidth=el.innerWidth()-el[0].clientWidth,widths={left:0,right:0,top:0,bottom:el.innerHeight()-el[0].clientHeight};return!function(){null===_isLeftRtlScrollbars&&(el=$("<div><div/></div>").css({position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}).appendTo("body"),res=el.children().offset().left>el.offset().left,el.remove(),_isLeftRtlScrollbars=res);var el,res;return _isLeftRtlScrollbars}()||"rtl"!=el.css("direction")?widths.right=leftRightWidth:widths.left=leftRightWidth,widths}FC.intersectRanges=intersectRanges,FC.applyAll=applyAll,FC.debounce=debounce,FC.isInt=isInt,FC.htmlEscape=htmlEscape,FC.cssToStr=cssToStr,FC.proxy=proxy,FC.capitaliseFirstLetter=function(str){return str.charAt(0).toUpperCase()+str.slice(1)},FC.getOuterRect=getOuterRect,FC.getClientRect=getClientRect,FC.getContentRect=function(el,origin){var offset=el.offset(),left=offset.left+getCssFloat(el,"border-left-width")+getCssFloat(el,"padding-left")-(origin?origin.left:0),top=offset.top+getCssFloat(el,"border-top-width")+getCssFloat(el,"padding-top")-(origin?origin.top:0);return{left:left,right:left+el.width(),top:top,bottom:top+el.height()}},FC.getScrollbarWidths=getScrollbarWidths;var _isLeftRtlScrollbars=null;function getCssFloat(el,prop){return parseFloat(el.css(prop))||0}function isPrimaryMouseButton(ev){return 1==ev.which&&!ev.ctrlKey}function getEvX(ev){if(void 0!==ev.pageX)return ev.pageX;var touches=ev.originalEvent.touches;return touches?touches[0].pageX:void 0}function getEvY(ev){if(void 0!==ev.pageY)return ev.pageY;var touches=ev.originalEvent.touches;return touches?touches[0].pageY:void 0}function getEvIsTouch(ev){return/^touch/.test(ev.type)}function preventDefault(ev){ev.preventDefault()}function intersectRects(rect1,rect2){var res={left:Math.max(rect1.left,rect2.left),right:Math.min(rect1.right,rect2.right),top:Math.max(rect1.top,rect2.top),bottom:Math.min(rect1.bottom,rect2.bottom)};return res.left<res.right&&res.top<res.bottom&&res}function parseFieldSpecs(input){var i,token,specs=[],tokens=[];for("string"==typeof input?tokens=input.split(/\s*,\s*/):"function"==typeof input?tokens=[input]:$.isArray(input)&&(tokens=input),i=0;i<tokens.length;i++)"string"==typeof(token=tokens[i])?specs.push("-"==token.charAt(0)?{field:token.substring(1),order:-1}:{field:token,order:1}):"function"==typeof token&&specs.push({func:token});return specs}function compareByFieldSpecs(obj1,obj2,fieldSpecs){var i,cmp;for(i=0;i<fieldSpecs.length;i++)if(cmp=compareByFieldSpec(obj1,obj2,fieldSpecs[i]))return cmp;return 0}function compareByFieldSpec(obj1,obj2,fieldSpec){return fieldSpec.func?fieldSpec.func(obj1,obj2):flexibleCompare(obj1[fieldSpec.field],obj2[fieldSpec.field])*(fieldSpec.order||1)}function flexibleCompare(a,b){return a||b?null==b?-1:null==a?1:"string"===$.type(a)||"string"===$.type(b)?String(a).localeCompare(String(b)):a-b:0}function intersectRanges(subjectRange,constraintRange){var segStart,segEnd,isStart,isEnd,subjectStart=subjectRange.start,subjectEnd=subjectRange.end,constraintStart=constraintRange.start,constraintEnd=constraintRange.end;if(subjectEnd>constraintStart&&subjectStart<constraintEnd)return subjectStart>=constraintStart?(segStart=subjectStart.clone(),isStart=!0):(segStart=constraintStart.clone(),isStart=!1),subjectEnd<=constraintEnd?(segEnd=subjectEnd.clone(),isEnd=!0):(segEnd=constraintEnd.clone(),isEnd=!1),{start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd}}FC.preventDefault=preventDefault,FC.intersectRects=intersectRects,FC.parseFieldSpecs=parseFieldSpecs,FC.compareByFieldSpecs=compareByFieldSpecs,FC.compareByFieldSpec=compareByFieldSpec,FC.flexibleCompare=flexibleCompare,FC.computeIntervalUnit=computeIntervalUnit,FC.divideRangeByDuration=function(start,end,dur){var months;if(durationHasTime(dur))return(end-start)/dur;if(months=dur.asMonths(),Math.abs(months)>=1&&isInt(months))return end.diff(start,"months",!0)/months;return end.diff(start,"days",!0)/dur.asDays()},FC.divideDurationByDuration=divideDurationByDuration,FC.multiplyDuration=function(dur,n){var months;if(durationHasTime(dur))return moment.duration(dur*n);if(months=dur.asMonths(),Math.abs(months)>=1&&isInt(months))return moment.duration({months:months*n});return moment.duration({days:dur.asDays()*n})},FC.durationHasTime=durationHasTime;var dayIDs=["sun","mon","tue","wed","thu","fri","sat"],intervalUnits=["year","month","week","day","hour","minute","second","millisecond"];function diffDayTime(a,b){return moment.duration({days:a.clone().stripTime().diff(b.clone().stripTime(),"days"),ms:a.time()-b.time()})}function diffByUnit(a,b,unit){return moment.duration(Math.round(a.diff(b,unit,!0)),unit)}function computeIntervalUnit(start,end){var i,unit,val;for(i=0;i<intervalUnits.length&&!((val=computeRangeAs(unit=intervalUnits[i],start,end))>=1&&isInt(val));i++);return unit}function computeRangeAs(unit,start,end){return null!=end?end.diff(start,unit,!0):moment.isDuration(start)?start.as(unit):start.end.diff(start.start,unit,!0)}function divideDurationByDuration(dur1,dur2){var months1,months2;return durationHasTime(dur1)||durationHasTime(dur2)?dur1/dur2:(months1=dur1.asMonths(),months2=dur2.asMonths(),Math.abs(months1)>=1&&isInt(months1)&&Math.abs(months2)>=1&&isInt(months2)?months1/months2:dur1.asDays()/dur2.asDays())}function durationHasTime(dur){return Boolean(dur.hours()||dur.minutes()||dur.seconds()||dur.milliseconds())}function isTimeString(str){return/^\d+\:\d+(?:\:\d+\.?(?:\d{3})?)?$/.test(str)}FC.log=function(){var console=window.console;if(console&&console.log)return console.log.apply(console,arguments)},FC.warn=function(){var console=window.console;return console&&console.warn?console.warn.apply(console,arguments):FC.log.apply(FC,arguments)};var hasOwnPropMethod={}.hasOwnProperty;function mergeProps(propObjs,complexProps){var i,name,complexObjs,j,val,props,dest={};if(complexProps)for(i=0;i<complexProps.length;i++){for(name=complexProps[i],complexObjs=[],j=propObjs.length-1;j>=0;j--)if("object"==typeof(val=propObjs[j][name]))complexObjs.unshift(val);else if(void 0!==val){dest[name]=val;break}complexObjs.length&&(dest[name]=mergeProps(complexObjs))}for(i=propObjs.length-1;i>=0;i--)for(name in props=propObjs[i])name in dest||(dest[name]=props[name]);return dest}function createObject(proto){var f=function(){};return f.prototype=proto,new f}function copyOwnProps(src,dest){for(var name in src)hasOwnProp(src,name)&&(dest[name]=src[name])}function hasOwnProp(obj,name){return hasOwnPropMethod.call(obj,name)}function applyAll(functions,thisObj,args){if($.isFunction(functions)&&(functions=[functions]),functions){var i,ret;for(i=0;i<functions.length;i++)ret=functions[i].apply(thisObj,args)||ret;return ret}}function firstDefined(){for(var i=0;i<arguments.length;i++)if(void 0!==arguments[i])return arguments[i]}function htmlEscape(s){return(s+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function stripHtmlEntities(text){return text.replace(/&.*?;/g,"")}function cssToStr(cssProps){var statements=[];return $.each(cssProps,function(name,val){null!=val&&statements.push(name+":"+val)}),statements.join(";")}function compareNumbers(a,b){return a-b}function isInt(n){return n%1==0}function proxy(obj,methodName){var method=obj[methodName];return function(){return method.apply(obj,arguments)}}function debounce(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=+new Date-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))};return function(){context=this,args=arguments,timestamp=+new Date;var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}}var allowValueOptimization,setUTCValues,setLocalValues,ambigDateOfMonthRegex=/^\s*\d{4}-\d\d$/,ambigTimeOrZoneRegex=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?)?$/,newMomentProto=moment.fn,oldMomentProto=$.extend({},newMomentProto);function makeMoment(args,parseAsUTC,parseZone){var isAmbigTime,isAmbigZone,ambigMatch,mom,input=args[0],isSingleString=1==args.length&&"string"==typeof input;return moment.isMoment(input)?transferAmbigs(input,mom=moment.apply(null,args)):!function(input){return"[object Date]"===Object.prototype.toString.call(input)||input instanceof Date}(input)&&void 0!==input?(isAmbigTime=!1,isAmbigZone=!1,isSingleString?ambigDateOfMonthRegex.test(input)?(args=[input+="-01"],isAmbigTime=!0,isAmbigZone=!0):(ambigMatch=ambigTimeOrZoneRegex.exec(input))&&(isAmbigTime=!ambigMatch[5],isAmbigZone=!0):$.isArray(input)&&(isAmbigZone=!0),mom=parseAsUTC||isAmbigTime?moment.utc.apply(moment,args):moment.apply(null,args),isAmbigTime?(mom._ambigTime=!0,mom._ambigZone=!0):parseZone&&(isAmbigZone?mom._ambigZone=!0:isSingleString&&(mom.utcOffset?mom.utcOffset(input):mom.zone(input)))):mom=moment.apply(null,args),mom._fullCalendar=!0,mom}function commonlyAmbiguate(inputs,preserveTime){var i,mom,anyAmbigTime=!1,anyAmbigZone=!1,len=inputs.length,moms=[];for(i=0;i<len;i++)mom=inputs[i],moment.isMoment(mom)||(mom=FC.moment.parseZone(mom)),anyAmbigTime=anyAmbigTime||mom._ambigTime,anyAmbigZone=anyAmbigZone||mom._ambigZone,moms.push(mom);for(i=0;i<len;i++)mom=moms[i],preserveTime||!anyAmbigTime||mom._ambigTime?anyAmbigZone&&!mom._ambigZone&&(moms[i]=mom.clone().stripZone()):moms[i]=mom.clone().stripTime();return moms}function transferAmbigs(src,dest){src._ambigTime?dest._ambigTime=!0:dest._ambigTime&&(dest._ambigTime=!1),src._ambigZone?dest._ambigZone=!0:dest._ambigZone&&(dest._ambigZone=!1)}function setMomentValues(mom,a){mom.year(a[0]||0).month(a[1]||0).date(a[2]||0).hours(a[3]||0).minutes(a[4]||0).seconds(a[5]||0).milliseconds(a[6]||0)}function oldMomentFormat(mom,formatStr){return oldMomentProto.format.call(mom,formatStr)}function formatDateWithChunks(date,chunks){var i,s="";for(i=0;i<chunks.length;i++)s+=formatDateWithChunk(date,chunks[i]);return s}FC.moment=function(){return makeMoment(arguments)},FC.moment.utc=function(){var mom=makeMoment(arguments,!0);return mom.hasTime()&&mom.utc(),mom},FC.moment.parseZone=function(){return makeMoment(arguments,!0,!0)},newMomentProto.clone=function(){var mom=oldMomentProto.clone.apply(this,arguments);return transferAmbigs(this,mom),this._fullCalendar&&(mom._fullCalendar=!0),mom},newMomentProto.week=newMomentProto.weeks=function(input){var weekCalc=(this._locale||this._lang)._fullCalendar_weekCalc;return null==input&&"function"==typeof weekCalc?weekCalc(this):"ISO"===weekCalc?oldMomentProto.isoWeek.apply(this,arguments):oldMomentProto.week.apply(this,arguments)},newMomentProto.time=function(time){if(!this._fullCalendar)return oldMomentProto.time.apply(this,arguments);if(null==time)return moment.duration({hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()});this._ambigTime=!1,moment.isDuration(time)||moment.isMoment(time)||(time=moment.duration(time));var dayHours=0;return moment.isDuration(time)&&(dayHours=24*Math.floor(time.asDays())),this.hours(dayHours+time.hours()).minutes(time.minutes()).seconds(time.seconds()).milliseconds(time.milliseconds())},newMomentProto.stripTime=function(){var a;return this._ambigTime||(a=this.toArray(),this.utc(),setUTCValues(this,a.slice(0,3)),this._ambigTime=!0,this._ambigZone=!0),this},newMomentProto.hasTime=function(){return!this._ambigTime},newMomentProto.stripZone=function(){var a,wasAmbigTime;return this._ambigZone||(a=this.toArray(),wasAmbigTime=this._ambigTime,this.utc(),setUTCValues(this,a),this._ambigTime=wasAmbigTime||!1,this._ambigZone=!0),this},newMomentProto.hasZone=function(){return!this._ambigZone},newMomentProto.local=function(){var a=this.toArray(),wasAmbigZone=this._ambigZone;return oldMomentProto.local.apply(this,arguments),this._ambigTime=!1,this._ambigZone=!1,wasAmbigZone&&setLocalValues(this,a),this},newMomentProto.utc=function(){return oldMomentProto.utc.apply(this,arguments),this._ambigTime=!1,this._ambigZone=!1,this},$.each(["zone","utcOffset"],function(i,name){oldMomentProto[name]&&(newMomentProto[name]=function(tzo){return null!=tzo&&(this._ambigTime=!1,this._ambigZone=!1),oldMomentProto[name].apply(this,arguments)})}),newMomentProto.format=function(){return this._fullCalendar&&arguments[0]?(date=this,formatStr=arguments[0],formatDateWithChunks(date,getFormatStringChunks(formatStr))):this._ambigTime?oldMomentFormat(this,"YYYY-MM-DD"):this._ambigZone?oldMomentFormat(this,"YYYY-MM-DD[T]HH:mm:ss"):oldMomentProto.format.apply(this,arguments);var date,formatStr},newMomentProto.toISOString=function(){return this._ambigTime?oldMomentFormat(this,"YYYY-MM-DD"):this._ambigZone?oldMomentFormat(this,"YYYY-MM-DD[T]HH:mm:ss"):oldMomentProto.toISOString.apply(this,arguments)},newMomentProto.isWithin=function(start,end){var a=commonlyAmbiguate([this,start,end]);return a[0]>=a[1]&&a[0]<a[2]},newMomentProto.isSame=function(input,units){var a;return this._fullCalendar?units?(a=commonlyAmbiguate([this,input],!0),oldMomentProto.isSame.call(a[0],a[1],units)):(input=FC.moment.parseZone(input),oldMomentProto.isSame.call(this,input)&&Boolean(this._ambigTime)===Boolean(input._ambigTime)&&Boolean(this._ambigZone)===Boolean(input._ambigZone)):oldMomentProto.isSame.apply(this,arguments)},$.each(["isBefore","isAfter"],function(i,methodName){newMomentProto[methodName]=function(input,units){var a;return this._fullCalendar?(a=commonlyAmbiguate([this,input]),oldMomentProto[methodName].call(a[0],a[1],units)):oldMomentProto[methodName].apply(this,arguments)}}),allowValueOptimization="_d"in moment()&&"updateOffset"in moment,setUTCValues=allowValueOptimization?function(mom,a){mom._d.setTime(Date.UTC.apply(Date,a)),moment.updateOffset(mom,!1)}:setMomentValues,setLocalValues=allowValueOptimization?function(mom,a){mom._d.setTime(+new Date(a[0]||0,a[1]||0,a[2]||0,a[3]||0,a[4]||0,a[5]||0,a[6]||0)),moment.updateOffset(mom,!1)}:setMomentValues;var tokenOverrides={t:function(date){return oldMomentFormat(date,"a").charAt(0)},T:function(date){return oldMomentFormat(date,"A").charAt(0)}};function formatDateWithChunk(date,chunk){var token,maybeStr;return"string"==typeof chunk?chunk:(token=chunk.token)?tokenOverrides[token]?tokenOverrides[token](date):oldMomentFormat(date,token):chunk.maybe&&(maybeStr=formatDateWithChunks(date,chunk.maybe)).match(/[1-9]/)?maybeStr:""}function formatRange(date1,date2,formatStr,separator,isRTL){return date1=FC.moment.parseZone(date1),date2=FC.moment.parseZone(date2),formatStr=(date1.localeData||date1.lang).call(date1).longDateFormat(formatStr)||formatStr,separator=separator||" - ",function(date1,date2,chunks,separator,isRTL){var chunkStr,leftI,rightI,middleI,unzonedDate1=date1.clone().stripZone(),unzonedDate2=date2.clone().stripZone(),leftStr="",rightStr="",middleStr1="",middleStr2="",middleStr="";for(leftI=0;leftI<chunks.length&&!1!==(chunkStr=formatSimilarChunk(date1,date2,unzonedDate1,unzonedDate2,chunks[leftI]));leftI++)leftStr+=chunkStr;for(rightI=chunks.length-1;rightI>leftI&&!1!==(chunkStr=formatSimilarChunk(date1,date2,unzonedDate1,unzonedDate2,chunks[rightI]));rightI--)rightStr=chunkStr+rightStr;for(middleI=leftI;middleI<=rightI;middleI++)middleStr1+=formatDateWithChunk(date1,chunks[middleI]),middleStr2+=formatDateWithChunk(date2,chunks[middleI]);(middleStr1||middleStr2)&&(middleStr=isRTL?middleStr2+separator+middleStr1:middleStr1+separator+middleStr2);return leftStr+middleStr+rightStr}(date1,date2,getFormatStringChunks(formatStr),separator,isRTL)}FC.formatRange=formatRange;var similarUnitMap={Y:"year",M:"month",D:"day",d:"day",A:"second",a:"second",T:"second",t:"second",H:"second",h:"second",m:"second",s:"second"};function formatSimilarChunk(date1,date2,unzonedDate1,unzonedDate2,chunk){var token,unit;return"string"==typeof chunk?chunk:!!((token=chunk.token)&&(unit=similarUnitMap[token.charAt(0)])&&unzonedDate1.isSame(unzonedDate2,unit))&&oldMomentFormat(date1,token)}var formatStringChunkCache={};function getFormatStringChunks(formatStr){return formatStr in formatStringChunkCache?formatStringChunkCache[formatStr]:formatStringChunkCache[formatStr]=function chunkFormatString(formatStr){var chunks=[];var chunker=/\[([^\]]*)\]|\(([^\)]*)\)|(LTS|LT|(\w)\4*o?)|([^\w\[\(]+)/g;var match;for(;match=chunker.exec(formatStr);)match[1]?chunks.push(match[1]):match[2]?chunks.push({maybe:chunkFormatString(match[2])}):match[3]?chunks.push({token:match[3]}):match[5]&&chunks.push(match[5]);return chunks}(formatStr)}function Class(){}function mixIntoClass(theClass,members){copyOwnProps(members,theClass.prototype)}FC.Class=Class,Class.extend=function(){var i,members,len=arguments.length;for(i=0;i<len;i++)members=arguments[i],i<len-1&&mixIntoClass(this,members);return function(superClass,members){var subClass;hasOwnProp(members,"constructor")&&(subClass=members.constructor);"function"!=typeof subClass&&(subClass=members.constructor=function(){superClass.apply(this,arguments)});return subClass.prototype=createObject(superClass.prototype),copyOwnProps(members,subClass.prototype),function(src,dest){var i,name,names=["constructor","toString","valueOf"];for(i=0;i<names.length;i++)src[name=names[i]]!==Object.prototype[name]&&(dest[name]=src[name])}(members,subClass.prototype),copyOwnProps(superClass,subClass),subClass}(this,members||{})},Class.mixin=function(members){mixIntoClass(this,members)};var guid,EmitterMixin=FC.EmitterMixin={on:function(types,handler){var intercept=function(ev,extra){return handler.apply(extra.context||this,extra.args||[])};return handler.guid||(handler.guid=$.guid++),intercept.guid=handler.guid,$(this).on(types,intercept),this},off:function(types,handler){return $(this).off(types,handler),this},trigger:function(types){var args=Array.prototype.slice.call(arguments,1);return $(this).triggerHandler(types,{args:args}),this},triggerWith:function(types,context,args){return $(this).triggerHandler(types,{context:context,args:args}),this}},ListenerMixin=FC.ListenerMixin=(guid=0,{listenerId:null,listenTo:function(other,arg,callback){if("object"==typeof arg)for(var eventName in arg)arg.hasOwnProperty(eventName)&&this.listenTo(other,eventName,arg[eventName]);else"string"==typeof arg&&other.on(arg+"."+this.getListenerNamespace(),$.proxy(callback,this))},stopListeningTo:function(other,eventName){other.off((eventName||"")+"."+this.getListenerNamespace())},getListenerNamespace:function(){return null==this.listenerId&&(this.listenerId=guid++),"_listener"+this.listenerId}}),MouseIgnorerMixin={isIgnoringMouse:!1,delayUnignoreMouse:null,initMouseIgnoring:function(delay){this.delayUnignoreMouse=debounce(proxy(this,"unignoreMouse"),delay||1e3)},tempIgnoreMouse:function(){this.isIgnoringMouse=!0,this.delayUnignoreMouse()},unignoreMouse:function(){this.isIgnoringMouse=!1}},Popover=Class.extend(ListenerMixin,{isHidden:!0,options:null,el:null,margin:10,constructor:function(options){this.options=options||{}},show:function(){this.isHidden&&(this.el||this.render(),this.el.show(),this.position(),this.isHidden=!1,this.trigger("show"))},hide:function(){this.isHidden||(this.el.hide(),this.isHidden=!0,this.trigger("hide"))},render:function(){var _this=this,options=this.options;this.el=$('<div class="fc-popover"/>').addClass(options.className||"").css({top:0,left:0}).append(options.content).appendTo(options.parentEl),this.el.on("click",".fc-close",function(){_this.hide()}),options.autoHide&&this.listenTo($(document),"mousedown",this.documentMousedown)},documentMousedown:function(ev){this.el&&!$(ev.target).closest(this.el).length&&this.hide()},removeElement:function(){this.hide(),this.el&&(this.el.remove(),this.el=null),this.stopListeningTo($(document),"mousedown")},position:function(){var viewportTop,viewportLeft,viewportOffset,top,left,options=this.options,origin=this.el.offsetParent().offset(),width=this.el.outerWidth(),height=this.el.outerHeight(),windowEl=$(window),viewportEl=getScrollParent(this.el);top=options.top||0,left=void 0!==options.left?options.left:void 0!==options.right?options.right-width:0,viewportEl.is(window)||viewportEl.is(document)?(viewportEl=windowEl,viewportTop=0,viewportLeft=0):(viewportTop=(viewportOffset=viewportEl.offset()).top,viewportLeft=viewportOffset.left),viewportTop+=windowEl.scrollTop(),viewportLeft+=windowEl.scrollLeft(),!1!==options.viewportConstrain&&(top=Math.min(top,viewportTop+viewportEl.outerHeight()-height-this.margin),top=Math.max(top,viewportTop+this.margin),left=Math.min(left,viewportLeft+viewportEl.outerWidth()-width-this.margin),left=Math.max(left,viewportLeft+this.margin)),this.el.css({top:top-origin.top,left:left-origin.left})},trigger:function(name){this.options[name]&&this.options[name].apply(this,Array.prototype.slice.call(arguments,1))}}),CoordCache=FC.CoordCache=Class.extend({els:null,forcedOffsetParentEl:null,origin:null,boundingRect:null,isHorizontal:!1,isVertical:!1,lefts:null,rights:null,tops:null,bottoms:null,constructor:function(options){this.els=$(options.els),this.isHorizontal=options.isHorizontal,this.isVertical=options.isVertical,this.forcedOffsetParentEl=options.offsetParent?$(options.offsetParent):null},build:function(){var offsetParentEl=this.forcedOffsetParentEl||this.els.eq(0).offsetParent();this.origin=offsetParentEl.offset(),this.boundingRect=this.queryBoundingRect(),this.isHorizontal&&this.buildElHorizontals(),this.isVertical&&this.buildElVerticals()},clear:function(){this.origin=null,this.boundingRect=null,this.lefts=null,this.rights=null,this.tops=null,this.bottoms=null},ensureBuilt:function(){this.origin||this.build()},queryBoundingRect:function(){var scrollParentEl=getScrollParent(this.els.eq(0));if(!scrollParentEl.is(document))return getClientRect(scrollParentEl)},buildElHorizontals:function(){var lefts=[],rights=[];this.els.each(function(i,node){var el=$(node),left=el.offset().left,width=el.outerWidth();lefts.push(left),rights.push(left+width)}),this.lefts=lefts,this.rights=rights},buildElVerticals:function(){var tops=[],bottoms=[];this.els.each(function(i,node){var el=$(node),top=el.offset().top,height=el.outerHeight();tops.push(top),bottoms.push(top+height)}),this.tops=tops,this.bottoms=bottoms},getHorizontalIndex:function(leftOffset){this.ensureBuilt();var i,boundingRect=this.boundingRect,lefts=this.lefts,rights=this.rights,len=lefts.length;if(!boundingRect||leftOffset>=boundingRect.left&&leftOffset<boundingRect.right)for(i=0;i<len;i++)if(leftOffset>=lefts[i]&&leftOffset<rights[i])return i},getVerticalIndex:function(topOffset){this.ensureBuilt();var i,boundingRect=this.boundingRect,tops=this.tops,bottoms=this.bottoms,len=tops.length;if(!boundingRect||topOffset>=boundingRect.top&&topOffset<boundingRect.bottom)for(i=0;i<len;i++)if(topOffset>=tops[i]&&topOffset<bottoms[i])return i},getLeftOffset:function(leftIndex){return this.ensureBuilt(),this.lefts[leftIndex]},getLeftPosition:function(leftIndex){return this.ensureBuilt(),this.lefts[leftIndex]-this.origin.left},getRightOffset:function(leftIndex){return this.ensureBuilt(),this.rights[leftIndex]},getRightPosition:function(leftIndex){return this.ensureBuilt(),this.rights[leftIndex]-this.origin.left},getWidth:function(leftIndex){return this.ensureBuilt(),this.rights[leftIndex]-this.lefts[leftIndex]},getTopOffset:function(topIndex){return this.ensureBuilt(),this.tops[topIndex]},getTopPosition:function(topIndex){return this.ensureBuilt(),this.tops[topIndex]-this.origin.top},getBottomOffset:function(topIndex){return this.ensureBuilt(),this.bottoms[topIndex]},getBottomPosition:function(topIndex){return this.ensureBuilt(),this.bottoms[topIndex]-this.origin.top},getHeight:function(topIndex){return this.ensureBuilt(),this.bottoms[topIndex]-this.tops[topIndex]}}),DragListener=FC.DragListener=Class.extend(ListenerMixin,MouseIgnorerMixin,{options:null,subjectEl:null,subjectHref:null,originX:null,originY:null,scrollEl:null,isInteracting:!1,isDistanceSurpassed:!1,isDelayEnded:!1,isDragging:!1,isTouch:!1,delay:null,delayTimeoutId:null,minDistance:null,handleTouchScrollProxy:null,constructor:function(options){this.options=options||{},this.handleTouchScrollProxy=proxy(this,"handleTouchScroll"),this.initMouseIgnoring(500)},startInteraction:function(ev,extraOptions){var isTouch=getEvIsTouch(ev);if("mousedown"===ev.type){if(this.isIgnoringMouse)return;if(!isPrimaryMouseButton(ev))return;ev.preventDefault()}this.isInteracting||(extraOptions=extraOptions||{},this.delay=firstDefined(extraOptions.delay,this.options.delay,0),this.minDistance=firstDefined(extraOptions.distance,this.options.distance,0),this.subjectEl=this.options.subjectEl,this.isInteracting=!0,this.isTouch=isTouch,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.originX=getEvX(ev),this.originY=getEvY(ev),this.scrollEl=getScrollParent($(ev.target)),this.bindHandlers(),this.initAutoScroll(),this.handleInteractionStart(ev),this.startDelay(ev),this.minDistance||this.handleDistanceSurpassed(ev))},handleInteractionStart:function(ev){this.trigger("interactionStart",ev)},endInteraction:function(ev,isCancelled){this.isInteracting&&(this.endDrag(ev),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null),this.destroyAutoScroll(),this.unbindHandlers(),this.isInteracting=!1,this.handleInteractionEnd(ev,isCancelled),this.isTouch&&this.tempIgnoreMouse())},handleInteractionEnd:function(ev,isCancelled){this.trigger("interactionEnd",ev,isCancelled||!1)},bindHandlers:function(){var handler,_this=this,touchStartIgnores=1;this.isTouch?(this.listenTo($(document),{touchmove:this.handleTouchMove,touchend:this.endInteraction,touchcancel:this.endInteraction,touchstart:function(ev){touchStartIgnores?touchStartIgnores--:_this.endInteraction(ev,!0)}}),handler=this.handleTouchScrollProxy,window.addEventListener&&(window.addEventListener("scroll",handler,!0),1)||!this.scrollEl||this.listenTo(this.scrollEl,"scroll",this.handleTouchScroll)):this.listenTo($(document),{mousemove:this.handleMouseMove,mouseup:this.endInteraction}),this.listenTo($(document),{selectstart:preventDefault,contextmenu:preventDefault})},unbindHandlers:function(){var handler;this.stopListeningTo($(document)),handler=this.handleTouchScrollProxy,window.removeEventListener&&window.removeEventListener("scroll",handler,!0),this.scrollEl&&this.stopListeningTo(this.scrollEl,"scroll")},startDrag:function(ev,extraOptions){this.startInteraction(ev,extraOptions),this.isDragging||(this.isDragging=!0,this.handleDragStart(ev))},handleDragStart:function(ev){this.trigger("dragStart",ev),this.initHrefHack()},handleMove:function(ev){var dx=getEvX(ev)-this.originX,dy=getEvY(ev)-this.originY,minDistance=this.minDistance;this.isDistanceSurpassed||dx*dx+dy*dy>=minDistance*minDistance&&this.handleDistanceSurpassed(ev),this.isDragging&&this.handleDrag(dx,dy,ev)},handleDrag:function(dx,dy,ev){this.trigger("drag",dx,dy,ev),this.updateAutoScroll(ev)},endDrag:function(ev){this.isDragging&&(this.isDragging=!1,this.handleDragEnd(ev))},handleDragEnd:function(ev){this.trigger("dragEnd",ev),this.destroyHrefHack()},startDelay:function(initialEv){var _this=this;this.delay?this.delayTimeoutId=setTimeout(function(){_this.handleDelayEnd(initialEv)},this.delay):this.handleDelayEnd(initialEv)},handleDelayEnd:function(initialEv){this.isDelayEnded=!0,this.isDistanceSurpassed&&this.startDrag(initialEv)},handleDistanceSurpassed:function(ev){this.isDistanceSurpassed=!0,this.isDelayEnded&&this.startDrag(ev)},handleTouchMove:function(ev){this.isDragging&&ev.preventDefault(),this.handleMove(ev)},handleMouseMove:function(ev){this.handleMove(ev)},handleTouchScroll:function(ev){this.isDragging||this.endInteraction(ev,!0)},initHrefHack:function(){var subjectEl=this.subjectEl;(this.subjectHref=subjectEl?subjectEl.attr("href"):null)&&subjectEl.removeAttr("href")},destroyHrefHack:function(){var subjectEl=this.subjectEl,subjectHref=this.subjectHref;setTimeout(function(){subjectHref&&subjectEl.attr("href",subjectHref)},0)},trigger:function(name){this.options[name]&&this.options[name].apply(this,Array.prototype.slice.call(arguments,1)),this["_"+name]&&this["_"+name].apply(this,Array.prototype.slice.call(arguments,1))}});DragListener.mixin({isAutoScroll:!1,scrollBounds:null,scrollTopVel:null,scrollLeftVel:null,scrollIntervalId:null,scrollSensitivity:30,scrollSpeed:200,scrollIntervalMs:50,initAutoScroll:function(){var scrollEl=this.scrollEl;this.isAutoScroll=this.options.scroll&&scrollEl&&!scrollEl.is(window)&&!scrollEl.is(document),this.isAutoScroll&&this.listenTo(scrollEl,"scroll",debounce(this.handleDebouncedScroll,100))},destroyAutoScroll:function(){this.endAutoScroll(),this.isAutoScroll&&this.stopListeningTo(this.scrollEl,"scroll")},computeScrollBounds:function(){this.isAutoScroll&&(this.scrollBounds=getOuterRect(this.scrollEl))},updateAutoScroll:function(ev){var topCloseness,bottomCloseness,leftCloseness,rightCloseness,sensitivity=this.scrollSensitivity,bounds=this.scrollBounds,topVel=0,leftVel=0;bounds&&(topCloseness=(sensitivity-(getEvY(ev)-bounds.top))/sensitivity,bottomCloseness=(sensitivity-(bounds.bottom-getEvY(ev)))/sensitivity,leftCloseness=(sensitivity-(getEvX(ev)-bounds.left))/sensitivity,rightCloseness=(sensitivity-(bounds.right-getEvX(ev)))/sensitivity,topCloseness>=0&&topCloseness<=1?topVel=topCloseness*this.scrollSpeed*-1:bottomCloseness>=0&&bottomCloseness<=1&&(topVel=bottomCloseness*this.scrollSpeed),leftCloseness>=0&&leftCloseness<=1?leftVel=leftCloseness*this.scrollSpeed*-1:rightCloseness>=0&&rightCloseness<=1&&(leftVel=rightCloseness*this.scrollSpeed)),this.setScrollVel(topVel,leftVel)},setScrollVel:function(topVel,leftVel){this.scrollTopVel=topVel,this.scrollLeftVel=leftVel,this.constrainScrollVel(),!this.scrollTopVel&&!this.scrollLeftVel||this.scrollIntervalId||(this.scrollIntervalId=setInterval(proxy(this,"scrollIntervalFunc"),this.scrollIntervalMs))},constrainScrollVel:function(){var el=this.scrollEl;this.scrollTopVel<0?el.scrollTop()<=0&&(this.scrollTopVel=0):this.scrollTopVel>0&&el.scrollTop()+el[0].clientHeight>=el[0].scrollHeight&&(this.scrollTopVel=0),this.scrollLeftVel<0?el.scrollLeft()<=0&&(this.scrollLeftVel=0):this.scrollLeftVel>0&&el.scrollLeft()+el[0].clientWidth>=el[0].scrollWidth&&(this.scrollLeftVel=0)},scrollIntervalFunc:function(){var el=this.scrollEl,frac=this.scrollIntervalMs/1e3;this.scrollTopVel&&el.scrollTop(el.scrollTop()+this.scrollTopVel*frac),this.scrollLeftVel&&el.scrollLeft(el.scrollLeft()+this.scrollLeftVel*frac),this.constrainScrollVel(),this.scrollTopVel||this.scrollLeftVel||this.endAutoScroll()},endAutoScroll:function(){this.scrollIntervalId&&(clearInterval(this.scrollIntervalId),this.scrollIntervalId=null,this.handleScrollEnd())},handleDebouncedScroll:function(){this.scrollIntervalId||this.handleScrollEnd()},handleScrollEnd:function(){}});var HitDragListener=DragListener.extend({component:null,origHit:null,hit:null,coordAdjust:null,constructor:function(component,options){DragListener.call(this,options),this.component=component},handleInteractionStart:function(ev){var subjectRect,origPoint,point,point1,point2,rect,subjectEl=this.subjectEl;this.computeCoords(),ev?(point=origPoint={left:getEvX(ev),top:getEvY(ev)},subjectEl&&(point=function(point,rect){return{left:Math.min(Math.max(point.left,rect.left),rect.right),top:Math.min(Math.max(point.top,rect.top),rect.bottom)}}(point,subjectRect=getOuterRect(subjectEl))),this.origHit=this.queryHit(point.left,point.top),subjectEl&&this.options.subjectCenter&&(this.origHit&&(subjectRect=intersectRects(this.origHit,subjectRect)||subjectRect),point={left:((rect=subjectRect).left+rect.right)/2,top:(rect.top+rect.bottom)/2}),this.coordAdjust=(point2=origPoint,{left:(point1=point).left-point2.left,top:point1.top-point2.top})):(this.origHit=null,this.coordAdjust=null),DragListener.prototype.handleInteractionStart.apply(this,arguments)},computeCoords:function(){this.component.prepareHits(),this.computeScrollBounds()},handleDragStart:function(ev){var hit;DragListener.prototype.handleDragStart.apply(this,arguments),(hit=this.queryHit(getEvX(ev),getEvY(ev)))&&this.handleHitOver(hit)},handleDrag:function(dx,dy,ev){var hit;DragListener.prototype.handleDrag.apply(this,arguments),isHitsEqual(hit=this.queryHit(getEvX(ev),getEvY(ev)),this.hit)||(this.hit&&this.handleHitOut(),hit&&this.handleHitOver(hit))},handleDragEnd:function(){this.handleHitDone(),DragListener.prototype.handleDragEnd.apply(this,arguments)},handleHitOver:function(hit){var isOrig=isHitsEqual(hit,this.origHit);this.hit=hit,this.trigger("hitOver",this.hit,isOrig,this.origHit)},handleHitOut:function(){this.hit&&(this.trigger("hitOut",this.hit),this.handleHitDone(),this.hit=null)},handleHitDone:function(){this.hit&&this.trigger("hitDone",this.hit)},handleInteractionEnd:function(){DragListener.prototype.handleInteractionEnd.apply(this,arguments),this.origHit=null,this.hit=null,this.component.releaseHits()},handleScrollEnd:function(){DragListener.prototype.handleScrollEnd.apply(this,arguments),this.computeCoords()},queryHit:function(left,top){return this.coordAdjust&&(left+=this.coordAdjust.left,top+=this.coordAdjust.top),this.component.queryHit(left,top)}});function isHitsEqual(hit0,hit1){return!hit0&&!hit1||!(!hit0||!hit1)&&(hit0.component===hit1.component&&isHitPropsWithin(hit0,hit1)&&isHitPropsWithin(hit1,hit0))}function isHitPropsWithin(subHit,superHit){for(var propName in subHit)if(!/^(component|left|right|top|bottom)$/.test(propName)&&subHit[propName]!==superHit[propName])return!1;return!0}var MouseFollower=Class.extend(ListenerMixin,{options:null,sourceEl:null,el:null,parentEl:null,top0:null,left0:null,y0:null,x0:null,topDelta:null,leftDelta:null,isFollowing:!1,isHidden:!1,isAnimating:!1,constructor:function(sourceEl,options){this.options=options=options||{},this.sourceEl=sourceEl,this.parentEl=options.parentEl?$(options.parentEl):sourceEl.parent()},start:function(ev){this.isFollowing||(this.isFollowing=!0,this.y0=getEvY(ev),this.x0=getEvX(ev),this.topDelta=0,this.leftDelta=0,this.isHidden||this.updatePosition(),getEvIsTouch(ev)?this.listenTo($(document),"touchmove",this.handleMove):this.listenTo($(document),"mousemove",this.handleMove))},stop:function(shouldRevert,callback){var _this=this,revertDuration=this.options.revertDuration;function complete(){this.isAnimating=!1,_this.removeElement(),this.top0=this.left0=null,callback&&callback()}this.isFollowing&&!this.isAnimating&&(this.isFollowing=!1,this.stopListeningTo($(document)),shouldRevert&&revertDuration&&!this.isHidden?(this.isAnimating=!0,this.el.animate({top:this.top0,left:this.left0},{duration:revertDuration,complete:complete})):complete())},getEl:function(){var el=this.el;return el||(this.sourceEl.width(),(el=this.el=this.sourceEl.clone().addClass(this.options.additionalClass||"").css({position:"absolute",visibility:"",display:this.isHidden?"none":"",margin:0,right:"auto",bottom:"auto",width:this.sourceEl.width(),height:this.sourceEl.height(),opacity:this.options.opacity||"",zIndex:this.options.zIndex})).addClass("fc-unselectable"),el.appendTo(this.parentEl)),el},removeElement:function(){this.el&&(this.el.remove(),this.el=null)},updatePosition:function(){var sourceOffset,origin;this.getEl(),null===this.top0&&(this.sourceEl.width(),sourceOffset=this.sourceEl.offset(),origin=this.el.offsetParent().offset(),this.top0=sourceOffset.top-origin.top,this.left0=sourceOffset.left-origin.left),this.el.css({top:this.top0+this.topDelta,left:this.left0+this.leftDelta})},handleMove:function(ev){this.topDelta=getEvY(ev)-this.y0,this.leftDelta=getEvX(ev)-this.x0,this.isHidden||this.updatePosition()},hide:function(){this.isHidden||(this.isHidden=!0,this.el&&this.el.hide())},show:function(){this.isHidden&&(this.isHidden=!1,this.updatePosition(),this.getEl().show())}}),Grid=FC.Grid=Class.extend(ListenerMixin,MouseIgnorerMixin,{view:null,isRTL:null,start:null,end:null,el:null,elsByFill:null,eventTimeFormat:null,displayEventTime:null,displayEventEnd:null,minResizeDuration:null,largeUnit:null,dayDragListener:null,segDragListener:null,segResizeListener:null,externalDragListener:null,constructor:function(view){this.view=view,this.isRTL=view.opt("isRTL"),this.elsByFill={},this.dayDragListener=this.buildDayDragListener(),this.initMouseIgnoring()},computeEventTimeFormat:function(){return this.view.opt("smallTimeFormat")},computeDisplayEventTime:function(){return!0},computeDisplayEventEnd:function(){return!0},setRange:function(range){this.start=range.start.clone(),this.end=range.end.clone(),this.rangeUpdated(),this.processRangeOptions()},rangeUpdated:function(){},processRangeOptions:function(){var displayEventTime,displayEventEnd,view=this.view;this.eventTimeFormat=view.opt("eventTimeFormat")||view.opt("timeFormat")||this.computeEventTimeFormat(),null==(displayEventTime=view.opt("displayEventTime"))&&(displayEventTime=this.computeDisplayEventTime()),null==(displayEventEnd=view.opt("displayEventEnd"))&&(displayEventEnd=this.computeDisplayEventEnd()),this.displayEventTime=displayEventTime,this.displayEventEnd=displayEventEnd},spanToSegs:function(span){},diffDates:function(a,b){return this.largeUnit?diffByUnit(a,b,this.largeUnit):diffDayTime(a,b)},prepareHits:function(){},releaseHits:function(){},queryHit:function(leftOffset,topOffset){},getHitSpan:function(hit){},getHitEl:function(hit){},setElement:function(el){this.el=el,function(el){el.addClass("fc-unselectable").on("selectstart",preventDefault)}(el),this.bindDayHandler("touchstart",this.dayTouchStart),this.bindDayHandler("mousedown",this.dayMousedown),this.bindSegHandlers(),this.bindGlobalHandlers()},bindDayHandler:function(name,handler){var _this=this;this.el.on(name,function(ev){if(!$(ev.target).is(".fc-event-container *, .fc-more")&&!$(ev.target).closest(".fc-popover").length)return handler.call(_this,ev)})},removeElement:function(){this.unbindGlobalHandlers(),this.clearDragListeners(),this.el.remove()},renderSkeleton:function(){},renderDates:function(){},unrenderDates:function(){},bindGlobalHandlers:function(){this.listenTo($(document),{dragstart:this.externalDragStart,sortstart:this.externalDragStart})},unbindGlobalHandlers:function(){this.stopListeningTo($(document))},dayMousedown:function(ev){this.isIgnoringMouse||this.dayDragListener.startInteraction(ev,{})},dayTouchStart:function(ev){var view=this.view;(view.isSelected||view.selectedEvent)&&this.tempIgnoreMouse(),this.dayDragListener.startInteraction(ev,{delay:this.view.opt("longPressDelay")})},buildDayDragListener:function(){var dayClickHit,selectionSpan,_this=this,view=this.view,isSelectable=view.opt("selectable"),dragListener=new HitDragListener(this,{scroll:view.opt("dragScroll"),interactionStart:function(){dayClickHit=dragListener.origHit},dragStart:function(){view.unselect()},hitOver:function(hit,isOrig,origHit){origHit&&(isOrig||(dayClickHit=null),isSelectable&&((selectionSpan=_this.computeSelection(_this.getHitSpan(origHit),_this.getHitSpan(hit)))?_this.renderSelection(selectionSpan):!1===selectionSpan&&disableCursor()))},hitOut:function(){dayClickHit=null,selectionSpan=null,_this.unrenderSelection(),enableCursor()},interactionEnd:function(ev,isCancelled){isCancelled||(dayClickHit&&!_this.isIgnoringMouse&&view.triggerDayClick(_this.getHitSpan(dayClickHit),_this.getHitEl(dayClickHit),ev),selectionSpan&&view.reportSelection(selectionSpan,ev),enableCursor())}});return dragListener},clearDragListeners:function(){this.dayDragListener.endInteraction(),this.segDragListener&&this.segDragListener.endInteraction(),this.segResizeListener&&this.segResizeListener.endInteraction(),this.externalDragListener&&this.externalDragListener.endInteraction()},renderEventLocationHelper:function(eventLocation,sourceSeg){var fakeEvent=this.fabricateHelperEvent(eventLocation,sourceSeg);return this.renderHelper(fakeEvent,sourceSeg)},fabricateHelperEvent:function(eventLocation,sourceSeg){var fakeEvent=sourceSeg?createObject(sourceSeg.event):{};return fakeEvent.start=eventLocation.start.clone(),fakeEvent.end=eventLocation.end?eventLocation.end.clone():null,fakeEvent.allDay=null,this.view.calendar.normalizeEventDates(fakeEvent),fakeEvent.className=(fakeEvent.className||[]).concat("fc-helper"),sourceSeg||(fakeEvent.editable=!1),fakeEvent},renderHelper:function(eventLocation,sourceSeg){},unrenderHelper:function(){},renderSelection:function(span){this.renderHighlight(span)},unrenderSelection:function(){this.unrenderHighlight()},computeSelection:function(span0,span1){var span=this.computeSelectionSpan(span0,span1);return!(span&&!this.view.calendar.isSelectionSpanAllowed(span))&&span},computeSelectionSpan:function(span0,span1){var dates=[span0.start,span0.end,span1.start,span1.end];return dates.sort(compareNumbers),{start:dates[0].clone(),end:dates[3].clone()}},renderHighlight:function(span){this.renderFill("highlight",this.spanToSegs(span))},unrenderHighlight:function(){this.unrenderFill("highlight")},highlightSegClasses:function(){return["fc-highlight"]},renderBusinessHours:function(){},unrenderBusinessHours:function(){},getNowIndicatorUnit:function(){},renderNowIndicator:function(date){},unrenderNowIndicator:function(){},renderFill:function(type,segs){},unrenderFill:function(type){var el=this.elsByFill[type];el&&(el.remove(),delete this.elsByFill[type])},renderFillSegEls:function(type,segs){var i,_this=this,segElMethod=this[type+"SegEl"],html="",renderedSegs=[];if(segs.length){for(i=0;i<segs.length;i++)html+=this.fillSegHtml(type,segs[i]);$(html).each(function(i,node){var seg=segs[i],el=$(node);segElMethod&&(el=segElMethod.call(_this,seg,el)),el&&(el=$(el)).is(_this.fillSegTag)&&(seg.el=el,renderedSegs.push(seg))})}return renderedSegs},fillSegTag:"div",fillSegHtml:function(type,seg){var classesMethod=this[type+"SegClasses"],cssMethod=this[type+"SegCss"],classes=classesMethod?classesMethod.call(this,seg):[],css=cssToStr(cssMethod?cssMethod.call(this,seg):{});return"<"+this.fillSegTag+(classes.length?' class="'+classes.join(" ")+'"':"")+(css?' style="'+css+'"':"")+" />"},getDayClasses:function(date){var view=this.view,today=view.calendar.getNow(),classes=["fc-"+dayIDs[date.day()]];return 1==view.intervalDuration.as("months")&&date.month()!=view.intervalStart.month()&&classes.push("fc-other-month"),date.isSame(today,"day")?classes.push("fc-today",view.highlightStateClass):date<today?classes.push("fc-past"):classes.push("fc-future"),classes}});function isBgEvent(event){var rendering=getEventRendering(event);return"background"===rendering||"inverse-background"===rendering}function getEventRendering(event){return firstDefined((event.source||{}).rendering,event.rendering)}function compareRanges(range1,range2){return range1.start-range2.start}Grid.mixin({mousedOverSeg:null,isDraggingSeg:!1,isResizingSeg:!1,isDraggingExternal:!1,segs:null,renderEvents:function(events){var i,bgEvents=[],fgEvents=[];for(i=0;i<events.length;i++)(isBgEvent(events[i])?bgEvents:fgEvents).push(events[i]);this.segs=[].concat(this.renderBgEvents(bgEvents),this.renderFgEvents(fgEvents))},renderBgEvents:function(events){var segs=this.eventsToSegs(events);return this.renderBgSegs(segs)||segs},renderFgEvents:function(events){var segs=this.eventsToSegs(events);return this.renderFgSegs(segs)||segs},unrenderEvents:function(){this.handleSegMouseout(),this.clearDragListeners(),this.unrenderFgSegs(),this.unrenderBgSegs(),this.segs=null},getEventSegs:function(){return this.segs||[]},renderFgSegs:function(segs){},unrenderFgSegs:function(){},renderFgSegEls:function(segs,disableResizing){var i,view=this.view,html="",renderedSegs=[];if(segs.length){for(i=0;i<segs.length;i++)html+=this.fgSegHtml(segs[i],disableResizing);$(html).each(function(i,node){var seg=segs[i],el=view.resolveEventEl(seg.event,$(node));el&&(el.data("fc-seg",seg),seg.el=el,renderedSegs.push(seg))})}return renderedSegs},fgSegHtml:function(seg,disableResizing){},renderBgSegs:function(segs){return this.renderFill("bgEvent",segs)},unrenderBgSegs:function(){this.unrenderFill("bgEvent")},bgEventSegEl:function(seg,el){return this.view.resolveEventEl(seg.event,el)},bgEventSegClasses:function(seg){var event=seg.event,source=event.source||{};return["fc-bgevent"].concat(event.className,source.className||[])},bgEventSegCss:function(seg){return{"background-color":this.getSegSkinCss(seg)["background-color"]}},businessHoursSegClasses:function(seg){return["fc-nonbusiness","fc-bgevent"]},bindSegHandlers:function(){this.bindSegHandler("touchstart",this.handleSegTouchStart),this.bindSegHandler("touchend",this.handleSegTouchEnd),this.bindSegHandler("mouseenter",this.handleSegMouseover),this.bindSegHandler("mouseleave",this.handleSegMouseout),this.bindSegHandler("mousedown",this.handleSegMousedown),this.bindSegHandler("click",this.handleSegClick)},bindSegHandler:function(name,handler){var _this=this;this.el.on(name,".fc-event-container > *",function(ev){var seg=$(this).data("fc-seg");if(seg&&!_this.isDraggingSeg&&!_this.isResizingSeg)return handler.call(_this,seg,ev)})},handleSegClick:function(seg,ev){return this.view.trigger("eventClick",seg.el[0],seg.event,ev)},handleSegMouseover:function(seg,ev){this.isIgnoringMouse||this.mousedOverSeg||(this.mousedOverSeg=seg,seg.el.addClass("fc-allow-mouse-resize"),this.view.trigger("eventMouseover",seg.el[0],seg.event,ev))},handleSegMouseout:function(seg,ev){ev=ev||{},this.mousedOverSeg&&(seg=seg||this.mousedOverSeg,this.mousedOverSeg=null,seg.el.removeClass("fc-allow-mouse-resize"),this.view.trigger("eventMouseout",seg.el[0],seg.event,ev))},handleSegMousedown:function(seg,ev){!this.startSegResize(seg,ev,{distance:5})&&this.view.isEventDraggable(seg.event)&&this.buildSegDragListener(seg).startInteraction(ev,{distance:5})},handleSegTouchStart:function(seg,ev){var view=this.view,event=seg.event,isSelected=view.isEventSelected(event),isDraggable=view.isEventDraggable(event),isResizable=view.isEventResizable(event),isResizing=!1;isSelected&&isResizable&&(isResizing=this.startSegResize(seg,ev)),isResizing||!isDraggable&&!isResizable||(isDraggable?this.buildSegDragListener(seg):this.buildSegSelectListener(seg)).startInteraction(ev,{delay:isSelected?0:this.view.opt("longPressDelay")}),this.tempIgnoreMouse()},handleSegTouchEnd:function(seg,ev){this.tempIgnoreMouse()},startSegResize:function(seg,ev,dragOptions){return!!$(ev.target).is(".fc-resizer")&&(this.buildSegResizeListener(seg,$(ev.target).is(".fc-start-resizer")).startInteraction(ev,dragOptions),!0)},buildSegDragListener:function(seg){var isDragging,mouseFollower,dropLocation,_this=this,view=this.view,calendar=view.calendar,el=seg.el,event=seg.event;if(this.segDragListener)return this.segDragListener;var dragListener=this.segDragListener=new HitDragListener(view,{scroll:view.opt("dragScroll"),subjectEl:el,subjectCenter:!0,interactionStart:function(ev){isDragging=!1,(mouseFollower=new MouseFollower(seg.el,{additionalClass:"fc-dragging",parentEl:view.el,opacity:dragListener.isTouch?null:view.opt("dragOpacity"),revertDuration:view.opt("dragRevertDuration"),zIndex:2})).hide(),mouseFollower.start(ev)},dragStart:function(ev){dragListener.isTouch&&!view.isEventSelected(event)&&view.selectEvent(event),isDragging=!0,_this.handleSegMouseout(seg,ev),_this.segDragStart(seg,ev),view.hideEvent(event)},hitOver:function(hit,isOrig,origHit){var dragHelperEls;seg.hit&&(origHit=seg.hit),(dropLocation=_this.computeEventDrop(origHit.component.getHitSpan(origHit),hit.component.getHitSpan(hit),event))&&!calendar.isEventSpanAllowed(_this.eventToSpan(dropLocation),event)&&(disableCursor(),dropLocation=null),dropLocation&&(dragHelperEls=view.renderDrag(dropLocation,seg))?(dragHelperEls.addClass("fc-dragging"),dragListener.isTouch||_this.applyDragOpacity(dragHelperEls),mouseFollower.hide()):mouseFollower.show(),isOrig&&(dropLocation=null)},hitOut:function(){view.unrenderDrag(),mouseFollower.show(),dropLocation=null},hitDone:function(){enableCursor()},interactionEnd:function(ev){mouseFollower.stop(!dropLocation,function(){isDragging&&(view.unrenderDrag(),view.showEvent(event),_this.segDragStop(seg,ev)),dropLocation&&view.reportEventDrop(event,dropLocation,this.largeUnit,el,ev)}),_this.segDragListener=null}});return dragListener},buildSegSelectListener:function(seg){var _this=this,view=this.view,event=seg.event;if(this.segDragListener)return this.segDragListener;var dragListener=this.segDragListener=new DragListener({dragStart:function(ev){dragListener.isTouch&&!view.isEventSelected(event)&&view.selectEvent(event)},interactionEnd:function(ev){_this.segDragListener=null}});return dragListener},segDragStart:function(seg,ev){this.isDraggingSeg=!0,this.view.trigger("eventDragStart",seg.el[0],seg.event,ev,{})},segDragStop:function(seg,ev){this.isDraggingSeg=!1,this.view.trigger("eventDragStop",seg.el[0],seg.event,ev,{})},computeEventDrop:function(startSpan,endSpan,event){var delta,dropLocation,calendar=this.view.calendar,dragStart=startSpan.start,dragEnd=endSpan.start;return dragStart.hasTime()===dragEnd.hasTime()?(delta=this.diffDates(dragEnd,dragStart),event.allDay&&durationHasTime(delta)?(dropLocation={start:event.start.clone(),end:calendar.getEventEnd(event),allDay:!1},calendar.normalizeEventTimes(dropLocation)):dropLocation={start:event.start.clone(),end:event.end?event.end.clone():null,allDay:event.allDay},dropLocation.start.add(delta),dropLocation.end&&dropLocation.end.add(delta)):dropLocation={start:dragEnd.clone(),end:null,allDay:!dragEnd.hasTime()},dropLocation},applyDragOpacity:function(els){var opacity=this.view.opt("dragOpacity");null!=opacity&&els.each(function(i,node){node.style.opacity=opacity})},externalDragStart:function(ev,ui){var el,accept,view=this.view;view.opt("droppable")&&(el=$((ui?ui.item:null)||ev.target),accept=view.opt("dropAccept"),($.isFunction(accept)?accept.call(el[0],el):el.is(accept))&&(this.isDraggingExternal||this.listenToExternalDrag(el,ev,ui)))},listenToExternalDrag:function(el,ev,ui){var dropLocation,_this=this,calendar=this.view.calendar,meta=function(el){var eventProps,startTime,duration,stick,prefix=FC.dataAttrPrefix;prefix&&(prefix+="-");(eventProps=el.data(prefix+"event")||null)&&(eventProps="object"==typeof eventProps?$.extend({},eventProps):{},null==(startTime=eventProps.start)&&(startTime=eventProps.time),duration=eventProps.duration,stick=eventProps.stick,delete eventProps.start,delete eventProps.time,delete eventProps.duration,delete eventProps.stick);null==startTime&&(startTime=el.data(prefix+"start"));null==startTime&&(startTime=el.data(prefix+"time"));null==duration&&(duration=el.data(prefix+"duration"));null==stick&&(stick=el.data(prefix+"stick"));return startTime=null!=startTime?moment.duration(startTime):null,duration=null!=duration?moment.duration(duration):null,stick=Boolean(stick),{eventProps:eventProps,startTime:startTime,duration:duration,stick:stick}}(el);(_this.externalDragListener=new HitDragListener(this,{interactionStart:function(){_this.isDraggingExternal=!0},hitOver:function(hit){(dropLocation=_this.computeExternalDrop(hit.component.getHitSpan(hit),meta))&&!calendar.isExternalSpanAllowed(_this.eventToSpan(dropLocation),dropLocation,meta.eventProps)&&(disableCursor(),dropLocation=null),dropLocation&&_this.renderDrag(dropLocation)},hitOut:function(){dropLocation=null},hitDone:function(){enableCursor(),_this.unrenderDrag()},interactionEnd:function(ev){dropLocation&&_this.view.reportExternalDrop(meta,dropLocation,el,ev,ui),_this.isDraggingExternal=!1,_this.externalDragListener=null}})).startDrag(ev)},computeExternalDrop:function(span,meta){var dropLocation={start:this.view.calendar.applyTimezone(span.start),end:null};return meta.startTime&&!dropLocation.start.hasTime()&&dropLocation.start.time(meta.startTime),meta.duration&&(dropLocation.end=dropLocation.start.clone().add(meta.duration)),dropLocation},renderDrag:function(dropLocation,seg){},unrenderDrag:function(){},buildSegResizeListener:function(seg,isStart){var isDragging,resizeLocation,_this=this,view=this.view,calendar=view.calendar,el=seg.el,event=seg.event,eventEnd=calendar.getEventEnd(event);return this.segResizeListener=new HitDragListener(this,{scroll:view.opt("dragScroll"),subjectEl:el,interactionStart:function(){isDragging=!1},dragStart:function(ev){isDragging=!0,_this.handleSegMouseout(seg,ev),_this.segResizeStart(seg,ev)},hitOver:function(hit,isOrig,origHit){var origHitSpan=_this.getHitSpan(origHit),hitSpan=_this.getHitSpan(hit);(resizeLocation=isStart?_this.computeEventStartResize(origHitSpan,hitSpan,event):_this.computeEventEndResize(origHitSpan,hitSpan,event))&&(calendar.isEventSpanAllowed(_this.eventToSpan(resizeLocation),event)?resizeLocation.start.isSame(event.start)&&resizeLocation.end.isSame(eventEnd)&&(resizeLocation=null):(disableCursor(),resizeLocation=null)),resizeLocation&&(view.hideEvent(event),_this.renderEventResize(resizeLocation,seg))},hitOut:function(){resizeLocation=null},hitDone:function(){_this.unrenderEventResize(),view.showEvent(event),enableCursor()},interactionEnd:function(ev){isDragging&&_this.segResizeStop(seg,ev),resizeLocation&&view.reportEventResize(event,resizeLocation,this.largeUnit,el,ev),_this.segResizeListener=null}})},segResizeStart:function(seg,ev){this.isResizingSeg=!0,this.view.trigger("eventResizeStart",seg.el[0],seg.event,ev,{})},segResizeStop:function(seg,ev){this.isResizingSeg=!1,this.view.trigger("eventResizeStop",seg.el[0],seg.event,ev,{})},computeEventStartResize:function(startSpan,endSpan,event){return this.computeEventResize("start",startSpan,endSpan,event)},computeEventEndResize:function(startSpan,endSpan,event){return this.computeEventResize("end",startSpan,endSpan,event)},computeEventResize:function(type,startSpan,endSpan,event){var resizeLocation,defaultDuration,calendar=this.view.calendar,delta=this.diffDates(endSpan[type],startSpan[type]);return(resizeLocation={start:event.start.clone(),end:calendar.getEventEnd(event),allDay:event.allDay}).allDay&&durationHasTime(delta)&&(resizeLocation.allDay=!1,calendar.normalizeEventTimes(resizeLocation)),resizeLocation[type].add(delta),resizeLocation.start.isBefore(resizeLocation.end)||(defaultDuration=this.minResizeDuration||(event.allDay?calendar.defaultAllDayEventDuration:calendar.defaultTimedEventDuration),"start"==type?resizeLocation.start=resizeLocation.end.clone().subtract(defaultDuration):resizeLocation.end=resizeLocation.start.clone().add(defaultDuration)),resizeLocation},renderEventResize:function(range,seg){},unrenderEventResize:function(){},getEventTimeText:function(range,formatStr,displayEnd){return null==formatStr&&(formatStr=this.eventTimeFormat),null==displayEnd&&(displayEnd=this.displayEventEnd),this.displayEventTime&&range.start.hasTime()?displayEnd&&range.end?this.view.formatRange(range,formatStr):range.start.format(formatStr):""},getSegClasses:function(seg,isDraggable,isResizable){var view=this.view,event=seg.event,classes=["fc-event",seg.isStart?"fc-start":"fc-not-start",seg.isEnd?"fc-end":"fc-not-end"].concat(event.className,event.source?event.source.className:[]);return isDraggable&&classes.push("fc-draggable"),isResizable&&classes.push("fc-resizable"),view.isEventSelected(event)&&classes.push("fc-selected"),classes},getSegSkinCss:function(seg){var event=seg.event,view=this.view,source=event.source||{},eventColor=event.color,sourceColor=source.color,optionColor=view.opt("eventColor");return{"background-color":event.backgroundColor||eventColor||source.backgroundColor||sourceColor||view.opt("eventBackgroundColor")||optionColor,"border-color":event.borderColor||eventColor||source.borderColor||sourceColor||view.opt("eventBorderColor")||optionColor,color:event.textColor||source.textColor||view.opt("eventTextColor")}},eventToSegs:function(event){return this.eventsToSegs([event])},eventToSpan:function(event){return this.eventToSpans(event)[0]},eventToSpans:function(event){var range=this.eventToRange(event);return this.eventRangeToSpans(range,event)},eventsToSegs:function(allEvents,segSliceFunc){var _this=this,eventsById=function(events){var i,event,eventsById={};for(i=0;i<events.length;i++)event=events[i],(eventsById[event._id]||(eventsById[event._id]=[])).push(event);return eventsById}(allEvents),segs=[];return $.each(eventsById,function(id,events){var i,ranges=[];for(i=0;i<events.length;i++)ranges.push(_this.eventToRange(events[i]));if("inverse-background"===getEventRendering(events[0]))for(ranges=_this.invertRanges(ranges),i=0;i<ranges.length;i++)segs.push.apply(segs,_this.eventRangeToSegs(ranges[i],events[0],segSliceFunc));else for(i=0;i<ranges.length;i++)segs.push.apply(segs,_this.eventRangeToSegs(ranges[i],events[i],segSliceFunc))}),segs},eventToRange:function(event){return{start:event.start.clone().stripZone(),end:(event.end?event.end.clone():this.view.calendar.getDefaultEventEnd(null!=event.allDay?event.allDay:!event.start.hasTime(),event.start)).stripZone()}},eventRangeToSegs:function(range,event,segSliceFunc){var i,spans=this.eventRangeToSpans(range,event),segs=[];for(i=0;i<spans.length;i++)segs.push.apply(segs,this.eventSpanToSegs(spans[i],event,segSliceFunc));return segs},eventRangeToSpans:function(range,event){return[$.extend({},range)]},eventSpanToSegs:function(span,event,segSliceFunc){var i,seg,segs=segSliceFunc?segSliceFunc(span):this.spanToSegs(span);for(i=0;i<segs.length;i++)(seg=segs[i]).event=event,seg.eventStartMS=+span.start,seg.eventDurationMS=span.end-span.start;return segs},invertRanges:function(ranges){var i,range,view=this.view,viewStart=view.start.clone(),viewEnd=view.end.clone(),inverseRanges=[],start=viewStart;for(ranges.sort(compareRanges),i=0;i<ranges.length;i++)(range=ranges[i]).start>start&&inverseRanges.push({start:start,end:range.start}),start=range.end;return start<viewEnd&&inverseRanges.push({start:start,end:viewEnd}),inverseRanges},sortEventSegs:function(segs){segs.sort(proxy(this,"compareEventSegs"))},compareEventSegs:function(seg1,seg2){return seg1.eventStartMS-seg2.eventStartMS||seg2.eventDurationMS-seg1.eventDurationMS||seg2.event.allDay-seg1.event.allDay||compareByFieldSpecs(seg1.event,seg2.event,this.view.eventOrderSpecs)}}),FC.isBgEvent=isBgEvent,FC.dataAttrPrefix="";var DayTableMixin=FC.DayTableMixin={breakOnWeeks:!1,dayDates:null,dayIndices:null,daysPerRow:null,rowCnt:null,colCnt:null,colHeadFormat:null,updateDayTable:function(){for(var daysPerRow,firstDay,rowCnt,view=this.view,date=this.start.clone(),dayIndex=-1,dayIndices=[],dayDates=[];date.isBefore(this.end);)view.isHiddenDay(date)?dayIndices.push(dayIndex+.5):(dayIndex++,dayIndices.push(dayIndex),dayDates.push(date.clone())),date.add(1,"days");if(this.breakOnWeeks){for(firstDay=dayDates[0].day(),daysPerRow=1;daysPerRow<dayDates.length&&dayDates[daysPerRow].day()!=firstDay;daysPerRow++);rowCnt=Math.ceil(dayDates.length/daysPerRow)}else rowCnt=1,daysPerRow=dayDates.length;this.dayDates=dayDates,this.dayIndices=dayIndices,this.daysPerRow=daysPerRow,this.rowCnt=rowCnt,this.updateDayTableCols()},updateDayTableCols:function(){this.colCnt=this.computeColCnt(),this.colHeadFormat=this.view.opt("columnFormat")||this.computeColHeadFormat()},computeColCnt:function(){return this.daysPerRow},getCellDate:function(row,col){return this.dayDates[this.getCellDayIndex(row,col)].clone()},getCellRange:function(row,col){var start=this.getCellDate(row,col);return{start:start,end:start.clone().add(1,"days")}},getCellDayIndex:function(row,col){return row*this.daysPerRow+this.getColDayIndex(col)},getColDayIndex:function(col){return this.isRTL?this.colCnt-1-col:col},getDateDayIndex:function(date){var dayIndices=this.dayIndices,dayOffset=date.diff(this.start,"days");return dayOffset<0?dayIndices[0]-1:dayOffset>=dayIndices.length?dayIndices[dayIndices.length-1]+1:dayIndices[dayOffset]},computeColHeadFormat:function(){return this.rowCnt>1||this.colCnt>10?"ddd":this.colCnt>1?this.view.opt("dayOfMonthFormat"):"dddd"},sliceRangeByRow:function(range){var row,rowFirst,rowLast,segFirst,segLast,daysPerRow=this.daysPerRow,normalRange=this.view.computeDayRange(range),rangeFirst=this.getDateDayIndex(normalRange.start),rangeLast=this.getDateDayIndex(normalRange.end.clone().subtract(1,"days")),segs=[];for(row=0;row<this.rowCnt;row++)rowLast=(rowFirst=row*daysPerRow)+daysPerRow-1,segFirst=Math.max(rangeFirst,rowFirst),segLast=Math.min(rangeLast,rowLast),(segFirst=Math.ceil(segFirst))<=(segLast=Math.floor(segLast))&&segs.push({row:row,firstRowDayIndex:segFirst-rowFirst,lastRowDayIndex:segLast-rowFirst,isStart:segFirst===rangeFirst,isEnd:segLast===rangeLast});return segs},sliceRangeByDay:function(range){var row,rowFirst,rowLast,i,segFirst,segLast,daysPerRow=this.daysPerRow,normalRange=this.view.computeDayRange(range),rangeFirst=this.getDateDayIndex(normalRange.start),rangeLast=this.getDateDayIndex(normalRange.end.clone().subtract(1,"days")),segs=[];for(row=0;row<this.rowCnt;row++)for(rowLast=(rowFirst=row*daysPerRow)+daysPerRow-1,i=rowFirst;i<=rowLast;i++)segFirst=Math.max(rangeFirst,i),segLast=Math.min(rangeLast,i),(segFirst=Math.ceil(segFirst))<=(segLast=Math.floor(segLast))&&segs.push({row:row,firstRowDayIndex:segFirst-rowFirst,lastRowDayIndex:segLast-rowFirst,isStart:segFirst===rangeFirst,isEnd:segLast===rangeLast});return segs},renderHeadHtml:function(){return'<div class="fc-row '+this.view.widgetHeaderClass+'"><table></table></div>'},renderHeadIntroHtml:function(){return this.renderIntroHtml()},renderHeadTrHtml:function(){return"<tr>"+(this.isRTL?"":this.renderHeadIntroHtml())+this.renderHeadDateCellsHtml()+(this.isRTL?this.renderHeadIntroHtml():"")+"</tr>"},renderHeadDateCellsHtml:function(){var col,date,htmls=[];for(col=0;col<this.colCnt;col++)date=this.getCellDate(0,col),htmls.push(this.renderHeadDateCellHtml(date));return htmls.join("")},renderHeadDateCellHtml:function(date,colspan,otherAttrs){return'<th class="fc-day-header '+this.view.widgetHeaderClass+" fc-"+dayIDs[date.day()]+'"'+(1==this.rowCnt?' data-date="'+date.format("YYYY-MM-DD")+'"':"")+(colspan>1?' colspan="'+colspan+'"':"")+(otherAttrs?" "+otherAttrs:"")+">"+htmlEscape(date.format(this.colHeadFormat))+"</th>"},renderBgTrHtml:function(row){return"<tr>"+(this.isRTL?"":this.renderBgIntroHtml(row))+this.renderBgCellsHtml(row)+(this.isRTL?this.renderBgIntroHtml(row):"")+"</tr>"},renderBgIntroHtml:function(row){return this.renderIntroHtml()},renderBgCellsHtml:function(row){var col,date,htmls=[];for(col=0;col<this.colCnt;col++)date=this.getCellDate(row,col),htmls.push(this.renderBgCellHtml(date));return htmls.join("")},renderBgCellHtml:function(date,otherAttrs){var view=this.view,classes=this.getDayClasses(date);return classes.unshift("fc-day",view.widgetContentClass),'<td class="'+classes.join(" ")+'" data-date="'+date.format("YYYY-MM-DD")+'"'+(otherAttrs?" "+otherAttrs:"")+"></td>"},renderIntroHtml:function(){},bookendCells:function(trEl){var introHtml=this.renderIntroHtml();introHtml&&(this.isRTL?trEl.append(introHtml):trEl.prepend(introHtml))}},DayGrid=FC.DayGrid=Grid.extend(DayTableMixin,{numbersVisible:!1,bottomCoordPadding:0,rowEls:null,cellEls:null,helperEls:null,rowCoordCache:null,colCoordCache:null,renderDates:function(isRigid){var row,col,view=this.view,rowCnt=this.rowCnt,colCnt=this.colCnt,html="";for(row=0;row<rowCnt;row++)html+=this.renderDayRowHtml(row,isRigid);for(this.el.html(html),this.rowEls=this.el.find(".fc-row"),this.cellEls=this.el.find(".fc-day"),this.rowCoordCache=new CoordCache({els:this.rowEls,isVertical:!0}),this.colCoordCache=new CoordCache({els:this.cellEls.slice(0,this.colCnt),isHorizontal:!0}),row=0;row<rowCnt;row++)for(col=0;col<colCnt;col++)view.trigger("dayRender",null,this.getCellDate(row,col),this.getCellEl(row,col))},unrenderDates:function(){this.removeSegPopover()},renderBusinessHours:function(){var events=this.view.calendar.getBusinessHoursEvents(!0),segs=this.eventsToSegs(events);this.renderFill("businessHours",segs,"bgevent")},renderDayRowHtml:function(row,isRigid){var classes=["fc-row","fc-week",this.view.widgetContentClass];return isRigid&&classes.push("fc-rigid"),'<div class="'+classes.join(" ")+'"><div class="fc-bg"><table>'+this.renderBgTrHtml(row)+'</table></div><div class="fc-content-skeleton"><table>'+(this.numbersVisible?"<thead>"+this.renderNumberTrHtml(row)+"</thead>":"")+"</table></div></div>"},renderNumberTrHtml:function(row){return"<tr>"+(this.isRTL?"":this.renderNumberIntroHtml(row))+this.renderNumberCellsHtml(row)+(this.isRTL?this.renderNumberIntroHtml(row):"")+"</tr>"},renderNumberIntroHtml:function(row){return this.renderIntroHtml()},renderNumberCellsHtml:function(row){var col,date,htmls=[];for(col=0;col<this.colCnt;col++)date=this.getCellDate(row,col),htmls.push(this.renderNumberCellHtml(date));return htmls.join("")},renderNumberCellHtml:function(date){var classes;return this.view.dayNumbersVisible?((classes=this.getDayClasses(date)).unshift("fc-day-number"),'<td class="'+classes.join(" ")+'" data-date="'+date.format()+'">'+date.date()+"</td>"):"<td/>"},computeEventTimeFormat:function(){return this.view.opt("extraSmallTimeFormat")},computeDisplayEventEnd:function(){return 1==this.colCnt},rangeUpdated:function(){this.updateDayTable()},spanToSegs:function(span){var i,seg,segs=this.sliceRangeByRow(span);for(i=0;i<segs.length;i++)seg=segs[i],this.isRTL?(seg.leftCol=this.daysPerRow-1-seg.lastRowDayIndex,seg.rightCol=this.daysPerRow-1-seg.firstRowDayIndex):(seg.leftCol=seg.firstRowDayIndex,seg.rightCol=seg.lastRowDayIndex);return segs},prepareHits:function(){this.colCoordCache.build(),this.rowCoordCache.build(),this.rowCoordCache.bottoms[this.rowCnt-1]+=this.bottomCoordPadding},releaseHits:function(){this.colCoordCache.clear(),this.rowCoordCache.clear()},queryHit:function(leftOffset,topOffset){var col=this.colCoordCache.getHorizontalIndex(leftOffset),row=this.rowCoordCache.getVerticalIndex(topOffset);if(null!=row&&null!=col)return this.getCellHit(row,col)},getHitSpan:function(hit){return this.getCellRange(hit.row,hit.col)},getHitEl:function(hit){return this.getCellEl(hit.row,hit.col)},getCellHit:function(row,col){return{row:row,col:col,component:this,left:this.colCoordCache.getLeftOffset(col),right:this.colCoordCache.getRightOffset(col),top:this.rowCoordCache.getTopOffset(row),bottom:this.rowCoordCache.getBottomOffset(row)}},getCellEl:function(row,col){return this.cellEls.eq(row*this.colCnt+col)},renderDrag:function(eventLocation,seg){if(this.renderHighlight(this.eventToSpan(eventLocation)),seg&&!seg.el.closest(this.el).length)return this.renderEventLocationHelper(eventLocation,seg)},unrenderDrag:function(){this.unrenderHighlight(),this.unrenderHelper()},renderEventResize:function(eventLocation,seg){return this.renderHighlight(this.eventToSpan(eventLocation)),this.renderEventLocationHelper(eventLocation,seg)},unrenderEventResize:function(){this.unrenderHighlight(),this.unrenderHelper()},renderHelper:function(event,sourceSeg){var rowStructs,helperNodes=[],segs=this.eventToSegs(event);return segs=this.renderFgSegEls(segs),rowStructs=this.renderSegRows(segs),this.rowEls.each(function(row,rowNode){var skeletonTop,rowEl=$(rowNode),skeletonEl=$('<div class="fc-helper-skeleton"><table/></div>');skeletonTop=sourceSeg&&sourceSeg.row===row?sourceSeg.el.position().top:rowEl.find(".fc-content-skeleton tbody").position().top,skeletonEl.css("top",skeletonTop).find("table").append(rowStructs[row].tbodyEl),rowEl.append(skeletonEl),helperNodes.push(skeletonEl[0])}),this.helperEls=$(helperNodes)},unrenderHelper:function(){this.helperEls&&(this.helperEls.remove(),this.helperEls=null)},fillSegTag:"td",renderFill:function(type,segs,className){var i,seg,skeletonEl,nodes=[];for(segs=this.renderFillSegEls(type,segs),i=0;i<segs.length;i++)seg=segs[i],skeletonEl=this.renderFillRow(type,seg,className),this.rowEls.eq(seg.row).append(skeletonEl),nodes.push(skeletonEl[0]);return this.elsByFill[type]=$(nodes),segs},renderFillRow:function(type,seg,className){var skeletonEl,trEl,colCnt=this.colCnt,startCol=seg.leftCol,endCol=seg.rightCol+1;return className=className||type.toLowerCase(),trEl=(skeletonEl=$('<div class="fc-'+className+'-skeleton"><table><tr/></table></div>')).find("tr"),startCol>0&&trEl.append('<td colspan="'+startCol+'"/>'),trEl.append(seg.el.attr("colspan",endCol-startCol)),endCol<colCnt&&trEl.append('<td colspan="'+(colCnt-endCol)+'"/>'),this.bookendCells(trEl),skeletonEl}});function isDaySegCollision(seg,otherSegs){var i,otherSeg;for(i=0;i<otherSegs.length;i++)if((otherSeg=otherSegs[i]).leftCol<=seg.rightCol&&otherSeg.rightCol>=seg.leftCol)return!0;return!1}function compareDaySegCols(a,b){return a.leftCol-b.leftCol}DayGrid.mixin({rowStructs:null,unrenderEvents:function(){this.removeSegPopover(),Grid.prototype.unrenderEvents.apply(this,arguments)},getEventSegs:function(){return Grid.prototype.getEventSegs.call(this).concat(this.popoverSegs||[])},renderBgSegs:function(segs){var allDaySegs=$.grep(segs,function(seg){return seg.event.allDay});return Grid.prototype.renderBgSegs.call(this,allDaySegs)},renderFgSegs:function(segs){var rowStructs;return segs=this.renderFgSegEls(segs),rowStructs=this.rowStructs=this.renderSegRows(segs),this.rowEls.each(function(i,rowNode){$(rowNode).find(".fc-content-skeleton > table").append(rowStructs[i].tbodyEl)}),segs},unrenderFgSegs:function(){for(var rowStruct,rowStructs=this.rowStructs||[];rowStruct=rowStructs.pop();)rowStruct.tbodyEl.remove();this.rowStructs=null},renderSegRows:function(segs){var segRows,row,rowStructs=[];for(segRows=this.groupSegRows(segs),row=0;row<segRows.length;row++)rowStructs.push(this.renderSegRow(row,segRows[row]));return rowStructs},fgSegHtml:function(seg,disableResizing){var timeText,titleHtml,view=this.view,event=seg.event,isDraggable=view.isEventDraggable(event),isResizableFromStart=!disableResizing&&event.allDay&&seg.isStart&&view.isEventResizableFromStart(event),isResizableFromEnd=!disableResizing&&event.allDay&&seg.isEnd&&view.isEventResizableFromEnd(event),classes=this.getSegClasses(seg,isDraggable,isResizableFromStart||isResizableFromEnd),skinCss=cssToStr(this.getSegSkinCss(seg)),timeHtml="";return classes.unshift("fc-day-grid-event","fc-h-event"),seg.isStart&&(timeText=this.getEventTimeText(event))&&(timeHtml='<span class="fc-time">'+htmlEscape(timeText)+"</span>"),titleHtml='<span class="fc-title">'+(htmlEscape(event.title||"")||"&nbsp;")+"</span>",'<a class="'+classes.join(" ")+'"'+(event.url?' href="'+htmlEscape(event.url)+'"':"")+(skinCss?' style="'+skinCss+'"':"")+'><div class="fc-content">'+(this.isRTL?titleHtml+" "+timeHtml:timeHtml+" "+titleHtml)+"</div>"+(isResizableFromStart?'<div class="fc-resizer fc-start-resizer" />':"")+(isResizableFromEnd?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},renderSegRow:function(row,rowSegs){var i,levelSegs,col,tr,j,seg,td,colCnt=this.colCnt,segLevels=this.buildSegLevels(rowSegs),levelCnt=Math.max(1,segLevels.length),tbody=$("<tbody/>"),segMatrix=[],cellMatrix=[],loneCellMatrix=[];function emptyCellsUntil(endCol){for(;col<endCol;)(td=(loneCellMatrix[i-1]||[])[col])?td.attr("rowspan",parseInt(td.attr("rowspan")||1,10)+1):(td=$("<td/>"),tr.append(td)),cellMatrix[i][col]=td,loneCellMatrix[i][col]=td,col++}for(i=0;i<levelCnt;i++){if(levelSegs=segLevels[i],col=0,tr=$("<tr/>"),segMatrix.push([]),cellMatrix.push([]),loneCellMatrix.push([]),levelSegs)for(j=0;j<levelSegs.length;j++){for(emptyCellsUntil((seg=levelSegs[j]).leftCol),td=$('<td class="fc-event-container"/>').append(seg.el),seg.leftCol!=seg.rightCol?td.attr("colspan",seg.rightCol-seg.leftCol+1):loneCellMatrix[i][col]=td;col<=seg.rightCol;)cellMatrix[i][col]=td,segMatrix[i][col]=seg,col++;tr.append(td)}emptyCellsUntil(colCnt),this.bookendCells(tr),tbody.append(tr)}return{row:row,tbodyEl:tbody,cellMatrix:cellMatrix,segMatrix:segMatrix,segLevels:segLevels,segs:rowSegs}},buildSegLevels:function(segs){var i,seg,j,levels=[];for(this.sortEventSegs(segs),i=0;i<segs.length;i++){for(seg=segs[i],j=0;j<levels.length&&isDaySegCollision(seg,levels[j]);j++);seg.level=j,(levels[j]||(levels[j]=[])).push(seg)}for(j=0;j<levels.length;j++)levels[j].sort(compareDaySegCols);return levels},groupSegRows:function(segs){var i,segRows=[];for(i=0;i<this.rowCnt;i++)segRows.push([]);for(i=0;i<segs.length;i++)segRows[segs[i].row].push(segs[i]);return segRows}}),DayGrid.mixin({segPopover:null,popoverSegs:null,removeSegPopover:function(){this.segPopover&&this.segPopover.hide()},limitRows:function(levelLimit){var row,rowLevelLimit,rowStructs=this.rowStructs||[];for(row=0;row<rowStructs.length;row++)this.unlimitRow(row),!1!==(rowLevelLimit=!!levelLimit&&("number"==typeof levelLimit?levelLimit:this.computeRowLevelLimit(row)))&&this.limitRow(row,rowLevelLimit)},computeRowLevelLimit:function(row){var i,trEl,trHeight,rowHeight=this.rowEls.eq(row).height(),trEls=this.rowStructs[row].tbodyEl.children();function iterInnerHeights(i,childNode){trHeight=Math.max(trHeight,$(childNode).outerHeight())}for(i=0;i<trEls.length;i++)if(trEl=trEls.eq(i).removeClass("fc-limited"),trHeight=0,trEl.find("> td > :first-child").each(iterInnerHeights),trEl.position().top+trHeight>rowHeight)return i;return!1},limitRow:function(row,levelLimit){var levelSegs,cellMatrix,limitedNodes,i,seg,segsBelow,totalSegsBelow,colSegsBelow,td,rowspan,segMoreNodes,j,moreTd,moreWrap,moreLink,_this=this,rowStruct=this.rowStructs[row],moreNodes=[],col=0;function emptyCellsUntil(endCol){for(;col<endCol;)(segsBelow=_this.getCellSegs(row,col,levelLimit)).length&&(td=cellMatrix[levelLimit-1][col],moreLink=_this.renderMoreLink(row,col,segsBelow),moreWrap=$("<div/>").append(moreLink),td.append(moreWrap),moreNodes.push(moreWrap[0])),col++}if(levelLimit&&levelLimit<rowStruct.segLevels.length){for(levelSegs=rowStruct.segLevels[levelLimit-1],cellMatrix=rowStruct.cellMatrix,limitedNodes=rowStruct.tbodyEl.children().slice(levelLimit).addClass("fc-limited").get(),i=0;i<levelSegs.length;i++){for(emptyCellsUntil((seg=levelSegs[i]).leftCol),colSegsBelow=[],totalSegsBelow=0;col<=seg.rightCol;)segsBelow=this.getCellSegs(row,col,levelLimit),colSegsBelow.push(segsBelow),totalSegsBelow+=segsBelow.length,col++;if(totalSegsBelow){for(rowspan=(td=cellMatrix[levelLimit-1][seg.leftCol]).attr("rowspan")||1,segMoreNodes=[],j=0;j<colSegsBelow.length;j++)moreTd=$('<td class="fc-more-cell"/>').attr("rowspan",rowspan),segsBelow=colSegsBelow[j],moreLink=this.renderMoreLink(row,seg.leftCol+j,[seg].concat(segsBelow)),moreWrap=$("<div/>").append(moreLink),moreTd.append(moreWrap),segMoreNodes.push(moreTd[0]),moreNodes.push(moreTd[0]);td.addClass("fc-limited").after($(segMoreNodes)),limitedNodes.push(td[0])}}emptyCellsUntil(this.colCnt),rowStruct.moreEls=$(moreNodes),rowStruct.limitedEls=$(limitedNodes)}},unlimitRow:function(row){var rowStruct=this.rowStructs[row];rowStruct.moreEls&&(rowStruct.moreEls.remove(),rowStruct.moreEls=null),rowStruct.limitedEls&&(rowStruct.limitedEls.removeClass("fc-limited"),rowStruct.limitedEls=null)},renderMoreLink:function(row,col,hiddenSegs){var _this=this,view=this.view;return $('<a class="fc-more"/>').text(this.getMoreLinkText(hiddenSegs.length)).on("click",function(ev){var clickOption=view.opt("eventLimitClick"),date=_this.getCellDate(row,col),moreEl=$(this),dayEl=_this.getCellEl(row,col),allSegs=_this.getCellSegs(row,col),reslicedAllSegs=_this.resliceDaySegs(allSegs,date),reslicedHiddenSegs=_this.resliceDaySegs(hiddenSegs,date);"function"==typeof clickOption&&(clickOption=view.trigger("eventLimitClick",null,{date:date,dayEl:dayEl,moreEl:moreEl,segs:reslicedAllSegs,hiddenSegs:reslicedHiddenSegs},ev)),"popover"===clickOption?_this.showSegPopover(row,col,moreEl,reslicedAllSegs):"string"==typeof clickOption&&view.calendar.zoomTo(date,clickOption)})},showSegPopover:function(row,col,moreLink,segs){var topEl,options,_this=this,view=this.view,moreWrap=moreLink.parent();topEl=1==this.rowCnt?view.el:this.rowEls.eq(row),options={className:"fc-more-popover",content:this.renderSegPopoverContent(row,col,segs),parentEl:this.el,top:topEl.offset().top,autoHide:!0,viewportConstrain:view.opt("popoverViewportConstrain"),hide:function(){_this.segPopover.removeElement(),_this.segPopover=null,_this.popoverSegs=null}},this.isRTL?options.right=moreWrap.offset().left+moreWrap.outerWidth()+1:options.left=moreWrap.offset().left-1,this.segPopover=new Popover(options),this.segPopover.show()},renderSegPopoverContent:function(row,col,segs){var i,view=this.view,isTheme=view.opt("theme"),title=this.getCellDate(row,col).format(view.opt("dayPopoverFormat")),content=$('<div class="fc-header '+view.widgetHeaderClass+'"><span class="fc-close '+(isTheme?"ui-icon ui-icon-closethick":"fc-icon fc-icon-x")+'"></span><span class="fc-title">'+htmlEscape(title)+'</span><div class="fc-clear"/></div><div class="fc-body '+view.widgetContentClass+'"><div class="fc-event-container"></div></div>'),segContainer=content.find(".fc-event-container");for(segs=this.renderFgSegEls(segs,!0),this.popoverSegs=segs,i=0;i<segs.length;i++)this.prepareHits(),segs[i].hit=this.getCellHit(row,col),this.releaseHits(),segContainer.append(segs[i].el);return content},resliceDaySegs:function(segs,dayDate){var events=$.map(segs,function(seg){return seg.event}),dayStart=dayDate.clone(),dayRange={start:dayStart,end:dayStart.clone().add(1,"days")};return segs=this.eventsToSegs(events,function(range){var seg=intersectRanges(range,dayRange);return seg?[seg]:[]}),this.sortEventSegs(segs),segs},getMoreLinkText:function(num){var opt=this.view.opt("eventLimitText");return"function"==typeof opt?opt(num):"+"+num+" "+opt},getCellSegs:function(row,col,startLevel){for(var seg,segMatrix=this.rowStructs[row].segMatrix,level=startLevel||0,segs=[];level<segMatrix.length;)(seg=segMatrix[level][col])&&segs.push(seg),level++;return segs}});var TimeGrid=FC.TimeGrid=Grid.extend(DayTableMixin,{slotDuration:null,snapDuration:null,snapsPerSlot:null,minTime:null,maxTime:null,labelFormat:null,labelInterval:null,colEls:null,slatContainerEl:null,slatEls:null,nowIndicatorEls:null,colCoordCache:null,slatCoordCache:null,constructor:function(){Grid.apply(this,arguments),this.processOptions()},renderDates:function(){this.el.html(this.renderHtml()),this.colEls=this.el.find(".fc-day"),this.slatContainerEl=this.el.find(".fc-slats"),this.slatEls=this.slatContainerEl.find("tr"),this.colCoordCache=new CoordCache({els:this.colEls,isHorizontal:!0}),this.slatCoordCache=new CoordCache({els:this.slatEls,isVertical:!0}),this.renderContentSkeleton()},renderHtml:function(){return'<div class="fc-bg"><table>'+this.renderBgTrHtml(0)+'</table></div><div class="fc-slats"><table>'+this.renderSlatRowHtml()+"</table></div>"},renderSlatRowHtml:function(){for(var slotDate,isLabeled,axisHtml,view=this.view,isRTL=this.isRTL,html="",slotTime=moment.duration(+this.minTime);slotTime<this.maxTime;)slotDate=this.start.clone().time(slotTime),isLabeled=isInt(divideDurationByDuration(slotTime,this.labelInterval)),axisHtml='<td class="fc-axis fc-time '+view.widgetContentClass+'" '+view.axisStyleAttr()+">"+(isLabeled?"<span>"+htmlEscape(slotDate.format(this.labelFormat))+"</span>":"")+"</td>",html+='<tr data-time="'+slotDate.format("HH:mm:ss")+'"'+(isLabeled?"":' class="fc-minor"')+">"+(isRTL?"":axisHtml)+'<td class="'+view.widgetContentClass+'"/>'+(isRTL?axisHtml:"")+"</tr>",slotTime.add(this.slotDuration);return html},processOptions:function(){var input,view=this.view,slotDuration=view.opt("slotDuration"),snapDuration=view.opt("snapDuration");slotDuration=moment.duration(slotDuration),snapDuration=snapDuration?moment.duration(snapDuration):slotDuration,this.slotDuration=slotDuration,this.snapDuration=snapDuration,this.snapsPerSlot=slotDuration/snapDuration,this.minResizeDuration=snapDuration,this.minTime=moment.duration(view.opt("minTime")),this.maxTime=moment.duration(view.opt("maxTime")),input=view.opt("slotLabelFormat"),$.isArray(input)&&(input=input[input.length-1]),this.labelFormat=input||view.opt("axisFormat")||view.opt("smallTimeFormat"),input=view.opt("slotLabelInterval"),this.labelInterval=input?moment.duration(input):this.computeLabelInterval(slotDuration)},computeLabelInterval:function(slotDuration){var i,labelInterval,slotsPerLabel;for(i=AGENDA_STOCK_SUB_DURATIONS.length-1;i>=0;i--)if(isInt(slotsPerLabel=divideDurationByDuration(labelInterval=moment.duration(AGENDA_STOCK_SUB_DURATIONS[i]),slotDuration))&&slotsPerLabel>1)return labelInterval;return moment.duration(slotDuration)},computeEventTimeFormat:function(){return this.view.opt("noMeridiemTimeFormat")},computeDisplayEventEnd:function(){return!0},prepareHits:function(){this.colCoordCache.build(),this.slatCoordCache.build()},releaseHits:function(){this.colCoordCache.clear()},queryHit:function(leftOffset,topOffset){var snapsPerSlot=this.snapsPerSlot,colCoordCache=this.colCoordCache,slatCoordCache=this.slatCoordCache,colIndex=colCoordCache.getHorizontalIndex(leftOffset),slatIndex=slatCoordCache.getVerticalIndex(topOffset);if(null!=colIndex&&null!=slatIndex){var slatTop=slatCoordCache.getTopOffset(slatIndex),slatHeight=slatCoordCache.getHeight(slatIndex),partial=(topOffset-slatTop)/slatHeight,localSnapIndex=Math.floor(partial*snapsPerSlot),snapTop=slatTop+localSnapIndex/snapsPerSlot*slatHeight,snapBottom=slatTop+(localSnapIndex+1)/snapsPerSlot*slatHeight;return{col:colIndex,snap:slatIndex*snapsPerSlot+localSnapIndex,component:this,left:colCoordCache.getLeftOffset(colIndex),right:colCoordCache.getRightOffset(colIndex),top:snapTop,bottom:snapBottom}}},getHitSpan:function(hit){var start=this.getCellDate(0,hit.col),time=this.computeSnapTime(hit.snap);return start.time(time),{start:start,end:start.clone().add(this.snapDuration)}},getHitEl:function(hit){return this.colEls.eq(hit.col)},rangeUpdated:function(){this.updateDayTable()},computeSnapTime:function(snapIndex){return moment.duration(this.minTime+this.snapDuration*snapIndex)},spanToSegs:function(span){var i,segs=this.sliceRangeByTimes(span);for(i=0;i<segs.length;i++)this.isRTL?segs[i].col=this.daysPerRow-1-segs[i].dayIndex:segs[i].col=segs[i].dayIndex;return segs},sliceRangeByTimes:function(range){var seg,dayIndex,dayDate,segs=[];for(dayIndex=0;dayIndex<this.daysPerRow;dayIndex++)(seg=intersectRanges(range,{start:(dayDate=this.dayDates[dayIndex].clone()).clone().time(this.minTime),end:dayDate.clone().time(this.maxTime)}))&&(seg.dayIndex=dayIndex,segs.push(seg));return segs},updateSize:function(isResize){this.slatCoordCache.build(),isResize&&this.updateSegVerticals([].concat(this.fgSegs||[],this.bgSegs||[],this.businessSegs||[]))},getTotalSlatHeight:function(){return this.slatContainerEl.outerHeight()},computeDateTop:function(date,startOfDayDate){return this.computeTimeTop(moment.duration(date-startOfDayDate.clone().stripTime()))},computeTimeTop:function(time){var slatIndex,slatRemainder,len=this.slatEls.length,slatCoverage=(time-this.minTime)/this.slotDuration;return slatCoverage=Math.max(0,slatCoverage),slatCoverage=Math.min(len,slatCoverage),slatIndex=Math.floor(slatCoverage),slatRemainder=slatCoverage-(slatIndex=Math.min(slatIndex,len-1)),this.slatCoordCache.getTopPosition(slatIndex)+this.slatCoordCache.getHeight(slatIndex)*slatRemainder},renderDrag:function(eventLocation,seg){if(seg)return this.renderEventLocationHelper(eventLocation,seg);this.renderHighlight(this.eventToSpan(eventLocation))},unrenderDrag:function(){this.unrenderHelper(),this.unrenderHighlight()},renderEventResize:function(eventLocation,seg){return this.renderEventLocationHelper(eventLocation,seg)},unrenderEventResize:function(){this.unrenderHelper()},renderHelper:function(event,sourceSeg){return this.renderHelperSegs(this.eventToSegs(event),sourceSeg)},unrenderHelper:function(){this.unrenderHelperSegs()},renderBusinessHours:function(){var events=this.view.calendar.getBusinessHoursEvents(),segs=this.eventsToSegs(events);this.renderBusinessSegs(segs)},unrenderBusinessHours:function(){this.unrenderBusinessSegs()},getNowIndicatorUnit:function(){return"minute"},renderNowIndicator:function(date){var i,segs=this.spanToSegs({start:date,end:date}),top=this.computeDateTop(date,date),nodes=[];for(i=0;i<segs.length;i++)nodes.push($('<div class="fc-now-indicator fc-now-indicator-line"></div>').css("top",top).appendTo(this.colContainerEls.eq(segs[i].col))[0]);segs.length>0&&nodes.push($('<div class="fc-now-indicator fc-now-indicator-arrow"></div>').css("top",top).appendTo(this.el.find(".fc-content-skeleton"))[0]),this.nowIndicatorEls=$(nodes)},unrenderNowIndicator:function(){this.nowIndicatorEls&&(this.nowIndicatorEls.remove(),this.nowIndicatorEls=null)},renderSelection:function(span){this.view.opt("selectHelper")?this.renderEventLocationHelper(span):this.renderHighlight(span)},unrenderSelection:function(){this.unrenderHelper(),this.unrenderHighlight()},renderHighlight:function(span){this.renderHighlightSegs(this.spanToSegs(span))},unrenderHighlight:function(){this.unrenderHighlightSegs()}});function computeSlotSegPressures(seg){var i,forwardSeg,forwardSegs=seg.forwardSegs,forwardPressure=0;if(void 0===seg.forwardPressure){for(i=0;i<forwardSegs.length;i++)computeSlotSegPressures(forwardSeg=forwardSegs[i]),forwardPressure=Math.max(forwardPressure,1+forwardSeg.forwardPressure);seg.forwardPressure=forwardPressure}}function computeSlotSegCollisions(seg,otherSegs,results){results=results||[];for(var i=0;i<otherSegs.length;i++)seg1=seg,seg2=otherSegs[i],seg1.bottom>seg2.top&&seg1.top<seg2.bottom&&results.push(otherSegs[i]);var seg1,seg2;return results}TimeGrid.mixin({colContainerEls:null,fgContainerEls:null,bgContainerEls:null,helperContainerEls:null,highlightContainerEls:null,businessContainerEls:null,fgSegs:null,bgSegs:null,helperSegs:null,highlightSegs:null,businessSegs:null,renderContentSkeleton:function(){var i,skeletonEl,cellHtml="";for(i=0;i<this.colCnt;i++)cellHtml+='<td><div class="fc-content-col"><div class="fc-event-container fc-helper-container"></div><div class="fc-event-container"></div><div class="fc-highlight-container"></div><div class="fc-bgevent-container"></div><div class="fc-business-container"></div></div></td>';skeletonEl=$('<div class="fc-content-skeleton"><table><tr>'+cellHtml+"</tr></table></div>"),this.colContainerEls=skeletonEl.find(".fc-content-col"),this.helperContainerEls=skeletonEl.find(".fc-helper-container"),this.fgContainerEls=skeletonEl.find(".fc-event-container:not(.fc-helper-container)"),this.bgContainerEls=skeletonEl.find(".fc-bgevent-container"),this.highlightContainerEls=skeletonEl.find(".fc-highlight-container"),this.businessContainerEls=skeletonEl.find(".fc-business-container"),this.bookendCells(skeletonEl.find("tr")),this.el.append(skeletonEl)},renderFgSegs:function(segs){return segs=this.renderFgSegsIntoContainers(segs,this.fgContainerEls),this.fgSegs=segs,segs},unrenderFgSegs:function(){this.unrenderNamedSegs("fgSegs")},renderHelperSegs:function(segs,sourceSeg){var i,seg,sourceEl,helperEls=[];for(segs=this.renderFgSegsIntoContainers(segs,this.helperContainerEls),i=0;i<segs.length;i++)seg=segs[i],sourceSeg&&sourceSeg.col===seg.col&&(sourceEl=sourceSeg.el,seg.el.css({left:sourceEl.css("left"),right:sourceEl.css("right"),"margin-left":sourceEl.css("margin-left"),"margin-right":sourceEl.css("margin-right")})),helperEls.push(seg.el[0]);return this.helperSegs=segs,$(helperEls)},unrenderHelperSegs:function(){this.unrenderNamedSegs("helperSegs")},renderBgSegs:function(segs){return segs=this.renderFillSegEls("bgEvent",segs),this.updateSegVerticals(segs),this.attachSegsByCol(this.groupSegsByCol(segs),this.bgContainerEls),this.bgSegs=segs,segs},unrenderBgSegs:function(){this.unrenderNamedSegs("bgSegs")},renderHighlightSegs:function(segs){segs=this.renderFillSegEls("highlight",segs),this.updateSegVerticals(segs),this.attachSegsByCol(this.groupSegsByCol(segs),this.highlightContainerEls),this.highlightSegs=segs},unrenderHighlightSegs:function(){this.unrenderNamedSegs("highlightSegs")},renderBusinessSegs:function(segs){segs=this.renderFillSegEls("businessHours",segs),this.updateSegVerticals(segs),this.attachSegsByCol(this.groupSegsByCol(segs),this.businessContainerEls),this.businessSegs=segs},unrenderBusinessSegs:function(){this.unrenderNamedSegs("businessSegs")},groupSegsByCol:function(segs){var i,segsByCol=[];for(i=0;i<this.colCnt;i++)segsByCol.push([]);for(i=0;i<segs.length;i++)segsByCol[segs[i].col].push(segs[i]);return segsByCol},attachSegsByCol:function(segsByCol,containerEls){var col,segs,i;for(col=0;col<this.colCnt;col++)for(segs=segsByCol[col],i=0;i<segs.length;i++)containerEls.eq(col).append(segs[i].el)},unrenderNamedSegs:function(propName){var i,segs=this[propName];if(segs){for(i=0;i<segs.length;i++)segs[i].el.remove();this[propName]=null}},renderFgSegsIntoContainers:function(segs,containerEls){var segsByCol,col;for(segs=this.renderFgSegEls(segs),segsByCol=this.groupSegsByCol(segs),col=0;col<this.colCnt;col++)this.updateFgSegCoords(segsByCol[col]);return this.attachSegsByCol(segsByCol,containerEls),segs},fgSegHtml:function(seg,disableResizing){var timeText,fullTimeText,startTimeText,view=this.view,event=seg.event,isDraggable=view.isEventDraggable(event),isResizableFromStart=!disableResizing&&seg.isStart&&view.isEventResizableFromStart(event),isResizableFromEnd=!disableResizing&&seg.isEnd&&view.isEventResizableFromEnd(event),classes=this.getSegClasses(seg,isDraggable,isResizableFromStart||isResizableFromEnd),skinCss=cssToStr(this.getSegSkinCss(seg));return classes.unshift("fc-time-grid-event","fc-v-event"),view.isMultiDayEvent(event)?(seg.isStart||seg.isEnd)&&(timeText=this.getEventTimeText(seg),fullTimeText=this.getEventTimeText(seg,"LT"),startTimeText=this.getEventTimeText(seg,null,!1)):(timeText=this.getEventTimeText(event),fullTimeText=this.getEventTimeText(event,"LT"),startTimeText=this.getEventTimeText(event,null,!1)),'<a id="style-3" class="scrollbar '+classes.join(" ")+'"'+(event.url?' href="'+htmlEscape(event.url)+'"':"")+(skinCss?' style="'+skinCss+'"':"")+'><div class="fc-content">'+(timeText?'<div class="fc-time" data-start="'+htmlEscape(startTimeText)+'" data-full="'+htmlEscape(fullTimeText)+'"><span>'+event.blockName+"</span></div>":"")+(event.title?'<div class="fc-title">'+htmlEscape(event.title)+"</div>":"")+'</div><div class="fc-bg"/>'+(isResizableFromEnd?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},updateSegVerticals:function(segs){this.computeSegVerticals(segs),this.assignSegVerticals(segs)},computeSegVerticals:function(segs){var i,seg;for(i=0;i<segs.length;i++)(seg=segs[i]).top=this.computeDateTop(seg.start,seg.start),seg.bottom=this.computeDateTop(seg.end,seg.start)},assignSegVerticals:function(segs){var i,seg;for(i=0;i<segs.length;i++)(seg=segs[i]).el.css(this.generateSegVerticalCss(seg))},generateSegVerticalCss:function(seg){return{top:seg.top,bottom:-seg.bottom}},updateFgSegCoords:function(segs){this.computeSegVerticals(segs),this.computeFgSegHorizontals(segs),this.assignSegVerticals(segs),this.assignFgSegHorizontals(segs)},computeFgSegHorizontals:function(segs){var levels,level0,i;if(this.sortEventSegs(segs),function(levels){var i,level,j,seg,k;for(i=0;i<levels.length;i++)for(level=levels[i],j=0;j<level.length;j++)for((seg=level[j]).forwardSegs=[],k=i+1;k<levels.length;k++)computeSlotSegCollisions(seg,levels[k],seg.forwardSegs)}(levels=function(segs){var i,seg,j,levels=[];for(i=0;i<segs.length;i++){for(seg=segs[i],j=0;j<levels.length&&computeSlotSegCollisions(seg,levels[j]).length;j++);seg.level=j,(levels[j]||(levels[j]=[])).push(seg)}return levels}(segs)),level0=levels[0]){for(i=0;i<level0.length;i++)computeSlotSegPressures(level0[i]);for(i=0;i<level0.length;i++)this.computeFgSegForwardBack(level0[i],0,0)}},computeFgSegForwardBack:function(seg,seriesBackwardPressure,seriesBackwardCoord){var i,forwardSegs=seg.forwardSegs;if(void 0===seg.forwardCoord)for(forwardSegs.length?(this.sortForwardSegs(forwardSegs),this.computeFgSegForwardBack(forwardSegs[0],seriesBackwardPressure+1,seriesBackwardCoord),seg.forwardCoord=forwardSegs[0].backwardCoord):seg.forwardCoord=1,seg.backwardCoord=seg.forwardCoord-(seg.forwardCoord-seriesBackwardCoord)/(seriesBackwardPressure+1),i=0;i<forwardSegs.length;i++)this.computeFgSegForwardBack(forwardSegs[i],0,seg.forwardCoord)},sortForwardSegs:function(forwardSegs){forwardSegs.sort(proxy(this,"compareForwardSegs"))},compareForwardSegs:function(seg1,seg2){return seg2.forwardPressure-seg1.forwardPressure||(seg1.backwardCoord||0)-(seg2.backwardCoord||0)||this.compareEventSegs(seg1,seg2)},assignFgSegHorizontals:function(segs){var i,seg;for(i=0;i<segs.length;i++)(seg=segs[i]).el.css(this.generateFgSegHorizontalCss(seg)),seg.bottom-seg.top<30&&seg.el.addClass("fc-short")},generateFgSegHorizontalCss:function(seg){var left,right,shouldOverlap=this.view.opt("slotEventOverlap"),backwardCoord=seg.backwardCoord,forwardCoord=seg.forwardCoord,props=this.generateSegVerticalCss(seg);return shouldOverlap&&(forwardCoord=Math.min(1,backwardCoord+2*(forwardCoord-backwardCoord))),this.isRTL?(left=1-forwardCoord,right=backwardCoord):(left=backwardCoord,right=1-forwardCoord),props.zIndex=seg.level+1,props.left=100*left+"%",props.right=100*right+"%",shouldOverlap&&seg.forwardPressure&&(props[this.isRTL?"marginLeft":"marginRight"]=20),props}});var View=FC.View=Class.extend(EmitterMixin,ListenerMixin,{type:null,name:null,title:null,calendar:null,options:null,el:null,displaying:null,isSkeletonRendered:!1,isEventsRendered:!1,start:null,end:null,intervalStart:null,intervalEnd:null,intervalDuration:null,intervalUnit:null,isRTL:!1,isSelected:!1,selectedEvent:null,eventOrderSpecs:null,widgetHeaderClass:null,widgetContentClass:null,highlightStateClass:null,nextDayThreshold:null,isHiddenDayHash:null,isNowIndicatorRendered:null,initialNowDate:null,initialNowQueriedMs:null,nowIndicatorTimeoutID:null,nowIndicatorIntervalID:null,constructor:function(calendar,type,options,intervalDuration){this.calendar=calendar,this.type=this.name=type,this.options=options,this.intervalDuration=intervalDuration||moment.duration(1,"day"),this.nextDayThreshold=moment.duration(this.opt("nextDayThreshold")),this.initThemingProps(),this.initHiddenDays(),this.isRTL=this.opt("isRTL"),this.eventOrderSpecs=parseFieldSpecs(this.opt("eventOrder")),this.initialize()},initialize:function(){},opt:function(name){return this.options[name]},trigger:function(name,thisObj){var calendar=this.calendar;return calendar.trigger.apply(calendar,[name,thisObj||this].concat(Array.prototype.slice.call(arguments,2),[this]))},setDate:function(date){this.setRange(this.computeRange(date))},setRange:function(range){$.extend(this,range),this.updateTitle()},computeRange:function(date){var start,end,intervalUnit=computeIntervalUnit(this.intervalDuration),intervalStart=date.clone().startOf(intervalUnit),intervalEnd=intervalStart.clone().add(this.intervalDuration);return/year|month|week|day/.test(intervalUnit)?(intervalStart.stripTime(),intervalEnd.stripTime()):(intervalStart.hasTime()||(intervalStart=this.calendar.time(0)),intervalEnd.hasTime()||(intervalEnd=this.calendar.time(0))),start=intervalStart.clone(),start=this.skipHiddenDays(start),end=intervalEnd.clone(),{intervalUnit:intervalUnit,intervalStart:intervalStart,intervalEnd:intervalEnd,start:start,end:end=this.skipHiddenDays(end,-1,!0)}},computePrevDate:function(date){return this.massageCurrentDate(date.clone().startOf(this.intervalUnit).subtract(this.intervalDuration),-1)},computeNextDate:function(date){return this.massageCurrentDate(date.clone().startOf(this.intervalUnit).add(this.intervalDuration))},massageCurrentDate:function(date,direction){return this.intervalDuration.as("days")<=1&&this.isHiddenDay(date)&&(date=this.skipHiddenDays(date,direction)).startOf("day"),date},updateTitle:function(){this.title=this.computeTitle()},computeTitle:function(){return this.formatRange({start:this.calendar.applyTimezone(this.intervalStart),end:this.calendar.applyTimezone(this.intervalEnd)},this.opt("titleFormat")||this.computeTitleFormat(),this.opt("titleRangeSeparator"))},computeTitleFormat:function(){return"year"==this.intervalUnit?"YYYY":"month"==this.intervalUnit?this.opt("monthYearFormat"):this.intervalDuration.as("days")>1?"ll":"LL"},formatRange:function(range,formatStr,separator){var end=range.end;return end.hasTime()||(end=end.clone().subtract(1)),formatRange(range.start,end,formatStr,separator,this.opt("isRTL"))},setElement:function(el){this.el=el,this.bindGlobalHandlers()},removeElement:function(){this.clear(),this.isSkeletonRendered&&(this.unrenderSkeleton(),this.isSkeletonRendered=!1),this.unbindGlobalHandlers(),this.el.remove()},display:function(date){var _this=this,scrollState=null;return this.displaying&&(scrollState=this.queryScroll()),this.calendar.freezeContentHeight(),this.clear().then(function(){return _this.displaying=$.when(_this.displayView(date)).then(function(){_this.forceScroll(_this.computeInitialScroll(scrollState)),_this.calendar.unfreezeContentHeight(),_this.triggerRender()})})},clear:function(){var _this=this,displaying=this.displaying;return displaying?displaying.then(function(){return _this.displaying=null,_this.clearEvents(),_this.clearView()}):$.when()},displayView:function(date){this.isSkeletonRendered||(this.renderSkeleton(),this.isSkeletonRendered=!0),date&&this.setDate(date),this.render&&this.render(),this.renderDates(),this.updateSize(),this.renderBusinessHours(),this.startNowIndicator()},clearView:function(){this.unselect(),this.stopNowIndicator(),this.triggerUnrender(),this.unrenderBusinessHours(),this.unrenderDates(),this.destroy&&this.destroy()},renderSkeleton:function(){},unrenderSkeleton:function(){},renderDates:function(){},unrenderDates:function(){},triggerRender:function(){this.trigger("viewRender",this,this,this.el)},triggerUnrender:function(){this.trigger("viewDestroy",this,this,this.el)},bindGlobalHandlers:function(){this.listenTo($(document),"mousedown",this.handleDocumentMousedown),this.listenTo($(document),"touchstart",this.processUnselect)},unbindGlobalHandlers:function(){this.stopListeningTo($(document))},initThemingProps:function(){var tm=this.opt("theme")?"ui":"fc";this.widgetHeaderClass=tm+"-widget-header",this.widgetContentClass=tm+"-widget-content",this.highlightStateClass=tm+"-state-highlight"},renderBusinessHours:function(){},unrenderBusinessHours:function(){},startNowIndicator:function(){var unit,update,delay,_this=this;this.opt("nowIndicator")&&(unit=this.getNowIndicatorUnit())&&(update=proxy(this,"updateNowIndicator"),this.initialNowDate=this.calendar.getNow(),this.initialNowQueriedMs=+new Date,this.renderNowIndicator(this.initialNowDate),this.isNowIndicatorRendered=!0,delay=this.initialNowDate.clone().startOf(unit).add(1,unit)-this.initialNowDate,this.nowIndicatorTimeoutID=setTimeout(function(){_this.nowIndicatorTimeoutID=null,update(),delay=+moment.duration(1,unit),delay=Math.max(100,delay),_this.nowIndicatorIntervalID=setInterval(update,delay)},delay))},updateNowIndicator:function(){this.isNowIndicatorRendered&&(this.unrenderNowIndicator(),this.renderNowIndicator(this.initialNowDate.clone().add(new Date-this.initialNowQueriedMs)))},stopNowIndicator:function(){this.isNowIndicatorRendered&&(this.nowIndicatorTimeoutID&&(clearTimeout(this.nowIndicatorTimeoutID),this.nowIndicatorTimeoutID=null),this.nowIndicatorIntervalID&&(clearTimeout(this.nowIndicatorIntervalID),this.nowIndicatorIntervalID=null),this.unrenderNowIndicator(),this.isNowIndicatorRendered=!1)},getNowIndicatorUnit:function(){},renderNowIndicator:function(date){},unrenderNowIndicator:function(){},updateSize:function(isResize){var scrollState;isResize&&(scrollState=this.queryScroll()),this.updateHeight(isResize),this.updateWidth(isResize),this.updateNowIndicator(),isResize&&this.setScroll(scrollState)},updateWidth:function(isResize){},updateHeight:function(isResize){var calendar=this.calendar;this.setHeight(calendar.getSuggestedViewHeight(),calendar.isHeightAuto())},setHeight:function(height,isAuto){},computeInitialScroll:function(previousScrollState){return 0},queryScroll:function(){},setScroll:function(scrollState){},forceScroll:function(scrollState){var _this=this;this.setScroll(scrollState),setTimeout(function(){_this.setScroll(scrollState)},0)},displayEvents:function(events){var scrollState=this.queryScroll();this.clearEvents(),this.renderEvents(events),this.isEventsRendered=!0,this.setScroll(scrollState),this.triggerEventRender()},clearEvents:function(){var scrollState;this.isEventsRendered&&(scrollState=this.queryScroll(),this.triggerEventUnrender(),this.destroyEvents&&this.destroyEvents(),this.unrenderEvents(),this.setScroll(scrollState),this.isEventsRendered=!1)},renderEvents:function(events){},unrenderEvents:function(){},triggerEventRender:function(){this.renderedEventSegEach(function(seg){this.trigger("eventAfterRender",seg.event,seg.event,seg.el)}),this.trigger("eventAfterAllRender")},triggerEventUnrender:function(){this.renderedEventSegEach(function(seg){this.trigger("eventDestroy",seg.event,seg.event,seg.el)})},resolveEventEl:function(event,el){var custom=this.trigger("eventRender",event,event,el);return!1===custom?el=null:custom&&!0!==custom&&(el=$(custom)),el},showEvent:function(event){this.renderedEventSegEach(function(seg){seg.el.css("visibility","")},event)},hideEvent:function(event){this.renderedEventSegEach(function(seg){seg.el.css("visibility","hidden")},event)},renderedEventSegEach:function(func,event){var i,segs=this.getEventSegs();for(i=0;i<segs.length;i++)event&&segs[i].event._id!==event._id||segs[i].el&&func.call(this,segs[i])},getEventSegs:function(){return[]},isEventDraggable:function(event){var source=event.source||{};return firstDefined(event.startEditable,source.startEditable,this.opt("eventStartEditable"),event.editable,source.editable,this.opt("editable"))},reportEventDrop:function(event,dropLocation,largeUnit,el,ev){var calendar=this.calendar,mutateResult=calendar.mutateEvent(event,dropLocation,largeUnit);this.triggerEventDrop(event,mutateResult.dateDelta,function(){mutateResult.undo(),calendar.reportEventChange()},el,ev),calendar.reportEventChange()},triggerEventDrop:function(event,dateDelta,undoFunc,el,ev){this.trigger("eventDrop",el[0],event,dateDelta,undoFunc,ev,{})},reportExternalDrop:function(meta,dropLocation,el,ev,ui){var eventInput,event,eventProps=meta.eventProps;eventProps&&(eventInput=$.extend({},eventProps,dropLocation),event=this.calendar.renderEvent(eventInput,meta.stick)[0]),this.triggerExternalDrop(event,dropLocation,el,ev,ui)},triggerExternalDrop:function(event,dropLocation,el,ev,ui){this.trigger("drop",el[0],dropLocation.start,ev,ui),event&&this.trigger("eventReceive",null,event)},renderDrag:function(dropLocation,seg){},unrenderDrag:function(){},isEventResizableFromStart:function(event){return this.opt("eventResizableFromStart")&&this.isEventResizable(event)},isEventResizableFromEnd:function(event){return this.isEventResizable(event)},isEventResizable:function(event){var source=event.source||{};return firstDefined(event.durationEditable,source.durationEditable,this.opt("eventDurationEditable"),event.editable,source.editable,this.opt("editable"))},reportEventResize:function(event,resizeLocation,largeUnit,el,ev){var calendar=this.calendar,mutateResult=calendar.mutateEvent(event,resizeLocation,largeUnit);this.triggerEventResize(event,mutateResult.durationDelta,function(){mutateResult.undo(),calendar.reportEventChange()},el,ev),calendar.reportEventChange()},triggerEventResize:function(event,durationDelta,undoFunc,el,ev){this.trigger("eventResize",el[0],event,durationDelta,undoFunc,ev,{})},select:function(span,ev){this.unselect(ev),this.renderSelection(span),this.reportSelection(span,ev)},renderSelection:function(span){},reportSelection:function(span,ev){this.isSelected=!0,this.triggerSelect(span,ev)},triggerSelect:function(span,ev){this.trigger("select",null,this.calendar.applyTimezone(span.start),this.calendar.applyTimezone(span.end),ev)},unselect:function(ev){this.isSelected&&(this.isSelected=!1,this.destroySelection&&this.destroySelection(),this.unrenderSelection(),this.trigger("unselect",null,ev))},unrenderSelection:function(){},selectEvent:function(event){this.selectedEvent&&this.selectedEvent===event||(this.unselectEvent(),this.renderedEventSegEach(function(seg){seg.el.addClass("fc-selected")},event),this.selectedEvent=event)},unselectEvent:function(){this.selectedEvent&&(this.renderedEventSegEach(function(seg){seg.el.removeClass("fc-selected")},this.selectedEvent),this.selectedEvent=null)},isEventSelected:function(event){return this.selectedEvent&&this.selectedEvent._id===event._id},handleDocumentMousedown:function(ev){isPrimaryMouseButton(ev)&&this.processUnselect(ev)},processUnselect:function(ev){this.processRangeUnselect(ev),this.processEventUnselect(ev)},processRangeUnselect:function(ev){var ignore;this.isSelected&&this.opt("unselectAuto")&&((ignore=this.opt("unselectCancel"))&&$(ev.target).closest(ignore).length||this.unselect(ev))},processEventUnselect:function(ev){this.selectedEvent&&($(ev.target).closest(".fc-selected").length||this.unselectEvent())},triggerDayClick:function(span,dayEl,ev){this.trigger("dayClick",dayEl,this.calendar.applyTimezone(span.start),ev)},initHiddenDays:function(){var i,hiddenDays=this.opt("hiddenDays")||[],isHiddenDayHash=[],dayCnt=0;for(!1===this.opt("weekends")&&hiddenDays.push(0,6),i=0;i<7;i++)(isHiddenDayHash[i]=-1!==$.inArray(i,hiddenDays))||dayCnt++;if(!dayCnt)throw"invalid hiddenDays";this.isHiddenDayHash=isHiddenDayHash},isHiddenDay:function(day){return moment.isMoment(day)&&(day=day.day()),this.isHiddenDayHash[day]},skipHiddenDays:function(date,inc,isExclusive){var out=date.clone();for(inc=inc||1;this.isHiddenDayHash[(out.day()+(isExclusive?inc:0)+7)%7];)out.add(inc,"days");return out},computeDayRange:function(range){var endTimeMS,startDay=range.start.clone().stripTime(),end=range.end,endDay=null;return end&&(endDay=end.clone().stripTime(),(endTimeMS=+end.time())&&endTimeMS>=this.nextDayThreshold&&endDay.add(1,"days")),(!end||endDay<=startDay)&&(endDay=startDay.clone().add(1,"days")),{start:startDay,end:endDay}},isMultiDayEvent:function(event){var range=this.computeDayRange(event);return range.end.diff(range.start,"days")>1}}),Scroller=FC.Scroller=Class.extend({el:null,scrollEl:null,overflowX:null,overflowY:null,constructor:function(options){options=options||{},this.overflowX=options.overflowX||options.overflow||"auto",this.overflowY=options.overflowY||options.overflow||"auto"},render:function(){this.el=this.renderEl(),this.applyOverflow()},renderEl:function(){return this.scrollEl=$('<div class="fc-scroller"></div>')},clear:function(){this.setHeight("auto"),this.applyOverflow()},destroy:function(){this.el.remove()},applyOverflow:function(){this.scrollEl.css({"overflow-x":this.overflowX,"overflow-y":this.overflowY})},lockOverflow:function(scrollbarWidths){var overflowX=this.overflowX,overflowY=this.overflowY;scrollbarWidths=scrollbarWidths||this.getScrollbarWidths(),"auto"===overflowX&&(overflowX=scrollbarWidths.top||scrollbarWidths.bottom||this.scrollEl[0].scrollWidth-1>this.scrollEl[0].clientWidth?"scroll":"hidden"),"auto"===overflowY&&(overflowY=scrollbarWidths.left||scrollbarWidths.right||this.scrollEl[0].scrollHeight-1>this.scrollEl[0].clientHeight?"scroll":"hidden"),this.scrollEl.css({"overflow-x":overflowX,"overflow-y":overflowY})},setHeight:function(height){this.scrollEl.height(height)},getScrollTop:function(){return this.scrollEl.scrollTop()},setScrollTop:function(top){this.scrollEl.scrollTop(top)},getClientWidth:function(){return this.scrollEl[0].clientWidth},getClientHeight:function(){return this.scrollEl[0].clientHeight},getScrollbarWidths:function(){return getScrollbarWidths(this.scrollEl)}}),Calendar=FC.Calendar=Class.extend({dirDefaults:null,langDefaults:null,overrides:null,options:null,viewSpecCache:null,view:null,header:null,loadingLevel:0,constructor:function(element,overrides){var t=this;t.initOptions(overrides||{});var options=this.options;t.render=function(){content?elementVisible()&&(calcSize(),renderView()):function(){options.theme?"ui":"fc",element.addClass("fc"),options.isRTL?element.addClass("fc-rtl"):element.addClass("fc-ltr");options.theme?element.addClass("ui-widget"):element.addClass("fc-unthemed");content=$("<div class='fc-view-container'/>").prependTo(element),header=t.header=new function(calendar,options){var t=this;t.render=function(){var sections=options.header;if(tm=options.theme?"ui":"fc",sections)return el=$("<div class='fc-toolbar'/>").append(renderSection("left")).append(renderSection("right")).append(renderSection("center")).append('<div class="fc-clear"/>')},t.removeElement=function(){el.remove(),el=$()},t.updateTitle=function(text){el.find("h2").text(text)},t.activateButton=function(buttonName){el.find(".fc-"+buttonName+"-button").addClass(tm+"-state-active")},t.deactivateButton=function(buttonName){el.find(".fc-"+buttonName+"-button").removeClass(tm+"-state-active")},t.disableButton=function(buttonName){el.find(".fc-"+buttonName+"-button").attr("disabled","disabled").addClass(tm+"-state-disabled")},t.enableButton=function(buttonName){el.find(".fc-"+buttonName+"-button").removeAttr("disabled").removeClass(tm+"-state-disabled")},t.getViewsWithButtons=function(){return viewsWithButtons};var tm,el=$(),viewsWithButtons=[];function renderSection(position){var sectionEl=$('<div class="fc-'+position+'"/>'),buttonStr=options.header[position];return buttonStr&&$.each(buttonStr.split(" "),function(i){var groupEl,groupChildren=$(),isOnlyButtons=!0;$.each(this.split(","),function(j,buttonName){var customButtonProps,viewSpec,buttonClick,overrideText,defaultText,themeIcon,normalIcon,innerHtml,button;"title"==buttonName?(groupChildren=groupChildren.add($("<h2>&nbsp;</h2>")),isOnlyButtons=!1):((customButtonProps=(calendar.options.customButtons||{})[buttonName])?(buttonClick=function(ev){customButtonProps.click&&customButtonProps.click.call(button[0],ev)},overrideText="",defaultText=customButtonProps.text):(viewSpec=calendar.getViewSpec(buttonName))?(buttonClick=function(){calendar.changeView(buttonName)},viewsWithButtons.push(buttonName),overrideText=viewSpec.buttonTextOverride,defaultText=viewSpec.buttonTextDefault):calendar[buttonName]&&(buttonClick=function(){calendar[buttonName]()},overrideText=(calendar.overrides.buttonText||{})[buttonName],defaultText=options.buttonText[buttonName]),buttonClick&&(themeIcon=customButtonProps?customButtonProps.themeIcon:options.themeButtonIcons[buttonName],normalIcon=customButtonProps?customButtonProps.icon:options.buttonIcons[buttonName],innerHtml=overrideText?htmlEscape(overrideText):themeIcon&&options.theme?"<span class='ui-icon ui-icon-"+themeIcon+"'></span>":normalIcon&&!options.theme?"<span class='fc-icon fc-icon-"+normalIcon+"'></span>":htmlEscape(defaultText),button=$('<button type="button" class="'+["fc-"+buttonName+"-button",tm+"-button",tm+"-state-default"].join(" ")+'">'+innerHtml+"</button>").click(function(ev){button.hasClass(tm+"-state-disabled")||(buttonClick(ev),(button.hasClass(tm+"-state-active")||button.hasClass(tm+"-state-disabled"))&&button.removeClass(tm+"-state-hover"))}).mousedown(function(){button.not("."+tm+"-state-active").not("."+tm+"-state-disabled").addClass(tm+"-state-down")}).mouseup(function(){button.removeClass(tm+"-state-down")}).hover(function(){button.not("."+tm+"-state-active").not("."+tm+"-state-disabled").addClass(tm+"-state-hover")},function(){button.removeClass(tm+"-state-hover").removeClass(tm+"-state-down")}),groupChildren=groupChildren.add(button)))}),isOnlyButtons&&groupChildren.first().addClass(tm+"-corner-left").end().last().addClass(tm+"-corner-right").end(),groupChildren.length>1?(groupEl=$("<div/>"),isOnlyButtons&&groupEl.addClass("fc-button-group"),groupEl.append(groupChildren),sectionEl.append(groupEl)):sectionEl.append(groupChildren)}),sectionEl}}(t,options),(headerElement=header.render())&&element.prepend(headerElement);renderView(options.defaultView),options.handleWindowResize&&(windowResizeProxy=debounce(windowResize,options.windowResizeDelay),$(window).resize(windowResizeProxy))}()},t.destroy=function(){currentView&&currentView.removeElement();header.removeElement(),content.remove(),element.removeClass("fc fc-ltr fc-rtl fc-unthemed ui-widget"),windowResizeProxy&&$(window).unbind("resize",windowResizeProxy)},t.refetchEvents=function(){freezeContentHeight(),currentView.clearEvents(),unfreezeContentHeight(),fetchAndRenderEvents()},t.reportEvents=function(_events){events=_events,renderEvents()},t.reportEventChange=function(){renderEvents()},t.rerenderEvents=renderEvents,t.changeView=renderView,t.select=function(zonedStartInput,zonedEndInput){currentView.select(t.buildSelectSpan.apply(t,arguments))},t.unselect=function(){currentView&&currentView.unselect()},t.prev=function(){date=currentView.computePrevDate(date),renderView()},t.next=function(){date=currentView.computeNextDate(date),renderView()},t.prevYear=function(){date.add(-1,"years"),renderView()},t.nextYear=function(){date.add(1,"years"),renderView()},t.today=function(){date=t.getNow(),renderView()},t.gotoDate=function(zonedDateInput){date=t.moment(zonedDateInput).stripZone(),renderView()},t.incrementDate=function(delta){date.add(moment.duration(delta)),renderView()},t.zoomTo=function(newDate,viewType){var spec;viewType=viewType||"day",spec=t.getViewSpec(viewType)||t.getUnitViewSpec(viewType),date=newDate.clone(),renderView(spec?spec.type:null)},t.getDate=function(){return t.applyTimezone(date)},t.getCalendar=function(){return t},t.getView=function(){return currentView},t.option=function(name,value){if(void 0===value)return options[name];"height"!=name&&"contentHeight"!=name&&"aspectRatio"!=name||(options[name]=value,updateSize(!0))},t.trigger=function(name,thisObj){var args=Array.prototype.slice.call(arguments,2);if(thisObj=thisObj||_element,this.triggerWith(name,thisObj,args),options[name])return options[name].apply(thisObj,args)};var localeData=createObject(getMomentLocaleData(options.lang));options.monthNames&&(localeData._months=options.monthNames);options.monthNamesShort&&(localeData._monthsShort=options.monthNamesShort);options.dayNames&&(localeData._weekdays=options.dayNames);options.dayNamesShort&&(localeData._weekdaysShort=options.dayNamesShort);if(null!=options.firstDay){var _week=createObject(localeData._week);_week.dow=options.firstDay,localeData._week=_week}localeData._fullCalendar_weekCalc=(weekCalc=options.weekNumberCalculation,"function"==typeof weekCalc?weekCalc:"local"===weekCalc?weekCalc:"iso"===weekCalc||"ISO"===weekCalc?"ISO":void 0),t.defaultAllDayEventDuration=moment.duration(options.defaultAllDayEventDuration),t.defaultTimedEventDuration=moment.duration(options.defaultTimedEventDuration),t.moment=function(){var mom;return"local"===options.timezone?(mom=FC.moment.apply(null,arguments)).hasTime()&&mom.local():mom="UTC"===options.timezone?FC.moment.utc.apply(null,arguments):FC.moment.parseZone.apply(null,arguments),"_locale"in mom?mom._locale=localeData:mom._lang=localeData,mom},t.getIsAmbigTimezone=function(){return"local"!==options.timezone&&"UTC"!==options.timezone},t.applyTimezone=function(date){if(!date.hasTime())return date.clone();var adjustedZonedDate,zonedDate=t.moment(date.toArray()),timeAdjust=date.time()-zonedDate.time();return timeAdjust&&(adjustedZonedDate=zonedDate.clone().add(timeAdjust),date.time()-adjustedZonedDate.time()==0&&(zonedDate=adjustedZonedDate)),zonedDate},t.getNow=function(){var now=options.now;return"function"==typeof now&&(now=now()),t.moment(now).stripZone()},t.getEventEnd=function(event){return event.end?event.end.clone():t.getDefaultEventEnd(event.allDay,event.start)},t.getDefaultEventEnd=function(allDay,zonedStart){var end=zonedStart.clone();return allDay?end.stripTime().add(t.defaultAllDayEventDuration):end.add(t.defaultTimedEventDuration),t.getIsAmbigTimezone()&&end.stripZone(),end},t.humanizeDuration=function(duration){return(duration.locale||duration.lang).call(duration,options.lang).humanize()},function(options){var t=this;t.isFetchNeeded=function(start,end){return!rangeStart||start<rangeStart||end>rangeEnd},t.fetchEvents=function(start,end){rangeStart=start,rangeEnd=end,cache=[];var fetchID=++currentFetchID,len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++)fetchEventSource(sources[i],fetchID)},t.addEventSource=function(sourceInput){var source=buildEventSource(sourceInput);source&&(sources.push(source),pendingSourceCnt++,fetchEventSource(source,currentFetchID))},t.removeEventSource=function(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source)}),cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source)}),reportEvents(cache)},t.updateEvent=function(event){event.start=t.moment(event.start),event.end?event.end=t.moment(event.end):event.end=null;mutateEvent(event,function(event){var props={};return $.each(event,function(name,val){isMiscEventPropName(name)&&void 0!==val&&function(val){return/undefined|null|boolean|number|string/.test($.type(val))}(val)&&(props[name]=val)}),props}(event)),reportEvents(cache)},t.renderEvent=function(eventInput,stick){var events,i,event,abstractEvent=buildEventFromInput(eventInput);if(abstractEvent){for(events=expandEvent(abstractEvent),i=0;i<events.length;i++)(event=events[i]).source||(stick&&(stickySource.events.push(event),event.source=stickySource),cache.push(event));return reportEvents(cache),events}return[]},t.removeEvents=function(filter){var eventID,i;null==filter?filter=function(){return!0}:$.isFunction(filter)||(eventID=filter+"",filter=function(event){return event._id==eventID});for(cache=$.grep(cache,filter,!0),i=0;i<sources.length;i++)$.isArray(sources[i].events)&&(sources[i].events=$.grep(sources[i].events,filter,!0));reportEvents(cache)},t.clientEvents=clientEvents,t.mutateEvent=mutateEvent,t.normalizeEventDates=normalizeEventDates,t.normalizeEventTimes=normalizeEventTimes;var rangeStart,rangeEnd,reportEvents=t.reportEvents,stickySource={events:[]},sources=[stickySource],currentFetchID=0,pendingSourceCnt=0,cache=[];function fetchEventSource(source,fetchID){!function _fetchEventSource(source,callback){var i;var fetchers=FC.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){if(!0===(res=fetchers[i].call(t,source,rangeStart.clone(),rangeEnd.clone(),options.timezone,callback)))return;if("object"==typeof res)return void _fetchEventSource(res,callback)}var events=source.events;if(events)$.isFunction(events)?(t.pushLoading(),events.call(t,rangeStart.clone(),rangeEnd.clone(),options.timezone,function(events){callback(events),t.popLoading()})):$.isArray(events)?callback(events):callback();else{var url=source.url;if(url){var customData,success=source.success,error=source.error,complete=source.complete;customData=$.isFunction(source.data)?source.data():source.data;var data=$.extend({},customData||{}),startParam=firstDefined(source.startParam,options.startParam),endParam=firstDefined(source.endParam,options.endParam),timezoneParam=firstDefined(source.timezoneParam,options.timezoneParam);startParam&&(data[startParam]=rangeStart.format()),endParam&&(data[endParam]=rangeEnd.format()),options.timezone&&"local"!=options.timezone&&(data[timezoneParam]=options.timezone),t.pushLoading(),$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);$.isArray(res)&&(events=res),callback(events)},error:function(){applyAll(error,this,arguments),callback()},complete:function(){applyAll(complete,this,arguments),t.popLoading()}}))}else callback()}}(source,function(eventInputs){var i,eventInput,abstractEvent,isArraySource=$.isArray(source.events);if(fetchID==currentFetchID){if(eventInputs)for(i=0;i<eventInputs.length;i++)eventInput=eventInputs[i],(abstractEvent=isArraySource?eventInput:buildEventFromInput(eventInput,source))&&cache.push.apply(cache,expandEvent(abstractEvent));--pendingSourceCnt||reportEvents(cache)}})}function buildEventSource(sourceInput){var source,i,normalizers=FC.sourceNormalizers;if($.isFunction(sourceInput)||$.isArray(sourceInput)?source={events:sourceInput}:"string"==typeof sourceInput?source={url:sourceInput}:"object"==typeof sourceInput&&(source=$.extend({},sourceInput)),source){for(source.className?"string"==typeof source.className&&(source.className=source.className.split(/\s+/)):source.className=[],$.isArray(source.events)&&(source.origArray=source.events,source.events=$.map(source.events,function(eventInput){return buildEventFromInput(eventInput,source)})),i=0;i<normalizers.length;i++)normalizers[i].call(t,source);return source}}function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2)}function getSourcePrimitive(source){return("object"==typeof source?source.origArray||source.googleCalendarId||source.url||source.events:null)||source}function isMiscEventPropName(name){return!/^_|^(id|allDay|start|end)$/.test(name)}function clientEvents(filter){return $.isFunction(filter)?$.grep(cache,filter):null!=filter?(filter+="",$.grep(cache,function(e){return e._id==filter})):cache}function buildEventFromInput(input,source){var start,end,allDay,out={};if(options.eventDataTransform&&(input=options.eventDataTransform(input)),source&&source.eventDataTransform&&(input=source.eventDataTransform(input)),$.extend(out,input),source&&(out.source=source),out._id=input._id||(void 0===input.id?"_fc"+eventGUID++:input.id+""),input.className?"string"==typeof input.className?out.className=input.className.split(/\s+/):out.className=input.className:out.className=[],start=input.start||input.date,end=input.end,isTimeString(start)&&(start=moment.duration(start)),isTimeString(end)&&(end=moment.duration(end)),input.dow||moment.isDuration(start)||moment.isDuration(end))out.start=start?moment.duration(start):null,out.end=end?moment.duration(end):null,out._recurring=!0;else{if(start&&!(start=t.moment(start)).isValid())return!1;end&&((end=t.moment(end)).isValid()||(end=null)),void 0===(allDay=input.allDay)&&(allDay=firstDefined(source?source.allDayDefault:void 0,options.allDayDefault)),assignDatesToEvent(start,end,allDay,out)}return t.normalizeEvent(out),out}function assignDatesToEvent(start,end,allDay,event){event.start=start,event.end=end,event.allDay=allDay,normalizeEventDates(event),backupEventDates(event)}function normalizeEventDates(eventProps){normalizeEventTimes(eventProps),eventProps.end&&!eventProps.end.isAfter(eventProps.start)&&(eventProps.end=null),eventProps.end||(options.forceEventDuration?eventProps.end=t.getDefaultEventEnd(eventProps.allDay,eventProps.start):eventProps.end=null)}function normalizeEventTimes(eventProps){null==eventProps.allDay&&(eventProps.allDay=!(eventProps.start.hasTime()||eventProps.end&&eventProps.end.hasTime())),eventProps.allDay?(eventProps.start.stripTime(),eventProps.end&&eventProps.end.stripTime()):(eventProps.start.hasTime()||(eventProps.start=t.applyTimezone(eventProps.start.time(0))),eventProps.end&&!eventProps.end.hasTime()&&(eventProps.end=t.applyTimezone(eventProps.end.time(0))))}function expandEvent(abstractEvent,_rangeStart,_rangeEnd){var dowHash,dow,i,date,startTime,endTime,start,end,event,events=[];if(_rangeStart=_rangeStart||rangeStart,_rangeEnd=_rangeEnd||rangeEnd,abstractEvent)if(abstractEvent._recurring){if(dow=abstractEvent.dow)for(dowHash={},i=0;i<dow.length;i++)dowHash[dow[i]]=!0;for(date=_rangeStart.clone().stripTime();date.isBefore(_rangeEnd);)dowHash&&!dowHash[date.day()]||(startTime=abstractEvent.start,endTime=abstractEvent.end,start=date.clone(),end=null,startTime&&(start=start.time(startTime)),endTime&&(end=date.clone().time(endTime)),event=$.extend({},abstractEvent),assignDatesToEvent(start,end,!startTime&&!endTime,event),events.push(event)),date.add(1,"days")}else events.push(abstractEvent);return events}function mutateEvent(event,newProps,largeUnit){var oldProps,clearEnd,startDelta,endDelta,durationDelta,undoFunc,miscProps={};function diffDates(date1,date0){return largeUnit?diffByUnit(date1,date0,largeUnit):newProps.allDay?(a=date1,b=date0,moment.duration({days:a.clone().stripTime().diff(b.clone().stripTime(),"days")})):diffDayTime(date1,date0);var a,b}return(newProps=newProps||{}).start||(newProps.start=event.start.clone()),void 0===newProps.end&&(newProps.end=event.end?event.end.clone():null),null==newProps.allDay&&(newProps.allDay=event.allDay),normalizeEventDates(newProps),normalizeEventDates(oldProps={start:event._start.clone(),end:event._end?event._end.clone():t.getDefaultEventEnd(event._allDay,event._start),allDay:newProps.allDay}),clearEnd=null!==event._end&&null===newProps.end,startDelta=diffDates(newProps.start,oldProps.start),newProps.end?(endDelta=diffDates(newProps.end,oldProps.end),durationDelta=endDelta.subtract(startDelta)):durationDelta=null,$.each(newProps,function(name,val){isMiscEventPropName(name)&&void 0!==val&&(miscProps[name]=val)}),undoFunc=function(events,clearEnd,allDay,dateDelta,durationDelta,miscProps){var isAmbigTimezone=t.getIsAmbigTimezone(),undoFunctions=[];dateDelta&&!dateDelta.valueOf()&&(dateDelta=null);durationDelta&&!durationDelta.valueOf()&&(durationDelta=null);return $.each(events,function(i,event){var oldProps,newProps;oldProps={start:event.start.clone(),end:event.end?event.end.clone():null,allDay:event.allDay},$.each(miscProps,function(name){oldProps[name]=event[name]}),normalizeEventDates(newProps={start:event._start,end:event._end,allDay:allDay}),clearEnd?newProps.end=null:durationDelta&&!newProps.end&&(newProps.end=t.getDefaultEventEnd(newProps.allDay,newProps.start)),dateDelta&&(newProps.start.add(dateDelta),newProps.end&&newProps.end.add(dateDelta)),durationDelta&&newProps.end.add(durationDelta),isAmbigTimezone&&!newProps.allDay&&(dateDelta||durationDelta)&&(newProps.start.stripZone(),newProps.end&&newProps.end.stripZone()),$.extend(event,miscProps,newProps),backupEventDates(event),undoFunctions.push(function(){$.extend(event,oldProps),backupEventDates(event)})}),function(){for(var i=0;i<undoFunctions.length;i++)undoFunctions[i]()}}(clientEvents(event._id),clearEnd,newProps.allDay,startDelta,durationDelta,miscProps),{dateDelta:startDelta,durationDelta:durationDelta,undo:undoFunc}}function getBusinessHoursEvents(wholeDay){var eventInput,optionVal=options.businessHours,view=t.getView();return optionVal&&(eventInput=$.extend({},{className:"fc-nonbusiness",start:"09:00",end:"17:00",dow:[1,2,3,4,5],rendering:"inverse-background"},"object"==typeof optionVal?optionVal:{})),eventInput?(wholeDay&&(eventInput.start=null,eventInput.end=null),expandEvent(buildEventFromInput(eventInput),view.start,view.end)):[]}function isEventSpanAllowed(span,event){var source=event.source||{},constraint=firstDefined(event.constraint,source.constraint,options.eventConstraint),overlap=firstDefined(event.overlap,source.overlap,options.eventOverlap);return isSpanAllowed(span,constraint,overlap,event)}function isSelectionSpanAllowed(span){return isSpanAllowed(span,options.selectConstraint,options.selectOverlap)}function isSpanAllowed(span,constraint,overlap,event){var constraintEvents,anyContainment,peerEvents,i,peerEvent,peerOverlap;if(null!=constraint){for(constraintEvents=function(constraintInput){if("businessHours"===constraintInput)return getBusinessHoursEvents();if("object"==typeof constraintInput)return expandEvent(buildEventFromInput(constraintInput));return clientEvents(constraintInput)}(constraint),anyContainment=!1,i=0;i<constraintEvents.length;i++)if(eventContainsRange(constraintEvents[i],span)){anyContainment=!0;break}if(!anyContainment)return!1}for(peerEvents=t.getPeerEvents(span,event),i=0;i<peerEvents.length;i++)if(eventIntersectsRange(peerEvent=peerEvents[i],span)){if(!1===overlap)return!1;if("function"==typeof overlap&&!overlap(peerEvent,event))return!1;if(event){if(!1===(peerOverlap=firstDefined(peerEvent.overlap,(peerEvent.source||{}).overlap)))return!1;if("function"==typeof peerOverlap&&!peerOverlap(event,peerEvent))return!1}}return!0}function eventContainsRange(event,range){var eventStart=event.start.clone().stripZone(),eventEnd=t.getEventEnd(event).stripZone();return range.start>=eventStart&&range.end<=eventEnd}function eventIntersectsRange(event,range){var eventStart=event.start.clone().stripZone(),eventEnd=t.getEventEnd(event).stripZone();return range.start<eventEnd&&range.end>eventStart}$.each((options.events?[options.events]:[]).concat(options.eventSources||[]),function(i,sourceInput){var source=buildEventSource(sourceInput);source&&sources.push(source)}),t.getBusinessHoursEvents=getBusinessHoursEvents,t.isEventSpanAllowed=isEventSpanAllowed,t.isExternalSpanAllowed=function(eventSpan,eventLocation,eventProps){var eventInput,event;eventProps&&(eventInput=$.extend({},eventProps,eventLocation),event=expandEvent(buildEventFromInput(eventInput))[0]);return event?isEventSpanAllowed(eventSpan,event):isSelectionSpanAllowed(eventSpan)},t.isSelectionSpanAllowed=isSelectionSpanAllowed,t.getEventCache=function(){return cache}}.call(t,options);var weekCalc;var header,headerElement,content,currentView,suggestedViewHeight,windowResizeProxy,date,isFetchNeeded=t.isFetchNeeded,fetchEvents=t.fetchEvents,_element=element[0],viewsByType={},ignoreWindowResize=0,events=[];date=null!=options.defaultDate?t.moment(options.defaultDate).stripZone():t.getNow();function elementVisible(){return element.is(":visible")}function renderView(viewType){ignoreWindowResize++,currentView&&viewType&&currentView.type!==viewType&&(header.deactivateButton(currentView.type),freezeContentHeight(),currentView.removeElement(),currentView=t.view=null),!currentView&&viewType&&((currentView=t.view=viewsByType[viewType]||(viewsByType[viewType]=t.instantiateView(viewType))).setElement($("<div class='fc-view fc-"+viewType+"-view' />").appendTo(content)),header.activateButton(viewType)),currentView&&(date=currentView.massageCurrentDate(date),currentView.displaying&&date.isWithin(currentView.intervalStart,currentView.intervalEnd)||elementVisible()&&(currentView.display(date),unfreezeContentHeight(),header.updateTitle(currentView.title),t.getNow().isWithin(currentView.intervalStart,currentView.intervalEnd)?header.disableButton("today"):header.enableButton("today"),!options.lazyFetching||isFetchNeeded(currentView.start,currentView.end)?fetchAndRenderEvents():renderEvents())),unfreezeContentHeight(),ignoreWindowResize--}function updateSize(shouldRecalc){if(elementVisible())return shouldRecalc&&_calcSize(),ignoreWindowResize++,currentView.updateSize(!0),ignoreWindowResize--,!0}function calcSize(){elementVisible()&&_calcSize()}function _calcSize(){suggestedViewHeight="number"==typeof options.contentHeight?options.contentHeight:"number"==typeof options.height?options.height-(headerElement?headerElement.outerHeight(!0):0):Math.round(content.width()/Math.max(options.aspectRatio,.5))}function windowResize(ev){!ignoreWindowResize&&ev.target===window&&currentView.start&&updateSize(!0)&&currentView.trigger("windowResize",_element)}function renderEvents(){elementVisible()&&(freezeContentHeight(),currentView.displayEvents(events),unfreezeContentHeight())}function fetchAndRenderEvents(){fetchEvents(currentView.start,currentView.end)}function freezeContentHeight(){content.css({width:"100%",height:content.height(),overflow:"hidden"})}function unfreezeContentHeight(){content.css({width:"",height:"",overflow:""})}t.getSuggestedViewHeight=function(){return void 0===suggestedViewHeight&&calcSize(),suggestedViewHeight},t.isHeightAuto=function(){return"auto"===options.contentHeight||"auto"===options.height},t.freezeContentHeight=freezeContentHeight,t.unfreezeContentHeight=unfreezeContentHeight,t.initialize()},initialize:function(){},initOptions:function(overrides){var lang,langDefaults,dirDefaults;lang=(overrides=function(input){var subObj,overrides={views:input.views||{}};return $.each(input,function(name,val){"views"!=name&&($.isPlainObject(val)&&!/(time|duration|interval)$/i.test(name)&&-1==$.inArray(name,complexOptions)?(subObj=null,$.each(val,function(subName,subVal){/^(month|week|day|default|basic(Week|Day)?|agenda(Week|Day)?)$/.test(subName)?(overrides.views[subName]||(overrides.views[subName]={}),overrides.views[subName][name]=subVal):(subObj||(subObj={}),subObj[subName]=subVal)}),subObj&&(overrides[name]=subObj)):overrides[name]=val)}),overrides}(overrides)).lang,(langDefaults=langOptionHash[lang])||(lang=Calendar.defaults.lang,langDefaults=langOptionHash[lang]||{}),dirDefaults=firstDefined(overrides.isRTL,langDefaults.isRTL,Calendar.defaults.isRTL)?Calendar.rtlDefaults:{},this.dirDefaults=dirDefaults,this.langDefaults=langDefaults,this.overrides=overrides,this.options=mergeOptions([Calendar.defaults,dirDefaults,langDefaults,overrides]),populateInstanceComputableOptions(this.options),this.viewSpecCache={}},getViewSpec:function(viewType){var cache=this.viewSpecCache;return cache[viewType]||(cache[viewType]=this.buildViewSpec(viewType))},getUnitViewSpec:function(unit){var viewTypes,i,spec;if(-1!=$.inArray(unit,intervalUnits))for(viewTypes=this.header.getViewsWithButtons(),$.each(FC.views,function(viewType){viewTypes.push(viewType)}),i=0;i<viewTypes.length;i++)if((spec=this.getViewSpec(viewTypes[i]))&&spec.singleUnit==unit)return spec},buildViewSpec:function(requestedViewType){for(var spec,overrides,duration,unit,viewOverrides=this.overrides.views||{},specChain=[],defaultsChain=[],overridesChain=[],viewType=requestedViewType;viewType;)spec=fcViews[viewType],overrides=viewOverrides[viewType],viewType=null,"function"==typeof spec&&(spec={class:spec}),spec&&(specChain.unshift(spec),defaultsChain.unshift(spec.defaults||{}),duration=duration||spec.duration,viewType=viewType||spec.type),overrides&&(overridesChain.unshift(overrides),duration=duration||overrides.duration,viewType=viewType||overrides.type);return(spec=mergeProps(specChain)).type=requestedViewType,!!spec.class&&(duration&&(duration=moment.duration(duration)).valueOf()&&(spec.duration=duration,unit=computeIntervalUnit(duration),1===duration.as(unit)&&(spec.singleUnit=unit,overridesChain.unshift(viewOverrides[unit]||{}))),spec.defaults=mergeOptions(defaultsChain),spec.overrides=mergeOptions(overridesChain),this.buildViewSpecOptions(spec),this.buildViewSpecButtonText(spec,requestedViewType),spec)},buildViewSpecOptions:function(spec){spec.options=mergeOptions([Calendar.defaults,spec.defaults,this.dirDefaults,this.langDefaults,this.overrides,spec.overrides]),populateInstanceComputableOptions(spec.options)},buildViewSpecButtonText:function(spec,requestedViewType){function queryButtonText(options){var buttonText=options.buttonText||{};return buttonText[requestedViewType]||(spec.singleUnit?buttonText[spec.singleUnit]:null)}spec.buttonTextOverride=queryButtonText(this.overrides)||spec.overrides.buttonText,spec.buttonTextDefault=queryButtonText(this.langDefaults)||queryButtonText(this.dirDefaults)||spec.defaults.buttonText||queryButtonText(Calendar.defaults)||(spec.duration?this.humanizeDuration(spec.duration):null)||requestedViewType},instantiateView:function(viewType){var spec=this.getViewSpec(viewType);return new spec.class(this,viewType,spec.options,spec.duration)},isValidViewType:function(viewType){return Boolean(this.getViewSpec(viewType))},pushLoading:function(){this.loadingLevel++||this.trigger("loading",null,!0,this.view)},popLoading:function(){--this.loadingLevel||this.trigger("loading",null,!1,this.view)},buildSelectSpan:function(zonedStartInput,zonedEndInput){var start=this.moment(zonedStartInput).stripZone();return{start:start,end:zonedEndInput?this.moment(zonedEndInput).stripZone():start.hasTime()?start.clone().add(this.defaultTimedEventDuration):start.clone().add(this.defaultAllDayEventDuration)}}});Calendar.mixin(EmitterMixin),Calendar.defaults={titleRangeSeparator:" — ",monthYearFormat:"MMMM YYYY",defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"09:00:00",defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberTitle:"W",weekNumberCalculation:"local",scrollTime:"06:00:00",lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",timezone:!1,isRTL:!1,buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day"},buttonIcons:{prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow"},theme:!1,themeButtonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e",prevYear:"seek-prev",nextYear:"seek-next"},dragOpacity:.75,dragRevertDuration:500,dragScroll:!0,unselectAuto:!0,dropAccept:"*",eventOrder:"title",eventLimit:!1,eventLimitText:"more",eventLimitClick:"popover",dayPopoverFormat:"LL",handleWindowResize:!0,windowResizeDelay:200,longPressDelay:1e3},Calendar.englishDefaults={dayPopoverFormat:"dddd, MMMM D"},Calendar.rtlDefaults={header:{left:"next,prev today",center:"",right:"title"},buttonIcons:{prev:"right-single-arrow",next:"left-single-arrow",prevYear:"right-double-arrow",nextYear:"left-double-arrow"},themeButtonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w",nextYear:"seek-prev",prevYear:"seek-next"}};var langOptionHash=FC.langs={};FC.datepickerLang=function(langCode,dpLangCode,dpOptions){var fcOptions=langOptionHash[langCode]||(langOptionHash[langCode]={});fcOptions.isRTL=dpOptions.isRTL,fcOptions.weekNumberTitle=dpOptions.weekHeader,$.each(dpComputableOptions,function(name,func){fcOptions[name]=func(dpOptions)}),$.datepicker&&($.datepicker.regional[dpLangCode]=$.datepicker.regional[langCode]=dpOptions,$.datepicker.regional.en=$.datepicker.regional[""],$.datepicker.setDefaults(dpOptions))},FC.lang=function(langCode,newFcOptions){var fcOptions,momOptions;fcOptions=langOptionHash[langCode]||(langOptionHash[langCode]={}),newFcOptions&&(fcOptions=langOptionHash[langCode]=mergeOptions([fcOptions,newFcOptions])),momOptions=getMomentLocaleData(langCode),$.each(momComputableOptions,function(name,func){null==fcOptions[name]&&(fcOptions[name]=func(momOptions,fcOptions))}),Calendar.defaults.lang=langCode};var dpComputableOptions={buttonText:function(dpOptions){return{prev:stripHtmlEntities(dpOptions.prevText),next:stripHtmlEntities(dpOptions.nextText),today:stripHtmlEntities(dpOptions.currentText)}},monthYearFormat:function(dpOptions){return dpOptions.showMonthAfterYear?"YYYY["+dpOptions.yearSuffix+"] MMMM":"MMMM YYYY["+dpOptions.yearSuffix+"]"}},momComputableOptions={dayOfMonthFormat:function(momOptions,fcOptions){var format=momOptions.longDateFormat("l");return format=format.replace(/^Y+[^\w\s]*|[^\w\s]*Y+$/g,""),fcOptions.isRTL?format+=" ddd":format="ddd "+format,format},mediumTimeFormat:function(momOptions){return momOptions.longDateFormat("LT").replace(/\s*a$/i,"a")},smallTimeFormat:function(momOptions){return momOptions.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"a")},extraSmallTimeFormat:function(momOptions){return momOptions.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"t")},hourFormat:function(momOptions){return momOptions.longDateFormat("LT").replace(":mm","").replace(/(\Wmm)$/,"").replace(/\s*a$/i,"a")},noMeridiemTimeFormat:function(momOptions){return momOptions.longDateFormat("LT").replace(/\s*a$/i,"")}},instanceComputableOptions={smallDayDateFormat:function(options){return options.isRTL?"D dd":"dd D"},weekFormat:function(options){return options.isRTL?"w[ "+options.weekNumberTitle+"]":"["+options.weekNumberTitle+" ]w"},smallWeekFormat:function(options){return options.isRTL?"w["+options.weekNumberTitle+"]":"["+options.weekNumberTitle+"]w"}};function populateInstanceComputableOptions(options){$.each(instanceComputableOptions,function(name,func){null==options[name]&&(options[name]=func(options))})}function getMomentLocaleData(langCode){var func=moment.localeData||moment.langData;return func.call(moment,langCode)||func.call(moment,"en")}FC.lang("en",Calendar.englishDefaults),FC.sourceNormalizers=[],FC.sourceFetchers=[];var ajaxDefaults={dataType:"json",cache:!1},eventGUID=1;function backupEventDates(event){event._allDay=event.allDay,event._start=event.start.clone(),event._end=event.end?event.end.clone():null}Calendar.prototype.normalizeEvent=function(event){},Calendar.prototype.getPeerEvents=function(span,event){var i,otherEvent,cache=this.getEventCache(),peerEvents=[];for(i=0;i<cache.length;i++)otherEvent=cache[i],event&&event._id===otherEvent._id||peerEvents.push(otherEvent);return peerEvents};var BasicView=FC.BasicView=View.extend({scroller:null,dayGridClass:DayGrid,dayGrid:null,dayNumbersVisible:!1,weekNumbersVisible:!1,weekNumberWidth:null,headContainerEl:null,headRowEl:null,initialize:function(){this.dayGrid=this.instantiateDayGrid(),this.scroller=new Scroller({overflowX:"hidden",overflowY:"auto"})},instantiateDayGrid:function(){return new(this.dayGridClass.extend(basicDayGridMethods))(this)},setRange:function(range){View.prototype.setRange.call(this,range),this.dayGrid.breakOnWeeks=/year|month|week/.test(this.intervalUnit),this.dayGrid.setRange(range)},computeRange:function(date){var range=View.prototype.computeRange.call(this,date);return/year|month/.test(range.intervalUnit)&&(range.start.startOf("week"),range.start=this.skipHiddenDays(range.start),range.end.weekday()&&(range.end.add(1,"week").startOf("week"),range.end=this.skipHiddenDays(range.end,-1,!0))),range},renderDates:function(){this.dayNumbersVisible=this.dayGrid.rowCnt>1,this.weekNumbersVisible=this.opt("weekNumbers"),this.dayGrid.numbersVisible=this.dayNumbersVisible||this.weekNumbersVisible,this.el.addClass("fc-basic-view").html(this.renderSkeletonHtml()),this.renderHead(),this.scroller.render();var dayGridContainerEl=this.scroller.el.addClass("fc-day-grid-container"),dayGridEl=$('<div class="fc-day-grid" />').appendTo(dayGridContainerEl);this.el.find(".fc-body > tr > td").append(dayGridContainerEl),this.dayGrid.setElement(dayGridEl),this.dayGrid.renderDates(this.hasRigidRows())},renderHead:function(){this.headContainerEl=this.el.find(".fc-head-container").html(this.dayGrid.renderHeadHtml()),this.headRowEl=this.headContainerEl.find(".fc-row")},unrenderDates:function(){this.dayGrid.unrenderDates(),this.dayGrid.removeElement(),this.scroller.destroy()},renderBusinessHours:function(){this.dayGrid.renderBusinessHours()},renderSkeletonHtml:function(){return'<table><thead class="fc-head"><tr><td class="fc-head-container '+this.widgetHeaderClass+'"></td></tr></thead><tbody class="fc-body"><tr><td class="'+this.widgetContentClass+'"></td></tr></tbody></table>'},weekNumberStyleAttr:function(){return null!==this.weekNumberWidth?'style="width:'+this.weekNumberWidth+'px"':""},hasRigidRows:function(){var eventLimit=this.opt("eventLimit");return eventLimit&&"number"!=typeof eventLimit},updateWidth:function(){this.weekNumbersVisible&&(this.weekNumberWidth=matchCellWidths(this.el.find(".fc-week-number")))},setHeight:function(totalHeight,isAuto){var scrollerHeight,scrollbarWidths,eventLimit=this.opt("eventLimit");this.scroller.clear(),uncompensateScroll(this.headRowEl),this.dayGrid.removeSegPopover(),eventLimit&&"number"==typeof eventLimit&&this.dayGrid.limitRows(eventLimit),scrollerHeight=this.computeScrollerHeight(totalHeight),this.setGridHeight(scrollerHeight,isAuto),eventLimit&&"number"!=typeof eventLimit&&this.dayGrid.limitRows(eventLimit),isAuto||(this.scroller.setHeight(scrollerHeight),((scrollbarWidths=this.scroller.getScrollbarWidths()).left||scrollbarWidths.right)&&(compensateScroll(this.headRowEl,scrollbarWidths),scrollerHeight=this.computeScrollerHeight(totalHeight),this.scroller.setHeight(scrollerHeight)),this.scroller.lockOverflow(scrollbarWidths))},computeScrollerHeight:function(totalHeight){return totalHeight-subtractInnerElHeight(this.el,this.scroller.el)},setGridHeight:function(height,isAuto){isAuto?undistributeHeight(this.dayGrid.rowEls):distributeHeight(this.dayGrid.rowEls,height,!0)},queryScroll:function(){return this.scroller.getScrollTop()},setScroll:function(top){this.scroller.setScrollTop(top)},prepareHits:function(){this.dayGrid.prepareHits()},releaseHits:function(){this.dayGrid.releaseHits()},queryHit:function(left,top){return this.dayGrid.queryHit(left,top)},getHitSpan:function(hit){return this.dayGrid.getHitSpan(hit)},getHitEl:function(hit){return this.dayGrid.getHitEl(hit)},renderEvents:function(events){this.dayGrid.renderEvents(events),this.updateHeight()},getEventSegs:function(){return this.dayGrid.getEventSegs()},unrenderEvents:function(){this.dayGrid.unrenderEvents()},renderDrag:function(dropLocation,seg){return this.dayGrid.renderDrag(dropLocation,seg)},unrenderDrag:function(){this.dayGrid.unrenderDrag()},renderSelection:function(span){this.dayGrid.renderSelection(span)},unrenderSelection:function(){this.dayGrid.unrenderSelection()}}),basicDayGridMethods={renderHeadIntroHtml:function(){var view=this.view;return view.weekNumbersVisible?'<th class="fc-week-number '+view.widgetHeaderClass+'" '+view.weekNumberStyleAttr()+"><span>"+htmlEscape(view.opt("weekNumberTitle"))+"</span></th>":""},renderNumberIntroHtml:function(row){var view=this.view;return view.weekNumbersVisible?'<td class="fc-week-number" '+view.weekNumberStyleAttr()+"><span>"+this.getCellDate(row,0).format("w")+"</span></td>":""},renderBgIntroHtml:function(){var view=this.view;return view.weekNumbersVisible?'<td class="fc-week-number '+view.widgetContentClass+'" '+view.weekNumberStyleAttr()+"></td>":""},renderIntroHtml:function(){var view=this.view;return view.weekNumbersVisible?'<td class="fc-week-number" '+view.weekNumberStyleAttr()+"></td>":""}},MonthView=FC.MonthView=BasicView.extend({computeRange:function(date){var rowCnt,range=BasicView.prototype.computeRange.call(this,date);return this.isFixedWeeks()&&(rowCnt=Math.ceil(range.end.diff(range.start,"weeks",!0)),range.end.add(6-rowCnt,"weeks")),range},setGridHeight:function(height,isAuto){(isAuto=isAuto||"variable"===this.opt("weekMode"))&&(height*=this.rowCnt/6),distributeHeight(this.dayGrid.rowEls,height,!isAuto)},isFixedWeeks:function(){var weekMode=this.opt("weekMode");return weekMode?"fixed"===weekMode:this.opt("fixedWeekCount")}});fcViews.basic={class:BasicView},fcViews.basicDay={type:"basic",duration:{days:1}},fcViews.basicWeek={type:"basic",duration:{weeks:1}},fcViews.month={class:MonthView,duration:{months:1},defaults:{fixedWeekCount:!0}};var AgendaView=FC.AgendaView=View.extend({scroller:null,timeGridClass:TimeGrid,timeGrid:null,dayGridClass:DayGrid,dayGrid:null,axisWidth:null,headContainerEl:null,noScrollRowEls:null,bottomRuleEl:null,initialize:function(){this.timeGrid=this.instantiateTimeGrid(),this.opt("allDaySlot")&&(this.dayGrid=this.instantiateDayGrid()),this.scroller=new Scroller({overflowX:"hidden",overflowY:"auto"})},instantiateTimeGrid:function(){return new(this.timeGridClass.extend(agendaTimeGridMethods))(this)},instantiateDayGrid:function(){return new(this.dayGridClass.extend(agendaDayGridMethods))(this)},setRange:function(range){View.prototype.setRange.call(this,range),this.timeGrid.setRange(range),this.dayGrid&&this.dayGrid.setRange(range)},renderDates:function(){this.el.addClass("fc-agenda-view").html(this.renderSkeletonHtml()),this.renderHead(),this.scroller.render();var timeGridWrapEl=this.scroller.el.addClass("fc-time-grid-container"),timeGridEl=$('<div class="fc-time-grid" />').appendTo(timeGridWrapEl);this.el.find(".fc-body > tr > td").append(timeGridWrapEl),this.timeGrid.setElement(timeGridEl),this.timeGrid.renderDates(),this.bottomRuleEl=$('<hr class="fc-divider '+this.widgetHeaderClass+'"/>').appendTo(this.timeGrid.el),this.dayGrid&&(this.dayGrid.setElement(this.el.find(".fc-day-grid")),this.dayGrid.renderDates(),this.dayGrid.bottomCoordPadding=this.dayGrid.el.next("hr").outerHeight()),this.noScrollRowEls=this.el.find(".fc-row:not(.fc-scroller *)")},renderHead:function(){this.headContainerEl=this.el.find(".fc-head-container").html(this.timeGrid.renderHeadHtml())},unrenderDates:function(){this.timeGrid.unrenderDates(),this.timeGrid.removeElement(),this.dayGrid&&(this.dayGrid.unrenderDates(),this.dayGrid.removeElement()),this.scroller.destroy()},renderSkeletonHtml:function(){return'<table><thead class="fc-head"><tr><td class="fc-head-container '+this.widgetHeaderClass+'"></td></tr></thead><tbody class="fc-body"><tr><td class="'+this.widgetContentClass+'">'+(this.dayGrid?'<div class="fc-day-grid"/><hr class="fc-divider '+this.widgetHeaderClass+'"/>':"")+"</td></tr></tbody></table>"},axisStyleAttr:function(){return null!==this.axisWidth?'style="width:'+this.axisWidth+'px"':""},renderBusinessHours:function(){this.timeGrid.renderBusinessHours(),this.dayGrid&&this.dayGrid.renderBusinessHours()},unrenderBusinessHours:function(){this.timeGrid.unrenderBusinessHours(),this.dayGrid&&this.dayGrid.unrenderBusinessHours()},getNowIndicatorUnit:function(){return this.timeGrid.getNowIndicatorUnit()},renderNowIndicator:function(date){this.timeGrid.renderNowIndicator(date)},unrenderNowIndicator:function(){this.timeGrid.unrenderNowIndicator()},updateSize:function(isResize){this.timeGrid.updateSize(isResize),View.prototype.updateSize.call(this,isResize)},updateWidth:function(){this.axisWidth=matchCellWidths(this.el.find(".fc-axis"))},setHeight:function(totalHeight,isAuto){var eventLimit,scrollerHeight,scrollbarWidths;this.bottomRuleEl.hide(),this.scroller.clear(),uncompensateScroll(this.noScrollRowEls),this.dayGrid&&(this.dayGrid.removeSegPopover(),(eventLimit=this.opt("eventLimit"))&&"number"!=typeof eventLimit&&(eventLimit=AGENDA_ALL_DAY_EVENT_LIMIT),eventLimit&&this.dayGrid.limitRows(eventLimit)),isAuto||(scrollerHeight=this.computeScrollerHeight(totalHeight),this.scroller.setHeight(scrollerHeight),((scrollbarWidths=this.scroller.getScrollbarWidths()).left||scrollbarWidths.right)&&(compensateScroll(this.noScrollRowEls,scrollbarWidths),scrollerHeight=this.computeScrollerHeight(totalHeight),this.scroller.setHeight(scrollerHeight)),this.scroller.lockOverflow(scrollbarWidths),this.timeGrid.getTotalSlatHeight()<scrollerHeight&&this.bottomRuleEl.show())},computeScrollerHeight:function(totalHeight){return totalHeight-subtractInnerElHeight(this.el,this.scroller.el)},computeInitialScroll:function(){var scrollTime=moment.duration(this.opt("scrollTime")),top=this.timeGrid.computeTimeTop(scrollTime);return(top=Math.ceil(top))&&top++,top},queryScroll:function(){return this.scroller.getScrollTop()},setScroll:function(top){this.scroller.setScrollTop(top)},prepareHits:function(){this.timeGrid.prepareHits(),this.dayGrid&&this.dayGrid.prepareHits()},releaseHits:function(){this.timeGrid.releaseHits(),this.dayGrid&&this.dayGrid.releaseHits()},queryHit:function(left,top){var hit=this.timeGrid.queryHit(left,top);return!hit&&this.dayGrid&&(hit=this.dayGrid.queryHit(left,top)),hit},getHitSpan:function(hit){return hit.component.getHitSpan(hit)},getHitEl:function(hit){return hit.component.getHitEl(hit)},renderEvents:function(events){var i,dayEvents=[],timedEvents=[];for(i=0;i<events.length;i++)events[i].allDay?dayEvents.push(events[i]):timedEvents.push(events[i]);this.timeGrid.renderEvents(timedEvents),this.dayGrid&&this.dayGrid.renderEvents(dayEvents),this.updateHeight()},getEventSegs:function(){return this.timeGrid.getEventSegs().concat(this.dayGrid?this.dayGrid.getEventSegs():[])},unrenderEvents:function(){this.timeGrid.unrenderEvents(),this.dayGrid&&this.dayGrid.unrenderEvents()},renderDrag:function(dropLocation,seg){return dropLocation.start.hasTime()?this.timeGrid.renderDrag(dropLocation,seg):this.dayGrid?this.dayGrid.renderDrag(dropLocation,seg):void 0},unrenderDrag:function(){this.timeGrid.unrenderDrag(),this.dayGrid&&this.dayGrid.unrenderDrag()},renderSelection:function(span){span.start.hasTime()||span.end.hasTime()?this.timeGrid.renderSelection(span):this.dayGrid&&this.dayGrid.renderSelection(span)},unrenderSelection:function(){this.timeGrid.unrenderSelection(),this.dayGrid&&this.dayGrid.unrenderSelection()}}),agendaTimeGridMethods={renderHeadIntroHtml:function(){var weekText,view=this.view;return view.opt("weekNumbers")?(weekText=this.start.format(view.opt("smallWeekFormat")),'<th class="fc-axis fc-week-number '+view.widgetHeaderClass+'" '+view.axisStyleAttr()+"><span>"+htmlEscape(weekText)+"</span></th>"):'<th class="fc-axis '+view.widgetHeaderClass+'" '+view.axisStyleAttr()+"></th>"},renderBgIntroHtml:function(){var view=this.view;return'<td class="fc-axis '+view.widgetContentClass+'" '+view.axisStyleAttr()+"></td>"},renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}},agendaDayGridMethods={renderBgIntroHtml:function(){var view=this.view;return'<td class="fc-axis '+view.widgetContentClass+'" '+view.axisStyleAttr()+"><span>"+(view.opt("allDayHtml")||htmlEscape(view.opt("allDayText")))+"</span></td>"},renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}},AGENDA_ALL_DAY_EVENT_LIMIT=5,AGENDA_STOCK_SUB_DURATIONS=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];return fcViews.agenda={class:AgendaView,defaults:{allDaySlot:!0,allDayText:"all-day",slotDuration:"00:30:00",minTime:"00:00:00",maxTime:"24:00:00",slotEventOverlap:!0}},fcViews.agendaDay={type:"agenda",duration:{days:1}},fcViews.agendaWeek={type:"agenda",duration:{weeks:1}},FC}),function(t){"function"==typeof define&&define.amd?define(["jquery","moment","fullcalendar"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("moment"),require("fullcalendar")):t(jQuery,moment)}(function(t,e){var r,o,i,n,s,l,h,u,a,c,p,d,f,g,y,v,w,m,R,S,b,C,E,T,H,_,I,D,x,F,G,M,W,L,B,z,k,V,P,A,O,q,N,j,Y,U,X,K,Q,J,Z,tt,et,rt,ot,it,nt,st,lt,ht,ut,at,ct,pt,dt,ft,gt,yt,vt,wt,mt,Rt,St,bt,Ct,Et,Tt,Ht,It,Dt,xt,Ft,Gt,Mt,Wt,Lt,Bt,zt,kt=function(t,e){function r(){this.constructor=t}for(var o in e)Vt.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Vt={}.hasOwnProperty,Pt=[].slice;return(d=t.fullCalendar).schedulerVersion="1.3.2",4!==d.internalApiVersion?void d.warn("v"+d.schedulerVersion+" of FullCalendar Scheduler is incompatible with v"+d.version+" of the core.\nPlease see http://fullcalendar.io/support/ for more information."):(o=d.Calendar,n=d.Class,X=d.View,f=d.Grid,vt=d.intersectRanges,ot=d.debounce,Rt=d.isInt,ft=d.getScrollbarWidths,u=d.DragListener,yt=d.htmlEscape,J=d.computeIntervalUnit,Ft=d.proxy,K=d.capitaliseFirstLetter,d.applyAll,a=d.EmitterMixin,v=d.ListenerMixin,lt=d.durationHasTime,st=d.divideRangeByDuration,nt=d.divideDurationByDuration,Ct=d.multiplyDuration,Dt=d.parseFieldSpecs,Q=d.compareByFieldSpecs,ht=d.flexibleCompare,wt=d.intersectRects,l=d.CoordCache,ut=d.getContentRect,at=d.getOuterRect,ct=function(t){return t.find("> td").filter(function(t,e){return e.rowSpan<=1})},c=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.requestMovingEnd=ot(this.reportMovingEnd,500)}var o,i;return kt(r,e),r.mixin(a),r.mixin(v),r.prototype.canvas=null,r.prototype.isScrolling=!1,r.prototype.isTouching=!1,r.prototype.isMoving=!1,r.prototype.isTouchScrollEnabled=!0,r.prototype.preventTouchScrollHandler=null,r.prototype.render=function(){return r.__super__.render.apply(this,arguments),this.canvas&&(this.canvas.render(),this.canvas.el.appendTo(this.scrollEl)),this.bindHandlers()},r.prototype.destroy=function(){return r.__super__.destroy.apply(this,arguments),this.unbindHandlers()},r.prototype.disableTouchScroll=function(){return this.isTouchScrollEnabled=!1,this.bindPreventTouchScroll()},r.prototype.enableTouchScroll=function(){return this.isTouchScrollEnabled=!0,this.isTouching?void 0:this.unbindPreventTouchScroll()},r.prototype.bindPreventTouchScroll=function(){return this.preventTouchScrollHandler?void 0:this.scrollEl.on("touchmove",this.preventTouchScrollHandler=d.preventDefault)},r.prototype.unbindPreventTouchScroll=function(){return this.preventTouchScrollHandler?(this.scrollEl.off("touchmove",this.preventTouchScrollHandler),this.preventTouchScrollHandler=null):void 0},r.prototype.bindHandlers=function(){return this.listenTo(this.scrollEl,{scroll:this.reportScroll,touchstart:this.reportTouchStart,touchend:this.reportTouchEnd})},r.prototype.unbindHandlers=function(){return this.stopListeningTo(this.scrollEl)},r.prototype.reportScroll=function(){return this.isScrolling||this.reportScrollStart(),this.trigger("scroll"),this.isMoving=!0,this.requestMovingEnd()},r.prototype.reportScrollStart=function(){return this.isScrolling?void 0:(this.isScrolling=!0,this.trigger("scrollStart",this.isTouching))},r.prototype.requestMovingEnd=null,r.prototype.reportMovingEnd=function(){return this.isMoving=!1,this.isTouching?void 0:this.reportScrollEnd()},r.prototype.reportScrollEnd=function(){return this.isScrolling?(this.trigger("scrollEnd"),this.isScrolling=!1):void 0},r.prototype.reportTouchStart=function(){return this.isTouching=!0},r.prototype.reportTouchEnd=function(){return this.isTouching&&(this.isTouching=!1,this.isTouchScrollEnabled&&this.unbindPreventTouchScroll(),!this.isMoving)?this.reportScrollEnd():void 0},r.prototype.getScrollLeft=function(){var t,e,r;if(t=this.scrollEl.css("direction"),r=(e=this.scrollEl[0]).scrollLeft,"rtl"===t)switch(i){case"positive":r=r+e.clientWidth-e.scrollWidth;break;case"reverse":r=-r}return r},r.prototype.setScrollLeft=function(t){var e,r;if(e=this.scrollEl.css("direction"),r=this.scrollEl[0],"rtl"===e)switch(i){case"positive":t=t-r.clientWidth+r.scrollWidth;break;case"reverse":t=-t}return r.scrollLeft=t},r.prototype.getScrollFromLeft=function(){var t,e,r;if(t=this.scrollEl.css("direction"),r=(e=this.scrollEl[0]).scrollLeft,"rtl"===t)switch(i){case"negative":r=r-e.clientWidth+e.scrollWidth;break;case"reverse":r=-r-e.clientWidth+e.scrollWidth}return r},r.prototype.getNativeScrollLeft=function(){return this.scrollEl[0].scrollLeft},r.prototype.setNativeScrollLeft=function(t){return this.scrollEl[0].scrollLeft=t},i=null,o=function(){var e,r,o;return o=(r=(e=t('<div style=" position: absolute top: -1000px; width: 1px; height: 1px; overflow: scroll; direction: rtl; font-size: 14px; ">A</div>').appendTo("body"))[0]).scrollLeft>0?"positive":(r.scrollLeft=1,e.scrollLeft>0?"reverse":"negative"),e.remove(),o},t(function(){return i=o()}),r}(d.Scroller),s=function(e){function r(){r.__super__.constructor.apply(this,arguments),"clipped-scroll"===this.overflowX&&(this.overflowX="scroll",this.isHScrollbarsClipped=!0),"clipped-scroll"===this.overflowY&&(this.overflowY="scroll",this.isVScrollbarsClipped=!0)}return kt(r,c),r.prototype.isHScrollbarsClipped=!1,r.prototype.isVScrollbarsClipped=!1,r.prototype.renderEl=function(){var e;return e=r.__super__.renderEl.apply(this,arguments),t('<div class="fc-scroller-clip" />').append(e)},r.prototype.updateSize=function(){var t,e,r;return e=this.scrollEl,r=ft(e),t={marginLeft:0,marginRight:0,marginTop:0,marginBottom:0},this.isHScrollbarsClipped&&(t.marginTop=-r.top,t.marginBottom=-r.bottom),this.isVScrollbarsClipped&&(t.marginLeft=-r.left,t.marginRight=-r.right),e.css(t),e.toggleClass("fc-no-scrollbars",(this.isHScrollbarsClipped||"hidden"===this.overflowX)&&(this.isVScrollbarsClipped||"hidden"===this.overflowY)&&!(r.top||r.bottom||r.left||r.right))},r.prototype.getScrollbarWidths=function(){var t;return t=ft(this.scrollEl),this.isHScrollbarsClipped&&(t.top=0,t.bottom=0),this.isVScrollbarsClipped&&(t.left=0,t.right=0),t},r}(),O=function(){function e(){this.gutters={}}return e.prototype.el=null,e.prototype.contentEl=null,e.prototype.bgEl=null,e.prototype.gutters=null,e.prototype.width=null,e.prototype.minWidth=null,e.prototype.render=function(){return this.el=t('<div class="fc-scroller-canvas"> <div class="fc-content"></div> <div class="fc-bg"></div> </div>'),this.contentEl=this.el.find(".fc-content"),this.bgEl=this.el.find(".fc-bg")},e.prototype.setGutters=function(e){return e?t.extend(this.gutters,e):this.gutters={},this.updateSize()},e.prototype.setWidth=function(t){return this.width=t,this.updateSize()},e.prototype.setMinWidth=function(t){return this.minWidth=t,this.updateSize()},e.prototype.clearWidth=function(){return this.width=null,this.minWidth=null,this.updateSize()},e.prototype.updateSize=function(){var t;return t=this.gutters,this.el.toggleClass("fc-gutter-left",Boolean(t.left)).toggleClass("fc-gutter-right",Boolean(t.right)).toggleClass("fc-gutter-top",Boolean(t.top)).toggleClass("fc-gutter-bottom",Boolean(t.bottom)).css({paddingLeft:t.left||"",paddingRight:t.right||"",paddingTop:t.top||"",paddingBottom:t.bottom||"",width:null!=this.width?this.width+(t.left||0)+(t.right||0):"",minWidth:null!=this.minWidth?this.minWidth+(t.left||0)+(t.right||0):""}),this.bgEl.css({left:t.left||"",right:t.right||"",top:t.top||"",bottom:t.bottom||""})},e}(),A=function(){function t(t,e){var r,o,i,n;for(this.axis=t,this.scrollers=e,r=0,o=(i=this.scrollers).length;o>r;r++)n=i[r],this.initScroller(n)}return t.prototype.axis=null,t.prototype.scrollers=null,t.prototype.masterScroller=null,t.prototype.initScroller=function(t){return t.scrollEl.on("wheel mousewheel DomMouseScroll MozMousePixelScroll",(e=this,function(){e.assignMasterScroller(t)})),t.on("scrollStart",function(e){return function(){return e.masterScroller?void 0:e.assignMasterScroller(t)}}(this)).on("scroll",function(e){return function(){var r,o,i,n,s;if(t===e.masterScroller){for(s=[],r=0,o=(n=e.scrollers).length;o>r;r++)if((i=n[r])!==t)switch(e.axis){case"horizontal":s.push(i.setNativeScrollLeft(t.getNativeScrollLeft()));break;case"vertical":s.push(i.setScrollTop(t.getScrollTop()));break;default:s.push(void 0)}else s.push(void 0);return s}}}(this)).on("scrollEnd",function(e){return function(){return t===e.masterScroller?e.unassignMasterScroller():void 0}}(this));var e},t.prototype.assignMasterScroller=function(t){var e,r,o,i;for(this.unassignMasterScroller(),this.masterScroller=t,e=0,r=(i=this.scrollers).length;r>e;e++)(o=i[e])!==t&&o.disableTouchScroll()},t.prototype.unassignMasterScroller=function(){var t,e,o;if(this.masterScroller){for(t=0,e=(o=this.scrollers).length;e>t;t++)o[t].enableTouchScroll();this.masterScroller=null}},t.prototype.update=function(){var t,e,r,o,i,n,s,l,h,u,a,c,p;for(t=function(){var t,e,r,o;for(o=[],t=0,e=(r=this.scrollers).length;e>t;t++)c=r[t],o.push(c.getScrollbarWidths());return o}.call(this),l=h=u=s=0,r=0,i=t.length;i>r;r++)p=t[r],l=Math.max(l,p.left),h=Math.max(h,p.right),u=Math.max(u,p.top),s=Math.max(s,p.bottom);for(e=o=0,n=(a=this.scrollers).length;n>o;e=++o)c=a[e],p=t[e],c.canvas.setGutters("horizontal"===this.axis?{left:l-p.left,right:h-p.right}:{top:u-p.top,bottom:s-p.bottom})},t}(),V=function(){function e(t,e){this.isTouch=e,this.scroller=t,this.sprites=[],this.isTouch&&(this.isForcedRelative=!0),t.on(this.isTouch?"scrollEnd":"scroll",function(t){return function(){return t.handleScroll()}}(this))}return e.prototype.scroller=null,e.prototype.scrollbarWidths=null,e.prototype.sprites=null,e.prototype.viewportRect=null,e.prototype.contentOffset=null,e.prototype.isHFollowing=!0,e.prototype.isVFollowing=!1,e.prototype.containOnNaturalLeft=!1,e.prototype.containOnNaturalRight=!1,e.prototype.minTravel=0,e.prototype.isTouch=!1,e.prototype.isForcedRelative=!1,e.prototype.setSprites=function(e){var r,o,i;if(this.clearSprites(),e instanceof t)return this.sprites=function(){var r,o,n;for(n=[],r=0,o=e.length;o>r;r++)i=e[r],n.push(new P(t(i),this));return n}.call(this);for(r=0,o=e.length;o>r;r++)(i=e[r]).follower=this;return this.sprites=e},e.prototype.clearSprites=function(){var t,e,r;for(t=0,e=(r=this.sprites).length;e>t;t++)r[t].clear();return this.sprites=[]},e.prototype.handleScroll=function(){return this.updateViewport(),this.updatePositions()},e.prototype.cacheDimensions=function(){var t,e,r;for(this.updateViewport(),this.scrollbarWidths=this.scroller.getScrollbarWidths(),this.contentOffset=this.scroller.canvas.el.offset(),t=0,e=(r=this.sprites).length;e>t;t++)r[t].cacheDimensions()},e.prototype.updateViewport=function(){var t,e,r;return t=(e=this.scroller).getScrollFromLeft(),r=e.getScrollTop(),this.viewportRect={left:t,right:t+e.getClientWidth(),top:r,bottom:r+e.getClientHeight()}},e.prototype.forceRelative=function(){var t,e,r,o,i;if(!this.isForcedRelative){for(this.isForcedRelative=!0,o=[],t=0,e=(r=this.sprites).length;e>t;t++)(i=r[t]).doAbsolute?o.push(i.assignPosition()):o.push(void 0);return o}},e.prototype.clearForce=function(){var t,e,r,o,i;if(this.isForcedRelative&&!this.isTouch){for(this.isForcedRelative=!1,o=[],t=0,e=(r=this.sprites).length;e>t;t++)i=r[t],o.push(i.assignPosition());return o}},e.prototype.update=function(){return this.cacheDimensions(),this.updatePositions()},e.prototype.updatePositions=function(){var t,e,r;for(t=0,e=(r=this.sprites).length;e>t;t++)r[t].updatePosition()},e.prototype.getContentRect=function(t){return ut(t,this.contentOffset)},e.prototype.getBoundingRect=function(t){return at(t,this.contentOffset)},e}(),P=function(){function t(t,e){this.el=t,this.follower=null!=e?e:null,this.isBlock="block"===this.el.css("display"),this.el.css("position","relative")}return t.prototype.follower=null,t.prototype.el=null,t.prototype.absoluteEl=null,t.prototype.naturalRect=null,t.prototype.parentRect=null,t.prototype.containerRect=null,t.prototype.isEnabled=!0,t.prototype.isHFollowing=!1,t.prototype.isVFollowing=!1,t.prototype.doAbsolute=!1,t.prototype.isAbsolute=!1,t.prototype.isCentered=!1,t.prototype.rect=null,t.prototype.isBlock=!1,t.prototype.naturalWidth=null,t.prototype.disable=function(){return this.isEnabled?(this.isEnabled=!1,this.resetPosition(),this.unabsolutize()):void 0},t.prototype.enable=function(){return this.isEnabled?void 0:(this.isEnabled=!0,this.assignPosition())},t.prototype.clear=function(){return this.disable(),this.follower=null,this.absoluteEl=null},t.prototype.cacheDimensions=function(){var t,e,r,o,i,n,s,l;return o=!1,i=!1,r=!1,this.naturalWidth=this.el.width(),this.resetPosition(),e=this.follower,s=this.naturalRect=e.getBoundingRect(this.el),l=this.el.parent(),this.parentRect=e.getBoundingRect(l),t=this.containerRect=bt(e.getContentRect(l),s),n=e.minTravel,e.containOnNaturalLeft&&(t.left=s.left),e.containOnNaturalRight&&(t.right=s.right),e.isHFollowing&&dt(t)-dt(s)>=n&&(r="center"===this.el.css("text-align"),o=!0),e.isVFollowing&&pt(t)-pt(s)>=n&&(i=!0),this.isHFollowing=o,this.isVFollowing=i,this.isCentered=r},t.prototype.updatePosition=function(){return this.computePosition(),this.assignPosition()},t.prototype.resetPosition=function(){return this.el.css({top:"",left:""})},t.prototype.computePosition=function(){var t,e,r,o,i,n,s,l;return s=this.follower.viewportRect,r=this.parentRect,t=this.containerRect,o=null,e=!1,(l=wt(s,r))&&(o=et(this.naturalRect),n=wt(o,r),(this.isCentered&&!Mt(s,r)||n&&!Mt(s,n))&&(e=!0,this.isHFollowing&&(this.isCentered?(i=dt(o),o.left=(l.left+l.right)/2-i/2,o.right=o.left+i):gt(o,s)||(e=!1),gt(o,t)&&(e=!1)),this.isVFollowing&&(zt(o,s)||(e=!1),zt(o,t)&&(e=!1)),Mt(s,o)||(e=!1))),this.rect=o,this.doAbsolute=e},t.prototype.assignPosition=function(){var t,e;return this.isEnabled?this.rect?this.doAbsolute&&!this.follower.isForcedRelative?(this.absolutize(),this.absoluteEl.css({top:this.rect.top-this.follower.viewportRect.top+this.follower.scrollbarWidths.top,left:this.rect.left-this.follower.viewportRect.left+this.follower.scrollbarWidths.left,width:this.isBlock?this.naturalWidth:""})):(e=this.rect.top-this.naturalRect.top,t=this.rect.left-this.naturalRect.left,this.unabsolutize(),this.el.toggleClass("fc-following",Boolean(e||t)).css({top:e,left:t})):this.unabsolutize():void 0},t.prototype.absolutize=function(){return this.isAbsolute?void 0:(this.absoluteEl||(this.absoluteEl=this.buildAbsoluteEl()),this.absoluteEl.appendTo(this.follower.scroller.el),this.el.css("visibility","hidden"),this.isAbsolute=!0)},t.prototype.unabsolutize=function(){return this.isAbsolute?(this.absoluteEl.detach(),this.el.css("visibility",""),this.isAbsolute=!1):void 0},t.prototype.buildAbsoluteEl=function(){return this.el.clone().addClass("fc-following").css({position:"absolute","z-index":1e3,"font-weight":this.el.css("font-weight"),"font-size":this.el.css("font-size"),"font-family":this.el.css("font-family"),color:this.el.css("color"),"padding-top":this.el.css("padding-top"),"padding-bottom":this.el.css("padding-bottom"),"padding-left":this.el.css("padding-left"),"padding-right":this.el.css("padding-right"),"pointer-events":"none"})},t}(),et=function(t){return{left:t.left,right:t.right,top:t.top,bottom:t.bottom}},dt=function(t){return t.right-t.left},pt=function(t){return t.bottom-t.top},Mt=function(t,e){return Wt(t,e)&&Lt(t,e)},Wt=function(t,e){return e.left>=t.left&&e.right<=t.right},Lt=function(t,e){return e.top>=t.top&&e.bottom<=t.bottom},gt=function(t,e){return t.left<e.left?(t.right=e.left+dt(t),t.left=e.left,!0):t.right>e.right&&(t.left=e.right-dt(t),t.right=e.right,!0)},zt=function(t,e){return t.top<e.top?(t.bottom=e.top+pt(t),t.top=e.top,!0):t.bottom>e.bottom&&(t.top=e.bottom-pt(t),t.bottom=e.bottom,!0)},bt=function(t,e){return{left:Math.min(t.left,e.left),right:Math.max(t.right,e.right),top:Math.min(t.top,e.top),bottom:Math.max(t.bottom,e.bottom)}},i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,o),r.prototype.resourceManager=null,r.prototype.initialize=function(){return this.resourceManager=new D(this)},r.prototype.instantiateView=function(t){var e,r;return r=(e=this.getViewSpec(t)).class,this.options.resources&&!1!==e.options.resources&&(e.queryResourceClass?r=e.queryResourceClass(e)||r:e.resourceClass&&(r=e.resourceClass)),new r(this,t,e.options,e.duration)},r.prototype.getResources=function(){return Array.prototype.slice.call(this.resourceManager.topLevelResources)},r.prototype.addResource=function(t,e){var r;null==e&&(e=!1),r=this.resourceManager.addResource(t),e&&this.view.scrollToResource&&r.done(function(t){return function(e){return t.view.scrollToResource(e)}}(this))},r.prototype.removeResource=function(t){return this.resourceManager.removeResource(t)},r.prototype.refetchResources=function(){this.resourceManager.fetchResources()},r.prototype.rerenderResources=function(){this.resourceManager.resetResources()},r.prototype.getPeerEvents=function(t,e){var o,i,n,s,l,h,u,a,p,d,f,g,y;for(f=r.__super__.getPeerEvents.apply(this,arguments),p=t.resourceId?[t.resourceId]:e?this.getEventResourceIds(e):[],o=[],n=0,h=f.length;h>n;n++){if(d=f[n],i=!1,(y=this.getEventResourceIds(d)).length&&p.length){for(s=0,u=y.length;u>s;s++)for(g=y[s],l=0,a=p.length;a>l;l++)if(p[l]===g){i=!0;break}}else i=!0;i&&o.push(d)}return o},r.prototype.buildSelectSpan=function(t,e,o){var i;return i=r.__super__.buildSelectSpan.apply(this,arguments),o&&(i.resourceId=o),i},r.prototype.getResourceById=function(t){return this.resourceManager.getResourceById(t)},r.prototype.normalizeEvent=function(t){return r.__super__.normalizeEvent.apply(this,arguments),null==t.resourceId&&(t.resourceId=null),null!=t.resourceIds?t.resourceIds:t.resourceIds=null},r.prototype.getEventResourceId=function(t){return this.getEventResourceIds(t)[0]},r.prototype.getEventResourceIds=function(t){var e,r,o,i,n,s,l,h;if(h=String(null!=(n=null!=(s=t[this.getEventResourceField()])?s:t.resourceId)?n:""))return[h];if(t.resourceIds){for(i=[],e=0,r=(l=t.resourceIds).length;r>e;e++)h=l[e],(o=String(null!=h?h:""))&&i.push(o);return i}return[]},r.prototype.setEventResourceId=function(t,e){return t[this.getEventResourceField()]=String(null!=e?e:"")},r.prototype.getEventResourceField=function(){return this.options.eventResourceField||"resourceId"},r.prototype.getResourceEvents=function(e){var r;return(r="object"==typeof e?e:this.getResourceById(e))?this.clientEvents(function(e){return function(o){return-1!==t.inArray(r.id,e.getEventResourceIds(o))}}(this)):[]},r.prototype.getEventResource=function(t){return this.getEventResources(t)[0]},r.prototype.getEventResources=function(t){var e,r,o,i,n,s,l;if(l=[],e="object"==typeof t?t:this.clientEvents(t)[0])for(r=0,o=(i=this.getEventResourceIds(e)).length;o>r;r++)s=i[r],(n=this.getResourceById(s))&&l.push(n);return l},r}(),o.prototype=i.prototype,Tt=X.prototype.displayView,X.prototype.renderSkeleton,It=X.prototype.unrenderSkeleton,Et=X.prototype.displayEvents,X.prototype.isResourcesBound=!1,X.prototype.settingResources=null,X.prototype.displayView=function(){return Tt.apply(this,arguments),xt(this.calendar.options.schedulerLicenseKey,this.el),this.bindResources(),this.whenResources()},X.prototype.unrenderSkeleton=function(){return It.apply(this,arguments),this.unbindResources(!0)},X.prototype.displayEvents=function(t){return this.whenResources((e=this,function(){return Et.call(e,t)}));var e},X.prototype.bindResources=function(){var e;return this.isResourcesBound?void 0:(this.isResourcesBound=!0,this.settingResources=t.Deferred(),e=function(t){return function(e){return t.setResources(e),t.settingResources.resolve()}}(this),this.listenTo(this.calendar.resourceManager,{set:e,unset:this.unsetResources,reset:this.resetResources,add:this.addResource,remove:this.removeResource}),this.calendar.resourceManager.hasFetched()?e(this.calendar.resourceManager.topLevelResources):this.calendar.resourceManager.getResources())},X.prototype.unbindResources=function(t){return this.isResourcesBound?(this.stopListeningTo(this.calendar.resourceManager),"resolved"===this.settingResources.state()&&this.unsetResources(t),this.settingResources=null,this.isResourcesBound=!1):void 0},X.prototype.whenResources=function(e){return"resolved"===this.settingResources.state()?t.when(e?e():void 0):e?this.settingResources.then(e):this.settingResources.promise()},X.prototype.setResources=function(t){},X.prototype.unsetResources=function(){},X.prototype.resetResources=function(t){return this.calendar.rerenderEvents()},X.prototype.addResource=function(t){return this.resetResources(this.calendar.resourceManager.topLevelResources)},X.prototype.removeResource=function(t){return this.resetResources(this.calendar.resourceManager.topLevelResources)},Ht=f.prototype.getSegClasses,f.prototype.getSegClasses=function(t){var e,r,o,i,n;for(e=Ht.apply(this,arguments),r=0,o=(i=this.getSegResources(t)).length;o>r;r++)n=i[r],e=e.concat(n.eventClassName||[]);return e},f.prototype.getSegSkinCss=function(t){var e,r,o,i,n,s,l,h,u,a;return a=this.view,h=(e=t.event).source||{},r=e.color,u=h.color,s=a.opt("eventColor"),l=this.getSegResources(t),o=function(){var t,e,r,o;for(o=null,e=0,r=l.length;r>e;e++)for(t=l[e];t&&!o;)o=t.eventBackgroundColor||t.eventColor,t=t._parent;return o},i=function(){var t,e,r,o;for(o=null,e=0,r=l.length;r>e;e++)for(t=l[e];t&&!o;)o=t.eventBorderColor||t.eventColor,t=t._parent;return o},n=function(){var t,e,r,o;for(o=null,e=0,r=l.length;r>e;e++)for(t=l[e];t&&!o;)o=t.eventTextColor,t=t._parent;return o},{"background-color":e.backgroundColor||r||o()||h.backgroundColor||u||a.opt("eventBackgroundColor")||s,"border-color":e.borderColor||r||i()||h.borderColor||u||a.opt("eventBorderColor")||s,color:e.textColor||n()||h.textColor||a.opt("eventTextColor")}},f.prototype.getSegResources=function(t){return t.resource?[t.resource]:this.view.calendar.getEventResources(t.event)},D=function(e){function r(t){this.calendar=t,this.initializeCache()}return kt(r,n),r.mixin(a),r.resourceGuid=1,r.ajaxDefaults={dataType:"json",cache:!1},r.prototype.calendar=null,r.prototype.topLevelResources=null,r.prototype.resourcesById=null,r.prototype.fetching=null,r.prototype.hasFetched=function(){return this.fetching&&"resolved"===this.fetching.state()},r.prototype.getResources=function(){var e;return this.fetching?t.Deferred().resolve(this.topLevelResources).promise():(e=t.Deferred(),this.fetchResources().done(function(t){return e.resolve(t)}).fail(function(){return e.resolve([])}),e)},r.prototype.fetchResources=function(){var e;return e=this.fetching,t.when(e).then(function(t){return function(){return t.fetching=t.fetchResourceInputs().then(function(r){return t.setResources(r,Boolean(e)),t.topLevelResources})}}(this))},r.prototype.fetchResourceInputs=function(){var e,o,i;switch(e=t.Deferred(),i=this.calendar.options.resources,"string"===t.type(i)&&(i={url:i}),t.type(i)){case"function":i(function(t){return e.resolve(t)});break;case"object":o=t.ajax(t.extend({},r.ajaxDefaults,i));break;case"array":e.resolve(i);break;default:e.resolve([])}return o||(o=e.promise()),"pending"===!o.state()&&(this.calendar.pushLoading(),o.always(function(){return this.calendar.popLoading()})),o},r.prototype.resetResources=function(){return this.getResources().then((t=this,function(){return t.trigger("reset",t.topLevelResources)}));var t},r.prototype.getResourceById=function(t){return this.resourcesById[t]},r.prototype.initializeCache=function(){return this.topLevelResources=[],this.resourcesById={}},r.prototype.setResources=function(t,e){var r,o,i,n,s,l;for(this.initializeCache(),s=function(){var e,r,o;for(o=[],e=0,r=t.length;r>e;e++)n=t[e],o.push(this.buildResource(n));return o}.call(this),l=function(){var t,e,r;for(r=[],t=0,e=s.length;e>t;t++)i=s[t],this.addResourceToIndex(i)&&r.push(i);return r}.call(this),r=0,o=l.length;o>r;r++)i=l[r],this.addResourceToTree(i);return e?this.trigger("reset",this.topLevelResources):this.trigger("set",this.topLevelResources),this.calendar.trigger("resourcesSet",null,this.topLevelResources)},r.prototype.addResource=function(e){return t.when(this.fetching).then(function(t){return function(){var r;return r=t.buildResource(e),!!t.addResourceToIndex(r)&&(t.addResourceToTree(r),t.trigger("add",r),r)}}(this))},r.prototype.addResourceToIndex=function(t){var e,r,o,i;if(this.resourcesById[t.id])return!1;for(this.resourcesById[t.id]=t,r=0,o=(i=t.children).length;o>r;r++)e=i[r],this.addResourceToIndex(e);return!0},r.prototype.addResourceToTree=function(t){var e,r,o,i;if(!t.parent){if(r=String(null!=(o=t.parentId)?o:"")){if(!(e=this.resourcesById[r]))return!1;t.parent=e,i=e.children}else i=this.topLevelResources;i.push(t)}return!0},r.prototype.removeResource=function(e){var r;return r="object"==typeof e?e.id:e,t.when(this.fetching).then(function(t){return function(){var e;return(e=t.removeResourceFromIndex(r))&&(t.removeResourceFromTree(e),t.trigger("remove",e)),e}}(this))},r.prototype.removeResourceFromIndex=function(t){var e,r,o,i,n;if(n=this.resourcesById[t]){for(delete this.resourcesById[t],r=0,o=(i=n.children).length;o>r;r++)e=i[r],this.removeResourceFromIndex(e.id);return n}return!1},r.prototype.removeResourceFromTree=function(t,e){var r,o,i,n;for(null==e&&(e=this.topLevelResources),r=o=0,i=e.length;i>o;r=++o){if((n=e[r])===t)return t.parent=null,e.splice(r,1),!0;if(this.removeResourceFromTree(t,n.children))return!0}return!1},r.prototype.buildResource=function(e){var o,i,n,s,l;return(l=t.extend({},e)).id=String(null!=(s=e.id)?s:"_fc"+r.resourceGuid++),n=e.eventClassName,l.eventClassName=function(){switch(t.type(n)){case"string":return n.split(/\s+/);case"array":return n;default:return[]}}(),l.children=function(){var t,r,n,s,h;for(h=[],t=0,r=(s=null!=(n=e.children)?n:[]).length;r>t;t++)i=s[t],(o=this.buildResource(i)).parent=l,h.push(o);return h}.call(this),l},r}(),L={resourceTextFunc:null,unsetResources:function(){return this.clearEvents()},resetResources:function(t){var e;return e=this.queryScroll(),this.unsetResources(),this.setResources(t),this.setScroll(e),this.calendar.rerenderEvents()},getResourceText:function(t){return this.getResourceTextFunc()(t)},getResourceTextFunc:function(){var t;return this.resourceTextFunc?this.resourceTextFunc:("function"!=typeof(t=this.opt("resourceText"))&&(t=function(t){return t.title||t.id}),this.resourceTextFunc=t)},triggerDayClick:function(t,e,r){var o;return o=this.calendar.resourceManager,this.trigger("dayClick",e,this.calendar.applyTimezone(t.start),r,this,o.getResourceById(t.resourceId))},triggerSelect:function(t,e){var r;return r=this.calendar.resourceManager,this.trigger("select",null,this.calendar.applyTimezone(t.start),this.calendar.applyTimezone(t.end),e,this,r.getResourceById(t.resourceId))},triggerExternalDrop:function(t,e,r,o,i){return this.trigger("drop",r[0],e.start,o,i,e.resourceId),t?this.trigger("eventReceive",null,t):void 0},reportEventDrop:function(){var t,e,r,o;return e=arguments[0],t=arguments[1],r=3<=arguments.length?Pt.call(arguments,2):[],(t=this.normalizeDropLocation(t)).resourceId&&e.resourceIds&&(t.resourceIds=null),(o=X.prototype.reportEventDrop).call.apply(o,[this,e,t].concat(Pt.call(r)))},reportExternalDrop:function(){var t,e,r,o;return e=arguments[0],t=arguments[1],r=3<=arguments.length?Pt.call(arguments,2):[],t=this.normalizeDropLocation(t),(o=X.prototype.reportExternalDrop).call.apply(o,[this,e,t].concat(Pt.call(r)))},normalizeDropLocation:function(e){var r;return delete(r=t.extend({},e)).resourceId,this.calendar.setEventResourceId(r,e.resourceId),r}},I={allowCrossResource:!0,eventRangeToSpans:function(e,r){var o,i,n,s,l;if((s=this.view.calendar.getEventResourceIds(r)).length){for(l=[],o=0,i=s.length;i>o;o++)n=s[o],l.push(t.extend({},e,{resourceId:n}));return l}return d.isBgEvent(r)?f.prototype.eventRangeToSpans.apply(this,arguments):[]},fabricateHelperEvent:function(t,e){var r;return r=f.prototype.fabricateHelperEvent.apply(this,arguments),this.view.calendar.setEventResourceId(r,t.resourceId),r},computeEventDrop:function(t,e,r){var i;return!0,(i=f.prototype.computeEventDrop.apply(this,arguments))&&(i.resourceId=e.resourceId),i},computeExternalDrop:function(t,e){var r;return(r=f.prototype.computeExternalDrop.apply(this,arguments))&&(r.resourceId=t.resourceId),r},computeEventResize:function(t,e,r,o){var i;if(this.allowCrossResource||e.resourceId===r.resourceId)return(i=f.prototype.computeEventResize.apply(this,arguments))&&(i.resourceId=e.resourceId),i},computeSelectionSpan:function(t,e){var r;if(this.allowCrossResource||t.resourceId===e.resourceId)return(r=f.prototype.computeSelectionSpan.apply(this,arguments))&&(r.resourceId=t.resourceId),r}},_={flattenedResources:null,resourceCnt:0,datesAboveResources:!1,allowCrossResource:!1,setResources:function(t){return this.flattenedResources=this.flattenResources(t),this.resourceCnt=this.flattenedResources.length,this.updateDayTableCols()},unsetResources:function(){return this.flattenedResources=null,this.resourceCnt=0,this.updateDayTableCols()},flattenResources:function(t){var e,r,o,i;return(r=this.view.opt("resourceOrder"))?(e=Dt(r),i=function(t,r){return Q(t,r,e)}):i=null,o=[],this.accumulateResources(t,i,o),o},accumulateResources:function(t,e,r){var o,i,n,s,l;for(e?(l=t.slice(0)).sort(e):l=t,s=[],o=0,i=l.length;i>o;o++)n=l[o],r.push(n),s.push(this.accumulateResources(n.children,e,r));return s},updateDayTableCols:function(){return this.datesAboveResources=this.view.opt("groupByDateAndResource"),d.DayTableMixin.updateDayTableCols.call(this)},computeColCnt:function(){return(this.resourceCnt||1)*this.daysPerRow},getColDayIndex:function(t){return this.isRTL&&(t=this.colCnt-1-t),this.datesAboveResources?Math.floor(t/(this.resourceCnt||1)):t%this.daysPerRow},getColResource:function(t){return this.flattenedResources[this.getColResourceIndex(t)]},getColResourceIndex:function(t){return this.isRTL&&(t=this.colCnt-1-t),this.datesAboveResources?t%(this.resourceCnt||1):Math.floor(t/this.daysPerRow)},indicesToCol:function(t,e){var r;return r=this.datesAboveResources?e*(this.resourceCnt||1)+t:t*this.daysPerRow+e,this.isRTL&&(r=this.colCnt-1-r),r},renderHeadTrHtml:function(){return this.resourceCnt?this.daysPerRow>1?this.datesAboveResources?this.renderHeadDateAndResourceHtml():this.renderHeadResourceAndDateHtml():this.renderHeadResourceHtml():d.DayTableMixin.renderHeadTrHtml.call(this)},renderHeadResourceHtml:function(){var t,e,r,o,i;for(i=[],t=0,e=(r=this.flattenedResources).length;e>t;t++)o=r[t],i.push(this.renderHeadResourceCellHtml(o));return this.wrapTr(i,"renderHeadIntroHtml")},renderHeadResourceAndDateHtml:function(){var t,e,r,o,i,n,s,l,h,u;for(u=[],e=[],o=0,n=(s=this.flattenedResources).length;n>o;o++)for(h=s[o],u.push(this.renderHeadResourceCellHtml(h,null,this.daysPerRow)),r=i=0,l=this.daysPerRow;l>i;r=i+=1)t=this.dayDates[r].clone(),e.push(this.renderHeadResourceDateCellHtml(t,h));return this.wrapTr(u,"renderHeadIntroHtml")+this.wrapTr(e,"renderHeadIntroHtml")},renderHeadDateAndResourceHtml:function(){var t,e,r,o,i,n,s,l,h,u;for(e=[],u=[],r=o=0,s=this.daysPerRow;s>o;r=o+=1)for(t=this.dayDates[r].clone(),e.push(this.renderHeadDateCellHtml(t,this.resourceCnt)),i=0,n=(l=this.flattenedResources).length;n>i;i++)h=l[i],u.push(this.renderHeadResourceCellHtml(h,t));return this.wrapTr(e,"renderHeadIntroHtml")+this.wrapTr(u,"renderHeadIntroHtml")},renderHeadResourceCellHtml:function(t,e,r){return'<th class="fc-resource-cell" data-resource-id="'+t.id+'"'+(e?' data-date="'+e.format("YYYY-MM-DD")+'"':"")+(r>1?' colspan="'+r+'"':"")+">"+yt(this.view.getResourceText(t))+"</th>"},renderHeadResourceDateCellHtml:function(t,e,r){return this.renderHeadDateCellHtml(t,r,'data-resource-id="'+e.id+'"')},processHeadResourceEls:function(e){return e.find(".fc-resource-cell").each(function(e){return function(r,o){var i;return i=e.datesAboveResources?e.getColResource(r):e.flattenedResources[e.isRTL?e.flattenedResources.length-1-r:r],e.view.trigger("resourceRender",i,i,t(o),t())}}(this))},renderBgCellsHtml:function(t){var e,r,o,i,n,s;if(this.resourceCnt){for(o=[],e=i=0,n=this.colCnt;n>i;e=i+=1)r=this.getCellDate(t,e),s=this.getColResource(e),o.push(this.renderResourceBgCellHtml(r,s));return o.join("")}return d.DayTableMixin.renderBgCellsHtml.call(this,t)},renderResourceBgCellHtml:function(t,e){return this.renderBgCellHtml(t,'data-resource-id="'+e.id+'"')},wrapTr:function(t,e){return this.isRTL?(t.reverse(),"<tr>"+t.join("")+this[e]()+"</tr>"):"<tr>"+this[e]()+t.join("")+"</tr>"}},H=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,e),r.mixin(I),r.mixin(_),r.prototype.getHitSpan=function(t){var e;return e=r.__super__.getHitSpan.apply(this,arguments),this.resourceCnt&&(e.resourceId=this.getColResource(t.col).id),e},r.prototype.spanToSegs=function(e){var r,o,i,n,s,l,h,u,a,c,p,d,f;if(a=this.resourceCnt,o=this.datesAboveResources?this.sliceRangeByDay(e):this.sliceRangeByRow(e),a){for(d=[],n=0,h=o.length;h>n;n++)for(f=o[n],c=s=0,u=a;u>s;c=s+=1)p=this.flattenedResources[c],e.resourceId&&e.resourceId!==p.id||((r=t.extend({},f)).resource=p,this.isRTL?(r.leftCol=this.indicesToCol(c,f.lastRowDayIndex),r.rightCol=this.indicesToCol(c,f.firstRowDayIndex)):(r.leftCol=this.indicesToCol(c,f.firstRowDayIndex),r.rightCol=this.indicesToCol(c,f.lastRowDayIndex)),d.push(r));return d}for(i=0,l=o.length;l>i;i++)f=o[i],this.isRTL?(f.leftCol=f.lastRowDayIndex,f.rightCol=f.firstRowDayIndex):(f.leftCol=f.firstRowDayIndex,f.rightCol=f.lastRowDayIndex);return o},r}(d.DayGrid),G=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,e),r.mixin(I),r.mixin(_),r.prototype.getHitSpan=function(t){var e;return e=r.__super__.getHitSpan.apply(this,arguments),this.resourceCnt&&(e.resourceId=this.getColResource(t.col).id),e},r.prototype.spanToSegs=function(e){var r,o,i,n,s,l,h,u,a,c,p,d,f;if(a=this.resourceCnt,o=this.sliceRangeByTimes(e),a){for(d=[],n=0,h=o.length;h>n;n++)for(f=o[n],c=s=0,u=a;u>s;c=s+=1)p=this.flattenedResources[c],e.resourceId&&e.resourceId!==p.id||((r=t.extend({},f)).resource=p,r.col=this.indicesToCol(c,f.dayIndex),d.push(r));return d}for(i=0,l=o.length;l>i;i++)(f=o[i]).col=f.dayIndex;return o},r}(d.TimeGrid),j=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return kt(e,X),e.prototype.timeGrid=null,e.prototype.isScrolled=!1,e.prototype.initialize=function(){return this.timeGrid=this.instantiateGrid(),this.intervalDuration=this.timeGrid.duration},e.prototype.instantiateGrid=function(){return new N(this)},e.prototype.setRange=function(t){return e.__super__.setRange.apply(this,arguments),this.timeGrid.setRange(t)},e.prototype.renderSkeleton=function(){return this.el.addClass("fc-timeline"),!1===this.opt("eventOverlap")&&this.el.addClass("fc-no-overlap"),this.el.html(this.renderSkeletonHtml()),this.renderTimeGridSkeleton()},e.prototype.renderSkeletonHtml=function(){return'<table> <thead class="fc-head"> <tr> <td class="fc-time-area '+this.widgetHeaderClass+'"></td> </tr> </thead> <tbody class="fc-body"> <tr> <td class="fc-time-area '+this.widgetContentClass+'"></td> </tr> </tbody> </table>'},e.prototype.renderTimeGridSkeleton=function(){return this.timeGrid.setElement(this.el.find("tbody .fc-time-area")),this.timeGrid.headEl=this.el.find("thead .fc-time-area"),this.timeGrid.renderSkeleton(),this.isScrolled=!1,this.timeGrid.bodyScroller.on("scroll",Ft(this,"handleBodyScroll"))},e.prototype.handleBodyScroll=function(t,e){if(t){if(!this.isScrolled)return this.isScrolled=!0,this.el.addClass("fc-scrolled")}else if(this.isScrolled)return this.isScrolled=!1,this.el.removeClass("fc-scrolled")},e.prototype.unrenderSkeleton=function(){return this.timeGrid.removeElement(),this.handleBodyScroll(0),e.__super__.unrenderSkeleton.apply(this,arguments)},e.prototype.renderDates=function(){return this.timeGrid.renderDates()},e.prototype.unrenderDates=function(){return this.timeGrid.unrenderDates()},e.prototype.renderBusinessHours=function(){return this.timeGrid.renderBusinessHours()},e.prototype.unrenderBusinessHours=function(){return this.timeGrid.unrenderBusinessHours()},e.prototype.getNowIndicatorUnit=function(){return this.timeGrid.getNowIndicatorUnit()},e.prototype.renderNowIndicator=function(t){return this.timeGrid.renderNowIndicator(t)},e.prototype.unrenderNowIndicator=function(){return this.timeGrid.unrenderNowIndicator()},e.prototype.prepareHits=function(){return this.timeGrid.prepareHits()},e.prototype.releaseHits=function(){return this.timeGrid.releaseHits()},e.prototype.queryHit=function(t,e){return this.timeGrid.queryHit(t,e)},e.prototype.getHitSpan=function(t){return this.timeGrid.getHitSpan(t)},e.prototype.getHitEl=function(t){return this.timeGrid.getHitEl(t)},e.prototype.updateWidth=function(){return this.timeGrid.updateWidth()},e.prototype.setHeight=function(t,e){var r;return r=e?"auto":t-this.timeGrid.headHeight()-this.queryMiscHeight(),this.timeGrid.bodyScroller.setHeight(r)},e.prototype.queryMiscHeight=function(){return this.el.outerHeight()-this.timeGrid.headScroller.el.outerHeight()-this.timeGrid.bodyScroller.el.outerHeight()},e.prototype.computeInitialScroll=function(t){return this.timeGrid.computeInitialScroll(t)},e.prototype.queryScroll=function(){return this.timeGrid.queryScroll()},e.prototype.setScroll=function(t){return this.timeGrid.setScroll(t)},e.prototype.renderEvents=function(t){return this.timeGrid.renderEvents(t),this.updateWidth()},e.prototype.unrenderEvents=function(){return this.timeGrid.unrenderEvents(),this.updateWidth()},e.prototype.renderDrag=function(t,e){return this.timeGrid.renderDrag(t,e)},e.prototype.unrenderDrag=function(){return this.timeGrid.unrenderDrag()},e.prototype.getEventSegs=function(){return this.timeGrid.getEventSegs()},e.prototype.renderSelection=function(t){return this.timeGrid.renderSelection(t)},e.prototype.unrenderSelection=function(){return this.timeGrid.unrenderSelection()},e}(),rt=d.cssToStr,N=function(r){function o(){var t;o.__super__.constructor.apply(this,arguments),this.initScaleProps(),this.minTime=e.duration(this.opt("minTime")||"00:00"),this.maxTime=e.duration(this.opt("maxTime")||"24:00"),this.timeWindowMs=this.maxTime-this.minTime,this.snapDuration=(t=this.opt("snapDuration"))?e.duration(t):this.slotDuration,this.minResizeDuration=this.snapDuration,this.snapsPerSlot=nt(this.slotDuration,this.snapDuration),this.slotWidth=this.opt("slotWidth")}return kt(o,f),o.prototype.slotDates=null,o.prototype.slotCnt=null,o.prototype.snapCnt=null,o.prototype.snapsPerSlot=null,o.prototype.snapDiffToIndex=null,o.prototype.snapIndexToDiff=null,o.prototype.headEl=null,o.prototype.slatContainerEl=null,o.prototype.slatEls=null,o.prototype.containerCoordCache=null,o.prototype.slatCoordCache=null,o.prototype.slatInnerCoordCache=null,o.prototype.headScroller=null,o.prototype.bodyScroller=null,o.prototype.joiner=null,o.prototype.follower=null,o.prototype.eventTitleFollower=null,o.prototype.minTime=null,o.prototype.maxTime=null,o.prototype.timeWindowMs=null,o.prototype.slotDuration=null,o.prototype.snapDuration=null,o.prototype.duration=null,o.prototype.labelInterval=null,o.prototype.headerFormats=null,o.prototype.isTimeScale=null,o.prototype.largeUnit=null,o.prototype.emphasizeWeeks=!1,o.prototype.titleFollower=null,o.prototype.segContainerEl=null,o.prototype.segContainerHeight=null,o.prototype.bgSegContainerEl=null,o.prototype.helperEls=null,o.prototype.innerEl=null,o.prototype.opt=function(t){return this.view.opt(t)},o.prototype.isValidDate=function(t){return!this.view.isHiddenDay(t)&&(!this.isTimeScale||((t.time()-this.minTime)%864e5+864e5)%864e5<this.timeWindowMs)},o.prototype.computeDisplayEventTime=function(){return!this.isTimeScale},o.prototype.computeDisplayEventEnd=function(){return!1},o.prototype.computeEventTimeFormat=function(){return this.opt("extraSmallTimeFormat")},o.prototype.normalizeGridDate=function(t){var e;return this.isTimeScale?(e=t.clone()).hasTime()||e.time(0):(e=t.clone().stripTime(),this.largeUnit&&e.startOf(this.largeUnit)),e},o.prototype.normalizeGridRange=function(t){var e,r;return this.isTimeScale?r={start:this.normalizeGridDate(t.start),end:this.normalizeGridDate(t.end)}:(r=this.view.computeDayRange(t),this.largeUnit&&(r.start.startOf(this.largeUnit),(e=r.end.clone().startOf(this.largeUnit)).isSame(r.end)&&e.isAfter(r.start)||e.add(this.slotDuration),r.end=e)),r},o.prototype.rangeUpdated=function(){var t,e;for(this.start=this.normalizeGridDate(this.start),this.end=this.normalizeGridDate(this.end),this.isTimeScale&&(this.start.add(this.minTime),this.end.subtract(1,"day").add(this.maxTime)),e=[],t=this.start.clone();t<this.end;)this.isValidDate(t)&&e.push(t.clone()),t.add(this.slotDuration);return this.slotDates=e,this.updateGridDates()},o.prototype.updateGridDates=function(){var t,e,r,o,i;for(o=-1,e=0,r=[],i=[],t=this.start.clone();t<this.end;)this.isValidDate(t)?(o++,r.push(o),i.push(e)):r.push(o+.5),t.add(this.snapDuration),e++;return this.snapDiffToIndex=r,this.snapIndexToDiff=i,this.snapCnt=o+1,this.slotCnt=this.snapCnt/this.snapsPerSlot},o.prototype.spanToSegs=function(t){var e,r;return e=this.normalizeGridRange(t),this.computeDateSnapCoverage(t.start)<this.computeDateSnapCoverage(t.end)&&(r=vt(e,this))?(r.isStart&&!this.isValidDate(r.start)&&(r.isStart=!1),r.isEnd&&r.end&&!this.isValidDate(r.end.clone().subtract(1))&&(r.isEnd=!1),[r]):[]},o.prototype.prepareHits=function(){return this.buildCoords()},o.prototype.queryHit=function(t,e){var r,o,i,n,s,l,h,u,a,c,p,d;return d=this.snapsPerSlot,n=this.slatCoordCache,null!=(r=this.containerCoordCache).getVerticalIndex(e)&&null!=(s=n.getHorizontalIndex(t))?(u=n.getWidth(s),this.isRTL?(i=((h=n.getRightOffset(s))-t)/u,a=s*d+(o=Math.floor(i*d)),c=(p=h-o/d*u)-(o+1)/d*u):(i=(t-(l=n.getLeftOffset(s)))/u,a=s*d+(o=Math.floor(i*d)),c=l+o/d*u,p=l+(o+1)/d*u),{snap:a,component:this,left:c,right:p,top:r.getTopOffset(0),bottom:r.getBottomOffset(0)}):void 0},o.prototype.getHitSpan=function(t){return this.getSnapRange(t.snap)},o.prototype.getHitEl=function(t){return this.getSnapEl(t.snap)},o.prototype.getSnapRange=function(t){var r;return(r=this.start.clone()).add(Ct(this.snapDuration,this.snapIndexToDiff[t])),{start:r,end:r.clone().add(this.snapDuration)}},o.prototype.getSnapEl=function(t){return this.slatEls.eq(Math.floor(t/this.snapsPerSlot))},o.prototype.renderSkeleton=function(){return this.headScroller=new s({overflowX:"clipped-scroll",overflowY:"hidden"}),this.headScroller.canvas=new O,this.headScroller.render(),this.headEl.append(this.headScroller.el),this.bodyScroller=new s,this.bodyScroller.canvas=new O,this.bodyScroller.render(),this.el.append(this.bodyScroller.el),this.innerEl=this.bodyScroller.canvas.contentEl,this.slatContainerEl=t('<div class="fc-slats"/>').appendTo(this.bodyScroller.canvas.bgEl),this.segContainerEl=t('<div class="fc-event-container"/>').appendTo(this.bodyScroller.canvas.contentEl),this.bgSegContainerEl=this.bodyScroller.canvas.bgEl,this.containerCoordCache=new l({els:this.bodyScroller.canvas.el,isHorizontal:!0,isVertical:!0}),this.joiner=new A("horizontal",[this.headScroller,this.bodyScroller]),this.follower=new V(this.headScroller,this.view.calendar.isTouch),this.eventTitleFollower=new V(this.bodyScroller,this.view.calendar.isTouch),this.eventTitleFollower.minTravel=50,this.isRTL?this.eventTitleFollower.containOnNaturalRight=!0:this.eventTitleFollower.containOnNaturalLeft=!0,o.__super__.renderSkeleton.apply(this,arguments)},o.prototype.headColEls=null,o.prototype.slatColEls=null,o.prototype.renderDates=function(){var t,e,r,o,i;for(this.headScroller.canvas.contentEl.html(this.renderHeadHtml()),this.headColEls=this.headScroller.canvas.contentEl.find("col"),this.slatContainerEl.html(this.renderSlatHtml()),this.slatColEls=this.slatContainerEl.find("col"),this.slatEls=this.slatContainerEl.find("td"),this.slatCoordCache=new l({els:this.slatEls,isHorizontal:!0}),this.slatInnerCoordCache=new l({els:this.slatEls.find("> div"),isHorizontal:!0,offsetParent:this.bodyScroller.canvas.el}),e=r=0,o=(i=this.slotDates).length;o>r;e=++r)t=i[e],this.view.trigger("dayRender",null,t,this.slatEls.eq(e));return this.follower?this.follower.setSprites(this.headEl.find("tr:not(:last-child) span")):void 0},o.prototype.unrenderDates=function(){return this.follower&&this.follower.clearSprites(),this.headScroller.canvas.contentEl.empty(),this.slatContainerEl.empty(),this.headScroller.canvas.clearWidth(),this.bodyScroller.canvas.clearWidth()},o.prototype.renderHeadHtml=function(){var t,e,r,o,i,n,s,l,h,u,c,p,d,f,g,y,v,w,m,R,S,b,C,E,T,H,_,I,D,x,F,G,M,W,L,B;for(g=this.labelInterval,n=this.headerFormats,e=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push([]);return r}(),y=null,I=null,M=[],p=0,v=(W=this.slotDates).length;v>p;p++){for(B=(r=W[p]).week(),c=this.emphasizeWeeks&&null!==I&&I!==B,x=d=0,w=n.length;w>d;x=++d)i=n[x],y=(F=e[x])[F.length-1],H=null,n.length>1&&x<n.length-1?(L=r.format(i),o=r.format(),y&&y.text===L?y.colspan+=1:H={text:L,dateData:o,colspan:1}):!y||Rt(st(this.start,r,g))?H={text:L=r.format(i),dateData:o=r.format(),colspan:1}:y.colspan+=1,H&&(H.weekStart=c,F.push(H));M.push({weekStart:c}),I=B}for(h=g>this.slotDuration,s="<table>",s+="<colgroup>",f=0,m=W.length;m>f;f++)r=W[f],s+="<col/>";for(s+="</colgroup>",s+="<tbody>",l=E=0,R=e.length;R>E;l=++E){for(F=e[l],u=l===e.length-1,s+="<tr"+(h&&u?' class="fc-chrono"':"")+">",T=0,S=F.length;S>T;T++)t=F[T],s+='<th class="'+this.view.widgetHeaderClass+" "+(t.weekStart?"fc-em-cell":"")+'" data-date="'+t.dateData+'"'+(t.colspan>1?' colspan="'+t.colspan+'"':"")+'><div class="fc-cell-content"><span class="fc-cell-text">'+yt(t.text)+"</span></div></th>";s+="</tr>"}for(s+="</tbody></table>",G="<table>",G+="<colgroup>",_=0,b=M.length;b>_;_++)t=M[_],G+="<col/>";for(G+="</colgroup>",G+="<tbody><tr>",l=D=0,C=M.length;C>D;l=++D)t=M[l],r=W[l],G+=this.slatCellHtml(r,t.weekStart);return G+="</tr></tbody></table>",this._slatHtml=G,s},o.prototype.renderSlatHtml=function(){return this._slatHtml},o.prototype.slatCellHtml=function(t,e){var r;return this.isTimeScale?(r=[]).push(Rt(st(this.start,t,this.labelInterval))?"fc-major":"fc-minor"):(r=this.getDayClasses(t)).push("fc-day"),r.unshift(this.view.widgetContentClass),e&&r.push("fc-em-cell"),'<td class="'+r.join(" ")+'" data-date="'+t.format()+'"><div /></td>'},o.prototype.businessHourSegs=null,o.prototype.renderBusinessHours=function(){var t,e;return this.largeUnit?void 0:(t=this.view.calendar.getBusinessHoursEvents(!this.isTimeScale),e=this.businessHourSegs=this.eventsToSegs(t),this.renderFill("businessHours",e,"bgevent"))},o.prototype.unrenderBusinessHours=function(){return this.unrenderFill("businessHours")},o.prototype.nowIndicatorEls=null,o.prototype.getNowIndicatorUnit=function(){return this.isTimeScale?J(this.slotDuration):void 0},o.prototype.renderNowIndicator=function(e){var r,o,i;return i=[],(e=this.normalizeGridDate(e))>=this.start&&e<this.end&&(r=this.dateToCoord(e),o=this.isRTL?{right:-r}:{left:r},i.push(t("<div class='fc-now-indicator fc-now-indicator-arrow'></div>").css(o).appendTo(this.headScroller.canvas.el)[0]),i.push(t("<div class='fc-now-indicator fc-now-indicator-line'></div>").css(o).appendTo(this.bodyScroller.canvas.el)[0])),this.nowIndicatorEls=t(i)},o.prototype.unrenderNowIndicator=function(){return this.nowIndicatorEls?(this.nowIndicatorEls.remove(),this.nowIndicatorEls=null):void 0},o.prototype.explicitSlotWidth=null,o.prototype.defaultSlotWidth=null,o.prototype.updateWidth=function(){var t,e,r,o,i;return r=(i=Math.round(this.slotWidth||(this.slotWidth=this.computeSlotWidth())))*this.slotDates.length,e="",o=i,(t=this.bodyScroller.getClientWidth())>r&&(e=t,r="",o=Math.floor(t/this.slotDates.length)),this.headScroller.canvas.setWidth(r),this.headScroller.canvas.setMinWidth(e),this.bodyScroller.canvas.setWidth(r),this.bodyScroller.canvas.setMinWidth(e),this.headColEls.slice(0,-1).add(this.slatColEls.slice(0,-1)).width(o),this.headScroller.updateSize(),this.bodyScroller.updateSize(),this.joiner.update(),this.buildCoords(),this.updateSegPositions(),this.view.updateNowIndicator(),this.follower&&this.follower.update(),this.eventTitleFollower?this.eventTitleFollower.update():void 0},o.prototype.computeSlotWidth=function(){var e,o,i,n,s;return o=0,this.headEl.find("tr:last-child th span").each(function(e,r){var i;return i=t(r).outerWidth(),o=Math.max(o,i)}),e=o+1,s=nt(this.labelInterval,this.slotDuration),n=Math.ceil(e/s),(i=this.headColEls.eq(0).css("min-width"))&&((i=parseInt(i,10))&&(n=Math.max(n,i))),n},o.prototype.buildCoords=function(){return this.containerCoordCache.build(),this.slatCoordCache.build(),this.slatInnerCoordCache.build()},o.prototype.computeDateSnapCoverage=function(t){var e,r,o;return 0>(r=st(this.start,t,this.snapDuration))?0:r>=this.snapDiffToIndex.length?this.snapCnt:(o=Math.floor(r),e=this.snapDiffToIndex[o],Rt(e)?e+=r-o:e=Math.ceil(e),e)},o.prototype.dateToCoord=function(t){var e,r,o,i;return o=this.computeDateSnapCoverage(t)/this.snapsPerSlot,i=Math.floor(o),r=o-(i=Math.min(i,this.slotCnt-1)),e=this.slatInnerCoordCache,this.isRTL?e.getRightPosition(i)-e.getWidth(i)*r-this.containerCoordCache.getWidth(0):e.getLeftPosition(i)+e.getWidth(i)*r},o.prototype.rangeToCoords=function(t){return this.isRTL?{right:this.dateToCoord(t.start),left:this.dateToCoord(t.end)}:{left:this.dateToCoord(t.start),right:this.dateToCoord(t.end)}},o.prototype.headHeight=function(){var t;return(t=this.headScroller.canvas.contentEl.find("table")).height.apply(t,arguments)},o.prototype.updateSegPositions=function(){var t,e,r,o,i;for(e=0,r=(i=(this.segs||[]).concat(this.businessHourSegs||[])).length;r>e;e++)o=i[e],t=this.rangeToCoords(o),o.el.css({left:o.left=t.left,right:-(o.right=t.right)})},o.prototype.computeInitialScroll=function(t){var r,o;return r=0,this.isTimeScale&&((o=this.opt("scrollTime"))&&(o=e.duration(o),r=this.dateToCoord(this.start.clone().time(o)))),{left:r,top:0}},o.prototype.queryScroll=function(){return{left:this.bodyScroller.getScrollLeft(),top:this.bodyScroller.getScrollTop()}},o.prototype.setScroll=function(t){return this.headScroller.setScrollLeft(t.left),this.headScroller.setScrollLeft(t.left),this.bodyScroller.setScrollTop(t.top)},o.prototype.renderFgSegs=function(t){return t=this.renderFgSegEls(t),this.renderFgSegsInContainers([[this,t]]),this.updateSegFollowers(t),t},o.prototype.unrenderFgSegs=function(){return this.clearSegFollowers(),this.unrenderFgContainers([this])},o.prototype.renderFgSegsInContainers=function(t){var e,r,o,i,n,s,l,h,u,a,c,p,d,f,g,y,v,w,m,R,S,b,C,E,T;for(o=0,s=t.length;s>o;o++)for(e=(m=t[o])[0],i=0,l=(T=m[1]).length;l>i;i++)E=T[i],r=this.rangeToCoords(E),E.el.css({left:E.left=r.left,right:-(E.right=r.right)});for(n=0,h=t.length;h>n;n++)for(e=(R=t[n])[0],f=0,u=(T=R[1]).length;u>f;f++)(E=T[f]).el.appendTo(e.segContainerEl);for(g=0,a=t.length;a>g;g++){for(e=(S=t[g])[0],y=0,c=(T=S[1]).length;c>y;y++)(E=T[y]).height=E.el.outerHeight(!0);this.buildSegLevels(T),e.segContainerHeight=tt(T)}for(C=[],v=0,p=t.length;p>v;v++){for(e=(b=t[v])[0],w=0,d=(T=b[1]).length;d>w;w++)(E=T[w]).el.css("top",E.top);C.push(e.segContainerEl.height(e.segContainerHeight))}return C},o.prototype.buildSegLevels=function(t){var e,r,o,i,n,s,l,h,u,a,c,p,d,f;for(d=[],this.sortEventSegs(t),o=0,s=t.length;s>o;o++){for((f=t[o]).above=[],u=0;u<d.length;){for(r=!1,i=0,l=(c=d[u]).length;l>i;i++)a=c[i],Bt(f,a)&&(f.above.push(a),r=!0);if(!r)break;u+=1}for((d[u]||(d[u]=[])).push(f),u+=1;u<d.length;){for(n=0,h=(p=d[u]).length;h>n;n++)e=p[n],Bt(f,e)&&e.above.push(f);u+=1}}return d},o.prototype.unrenderFgContainers=function(t){var e,r,o,i;for(i=[],r=0,o=t.length;o>r;r++)(e=t[r]).segContainerEl.empty(),e.segContainerEl.height(""),i.push(e.segContainerHeight=null);return i},o.prototype.fgSegHtml=function(t,e){var r,o,i,n,s,l;return o=t.event,i=this.view.isEventDraggable(o),s=t.isStart&&this.view.isEventResizableFromStart(o),n=t.isEnd&&this.view.isEventResizableFromEnd(o),(r=this.getSegClasses(t,i,s||n)).unshift("fc-timeline-event","fc-h-event"),l=this.getEventTimeText(o),'<a class="'+r.join(" ")+'" style="'+rt(this.getSegSkinCss(t))+'"'+(o.url?' href="'+yt(o.url)+'"':"")+'><div class="fc-content">'+(l?'<span class="fc-time">'+yt(l)+"</span>":"")+'<span class="fc-title">'+(o.title?yt(o.title):"&nbsp;")+'</span></div><div class="fc-bg" />'+(s?'<div class="fc-resizer fc-start-resizer"></div>':"")+(n?'<div class="fc-resizer fc-end-resizer"></div>':"")+"</a>"},o.prototype.updateSegFollowers=function(t){var e,r,i,n;if(this.eventTitleFollower){for(i=[],e=0,r=t.length;r>e;e++)(n=t[e].el.find(".fc-title")).length&&i.push(new P(n));return this.eventTitleFollower.setSprites(i)}},o.prototype.clearSegFollowers=function(){return this.eventTitleFollower?this.eventTitleFollower.clearSprites():void 0},o.prototype.segDragStart=function(){return o.__super__.segDragStart.apply(this,arguments),this.eventTitleFollower?this.eventTitleFollower.forceRelative():void 0},o.prototype.segDragEnd=function(){return o.__super__.segDragEnd.apply(this,arguments),this.eventTitleFollower?this.eventTitleFollower.clearForce():void 0},o.prototype.segResizeStart=function(){return o.__super__.segResizeStart.apply(this,arguments),this.eventTitleFollower?this.eventTitleFollower.forceRelative():void 0},o.prototype.segResizeEnd=function(){return o.__super__.segResizeEnd.apply(this,arguments),this.eventTitleFollower?this.eventTitleFollower.clearForce():void 0},o.prototype.renderHelper=function(t,e){var r;return r=this.eventToSegs(t),r=this.renderFgSegEls(r),this.renderHelperSegsInContainers([[this,r]],e)},o.prototype.renderHelperSegsInContainers=function(e,r){var o,i,n,s,l,h,u,a,c,p,d,f,g,y,v,w,m,R;for(s=[],m=[],l=0,a=e.length;a>l;l++)for(o=(g=e[l])[0],h=0,c=(R=g[1]).length;c>h;h++)w=R[h],i=this.rangeToCoords(w),w.el.css({left:w.left=i.left,right:-(w.right=i.right)}),r&&r.resourceId===(null!=(y=o.resource)?y.id:void 0)?w.el.css("top",r.el.css("top")):w.el.css("top",0);for(u=0,p=e.length;p>u;u++)for(o=(v=e[u])[0],R=v[1],n=t('<div class="fc-event-container fc-helper-container"/>').appendTo(o.innerEl),s.push(n[0]),f=0,d=R.length;d>f;f++)w=R[f],n.append(w.el),m.push(w.el[0]);return this.helperEls?this.helperEls=this.helperEls.add(t(s)):this.helperEls=t(s),t(m)},o.prototype.unrenderHelper=function(){return this.helperEls?(this.helperEls.remove(),this.helperEls=null):void 0},o.prototype.renderEventResize=function(t,e){return this.renderHighlight(this.eventToSpan(t)),this.renderEventLocationHelper(t,e)},o.prototype.unrenderEventResize=function(){return this.unrenderHighlight(),this.unrenderHelper()},o.prototype.renderFill=function(t,e,r){return e=this.renderFillSegEls(t,e),this.renderFillInContainers(t,[[this,e]],r),e},o.prototype.renderFillInContainers=function(t,e,r){var o,i,n,s,l,h;for(l=[],i=0,n=e.length;n>i;i++)o=(s=e[i])[0],h=s[1],l.push(this.renderFillInContainer(t,o,h,r));return l},o.prototype.renderFillInContainer=function(e,r,o,i){var n,s,l,h,u;if(o.length){for(i||(i=e.toLowerCase()),n=t('<div class="fc-'+i+'-container" />').appendTo(r.bgSegContainerEl),l=0,h=o.length;h>l;l++)u=o[l],s=this.rangeToCoords(u),u.el.css({left:u.left=s.left,right:-(u.right=s.right)}),u.el.appendTo(n);return this.elsByFill[e]?this.elsByFill[e]=this.elsByFill[e].add(n):this.elsByFill[e]=n}},o.prototype.renderDrag=function(t,e){return e?this.renderEventLocationHelper(t,e):(this.renderHighlight(this.eventToSpan(t)),null)},o.prototype.unrenderDrag=function(){return this.unrenderHelper(),this.unrenderHighlight()},o}(),tt=function(t){var e,r,o,i;for(o=0,e=0,r=t.length;r>e;e++)i=t[e],o=Math.max(o,Z(i));return o},Z=function(t){return null==t.top&&(t.top=tt(t.above)),t.top+t.height},Bt=function(t,e){return t.left<e.right&&t.right>e.left},S=18,m=6,w=200,R=1e3,h={months:1},k=[{years:1},{months:1},{days:1},{hours:1},{minutes:30},{minutes:15},{minutes:10},{minutes:5},{minutes:1},{seconds:30},{seconds:15},{seconds:10},{seconds:5},{seconds:1},{milliseconds:500},{milliseconds:100},{milliseconds:10},{milliseconds:1}],N.prototype.initScaleProps=function(){var e,r,o;return this.labelInterval=this.queryDurationOption("slotLabelInterval"),this.slotDuration=this.queryDurationOption("slotDuration"),this.ensureGridDuration(),this.validateLabelAndSlot(),this.ensureLabelInterval(),this.ensureSlotDuration(),e=this.opt("slotLabelFormat"),o=t.type(e),this.headerFormats="array"===o?e:"string"===o?[e]:this.computeHeaderFormats(),this.isTimeScale=lt(this.slotDuration),this.largeUnit=this.isTimeScale?void 0:(r=J(this.slotDuration),/year|month|week/.test(r)?r:void 0),this.emphasizeWeeks=1===this.slotDuration.as("days")&&this.duration.as("weeks")>=2&&!this.opt("businessHours")},N.prototype.queryDurationOption=function(t){var r,o;return null!=(o=this.opt(t))&&+(r=e.duration(o))?r:void 0},N.prototype.validateLabelAndSlot=function(){var r;return this.labelInterval&&(nt(this.duration,this.labelInterval)>R&&(d.warn("slotLabelInterval results in too many cells"),this.labelInterval=null)),this.slotDuration&&(nt(this.duration,this.slotDuration)>R&&(d.warn("slotDuration results in too many cells"),this.slotDuration=null)),this.labelInterval&&this.slotDuration&&(r=nt(this.labelInterval,this.slotDuration),!Rt(r)||1>r)?(d.warn("slotLabelInterval must be a multiple of slotDuration"),this.slotDuration=null):void 0},N.prototype.ensureGridDuration=function(){var t,r,o,n;if(!(t=this.duration)){if(!(t=this.view.intervalDuration))if(this.labelInterval||this.slotDuration)for(n=this.ensureLabelInterval(),o=k.length-1;o>=0&&(r=k[o],t=e.duration(r),!(nt(t,n)>=S));o+=-1);else t=e.duration(h);this.duration=t}return t},N.prototype.ensureLabelInterval=function(){var t,r,o,n,s,l,h,u;if(!(n=this.labelInterval)){if(this.duration||this.slotDuration||this.ensureGridDuration(),this.slotDuration){for(r=0,s=k.length;s>r;r++)if(t=k[r],u=e.duration(t),h=nt(u,this.slotDuration),Rt(h)&&m>=h){n=u;break}n||(n=this.slotDuration)}else for(o=0,l=k.length;l>o&&(t=k[o],n=e.duration(t),!(nt(this.duration,n)>=S));o++);this.labelInterval=n}return n},N.prototype.ensureSlotDuration=function(){var t,r,o,i,s,l,h;if(!(s=this.slotDuration)){for(o=this.ensureLabelInterval(),r=0,i=k.length;i>r;r++)if(t=k[r],h=e.duration(t),l=nt(o,h),Rt(l)&&l>1&&m>=l){s=h;break}s&&this.duration&&(nt(this.duration,s)>w&&(s=null)),s||(s=o),this.slotDuration=s}return s},N.prototype.computeHeaderFormats=function(){var t,e,r,o,i,n,l;switch(this.view,o=this.duration,i=this.labelInterval,n=J(i),l=this.opt("weekNumbers"),t=e=r=null,"week"!==n||l||(n="day"),n){case"year":t="YYYY";break;case"month":o.asYears()>1&&(t="YYYY"),e="MMM";break;case"week":o.asYears()>1&&(t="YYYY"),e=this.opt("shortWeekFormat");break;case"day":o.asYears()>1?t=this.opt("monthYearFormat"):o.asMonths()>1&&(t="MMMM"),l&&(e=this.opt("weekFormat")),r="dd D";break;case"hour":l&&(t=this.opt("weekFormat")),o.asDays()>1&&(e=this.opt("dayOfMonthFormat")),r=this.opt("smallTimeFormat");break;case"minute":i.asMinutes()/60>=m?(t=this.opt("hourFormat"),e="[:]mm"):t=this.opt("mediumTimeFormat");break;case"second":i.asSeconds()/60>=m?(t="LT",e="[:]ss"):t="LTS";break;case"millisecond":t="LTS",e="[.]SSS"}return[].concat(t||[],e||[],r||[])},d.views.timeline={class:j,defaults:{eventResizableFromStart:!0}},d.views.timelineDay={type:"timeline",duration:{days:1}},d.views.timelineWeek={type:"timeline",duration:{weeks:1}},d.views.timelineMonth={type:"timeline",duration:{months:1}},d.views.timelineYear={type:"timeline",duration:{years:1}},W=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,j),r.mixin(L),r.prototype.resourceGrid=null,r.prototype.tbodyHash=null,r.prototype.joiner=null,r.prototype.dividerEls=null,r.prototype.superHeaderText=null,r.prototype.isVGrouping=null,r.prototype.isHGrouping=null,r.prototype.groupSpecs=null,r.prototype.colSpecs=null,r.prototype.orderSpecs=null,r.prototype.rowHierarchy=null,r.prototype.resourceRowHash=null,r.prototype.nestingCnt=0,r.prototype.isNesting=null,r.prototype.dividerWidth=null,r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.processResourceOptions(),this.resourceGrid=new q(this),this.rowHierarchy=new z(this),this.resourceRowHash={}},r.prototype.instantiateGrid=function(){return new M(this)},r.prototype.processResourceOptions=function(){var t,e,r,o,i,n,s,l,h,u,a,c,p,d,f,g,y,v,w,m,R,S;for(t=this.opt("resourceColumns")||[],f=this.opt("resourceLabelText"),o="Resources",S=null,t.length?S=f:t.push({labelText:f||o,text:this.getResourceTextFunc()}),m=[],i=[],s=[],a=!1,u=!1,c=0,g=t.length;g>c;c++)(r=t[c]).group?i.push(r):m.push(r);for(m[0].isMain=!0,i.length?(s=i,a=!0):(l=this.opt("resourceGroupField"))&&(u=!0,s.push({field:l,text:this.opt("resourceGroupText"),render:this.opt("resourceGroupRender")})),R=[],p=0,y=(e=Dt(this.opt("resourceOrder"))).length;y>p;p++){for(w=e[p],h=!1,d=0,v=s.length;v>d;d++)if((n=s[d]).field===w.field){n.order=w.order,h=!0;break}h||R.push(w)}return this.superHeaderText=S,this.isVGrouping=a,this.isHGrouping=u,this.groupSpecs=s,this.colSpecs=i.concat(m),this.orderSpecs=R},r.prototype.renderSkeleton=function(){return r.__super__.renderSkeleton.apply(this,arguments),this.renderResourceGridSkeleton(),this.tbodyHash={spreadsheet:this.resourceGrid.tbodyEl,event:this.timeGrid.tbodyEl},this.joiner=new A("vertical",[this.resourceGrid.bodyScroller,this.timeGrid.bodyScroller]),this.initDividerMoving()},r.prototype.renderSkeletonHtml=function(){return'<table> <thead class="fc-head"> <tr> <td class="fc-resource-area '+this.widgetHeaderClass+'"></td> <td class="fc-divider fc-col-resizer '+this.widgetHeaderClass+'"></td> <td class="fc-time-area '+this.widgetHeaderClass+'"></td> </tr> </thead> <tbody class="fc-body"> <tr> <td class="fc-resource-area '+this.widgetContentClass+'"></td> <td class="fc-divider fc-col-resizer '+this.widgetHeaderClass+'"></td> <td class="fc-time-area '+this.widgetContentClass+'"></td> </tr> </tbody> </table>'},r.prototype.renderResourceGridSkeleton=function(){return this.resourceGrid.el=this.el.find("tbody .fc-resource-area"),this.resourceGrid.headEl=this.el.find("thead .fc-resource-area"),this.resourceGrid.renderSkeleton()},r.prototype.initDividerMoving=function(){var t;return this.dividerEls=this.el.find(".fc-divider"),this.dividerWidth=null!=(t=this.opt("resourceAreaWidth"))?t:this.resourceGrid.tableWidth,null!=this.dividerWidth&&this.positionDivider(this.dividerWidth),this.dividerEls.on("mousedown",function(t){return function(e){return t.dividerMousedown(e)}}(this))},r.prototype.dividerMousedown=function(t){var r,o,n;return r=this.opt("isRTL"),30,o=this.el.width()-30,n=this.getNaturalDividerWidth(),new u({dragStart:function(t){return function(){return t.dividerEls.addClass("fc-active")}}(this),drag:function(t){return function(e,s){var l;return l=r?n-e:n+e,l=Math.max(l,30),l=Math.min(l,o),t.dividerWidth=l,t.positionDivider(l),t.updateWidth()}}(this),dragEnd:function(t){return function(){return t.dividerEls.removeClass("fc-active")}}(this)}).startInteraction(t)},r.prototype.getNaturalDividerWidth=function(){return this.el.find(".fc-resource-area").width()},r.prototype.positionDivider=function(t){return this.el.find(".fc-resource-area").width(t)},r.prototype.renderEvents=function(t){return this.timeGrid.renderEvents(t),this.syncRowHeights(),this.updateWidth()},r.prototype.unrenderEvents=function(){return this.timeGrid.unrenderEvents(),this.syncRowHeights(),this.updateWidth()},r.prototype.updateWidth=function(){return r.__super__.updateWidth.apply(this,arguments),this.resourceGrid.updateWidth(),this.joiner.update(),this.cellFollower?this.cellFollower.update():void 0},r.prototype.updateHeight=function(t){return r.__super__.updateHeight.apply(this,arguments),t?this.syncRowHeights():void 0},r.prototype.setHeight=function(t,e){var r,o;return o=this.syncHeadHeights(),r=e?"auto":t-o-this.queryMiscHeight(),this.timeGrid.bodyScroller.setHeight(r),this.resourceGrid.bodyScroller.setHeight(r)},r.prototype.queryMiscHeight=function(){return this.el.outerHeight()-Math.max(this.resourceGrid.headScroller.el.outerHeight(),this.timeGrid.headScroller.el.outerHeight())-Math.max(this.resourceGrid.bodyScroller.el.outerHeight(),this.timeGrid.bodyScroller.el.outerHeight())},r.prototype.syncHeadHeights=function(){var t;return this.resourceGrid.headHeight("auto"),this.timeGrid.headHeight("auto"),t=Math.max(this.resourceGrid.headHeight(),this.timeGrid.headHeight()),this.resourceGrid.headHeight(t),this.timeGrid.headHeight(t),t},r.prototype.scrollToResource=function(t){return this.timeGrid.scrollToResource(t)},r.prototype.setResources=function(t){var e,r,o;for(this.batchRows(),e=0,r=t.length;r>e;e++)o=t[e],this.insertResource(o);return this.rowHierarchy.show(),this.unbatchRows(),this.reinitializeCellFollowers()},r.prototype.unsetResources=function(){return this.clearEvents(),this.batchRows(),this.rowHierarchy.removeChildren(),this.unbatchRows(),this.reinitializeCellFollowers()},r.prototype.addResource=function(t){return this.insertResource(t),this.reinitializeCellFollowers()},r.prototype.removeResource=function(t){var e;return(e=this.getResourceRow(t.id))?(this.batchRows(),e.remove(),this.unbatchRows(),this.reinitializeCellFollowers()):void 0},r.prototype.cellFollower=null,r.prototype.reinitializeCellFollowers=function(){var e,r,o,i,n,s;for(this.cellFollower&&this.cellFollower.clearSprites(),this.cellFollower=new V(this.resourceGrid.bodyScroller,this.calendar.isTouch),this.cellFollower.isHFollowing=!1,this.cellFollower.isVFollowing=!0,i=[],r=0,o=(n=this.rowHierarchy.getNodes()).length;o>r;r++)(s=n[r])instanceof U&&s.groupTd&&((e=s.groupTd.find(".fc-cell-content")).length&&i.push(e[0]));return this.cellFollower.setSprites(t(i))},r.prototype.insertResource=function(t,e){var r,o,i,n,s,l,h;for(h=new F(this,t),null==e&&((n=t.parentId)&&(e=this.getResourceRow(n))),e?this.insertRowAsChild(h,e):this.insertRow(h),l=[],o=0,i=(s=t.children).length;i>o;o++)r=s[o],l.push(this.insertResource(r,h));return l},r.prototype.insertRow=function(t,e,r){var o;return null==e&&(e=this.rowHierarchy),null==r&&(r=this.groupSpecs),r.length?(o=this.ensureResourceGroup(t,e,r[0]))instanceof g?this.insertRowAsChild(t,o):this.insertRow(t,o,r.slice(1)):this.insertRowAsChild(t,e)},r.prototype.insertRowAsChild=function(t,e){return e.addChild(t,this.computeChildRowPosition(t,e))},r.prototype.computeChildRowPosition=function(t,e){var o,i,n,s,l;if(this.orderSpecs.length)for(o=i=0,n=(s=e.children).length;n>i;o=++i)if(l=s[o],this.compareResources(l.resource||{},t.resource||{})>0)return o;return null},r.prototype.compareResources=function(t,e){return Q(t,e,this.orderSpecs)},r.prototype.ensureResourceGroup=function(t,e,r){var o,i,n,s,l,h,u,a,c,p,d;if(n=(t.resource||{})[r.field],i=null,r.order)for(s=l=0,u=(c=e.children).length;u>l;s=++l){if(d=c[s],0===(o=ht(d.groupValue,n)*r.order)){i=d;break}if(o>0)break}else for(s=h=0,a=(p=e.children).length;a>h;s=++h)if((d=p[s]).groupValue===n){i=d;break}return i||(i=this.isVGrouping?new U(this,r,n):new g(this,r,n),e.addChild(i,s)),i},r.prototype.pairSegsWithRows=function(t){var e,r,o,i,n,s,l,h;for(i=[],n={},e=0,r=t.length;r>e;e++)(s=(h=t[e]).resourceId)&&((l=this.getResourceRow(s))&&((o=n[s])||(o=[l,[]],i.push(o),n[s]=o),o[1].push(h)));return i},r.prototype.rowAdded=function(t){var e;return t instanceof F&&(this.resourceRowHash[t.resource.id]=t),this.isNesting!==(e=Boolean(this.nestingCnt+=t.depth?1:0))&&(this.el.toggleClass("fc-nested",e),this.el.toggleClass("fc-flat",!e)),this.isNesting=e},r.prototype.rowRemoved=function(t){var e;return t instanceof F&&delete this.resourceRowHash[t.resource.id],this.isNesting!==(e=Boolean(this.nestingCnt-=t.depth?1:0))&&(this.el.toggleClass("fc-nested",e),this.el.toggleClass("fc-flat",!e)),this.isNesting=e},r.prototype.batchRowDepth=0,r.prototype.shownRowBatch=null,r.prototype.hiddenRowBatch=null,r.prototype.batchRows=function(){return this.batchRowDepth++?void 0:(this.shownRowBatch=[],this.hiddenRowBatch=[])},r.prototype.unbatchRows=function(){return--this.batchRowDepth?void 0:(this.hiddenRowBatch.length&&this.rowsHidden(this.hiddenRowBatch),this.shownRowBatch.length&&this.rowsShown(this.shownRowBatch),this.hiddenRowBatch=null,this.shownRowBatch=null)},r.prototype.rowShown=function(t){return this.shownRowBatch?this.shownRowBatch.push(t):this.rowsShown([t])},r.prototype.rowHidden=function(t){return this.hiddenRowBatch?this.hiddenRowBatch.push(t):this.rowsHidden([t])},r.prototype.rowsShown=function(t){return this.syncRowHeights(t),this.updateWidth()},r.prototype.rowsHidden=function(t){return this.updateWidth()},r.prototype.syncRowHeights=function(t,e){var r,o,i,n,s,l,h,u,a,c;for(null==e&&(e=!1),null==t&&(t=this.getVisibleRows()),l=0,u=t.length;u>l;l++)(c=t[l]).setTrInnerHeight("");for(s=function(){var o,i,n;for(n=[],o=0,i=t.length;i>o;o++)c=t[o],r=c.getMaxTrInnerHeight(),e&&(r+=r%2),n.push(r);return n}(),n=h=0,a=t.length;a>h;n=++h)(c=t[n]).setTrInnerHeight(s[n]);return!e&&(o=this.resourceGrid.tbodyEl.height(),i=this.timeGrid.tbodyEl.height(),Math.abs(o-i)>1)?this.syncRowHeights(t,!0):void 0},r.prototype.getVisibleRows=function(){var t,e,r,o,i;for(o=[],t=0,e=(r=this.rowHierarchy.getRows()).length;e>t;t++)(i=r[t]).isShown&&o.push(i);return o},r.prototype.getEventRows=function(){var t,e,r,o,i;for(o=[],t=0,e=(r=this.rowHierarchy.getRows()).length;e>t;t++)(i=r[t])instanceof p&&o.push(i);return o},r.prototype.getResourceRow=function(t){return this.resourceRowHash[t]},r.prototype.setScroll=function(t){return r.__super__.setScroll.apply(this,arguments),this.resourceGrid.bodyScroller.setScrollTop(t.top)},r}(),M=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,N),r.mixin(I),r.prototype.eventRows=null,r.prototype.shownEventRows=null,r.prototype.tbodyEl=null,r.prototype.rowCoordCache=null,r.prototype.spanToSegs=function(t){var e,o,i,n,s,l;if(l=r.__super__.spanToSegs.apply(this,arguments),e=this.view.calendar,n=t.resourceId)for(o=0,i=l.length;i>o;o++)(s=l[o]).resource=e.getResourceById(n),s.resourceId=n;return l},r.prototype.prepareHits=function(){var t,e;return r.__super__.prepareHits.apply(this,arguments),this.eventRows=this.view.getEventRows(),this.shownEventRows=function(){var e,r,o,i;for(i=[],e=0,r=(o=this.eventRows).length;r>e;e++)(t=o[e]).isShown&&i.push(t);return i}.call(this),e=function(){var e,r,o,i;for(i=[],e=0,r=(o=this.shownEventRows).length;r>e;e++)t=o[e],i.push(t.getTr("event")[0]);return i}.call(this),this.rowCoordCache=new l({els:e,isVertical:!0}),this.rowCoordCache.build()},r.prototype.releaseHits=function(){return r.__super__.releaseHits.apply(this,arguments),this.eventRows=null,this.shownEventRows=null,this.rowCoordCache.clear()},r.prototype.queryHit=function(t,e){var o,i;return(i=r.__super__.queryHit.apply(this,arguments))&&null!=(o=this.rowCoordCache.getVerticalIndex(e))?{resourceId:this.shownEventRows[o].resource.id,snap:i.snap,component:this,left:i.left,right:i.right,top:this.rowCoordCache.getTopOffset(o),bottom:this.rowCoordCache.getBottomOffset(o)}:void 0},r.prototype.getHitSpan=function(t){var e;return(e=this.getSnapRange(t.snap)).resourceId=t.resourceId,e},r.prototype.getHitEl=function(t){return this.getSnapEl(t.snap)},r.prototype.renderSkeleton=function(){var e;return r.__super__.renderSkeleton.apply(this,arguments),this.segContainerEl.remove(),this.segContainerEl=null,e=t('<div class="fc-rows"><table><tbody/></table></div>').appendTo(this.bodyScroller.canvas.contentEl),this.tbodyEl=e.find("tbody")},r.prototype.renderFgSegs=function(t){var e,r,o,i,n,s,l;for(t=this.renderFgSegEls(t),l=[],o=0,i=(s=this.view.pairSegsWithRows(t)).length;i>o;o++)e=(n=s[o])[0],r=n[1],e.fgSegs=r,e.isShown&&(e.isSegsRendered=!0,l.push(n));return this.renderFgSegsInContainers(l),this.updateSegFollowers(t),t},r.prototype.unrenderFgSegs=function(){var t,e,r,o;for(this.clearSegFollowers(),r=0,o=(e=this.view.getEventRows()).length;o>r;r++)(t=e[r]).fgSegs=null,t.isSegsRendered=!1;return this.unrenderFgContainers(e)},r.prototype.renderFill=function(t,e,r){var o,i,n,s,l,h,u,a,c,p,d,f;for(a=[],l=[],o=0,n=(e=this.renderFillSegEls(t,e)).length;n>o;o++)(d=e[o]).resourceId?a.push(d):l.push(d);for(f=[],i=0,s=(u=this.view.pairSegsWithRows(a)).length;s>i;i++)c=(h=u[i])[0],p=h[1],"bgEvent"===t&&(c.bgSegs=p),c.isShown&&f.push(h);return l.length&&f.unshift([this,l]),this.renderFillInContainers(t,f,r),e},r.prototype.renderHelper=function(t,e){var r,o;return o=this.eventToSegs(t),o=this.renderFgSegEls(o),r=this.view.pairSegsWithRows(o),this.renderHelperSegsInContainers(r,e)},r.prototype.computeInitialScroll=function(t){var e;return e=r.__super__.computeInitialScroll.apply(this,arguments),t&&(e.resourceId=t.resourceId,e.bottom=t.bottom),e},r.prototype.queryScroll=function(){var t,e,o,i,n,s,l,h;for(h=r.__super__.queryScroll.apply(this,arguments),l=this.bodyScroller.scrollEl.offset().top,o=0,i=(n=this.view.getVisibleRows()).length;i>o;o++)if((s=n[o]).resource&&(e=(t=s.getTr("event")).offset().top+t.outerHeight())>l){h.resourceId=s.resource.id,h.bottom=e-l;break}return h},r.prototype.setScroll=function(t){var e,o,i,n;return t.resourceId&&((n=this.view.getResourceRow(t.resourceId))&&((e=n.getTr("event"))&&(i=this.bodyScroller.canvas.el.offset().top,o=e.offset().top+e.outerHeight(),t.top=o-t.bottom-i))),r.__super__.setScroll.call(this,t)},r.prototype.scrollToResource=function(t){var e,r,o,i;return(o=this.view.getResourceRow(t.id))&&(e=o.getTr("event"))?(r=this.bodyScroller.canvas.el.offset().top,i=e.offset().top-r,this.bodyScroller.scrollEl.scrollTop(i)):void 0},r}(),r=30,q=function(){function e(t){var e;this.view=t,this.isRTL=this.view.opt("isRTL"),this.givenColWidths=this.colWidths=function(){var t,r,o,i;for(i=[],t=0,r=(o=this.view.colSpecs).length;r>t;t++)e=o[t],i.push(e.width);return i}.call(this)}return e.prototype.view=null,e.prototype.headEl=null,e.prototype.el=null,e.prototype.tbodyEl=null,e.prototype.headScroller=null,e.prototype.bodyScroller=null,e.prototype.joiner=null,e.prototype.colGroupHtml="",e.prototype.headTable=null,e.prototype.headColEls=null,e.prototype.headCellEls=null,e.prototype.bodyColEls=null,e.prototype.bodyTable=null,e.prototype.renderSkeleton=function(){return this.headScroller=new s({overflowX:"clipped-scroll",overflowY:"hidden"}),this.headScroller.canvas=new O,this.headScroller.render(),this.headScroller.canvas.contentEl.html(this.renderHeadHtml()),this.headEl.append(this.headScroller.el),this.bodyScroller=new s({overflowY:"clipped-scroll"}),this.bodyScroller.canvas=new O,this.bodyScroller.render(),this.bodyScroller.canvas.contentEl.html("<table>"+this.colGroupHtml+"<tbody/></table>"),this.tbodyEl=this.bodyScroller.canvas.contentEl.find("tbody"),this.el.append(this.bodyScroller.el),this.joiner=new A("horizontal",[this.headScroller,this.bodyScroller]),this.headTable=this.headEl.find("table"),this.headColEls=this.headEl.find("col"),this.headCellEls=this.headScroller.canvas.contentEl.find("tr:last-child th"),this.bodyColEls=this.el.find("col"),this.bodyTable=this.el.find("table"),this.colMinWidths=this.computeColMinWidths(),this.applyColWidths(),this.initColResizing()},e.prototype.renderHeadHtml=function(){var t,e,r,o,i,s,l,h,u,a;for(r="<table>",t="<colgroup>",s=0,h=(e=this.view.colSpecs).length;h>s;s++)t+=(a=e[s]).isMain?'<col class="fc-main-col"/>':"<col/>";for(t+="</colgroup>",this.colGroupHtml=t,r+=t,r+="<tbody>",this.view.superHeaderText&&(r+='<tr class="fc-super"><th class="'+this.view.widgetHeaderClass+'" colspan="'+e.length+'"><div class="fc-cell-content"><span class="fc-cell-text">'+yt(this.view.superHeaderText)+"</span></div></th></tr>"),r+="<tr>",!0,o=l=0,u=e.length;u>l;o=++l)a=e[o],i=o===e.length-1,r+='<th class="'+this.view.widgetHeaderClass+'"><div><div class="fc-cell-content">'+(a.isMain?'<span class="fc-expander-space"><span class="fc-icon"></span></span>':"")+'<span class="fc-cell-text">'+yt(a.labelText||"")+"</span></div>"+(i?"":'<div class="fc-col-resizer"></div>')+"</div></th>";return(r+="</tr>")+"</tbody></table>"},e.prototype.givenColWidths=null,e.prototype.colWidths=null,e.prototype.colMinWidths=null,e.prototype.tableWidth=null,e.prototype.tableMinWidth=null,e.prototype.initColResizing=function(){return this.headEl.find("th .fc-col-resizer").each((e=this,function(r,o){return(o=t(o)).on("mousedown",function(t){return e.colResizeMousedown(r,t,o)})}));var e},e.prototype.colResizeMousedown=function(t,e,o){var i,s,l;return(i=this.colWidths=this.queryColWidths()).pop(),i.push(null),l=i[t],s=Math.min(this.colMinWidths[t],r),new u({dragStart:function(){return o.addClass("fc-active")},drag:function(e){return function(r,o){var n;return n=l+(e.isRTL?-r:r),n=Math.max(n,s),i[t]=n,e.applyColWidths()}}(this),dragEnd:function(){return o.removeClass("fc-active")}}).startInteraction(e)},e.prototype.applyColWidths=function(){var t,e,r,o,i,n,s,l,h,u,a,c,p,d,f,g,y;for(r=this.colMinWidths,t=!0,e=!1,y=0,u=0,p=(i=this.colWidths).length;p>u;u++)"number"==typeof(o=i[u])?y+=o:(t=!1,o&&(e=!0));for(l=e&&!this.view.isHGrouping?"auto":"",s=function(){var t,e,r;for(r=[],h=t=0,e=i.length;e>t;h=++t)o=i[h],r.push(null!=o?o:l);return r}(),g=0,h=a=0,d=s.length;d>a;h=++a)g+="number"==typeof(n=s[h])?n:r[h];for(h=c=0,f=s.length;f>c;h=++c)n=s[h],this.headColEls.eq(h).width(n),this.bodyColEls.eq(h).width(n);return this.headScroller.canvas.setMinWidth(g),this.bodyScroller.canvas.setMinWidth(g),this.tableMinWidth=g,this.tableWidth=t?y:void 0},e.prototype.computeColMinWidths=function(){var t,e,o,i,n,s;for(n=[],t=e=0,o=(i=this.givenColWidths).length;o>e;t=++e)"number"==typeof(s=i[t])?n.push(s):n.push(parseInt(this.headColEls.eq(t).css("min-width"))||r);return n},e.prototype.queryColWidths=function(){var e,r,o,i,n;for(n=[],e=0,r=(i=this.headCellEls).length;r>e;e++)o=i[e],n.push(t(o).outerWidth());return n},e.prototype.updateWidth=function(){return this.headScroller.updateSize(),this.bodyScroller.updateSize(),this.joiner.update(),this.follower?this.follower.update():void 0},e.prototype.headHeight=function(){var t;return(t=this.headScroller.canvas.contentEl.find("table")).height.apply(t,arguments)},e}(),z=function(){function e(e){this.view=e,this.children=[],this.trHash={},this.trs=t()}return e.prototype.view=null,e.prototype.parent=null,e.prototype.prevSibling=null,e.prototype.children=null,e.prototype.depth=0,e.prototype.hasOwnRow=!1,e.prototype.trHash=null,e.prototype.trs=null,e.prototype.isRendered=!1,e.prototype.isExpanded=!0,e.prototype.isShown=!1,e.prototype.addChild=function(t,e){var r,o,i,s;for(t.remove(),r=this.children,null!=e?r.splice(e,0,t):(e=r.length,r.push(t)),t.prevSibling=e>0?r[e-1]:null,e<r.length-1&&(r[e+1].prevSibling=t),t.parent=this,t.depth=this.depth+(this.hasOwnRow?1:0),o=0,i=(s=t.getNodes()).length;i>o;o++)s[o].added();return this.isShown&&this.isExpanded?t.show():void 0},e.prototype.removeChild=function(t){var e,r,o,i,n,s,l,h;for(o=!1,r=i=0,s=(e=this.children).length;s>i;r=++i)if(e[r]===t){o=!0;break}if(o){for(r<e.length-1&&(e[r+1].prevSibling=t.prevSibling),e.splice(r,1),t.recursivelyUnrender(),n=0,l=(h=t.getNodes()).length;l>n;n++)h[n].removed();return t.parent=null,t.prevSibling=null,t}return!1},e.prototype.removeChildren=function(){var e,r,o,i,n,s;for(e=0,o=(n=this.children).length;o>e;e++)n[e].recursivelyUnrender();for(r=0,i=(s=this.getDescendants()).length;i>r;r++)s[r].removed();return this.children=[]},e.prototype.remove=function(){return this.parent?this.parent.removeChild(this):void 0},e.prototype.getLastChild=function(){var t;return(t=this.children)[t.length-1]},e.prototype.getPrevRow=function(){var t,e;for(e=this;e;){if(e.prevSibling)for(e=e.prevSibling;t=e.getLastChild();)e=t;else e=e.parent;if(e&&e.hasOwnRow&&e.isShown)return e}return null},e.prototype.getLeadingRow=function(){return this.hasOwnRow?this:this.isExpanded&&this.children.length?this.children[0].getLeadingRow():void 0},e.prototype.getRows=function(t){var r,o,i;for(null==t&&(t=[]),this.hasOwnRow&&t.push(this),r=0,o=(i=this.children).length;o>r;r++)i[r].getRows(t);return t},e.prototype.getNodes=function(t){var r,o,i;for(null==t&&(t=[]),t.push(this),r=0,o=(i=this.children).length;o>r;r++)i[r].getNodes(t);return t},e.prototype.getDescendants=function(){var t,r,o,i;for(t=[],r=0,o=(i=this.children).length;o>r;r++)i[r].getNodes(t);return t},e.prototype.render=function(){var e,r,o,i,n,s,l;if(this.trHash={},s=[],this.hasOwnRow)for(l in e=this.getPrevRow(),r=this.view.tbodyHash)i=r[l],n=t("<tr/>"),this.trHash[l]=n,s.push(n[0]),this[o="render"+K(l)+"Content"]&&this[o](n),e?e.trHash[l].after(n):i.prepend(n);return this.trs=t(s).on("click",".fc-expander",Ft(this,"toggleExpanded")),this.isRendered=!0},e.prototype.unrender=function(){var e,r,o,i;if(this.isRendered){for(o in e=this.trHash)r=e[o],this[i="unrender"+K(o)+"Content"]&&this[i](r);return this.trHash={},this.trs.remove(),this.trs=t(),this.isRendered=!1,this.isShown=!1,this.hidden()}},e.prototype.recursivelyUnrender=function(){var t,e,r,o,i;for(this.unrender(),i=[],e=0,r=(o=this.children).length;r>e;e++)t=o[e],i.push(t.recursivelyUnrender());return i},e.prototype.getTr=function(t){return this.trHash[t]},e.prototype.show=function(){var t,e,r,o,i;if(!this.isShown&&(this.isRendered?this.trs.css("display",""):this.render(),this.ensureSegsRendered&&this.ensureSegsRendered(),this.isExpanded?this.indicateExpanded():this.indicateCollapsed(),this.isShown=!0,this.shown(),this.isExpanded)){for(i=[],e=0,r=(o=this.children).length;r>e;e++)t=o[e],i.push(t.show());return i}},e.prototype.hide=function(){var t,e,r,o,i;if(this.isShown&&(this.isRendered&&this.trs.hide(),this.isShown=!1,this.hidden(),this.isExpanded)){for(i=[],e=0,r=(o=this.children).length;r>e;e++)t=o[e],i.push(t.hide());return i}},e.prototype.expand=function(){var e,r,o;if(!this.isExpanded){for(this.isExpanded=!0,this.indicateExpanded(),this.view.batchRows(),e=0,r=(o=this.children).length;r>e;e++)o[e].show();return this.view.unbatchRows(),this.animateExpand()}},e.prototype.collapse=function(){var e,r,o;if(this.isExpanded){for(this.isExpanded=!1,this.indicateCollapsed(),this.view.batchRows(),e=0,r=(o=this.children).length;r>e;e++)o[e].hide();return this.view.unbatchRows()}},e.prototype.toggleExpanded=function(){return this.isExpanded?this.collapse():this.expand()},e.prototype.indicateExpanded=function(){return this.trs.find(".fc-expander .fc-icon").removeClass(this.getCollapsedIcon()).addClass(this.getExpandedIcon())},e.prototype.indicateCollapsed=function(){return this.trs.find(".fc-expander .fc-icon").removeClass(this.getExpandedIcon()).addClass(this.getCollapsedIcon())},e.prototype.enableExpanding=function(){return this.trs.find(".fc-expander-space").addClass("fc-expander")},e.prototype.disableExpanding=function(){return this.trs.find(".fc-expander-space").removeClass("fc-expander").find(".fc-icon").removeClass(this.getExpandedIcon()).removeClass(this.getCollapsedIcon())},e.prototype.getExpandedIcon=function(){return"fc-icon-down-triangle"},e.prototype.getCollapsedIcon=function(){return"fc-icon-"+(this.view.isRTL?"left":"right")+"-triangle"},e.prototype.animateExpand=function(){var t,e,r;return(r=null!=(t=this.children[0])&&null!=(e=t.getLeadingRow())?e.trs:void 0)?(r.addClass("fc-collapsed"),setTimeout(function(){return r.addClass("fc-transitioning"),r.removeClass("fc-collapsed")}),r.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){return r.removeClass("fc-transitioning")})):void 0},e.prototype.getMaxTrInnerHeight=function(){var e;return e=0,t.each(this.trHash,function(t,r){var o;return o=ct(r).find("> div:not(.fc-cell-content):first"),e=Math.max(o.height(),e)}),e},e.prototype.setTrInnerHeight=function(e){return t.each(this.trHash,function(t,r){return ct(r).find("> div:not(.fc-cell-content):first").height(e)})},e.prototype.shown=function(){return this.hasOwnRow?this.rowShown(this):void 0},e.prototype.hidden=function(){return this.hasOwnRow?this.rowHidden(this):void 0},e.prototype.rowShown=function(t){return(this.parent||this.view).rowShown(t)},e.prototype.rowHidden=function(t){return(this.parent||this.view).rowHidden(t)},e.prototype.added=function(){return this.hasOwnRow?this.rowAdded(this):void 0},e.prototype.removed=function(){return this.hasOwnRow?this.rowRemoved(this):void 0},e.prototype.rowAdded=function(t){return(this.parent||this.view).rowAdded(t)},e.prototype.rowRemoved=function(t){return(this.parent||this.view).rowRemoved(t)},e}(),B=function(e){function r(t,e,o){this.groupSpec=e,this.groupValue=o,r.__super__.constructor.apply(this,arguments)}return kt(r,z),r.prototype.groupSpec=null,r.prototype.groupValue=null,r.prototype.rowRemoved=function(t){return r.__super__.rowRemoved.apply(this,arguments),t===this||this.children.length?void 0:this.remove()},r.prototype.renderGroupContentEl=function(){var e,r;return e=t('<div class="fc-cell-content" />').append(this.renderGroupTextEl()),"function"==typeof(r=this.groupSpec.render)&&(e=r(e,this.groupValue)||e),e},r.prototype.renderGroupTextEl=function(){var e,r;return r=this.groupValue||"","function"==typeof(e=this.groupSpec.text)&&(r=e(r)||r),t('<span class="fc-cell-text" />').text(r)},r}(),g=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,B),r.prototype.hasOwnRow=!0,r.prototype.renderSpreadsheetContent=function(e){var r;return(r=this.renderGroupContentEl()).prepend('<span class="fc-expander"><span class="fc-icon"></span></span>'),t('<td class="fc-divider" />').attr("colspan",this.view.colSpecs.length).append(t("<div/>").append(r)).appendTo(e)},r.prototype.renderEventContent=function(t){return t.append('<td class="fc-divider"> <div/> </td>')},r}(),U=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return kt(r,B),r.prototype.rowspan=0,r.prototype.leadingTr=null,r.prototype.groupTd=null,r.prototype.rowShown=function(t){return this.rowspan+=1,this.renderRowspan(),r.__super__.rowShown.apply(this,arguments)},r.prototype.rowHidden=function(t){return this.rowspan-=1,this.renderRowspan(),r.__super__.rowHidden.apply(this,arguments)},r.prototype.renderRowspan=function(){var e;return this.rowspan?(this.groupTd||(this.groupTd=t('<td class="'+this.view.widgetContentClass+'"/>').append(this.renderGroupContentEl())),this.groupTd.attr("rowspan",this.rowspan),(e=this.getLeadingRow().getTr("spreadsheet"))!==this.leadingTr?(e&&e.prepend(this.groupTd),this.leadingTr=e):void 0):(this.groupTd&&(this.groupTd.remove(),this.groupTd=null),this.leadingTr=null)},r}(),p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return kt(e,z),e.prototype.hasOwnRow=!0,e.prototype.segContainerEl=null,e.prototype.segContainerHeight=null,e.prototype.innerEl=null,e.prototype.bgSegContainerEl=null,e.prototype.isSegsRendered=!1,e.prototype.bgSegs=null,e.prototype.fgSegs=null,e.prototype.renderEventContent=function(t){return t.html('<td class="'+this.view.widgetContentClass+'"> <div> <div class="fc-event-container" /> </div> </td>'),this.segContainerEl=t.find(".fc-event-container"),this.innerEl=this.bgSegContainerEl=t.find("td > div"),this.ensureSegsRendered()},e.prototype.ensureSegsRendered=function(){return this.isSegsRendered?void 0:(this.bgSegs&&this.view.timeGrid.renderFillInContainer("bgEvent",this,this.bgSegs),this.fgSegs&&this.view.timeGrid.renderFgSegsInContainers([[this,this.fgSegs]]),this.isSegsRendered=!0)},e.prototype.unrenderEventContent=function(){return this.bgSegs=null,this.fgSegs=null,this.isSegsRendered=!1},e}(),F=function(e){function r(t,e){this.resource=e,r.__super__.constructor.apply(this,arguments)}return kt(r,p),r.prototype.resource=null,r.prototype.rowAdded=function(t){return r.__super__.rowAdded.apply(this,arguments),t!==this&&this.isRendered&&1===this.children.length?(this.enableExpanding(),this.isExpanded?this.indicateExpanded():this.indicateCollapsed()):void 0},r.prototype.rowRemoved=function(t){return r.__super__.rowRemoved.apply(this,arguments),t!==this&&this.isRendered&&!this.children.length?this.disableExpanding():void 0},r.prototype.render=function(){return r.__super__.render.apply(this,arguments),this.children.length>0?this.enableExpanding():this.disableExpanding(),this.view.trigger("resourceRender",this.resource,this.resource,this.getTr("spreadsheet").find("> td"),this.getTr("event").find("> td"))},r.prototype.renderEventContent=function(t){return r.__super__.renderEventContent.apply(this,arguments),t.attr("data-resource-id",this.resource.id)},r.prototype.renderSpreadsheetContent=function(e){var r,o,i,n,s,l,h,u,a;for(h=this.resource,n=0,s=(l=this.view.colSpecs).length;s>n;n++)(r=l[n]).group||(i=r.field?h[r.field]||null:h,a="function"==typeof r.text?r.text(h,i):i,o=t('<div class="fc-cell-content">'+(r.isMain?this.renderGutterHtml():"")+'<span class="fc-cell-text">'+(a?yt(a):"&nbsp;")+"</span></div>"),"function"==typeof r.render&&(o=r.render(h,o,i)||o),u=t('<td class="'+this.view.widgetContentClass+'"/>').append(o),r.isMain&&u.wrapInner("<div/>"),e.append(u));return e.attr("data-resource-id",h.id)},r.prototype.renderGutterHtml=function(){var t,r,o;for(t="",r=0,o=this.depth;o>r;r+=1)t+='<span class="fc-icon"/>';return t+'<span class="fc-expander-space"><span class="fc-icon"></span></span>'},r}(),d.views.timeline.resourceClass=W,E=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return kt(e,t),e.mixin(L),e.prototype.timeGridClass=G,e.prototype.dayGridClass=H,e.prototype.renderHead=function(){return e.__super__.renderHead.apply(this,arguments),this.timeGrid.processHeadResourceEls(this.headContainerEl)},e.prototype.setResources=function(t){return this.timeGrid.setResources(t),this.dayGrid&&this.dayGrid.setResources(t),this.clearView(),this.displayView()},e.prototype.unsetResources=function(t){return this.clearEvents(),this.timeGrid.unsetResources(),this.dayGrid&&this.dayGrid.unsetResources(),t?void 0:(this.clearView(),this.displayView())},e}(d.AgendaView),d.views.agenda.queryResourceClass=function(t){var e;return(null!=(e=t.options.groupByResource||t.options.groupByDateAndResource)?e:1===t.duration.as("days"))?E:void 0},T=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return kt(e,t),e.mixin(L),e.prototype.dayGridClass=H,e.prototype.renderHead=function(){return e.__super__.renderHead.apply(this,arguments),this.dayGrid.processHeadResourceEls(this.headContainerEl)},e.prototype.setResources=function(t){return this.dayGrid.setResources(t),this.clearView(),this.displayView()},e.prototype.unsetResources=function(t){return this.clearEvents(),this.dayGrid.unsetResources(),t?void 0:(this.clearView(),this.displayView())},e}(d.BasicView),x=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return kt(e,t),e.mixin(L),e.prototype.dayGridClass=H,e.prototype.renderHead=function(){return e.__super__.renderHead.apply(this,arguments),this.dayGrid.processHeadResourceEls(this.headContainerEl)},e.prototype.setResources=function(t){return this.dayGrid.setResources(t),this.clearView(),this.displayView()},e.prototype.unsetResources=function(){return this.clearEvents(),this.dayGrid.unsetResources(),this.clearView(),this.displayView()},e}(d.MonthView),d.views.basic.queryResourceClass=function(t){var e;return(null!=(e=t.options.groupByResource||t.options.groupByDateAndResource)?e:1===t.duration.as("days"))?T:void 0},d.views.month.queryResourceClass=function(t){return t.options.groupByResource||t.options.groupByDateAndResource?x:void 0},C="2016-06-02",Y={years:1,weeks:1},y="http://fullcalendar.io/scheduler/license/",b=["GPL-My-Project-Is-Open-Source","CC-Attribution-NonCommercial-NoDerivatives"],xt=function(t,e){return mt(window.location.href)||St(t)||it(e)?void 0:Gt('Please use a valid license key. <a href="'+y+'">More Info</a>',e)},St=function(r){var o,i,n,s;return-1!==t.inArray(r,b)||!!((i=(r||"").match(/^(\d+)\-fcs\-(\d+)$/))&&10===i[1].length&&(n=e.utc(1e3*parseInt(i[2])),s=e.utc(d.mockSchedulerReleaseDate||C),s.isValid()&&(o=s.clone().subtract(Y),n.isAfter(o))))},mt=function(t){return Boolean(t.match(/\w+\:\/\/fullcalendar\.io\/|\/demos\/[\w-]+\.html$/))},Gt=function(e,r){return r.append(t('<div class="fc-license-message" />').html(e))},void(it=function(t){return t.find(".fc-license-message").length>=1}))}),(Bahmni=Bahmni||{}).Appointments=Bahmni.Appointments||{},angular.module("bahmni.appointments",["ui.router","bahmni.common.config","bahmni.common.uiHelper","bahmni.common.i18n","bahmni.common.domain","bahmni.common.displaycontrol.patientprofile","authentication","bahmni.common.appFramework","bahmni.common.routeErrorHandler","httpErrorInterceptor","pasvaz.bindonce","infinite-scroll","bahmni.common.util","ngSanitize","pascalprecht.translate","ngCookies","bahmni.common.patient","bahmni.common.logging","ui.calendar","monospaced.elastic","ivh.treeview","ngTagsInput","ngDialog"]),angular.module("bahmni.appointments").config(["$urlRouterProvider","$stateProvider","$httpProvider","$bahmniTranslateProvider","$compileProvider",function($urlRouterProvider,$stateProvider,$httpProvider,$bahmniTranslateProvider,$compileProvider){$httpProvider.defaults.headers.common["Disable-WWW-Authenticate"]=!0,$urlRouterProvider.otherwise("/home/manage/summary"),$urlRouterProvider.when("/home/manage","/home/manage/summary"),$compileProvider.debugInfoEnabled(!1),$stateProvider.state("home",{url:"/home",abstract:!0,views:{"additional-header":{templateUrl:"views/appointmentsHeader.html",controller:"AppointmentsHeaderController"},mainContent:{template:'<div class="opd-wrapper appointments-page-wrapper"><div ui-view="content" class="opd-content-wrapper appointments-content-wrapper"></div></div>'}},data:{backLinks:[]},resolve:{initializeConfig:function(initialization,$stateParams){return initialization($stateParams.appName)}}}).state("home.manage",{url:"/manage",views:{content:{templateUrl:"views/manage/appointmentsManage.html",controller:"AppointmentsManageController"}}}).state("home.manage.summary",{url:"/summary",tabName:"summary",params:{viewDate:null},views:{"content@manage":{templateUrl:"views/manage/appointmentsSummary.html",controller:"AppointmentsSummaryController"}}}).state("home.manage.appointments",{url:"/appointments",params:{filterParams:{},isFilterOpen:!0,isSearchEnabled:!1},views:{filter:{templateUrl:"views/manage/appointmentFilter.html",controller:"AppointmentsFilterController"},"content@manage":{templateUrl:"views/manage/allAppointments.html",controller:"AllAppointmentsController"}}}).state("home.manage.appointments.calendar",{url:"/calendar",tabName:"calendar",params:{viewDate:null,doFetchAppointmentsData:!0,appointmentsData:null},views:{"content@viewAppointments":{templateUrl:"views/manage/calendar/calendarView.html",controller:"AppointmentsCalendarViewController"}}}).state("home.manage.appointments.calendar.new",{url:"/new",params:{appointment:null},views:{"content@appointment":{templateUrl:"views/manage/newAppointment.html",controller:"AppointmentsCreateController"}},resolve:{appointmentContext:function(appointmentInitialization,$stateParams){return appointmentInitialization($stateParams)},appointmentCreateConfig:function(initializeConfig,appointmentConfigInitialization,appointmentContext){return appointmentConfigInitialization(appointmentContext)}}}).state("home.manage.appointments.calendar.edit",{url:"/:uuid",views:{"content@appointment":{templateUrl:"views/manage/newAppointment.html",controller:"AppointmentsCreateController"}},resolve:{appointmentContext:function(appointmentInitialization,$stateParams){return appointmentInitialization($stateParams)},appointmentCreateConfig:function(initializeConfig,appointmentConfigInitialization,appointmentContext){return appointmentConfigInitialization(appointmentContext)}}}).state("home.manage.appointments.list",{url:"/list",tabName:"list",params:{viewDate:null,patient:null,doFetchAppointmentsData:!0,appointmentsData:null,selectedAppointmentBlock:null,selectedAppointmentDate:null},views:{"content@viewAppointments":{templateUrl:"views/manage/list/listView.html",controller:"AppointmentsListViewController"}}}).state("home.manage.appointments.list.new",{url:"/new",views:{"content@appointment":{templateUrl:"views/manage/newAppointment.html",controller:"AppointmentsCreateController"}},resolve:{appointmentContext:function(appointmentInitialization,$stateParams){return appointmentInitialization($stateParams)},appointmentCreateConfig:function(initializeConfig,appointmentConfigInitialization,appointmentContext){return appointmentConfigInitialization(appointmentContext)}}}).state("home.manage.appointments.list.edit",{url:"/:uuid",views:{"content@appointment":{templateUrl:"views/manage/newAppointment.html",controller:"AppointmentsCreateController"}},resolve:{appointmentContext:function(appointmentInitialization,$stateParams){return appointmentInitialization($stateParams)},appointmentCreateConfig:function(initializeConfig,appointmentConfigInitialization,appointmentContext){return appointmentConfigInitialization(appointmentContext)}}}).state("home.admin",{url:"/admin",abstract:!0,views:{content:{templateUrl:"views/admin/appointmentsAdmin.html"}}}).state("home.admin.service",{url:"/service",views:{"content@admin":{templateUrl:"views/admin/allAppointmentServices.html",controller:"AllAppointmentServicesController"}}}).state("home.admin.service.edit",{url:"/:uuid",views:{"content@admin":{templateUrl:"views/admin/appointmentService.html",controller:"AppointmentServiceController"}},resolve:{appointmentServiceContext:function(appointmentServiceInitialization,$stateParams){return appointmentServiceInitialization($stateParams.uuid)}}}),$bahmniTranslateProvider.init({app:"appointments",shouldMerge:!0})}]).run(["$window",function($window){moment.locale($window.localStorage.NG_TRANSLATE_LANG_KEY||"en")}]),angular.module("bahmni.appointments").factory("initialization",["authenticator","appService","spinner","configurations",function(authenticator,appService,spinner,configurations){return function(){return spinner.forPromise(authenticator.authenticateUser().then(function(){return appService.initApp("appointments",{app:!0,extension:!0})}).then(function(){return configurations.load([])}))}}]),angular.module("bahmni.appointments").factory("appointmentServiceInitialization",["appointmentsServiceService",function(appointmentsServiceService){return function(serviceUuid){return function(){if("new"!==serviceUuid)return appointmentsServiceService.getService(serviceUuid).then(function(response){return{service:response.data}})}()}}]),angular.module("bahmni.appointments").factory("appointmentInitialization",["appointmentsService",function(appointmentsService){return function($stateParams){return $stateParams.appointment?{appointment:$stateParams.appointment}:$stateParams.uuid?appointmentsService.getAppointmentByUuid($stateParams.uuid).then(function(response){return{appointment:response.data}}):{}}}]),angular.module("bahmni.appointments").factory("appointmentConfigInitialization",["locationService","specialityService","appointmentsServiceService","providerService","appService","spinner","$q",function(locationService,specialityService,appointmentsServiceService,providerService,appService,spinner,$q){return function(appointmentContext){var promises,config,getAllSpecialities=function(){return specialityService.getAllSpecialities()},getAllServices=function(){return appointmentsServiceService.getAllServices()},getAllProviders=function(){return providerService.list({v:"custom:(display,person,uuid,retired,attributes:(attributeType:(display),value,voided))"}).then(function(response){return _.filter(response.data.results,function(provider){return _.find(provider.attributes,function(attribute){return!attribute.voided&&!provider.retired&&attribute.value&&attribute.attributeType.display===Bahmni.Appointments.Constants.availableForAppointments})})})},getAppointmentService=function(uuid){return appointmentsServiceService.getService(uuid)};return config={},(promises=[]).push(function(){return locationService.getAllByTag("Appointment Location")}(),getAllServices(),getAllProviders()),appService.getAppDescriptor().getConfigValue("enableSpecialities")&&promises.push(getAllSpecialities().then(function(response){config.specialities=response.data})),appointmentContext.appointment&&appointmentContext.appointment.service&&promises.push(getAppointmentService(appointmentContext.appointment.service.uuid).then(function(response){config.selectedService=response.data})),spinner.forPromise($q.all(promises).then(function(results){return config.locations=results[0].data.results,config.services=results[1].data,config.providers=results[2],config}))}}]),(Bahmni=Bahmni||{}).Appointments=Bahmni.Appointments||{},Bahmni.Appointments.Constants=function(){var hostURL=Bahmni.Common.Constants.hostURL+Bahmni.Common.Constants.RESTWS_V1;return{createServiceUrl:hostURL+"/appointmentService",getServiceLoad:hostURL+"/appointmentService/load",getAllSpecialitiesUrl:hostURL+"/speciality/all",createAppointmentUrl:hostURL+"/appointment",getAppointmentsForServiceTypeUrl:hostURL+"/appointment/futureAppointmentsForServiceType/",changeAppointmentStatusUrl:hostURL+"/appointment/{{appointmentUuid}}/changeStatus",undoCheckInUrl:hostURL+"/appointment/undoStatusChange/",getAppointmentByUuid:hostURL+"/appointment/",getAllAppointmentsUrl:hostURL+"/appointment/all",searchAppointmentUrl:hostURL+"/appointment/search",getAppointmentsSummaryUrl:hostURL+"/appointment/appointmentSummary",defaultServiceTypeDuration:15,defaultCalendarSlotLabelInterval:"01:00",defaultCalendarSlotDuration:"00:30",defaultCalendarStartTime:"08:00",defaultCalendarEndTime:"19:00",minDurationForAppointment:30,appointmentStatusList:["Scheduled","CheckedIn","Completed","Cancelled","Missed"],regexForTime:/^(?:(?:1[0-2]|0?[1-9]):[0-5]\d\s*[AaPp][Mm])?$/,privilegeManageAppointments:"app:appointments:manageAppointmentsTab",privilegeForAdmin:"app:appointments:adminTab",availableForAppointments:"Available for appointments"}}(),Bahmni.Appointments.Appointment=function(){var Appointment=function(appointmentDetails){angular.extend(this,appointmentDetails)};return Appointment.create=function(appointmentDetails){var dateUtil=Bahmni.Common.Util.DateUtil,getDateTime=function(appointmentDate,givenTime){if(!appointmentDate&&!givenTime)return appointmentDate;var formattedTime=moment(givenTime,["hh:mm a"]).format("HH:mm");return dateUtil.parseServerDateToDate(dateUtil.getDateWithoutTime(appointmentDate)+" "+formattedTime)};return new Appointment({uuid:appointmentDetails.uuid,patientUuid:appointmentDetails.patient.uuid,serviceUuid:appointmentDetails.service.uuid,serviceTypeUuid:appointmentDetails.serviceType&&appointmentDetails.serviceType.uuid,startDateTime:getDateTime(appointmentDetails.date,appointmentDetails.startTime),endDateTime:getDateTime(appointmentDetails.date,appointmentDetails.endTime),providerUuid:appointmentDetails.provider&&appointmentDetails.provider.uuid,locationUuid:appointmentDetails.location&&appointmentDetails.location.uuid,appointmentKind:appointmentDetails.appointmentKind,comments:appointmentDetails.comments})},Appointment}(),Bahmni.Appointments.AppointmentService=function(){var Service=function(serviceDetails){angular.extend(this,serviceDetails)};return Service.createFromUIObject=function(serviceDetails){var availabilities,dateUtil=Bahmni.Common.Util.DateUtil,getTime=function(dateTime){return dateTime?dateUtil.getDateTimeInSpecifiedFormat(dateTime,"HH:mm:ss"):void 0},constructAvailabilityPerDay=function(result,availability){var selectedDays=availability.days.filter(function(day){return day.isSelected||day.uuid});return result=result.concat(selectedDays.map(function(day){return{dayOfWeek:day.dayOfWeek,uuid:day.uuid,startTime:getTime(availability.startTime),endTime:getTime(availability.endTime),maxAppointmentsLimit:availability.maxAppointmentsLimit,voided:!day.isSelected}}))};return new Service({name:serviceDetails.name,uuid:serviceDetails.uuid,description:serviceDetails.description,durationMins:serviceDetails.durationMins,maxAppointmentsLimit:serviceDetails.maxAppointmentsLimit,color:serviceDetails.color,startTime:getTime(serviceDetails.startTime),endTime:getTime(serviceDetails.endTime),specialityUuid:serviceDetails.specialityUuid,locationUuid:serviceDetails.locationUuid,weeklyAvailability:(availabilities=serviceDetails.weeklyAvailability,availabilities?availabilities.reduce(constructAvailabilityPerDay,[]):[]),serviceTypes:serviceDetails.serviceTypes||[]})},Service}(),Bahmni.Appointments.AppointmentServiceViewModel=function(){var Service=function(serviceDetails){angular.extend(this,serviceDetails)},constDays=[{dayOfWeek:"SUNDAY",isSelected:!1},{dayOfWeek:"MONDAY",isSelected:!1},{dayOfWeek:"TUESDAY",isSelected:!1},{dayOfWeek:"WEDNESDAY",isSelected:!1},{dayOfWeek:"THURSDAY",isSelected:!1},{dayOfWeek:"FRIDAY",isSelected:!1},{dayOfWeek:"SATURDAY",isSelected:!1}];return Service.createFromResponse=function(serviceDetails){var avbsByDay,groupedAvbs,getDateTime=function(time){return time?new Date("January 01, 1970 "+time):void 0};return new Service({name:serviceDetails.name,uuid:serviceDetails.uuid,description:serviceDetails.description,durationMins:serviceDetails.durationMins,maxAppointmentsLimit:serviceDetails.maxAppointmentsLimit,color:serviceDetails.color,startTime:getDateTime(serviceDetails.startTime),endTime:getDateTime(serviceDetails.endTime),specialityUuid:serviceDetails.speciality?serviceDetails.speciality.uuid:void 0,locationUuid:serviceDetails.location?serviceDetails.location.uuid:void 0,weeklyAvailability:(avbsByDay=serviceDetails.weeklyAvailability,groupedAvbs=_.groupBy(avbsByDay,function(avb){return avb.startTime+"#"+avb.endTime+"#"+avb.maxAppointmentsLimit}),Object.keys(groupedAvbs).map(function(key){var result={};result.startTime=getDateTime(groupedAvbs[key][0].startTime),result.endTime=getDateTime(groupedAvbs[key][0].endTime),result.maxAppointmentsLimit=groupedAvbs[key][0].maxAppointmentsLimit;var selectedDays=groupedAvbs[key],days=angular.copy(constDays);return selectedDays.map(function(day){var d=_.find(days,{dayOfWeek:day.dayOfWeek});d.uuid=day.uuid,d.isSelected=!0}),result.days=days,result})||[]),serviceTypes:serviceDetails.serviceTypes||[]})},Service}(),Bahmni.Appointments.AppointmentViewModel=function(){var Appointment=function(appointmentDetails){angular.extend(this,appointmentDetails)};return Appointment.create=function(appointmentDetails,config){var dateTime,patientInfo,patient,getTimeWithoutDate=function(dateTime){return dateTime?moment(dateTime).format("hh:mm a"):void 0};return new Appointment({uuid:appointmentDetails.uuid,patient:appointmentDetails.patient&&(patientInfo=appointmentDetails.patient,patient={},patient.label=patientInfo.name+" ("+patientInfo.identifier+")",patient.uuid=patientInfo.uuid,patient),speciality:appointmentDetails.service&&function(selectedSpeciality,config){var specialities=config.specialities;return _.find(specialities,function(speciality){return selectedSpeciality.uuid===speciality.uuid})}(appointmentDetails.service.speciality,config),service:appointmentDetails.service&&function(selectedService,config){var services=config.services;return _.find(services,function(service){return selectedService.uuid===service.uuid})}(appointmentDetails.service,config),serviceType:appointmentDetails.serviceType&&function(selectedServiceType,config){var serviceTypes=config.selectedService.serviceTypes;return _.find(serviceTypes,function(serviceType){return serviceType.uuid===selectedServiceType.uuid})}(appointmentDetails.serviceType,config),provider:appointmentDetails.provider&&function(selectedProvider,config){var providers=config.providers;return _.find(providers,function(provider){return selectedProvider.uuid===provider.uuid})}(appointmentDetails.provider,config),location:appointmentDetails.location&&function(selectedLoc,config){var locations=config.locations;return _.find(locations,function(location){return location.uuid===selectedLoc.uuid})}(appointmentDetails.location,config),date:(dateTime=appointmentDetails.startDateTime,dateTime?new Date(moment(dateTime)):void 0),startTime:getTimeWithoutDate(appointmentDetails.startDateTime),endTime:getTimeWithoutDate(appointmentDetails.endDateTime),appointmentKind:appointmentDetails.appointmentKind,status:appointmentDetails.status,comments:appointmentDetails.comments})},Appointment}(),angular.module("bahmni.appointments").directive("timeValidator",function(){var DateUtil=Bahmni.Common.Util.DateUtil,isStartTimeBeforeEndTime=function(model){if(!model.startTime||!model.endTime)return!0;return DateUtil.getDateTimeInSpecifiedFormat(model.startTime,"THH:mm:ss")<DateUtil.getDateTimeInSpecifiedFormat(model.endTime,"THH:mm:ss")};return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){function validate(){ctrl.$setValidity("timeSequence",isStartTimeBeforeEndTime(ctrl.$viewValue))}scope.$watch(attrs.ngModel+".startTime",validate),scope.$watch(attrs.ngModel+".endTime",validate)}}}),angular.module("bahmni.appointments").directive("dayCalendar",[function(){return{restrict:"E",controller:"AppointmentsDayCalendarController",scope:{appointments:"=",date:"="},templateUrl:"../appointments/views/manage/calendar/dayCalendar.html"}}]),angular.module("bahmni.appointments").directive("weekdaySelector",function(){var constDays=[{dayOfWeek:"SUNDAY",isSelected:!1},{dayOfWeek:"MONDAY",isSelected:!1},{dayOfWeek:"TUESDAY",isSelected:!1},{dayOfWeek:"WEDNESDAY",isSelected:!1},{dayOfWeek:"THURSDAY",isSelected:!1},{dayOfWeek:"FRIDAY",isSelected:!1},{dayOfWeek:"SATURDAY",isSelected:!1}];return{restrict:"AE",scope:{ngModel:"=?",ngChange:"&",weekStartsIndex:"=",ngDisabled:"=?"},link:function(scope){var initDays=function(){scope.ngModel=scope.ngModel||angular.copy(scope.constDays)};scope.onDayClicked=function(dayIndex){initDays(),scope.ngDisabled||(scope.ngModel[dayIndex].isSelected=!scope.ngModel[dayIndex].isSelected,scope.ngChange&&scope.ngChange({newValue:{index:dayIndex,item:scope.ngModel[dayIndex]}}))},scope.constDays=constDays,scope.weekStartsIndex=scope.weekStartsIndex||1,initDays()},template:"<p class='service-ava-days' ng-class='{\"disabled\": ngDisabled===true}'><span id='day-0' ng-class='{\"is-selected\": ngModel[(0 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((0 + weekStartsIndex -1)%7)'>{{constDays[(0 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-1' ng-class='{\"is-selected\": ngModel[(1 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((1 + weekStartsIndex -1)%7)'>{{constDays[(1 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-2' ng-class='{\"is-selected\": ngModel[(2 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((2 + weekStartsIndex -1)%7)'>{{constDays[(2 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-3' ng-class='{\"is-selected\": ngModel[(3 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((3 + weekStartsIndex -1)%7)'>{{constDays[(3 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-4' ng-class='{\"is-selected\": ngModel[(4 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((4 + weekStartsIndex -1)%7)'>{{constDays[(4 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-5' ng-class='{\"is-selected\": ngModel[(5 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((5 + weekStartsIndex -1)%7)'>{{constDays[(5 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span><span id='day-6' ng-class='{\"is-selected\": ngModel[(6 + weekStartsIndex -1)%7].isSelected}' ng-click='onDayClicked((6 + weekStartsIndex -1)%7)'>{{constDays[(6 + weekStartsIndex -1)%7].dayOfWeek | translate}}</span></p>"}}),angular.module("bahmni.appointments").directive("serviceAvailability",["appService","confirmBox",function(appService,confirmBox){var states_NEW=0,states_EDIT=1,states_READONLY=2,constDays=[{dayOfWeek:"SUNDAY",isSelected:!1},{dayOfWeek:"MONDAY",isSelected:!1},{dayOfWeek:"TUESDAY",isSelected:!1},{dayOfWeek:"WEDNESDAY",isSelected:!1},{dayOfWeek:"THURSDAY",isSelected:!1},{dayOfWeek:"FRIDAY",isSelected:!1},{dayOfWeek:"SATURDAY",isSelected:!1}];return{restrict:"AE",scope:{availability:"=?",availabilityList:"=",state:"=",disableMaxLoad:"="},link:function(scope){scope.add=function(){addOrUpdateToIndex(scope.availabilityList.length)&&(scope.availability={days:angular.copy(constDays)})},scope.clearValueIfInvalid=function(){scope.availability.maxAppointmentsLimit<0&&(scope.availability.maxAppointmentsLimit="")},scope.update=function(){var index=scope.availabilityList.indexOf(scope.backUpAvailability);addOrUpdateToIndex(index)&&(scope.state=states_READONLY)};var addOrUpdateToIndex=function(index){return scope.doesOverlap=overlapsWithExisting(index),scope.doesOverlap||(scope.availabilityList[index]=scope.availability),!scope.doesOverlap};scope.isValid=function(){var startTime=scope.availability.startTime,endTime=scope.availability.endTime;return startTime&&endTime&&startTime<endTime&&convertDaysToBinary(scope.availability.days)};var overlapsWithExisting=function(index){var avb=scope.availability;return!_.isEmpty(scope.availabilityList)&&_.some(scope.availabilityList,function(currAvb,currIndex){if(index!==currIndex)return hasCommonDays(avb,currAvb)&&hasOverlappingTimes(avb,currAvb)})},convertDaysToBinary=function(days){return parseInt(days.map(function(day){return day.isSelected?1:0}).reverse().join(""),2)},hasCommonDays=function(avb1,avb2){return 0!=(convertDaysToBinary(avb1.days)&convertDaysToBinary(avb2.days))},hasOverlappingTimes=function(avb1,avb2){return avb1.startTime<avb2.endTime&&avb2.startTime<avb1.endTime};scope.confirmDelete=function(){var childScope={message:"CONFIRM_DELETE_AVAILABILITY"};childScope.ok=deleteAvailability,childScope.cancel=cancelDelete,confirmBox({scope:childScope,actions:[{name:"cancel",display:"CANCEL_KEY"},{name:"ok",display:"OK_KEY"}],className:"ngdialog-theme-default delete-program-popup"})};var deleteAvailability=function(closeDialog){var index=scope.availabilityList.indexOf(scope.availability);scope.availabilityList.splice(index,1),closeDialog()},cancelDelete=function(closeDialog){closeDialog()};scope.cancel=function(){scope.availability=scope.backUpAvailability,scope.doesOverlap=!1,scope.state=states_READONLY},scope.enableEdit=function(){scope.backUpAvailability=scope.availability,scope.availability=angular.copy(scope.availability),scope.state=states_EDIT},scope.isNew=function(){return scope.state===states_NEW},scope.isEdit=function(){return scope.state===states_EDIT},scope.isReadOnly=function(){return scope.state===states_READONLY},scope.availability=scope.availability||{},scope.startOfWeek=appService.getAppDescriptor().getConfigValue("startOfWeek")||2},templateUrl:"../appointments/views/admin/appointmentServiceAvailability.html"}}]),angular.module("bahmni.appointments").directive("serviceTypes",["ngDialog","messagingService","appointmentsService",function(ngDialog,messagingService,appointmentsService){return{restrict:"E",scope:{service:"="},templateUrl:"../appointments/views/admin/serviceTypes.html",controller:function($scope){$scope.serviceType={},$scope.updateServiceTypeDuration=function(){_.isEmpty($scope.serviceType.name)?($scope.serviceType.duration=void 0,$scope.serviceTypesForm.serviceTypeName.$setValidity("uniqueServiceTypeName",!0)):$scope.serviceType.duration=$scope.serviceType.duration||Bahmni.Appointments.Constants.defaultServiceTypeDuration};$scope.addServiceType=function(serviceType){!function(serviceType){var nonVoidedServiceTypes=_.filter($scope.service.serviceTypes,function(serviceType){return!serviceType.voided});return!_.find(nonVoidedServiceTypes,serviceType)}(serviceType)?$scope.serviceTypesForm.serviceTypeName.$setValidity("uniqueServiceTypeName",!1):($scope.service.serviceTypes.push({name:serviceType.name,duration:serviceType.duration?serviceType.duration:0}),$scope.serviceType={name:void 0,duration:void 0},$scope.serviceTypesForm.serviceTypeName.$setValidity("uniqueServiceTypeName",!0))};var openConfirmationDialog=function(serviceType){ngDialog.openConfirm({template:"views/admin/serviceTypeDeleteConfirmation.html",scope:$scope,data:{serviceType:serviceType},closeByEscape:!0})};$scope.deleteServiceType=function(serviceType){_.isEmpty(serviceType.uuid)?openConfirmationDialog(serviceType):appointmentsService.getAppointmentsForServiceType(serviceType.uuid).then(function(response){response.data.length?messagingService.showMessage("error","APPOINTMENT_SERVICE_TYPE_DELETE_CONFIRMATION_DIALOG_MESSAGE_KEY"):openConfirmationDialog(serviceType)})},$scope.deleteServiceTypeOnConfirmation=function(serviceType){_.isEmpty(serviceType.uuid)?_.remove($scope.service.serviceTypes,serviceType):serviceType.voided=!0,ngDialog.close()},$scope.cancelTransition=function(){ngDialog.close()}}}}]),angular.module("bahmni.appointments").directive("colorPicker",["$document",function($document){return{restrict:"E",scope:{colors:"=",selectedColor:"="},templateUrl:"../appointments/views/admin/colorPicker.html",link:function(scope){scope.showTheColorPicker=function(event){scope.showColorPicker=!scope.showColorPicker,event.stopPropagation()},scope.setColor=function(color,event){scope.selectedColor=color,scope.showColorPicker=!1,event.stopPropagation()},$document.bind("click",function(ev){scope.showColorPicker=!1,scope.$digest()})}}}]),angular.module("bahmni.appointments").directive("datePicker",function(){return{restrict:"E",scope:{viewDate:"=",onChange:"=",lastValidDate:"="},templateUrl:"../appointments/views/manage/datePicker.html",controller:function($scope){var dateUtil=Bahmni.Common.Util.DateUtil,viewDateChange=function(){(!$scope.lastValidDate||$scope.lastValidDate&&$scope.viewDate&&$scope.lastValidDate.getTime()!==$scope.viewDate.getTime())&&($scope.lastValidDate=$scope.viewDate,$scope.onChange($scope.viewDate))};$scope.goToPrevious=function(){$scope.viewDate=$scope.viewDate&&dateUtil.subtractDays($scope.viewDate,1),viewDateChange()},$scope.goToCurrent=function(){$scope.viewDate=moment().startOf("day").toDate(),viewDateChange()},$scope.goToNext=function(){$scope.viewDate=$scope.viewDate&&dateUtil.addDays($scope.viewDate,1),viewDateChange()},$scope.keydownEvent=function(){var keyCode;event&&(keyCode=event.keyCode?event.keyCode:event.which),!keyCode||46!==keyCode&&8!==keyCode?keyCode&&13===keyCode&&viewDateChange():event.preventDefault()},$scope.dateChanged=function(){viewDateChange()},$scope.viewDate||$scope.goToCurrent(),viewDateChange()}}}),angular.module("bahmni.appointments").directive("weekPicker",function(){return{restrict:"E",scope:{viewDate:"=",onChange:"=",weekStart:"=?"},templateUrl:"../appointments/views/manage/weekPicker.html",controller:function($scope){var dateUtil=Bahmni.Common.Util.DateUtil;$scope.goToPreviousWeek=function(){$scope.viewDate=$scope.viewDate&&dateUtil.subtractDays($scope.viewDate,7)},$scope.setViewDateToToday=function(){$scope.viewDate=moment().startOf("day").toDate()},$scope.goToNextWeek=function(){$scope.viewDate=$scope.viewDate&&dateUtil.addDays($scope.viewDate,7)};$scope.$watch("viewDate",function(viewDate){var date,weekStartDayStandard;date=viewDate,weekStartDayStandard=$scope.weekStart?$scope.weekStart:"isoWeek",$scope.weekStartDate=moment(date).startOf(weekStartDayStandard).toDate(),function(date){var weekStartDayStandard=$scope.weekStart?$scope.weekStart:"isoWeek";$scope.weekEndDate=moment(date).endOf(weekStartDayStandard).toDate()}(viewDate),$scope.onChange($scope.weekStartDate,$scope.weekEndDate)}),$scope.viewDate||$scope.setViewDateToToday()}}}),angular.module("bahmni.appointments").directive("multiSelectAutocomplete",[function(){return{restrict:"E",link:function($scope,element){$scope.focusOnTheTest=function(){$("input.input")[0].focus(),$scope.selectedValues=$scope.selectedValues||[]},$scope.addItem=function(item){item[item.name]=!0,$scope.selectedValues=_.union($scope.selectedValues,item,$scope.keyProperty)},$scope.removeItem=function(item){$scope.selectedValues=_.filter($scope.selectedValues,function(value){return value[$scope.keyProperty]!==item[$scope.keyProperty]})},$scope.search=function(query){var matchingAnswers=[],unselectedValues=_.xorBy($scope.inputItems,$scope.selectedValues,$scope.keyProperty);return _.forEach(unselectedValues,function(answer){"object"!=typeof answer.name&&-1!==answer.name.toLowerCase().indexOf(query.toLowerCase())&&matchingAnswers.push(answer)}),_.uniqBy(matchingAnswers,$scope.keyProperty)}},scope:{inputItems:"=",selectedValues:"=",displayProperty:"=",keyProperty:"=",placeholder:"=",loadOnDownArrow:"=",autoCompleteMinLength:"="},templateUrl:"../appointments/views/manage/multiSelectAutocomplete.html"}}]),angular.module("bahmni.appointments").directive("patientSearch",["patientService","appointmentsService","spinner","$state",function(patientService,appointmentsService,spinner,$state){return{restrict:"E",scope:{onSearch:"="},templateUrl:"../appointments/views/manage/patientSearch.html",link:{pre:function($scope){$scope.search=function(){return spinner.forPromise(patientService.search($scope.patient).then(function(response){return response.data.pageOfResults}))},$scope.responseMap=function(data){return _.map(data,function(patientInfo){return patientInfo.label=patientInfo.givenName+" "+patientInfo.familyName+" ("+patientInfo.identifier+")",patientInfo})},$scope.onSelectPatient=function(data){$state.params.patient=data,spinner.forPromise(appointmentsService.search({patientUuid:data.uuid}).then(function(oldAppointments){var appointmentInDESCOrderBasedOnStartDateTime=_.sortBy(oldAppointments.data,"startDateTime").reverse();$scope.onSearch(appointmentInDESCOrderBasedOnStartDateTime)}))},$state.params.isSearchEnabled&&$state.params.patient&&($scope.patient=$scope.responseMap([$state.params.patient])[0].label,$scope.onSelectPatient($state.params.patient)),$scope.$watch(function(){return $state.params.isSearchEnabled},function(isSearchEnabled){0==isSearchEnabled&&($scope.patient=null)},!0)}}}}]),angular.module("bahmni.appointments").service("appointmentsServiceService",["$http",function($http){this.save=function(service){return $http.post(Bahmni.Appointments.Constants.createServiceUrl,service,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAllServices=function(){return $http.get(Bahmni.Common.Constants.appointmentServiceUrl+"/all/default",{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAllServicesWithServiceTypes=function(){return $http.get(Bahmni.Common.Constants.appointmentServiceUrl+"/all/full",{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getServiceLoad=function(serviceUuid,startDateTime,endDateTime){var params={uuid:serviceUuid,startDateTime:startDateTime,endDateTime:endDateTime};return $http.get(Bahmni.Appointments.Constants.getServiceLoad,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getService=function(uuid){return $http.get(Bahmni.Common.Constants.appointmentServiceUrl+"?uuid="+uuid,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.deleteAppointmentService=function(serviceUuid){var params={uuid:serviceUuid};return $http.delete(Bahmni.Common.Constants.appointmentServiceUrl,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})}}]),angular.module("bahmni.appointments").service("specialityService",["$http",function($http){this.getAllSpecialities=function(){return $http.get(Bahmni.Appointments.Constants.getAllSpecialitiesUrl,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})}}]),angular.module("bahmni.appointments").service("appointmentsService",["$http","appService",function($http,appService){this.save=function(appointment){return $http.post(Bahmni.Appointments.Constants.createAppointmentUrl,appointment,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.search=function(appointment){return $http.post(Bahmni.Appointments.Constants.searchAppointmentUrl,appointment,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAppointmentsForServiceType=function(serviceTypeUuid){var params={appointmentServiceTypeUuid:serviceTypeUuid};return $http.get(Bahmni.Appointments.Constants.getAppointmentsForServiceTypeUrl,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAllAppointments=function(params){return $http.get(Bahmni.Appointments.Constants.getAllAppointmentsUrl,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAppointmentByUuid=function(appointmentUuid){var params={uuid:appointmentUuid};return $http.get(Bahmni.Appointments.Constants.getAppointmentByUuid,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.getAppointmentsSummary=function(params){return $http.get(Bahmni.Appointments.Constants.getAppointmentsSummaryUrl,{params:params,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.changeStatus=function(appointmentUuid,toStatus,onDate){var params={toStatus:toStatus,onDate:onDate},changeStatusUrl=appService.getAppDescriptor().formatUrl(Bahmni.Appointments.Constants.changeAppointmentStatusUrl,{appointmentUuid:appointmentUuid});return $http.post(changeStatusUrl,params,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},this.undoCheckIn=function(appointmentUuid){return $http.post(Bahmni.Appointments.Constants.undoCheckInUrl+appointmentUuid,{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})}}]),angular.module("bahmni.appointments").service("calendarViewPopUp",["$rootScope","ngDialog","$state","$translate","appointmentsService","confirmBox","checkinPopUp","appService","messagingService",function($rootScope,ngDialog,$state,$translate,appointmentsService,confirmBox,checkinPopUp,appService,messagingService){return function(config){var dialog,popUpScope=$rootScope.$new(),scope=config.scope;scope.patientList=scope.appointments.map(function(appt){return appt.patient}),scope.patientAppointmentMap=scope.appointments.reduce(function(result,appt){return result[appt.patient.uuid]=appt,result},{}),popUpScope.scope=scope,popUpScope.patient=1===scope.patientList.length?scope.patientList[0]:void 0,popUpScope.manageAppointmentPrivilege=Bahmni.Appointments.Constants.privilegeManageAppointments,popUpScope.allowedActions=appService.getAppDescriptor().getConfigValue("allowedActions")||[],popUpScope.allowedActionsByStatus=appService.getAppDescriptor().getConfigValue("allowedActionsByStatus")||{},popUpScope.navigateTo=function(state,appointment){var params=$state.params;"edit"===state?(ngDialog.close(dialog.id,!1),params.uuid=appointment.uuid,$state.go("home.manage.appointments.calendar.edit",params,{reload:!1})):"new"===state?(ngDialog.close(dialog.id,!1),params.appointment={startDateTime:scope.appointments[0].startDateTime,endDateTime:scope.appointments[0].endDateTime,provider:scope.appointments[0].provider,appointmentKind:"Scheduled"},$state.go("home.manage.appointments.calendar.new",params,{reload:!1})):$state.go($state.current,$state.params,{reload:!0}),popUpScope.$destroy()};var closeConfirmBox=function(closeConfirmBox){closeConfirmBox()},changeStatus=function(appointment,toStatus,onDate,closeConfirmBox){var message=$translate.instant("APPOINTMENT_STATUS_CHANGE_SUCCESS_MESSAGE",{toStatus:toStatus});return appointmentsService.changeStatus(appointment.uuid,toStatus,onDate).then(function(){appointment.status=toStatus,closeConfirmBox(),messagingService.showMessage("info",message)})};popUpScope.checkinAppointment=function(patientAppointment){var scope=$rootScope.$new();scope.message=$translate.instant("APPOINTMENT_STATUS_CHANGE_CONFIRM_MESSAGE",{toStatus:"CheckedIn"}),scope.action=_.partial(changeStatus,patientAppointment,"CheckedIn",_),checkinPopUp({scope:scope,className:"ngdialog-theme-default app-dialog-container"})},popUpScope.confirmAction=function(appointment,toStatus){var scope={};scope.message=$translate.instant("APPOINTMENT_STATUS_CHANGE_CONFIRM_MESSAGE",{toStatus:toStatus}),scope.no=closeConfirmBox,scope.yes=_.partial(changeStatus,appointment,toStatus,void 0,_),confirmBox({scope:scope,actions:[{name:"yes",display:"YES_KEY"},{name:"no",display:"NO_KEY"}],className:"ngdialog-theme-default"})},popUpScope.isAllowedAction=function(action){return _.includes(popUpScope.allowedActions,action)},popUpScope.isValidAction=function(appointment,action){if(!appointment)return!1;var allowedActions=popUpScope.allowedActionsByStatus.hasOwnProperty(appointment.status)?popUpScope.allowedActionsByStatus[appointment.status]:[];return _.includes(allowedActions,action)},(dialog=ngDialog.open({template:"../appointments/views/manage/calendar/popUp.html",scope:popUpScope,className:config.className||"ngdialog-theme-default"})).closePromise.then(function(data){!1!==data.value&&popUpScope.navigateTo("calendar")})}}]),angular.module("bahmni.common.uiHelper").service("checkinPopUp",["$rootScope","ngDialog",function($rootScope,ngDialog){return function(config){var dialog,scope=config.scope;scope.time=moment().seconds(0).milliseconds(0).toDate(),scope.close=function(){ngDialog.close(dialog.id),scope.$destroy()},dialog=ngDialog.open({template:"../appointments/views/checkInPopUp.html",scope:scope,className:config.className||"ngdialog-theme-default"}),scope.performAction=function(close){scope.action(scope.time,close)}}}]),angular.module("bahmni.appointments").controller("deleteAppointmentServiceController",["$scope","appointmentsServiceService","messagingService","ngDialog","$state",function($scope,appointmentsServiceService,messagingService,ngDialog,$state){$scope.service=$scope.ngDialogData.service,$scope.deleteServiceConfirmation=function(){return appointmentsServiceService.deleteAppointmentService($scope.service.uuid).then(function(){messagingService.showMessage("info","{{'APPOINTMENT_SERVICE_DELETE_SUCCESS_MESSAGE_KEY' | translate}}"),ngDialog.close(),$state.reload()},function(){ngDialog.close()})},$scope.cancelDeleteService=function(){ngDialog.close()}}]),angular.module("bahmni.appointments").controller("AppointmentsHeaderController",["$scope","$state","appService",function($scope,$state,appService){var backLinks;return(backLinks=[{label:"Home",url:"../home/",accessKey:"h",icon:"fa-home"}]).push({text:"APPOINTMENTS_MANAGE",state:"home.manage",accessKey:"M"}),appService.getAppDescriptor().getExtensionById("bahmni.appointments.admin",!0)&&backLinks.push({text:"APPOINTMENTS_ADMIN",state:"home.admin.service",accessKey:"A",requiredPrivilege:Bahmni.Appointments.Constants.privilegeForAdmin}),void($state.get("home").data.backLinks=backLinks)}]),angular.module("bahmni.appointments").controller("AppointmentsManageController",["$scope","$state","appService",function($scope,$state,appService){$scope.enableCalendarView=appService.getAppDescriptor().getConfigValue("enableCalendarView"),$scope.navigateTo=function(viewName){var stateName="home.manage."+("appointments"===viewName?getAppointmentsTab():viewName);$state.go(stateName,$state.params,{reload:!1})};var getAppointmentsTab=function(){return"appointments."+($scope.enableCalendarView?"calendar":"list")};$scope.getCurrentTabName=function(){return $state.current.tabName}}]),angular.module("bahmni.appointments").controller("AllAppointmentServicesController",["$scope","$state","$location","spinner","appointmentsServiceService","appService","ngDialog",function($scope,$state,$location,spinner,appointmentsServiceService,appService,ngDialog){$scope.enableSpecialities=appService.getAppDescriptor().getConfigValue("enableSpecialities"),$scope.createService=function(){$state.go("home.admin.service.edit",{uuid:"new"})},$scope.editService=function(uuid){$state.go("home.admin.service.edit",{uuid:uuid})},$scope.deleteAppointmentService=function(service){ngDialog.open({template:"views/admin/deleteAppointmentService.html",className:"ngdialog-theme-default",data:{service:service},controller:"deleteAppointmentServiceController"})};return spinner.forPromise(appointmentsServiceService.getAllServices().then(function(response){$scope.appointmentServices=response.data}))}]),angular.module("bahmni.appointments").controller("AppointmentsCreateController",["$scope","$q","$window","$state","$translate","spinner","patientService","appointmentsService","appointmentsServiceService","messagingService","ngDialog","appService","$stateParams","appointmentCreateConfig","appointmentContext","$http","sessionService",function($scope,$q,$window,$state,$translate,spinner,patientService,appointmentsService,appointmentsServiceService,messagingService,ngDialog,appService,$stateParams,appointmentCreateConfig,appointmentContext,$http,sessionService){$scope.isFilterOpen=$stateParams.isFilterOpen,$scope.showConfirmationPopUp=!0,$scope.enableSpecialities=appService.getAppDescriptor().getConfigValue("enableSpecialities"),$scope.enableServiceTypes=appService.getAppDescriptor().getConfigValue("enableServiceTypes"),$scope.today=Bahmni.Common.Util.DateUtil.getDateWithoutTime(Bahmni.Common.Util.DateUtil.now()),$scope.timeRegex=Bahmni.Appointments.Constants.regexForTime,$scope.warning={},$scope.minDuration=Bahmni.Appointments.Constants.minDurationForAppointment,$scope.appointmentCreateConfig=appointmentCreateConfig,$scope.enableEditService=appService.getAppDescriptor().getConfigValue("isServiceOnAppointmentEditable"),$scope.showStartTimes=[],$scope.showEndTimes=[];var patientSearchURL=appService.getAppDescriptor().getConfigValue("patientSearchUrl"),loginLocationUuid=sessionService.getLoginLocationUuid();$scope.minCharLengthToTriggerPatientSearch=appService.getAppDescriptor().getConfigValue("minCharLengthToTriggerPatientSearch")||3,$scope.appointmentBlocks=appService.getAppDescriptor().getConfigValue("appointmentBlocks"),$scope.canSave=!0,$scope.invalidField=!1,$scope.setBlockTimes=function(){$scope.appointment.startTime=$scope.selectedAppointmentBlock.startTime,$scope.appointment.endTime=$scope.selectedAppointmentBlock.endTime,angular.element("#appointmentBlock").css("border","1px solid #DDD"),angular.element("#appointmentBlock").css("background","#fff"),angular.element("#appointmentBlock").css("outline","0"),$scope.canSave=!0};var checkInvalidFields=function(){$scope.patientIdValue=angular.element("#patientID")[0].value,$scope.serviceValue=angular.element("#service")[0].value,$scope.dateValue=angular.element("#date")[0].value,$scope.appointmentBlockValue=angular.element("#appointmentBlock")[0].value,void 0!==$scope.patientIdValue&&""!==$scope.patientIdValue||(angular.element("#patientID").css("border","1px solid red"),angular.element("#patientID").css("background","#ffcdcd"),angular.element("#patientID").css("outline","0"),$scope.canSave=!1),void 0!==$scope.serviceValue&&""!==$scope.serviceValue||(angular.element("#service").css("border","1px solid red"),angular.element("#service").css("background","#ffcdcd"),angular.element("#service").css("outline","0"),$scope.canSave=!1),($scope.createAppointmentForm.date.$invalid||$scope.dateValue<$scope.today)&&(angular.element("#date").css("border","1px solid red"),angular.element("#date").css("background","#ffcdcd"),angular.element("#date").css("outline","0"),$scope.canSave=!1),void 0!==$scope.appointmentBlockValue&&""!==$scope.appointmentBlockValue||(angular.element("#appointmentBlock").css("border","1px solid red"),angular.element("#appointmentBlock").css("background","#ffcdcd"),angular.element("#appointmentBlock").css("outline","0"),$scope.canSave=!1)};$scope.save=function(){var message;if(checkInvalidFields(),$scope.createAppointmentForm.$invalid?message=$scope.createAppointmentForm.$error.pattern?"INVALID_TIME_ERROR_MESSAGE":"INVALID_SERVICE_FORM_ERROR_MESSAGE":moment($scope.appointment.startTime,"hh:mm a").isBefore(moment($scope.appointment.endTime,"hh:mm a"),"minutes")?$scope.invalidChosenDate&&(message="APPOINTMENT_INVALID_DATE"):message="TIME_SEQUENCE_ERROR_MESSAGE",message)messagingService.showMessage("error",message);else{$scope.validatedAppointment=Bahmni.Appointments.Appointment.create($scope.appointment),$scope.conflictingAppointments=$scope.patientAppointments,$scope.conflictingAppointmentsArray=[];for(var dia=dateUtil.getDateWithoutTime($scope.appointment.date),i=0;i<=$scope.conflictingAppointments.length;i++)void 0==$scope.conflictingAppointments[i]||dateUtil.getDateWithoutTime($scope.conflictingAppointments[i].startDateTime)==dia&&$scope.conflictingAppointmentsArray.push($scope.conflictingAppointments[i].service.uuid);0===$scope.conflictingAppointmentsArray.length||!1===$scope.conflictingAppointmentsArray.includes($scope.validatedAppointment.serviceUuid)?saveAppointment($scope.validatedAppointment):0!==$scope.conflictingAppointmentsArray.length&&!0===$scope.conflictingAppointmentsArray.includes($scope.validatedAppointment.serviceUuid)?($scope.allow=!0,$scope.displayConflictConfirmationDialog()):$scope.displayConflictConfirmationDialog()}},$scope.saveContinue=function(){var message;if(checkInvalidFields(),$scope.createAppointmentForm.$invalid?message=$scope.createAppointmentForm.$error.pattern?"INVALID_TIME_ERROR_MESSAGE":"INVALID_SERVICE_FORM_ERROR_MESSAGE":moment($scope.appointment.startTime,"hh:mm a").isBefore(moment($scope.appointment.endTime,"hh:mm a"),"minutes")?$scope.invalidChosenDate&&(message="APPOINTMENT_INVALID_DATE"):message="TIME_SEQUENCE_ERROR_MESSAGE",message)messagingService.showMessage("error",message);else{$scope.validatedAppointment=Bahmni.Appointments.Appointment.create($scope.appointment),$scope.conflictingAppointments=$scope.patientAppointments,$scope.conflictingAppointmentsArray=[];for(var dia=dateUtil.getDateWithoutTime($scope.appointment.date),i=0;i<=$scope.conflictingAppointments.length;i++)void 0==$scope.conflictingAppointments[i]||dateUtil.getDateWithoutTime($scope.conflictingAppointments[i].startDateTime)==dia&&$scope.conflictingAppointmentsArray.push($scope.conflictingAppointments[i].service.uuid);0===$scope.conflictingAppointmentsArray.length||!1===$scope.conflictingAppointmentsArray.includes($scope.validatedAppointment.serviceUuid)?saveAppointmentContinue($scope.validatedAppointment):0!==$scope.conflictingAppointmentsArray.length&&!0===$scope.conflictingAppointmentsArray.includes($scope.validatedAppointment.serviceUuid)?($scope.allow=!0,$scope.displayConflictConfirmationDialog()):$scope.displayConflictConfirmationDialog()}},$scope.search=function(){var formattedUrl;if(patientSearchURL&&!_.isEmpty(patientSearchURL)){var params={loginLocationUuid:loginLocationUuid,searchValue:$scope.appointment.patient.label};formattedUrl=appService.getAppDescriptor().formatUrl(patientSearchURL,params)}return spinner.forPromise(formattedUrl?$http.get(Bahmni.Common.Constants.RESTWS_V1+formattedUrl):patientService.statusBasedSearch($scope.appointment.patient.label)).then(function(response){return response.data.pageOfResults})},$scope.timeSource=function(){return $q(function(resolve){resolve($scope.showStartTimes)})},$scope.endTimeSlots=function(){return $q(function(resolve){resolve($scope.showEndTimes)})},$scope.onSelectPatient=function(data){return data&&(angular.element("#patientID").css("border","1px solid #DDD"),angular.element("#patientID").css("background","#fff"),angular.element("#patientID").css("outline","0"),$scope.canSave=!0),$scope.appointment.patient=data,spinner.forPromise(appointmentsService.search({patientUuid:data.uuid}).then(function(oldAppointments){$scope.patientAppointments=oldAppointments.data}))},$scope.onDateChange=function(){$scope.dateValue=angular.element("#date")[0].value,$scope.dateValue>=$scope.today?(angular.element("#date").css("border","1px solid #DDD"),angular.element("#date").css("background","#fff"),angular.element("#date").css("outline","0"),$scope.canSave=!0):(angular.element("#date").css("border","1px solid red"),angular.element("#date").css("background","#ffcdcd"),angular.element("#date").css("outline","0"),$scope.canSave=!1)};var clearSlotsInfo=function(){delete $scope.currentLoad,delete $scope.maxAppointmentsLimit},dateUtil=Bahmni.Common.Util.DateUtil,calculateMaxLoadFromDuration=function(avb){if(avb.durationMins&&avb.startTime&&avb.endTime){var startTime=moment(avb.startTime,["hh:mm a"]),endTime=moment(avb.endTime,["hh:mm a"]);return Math.round(dateUtil.diffInMinutes(startTime,endTime)/avb.durationMins)}},getDateTime=function(date,time){var formattedTime=moment(time,["hh:mm a"]).format("HH:mm");return dateUtil.parseServerDateToDate(dateUtil.getDateWithoutTime(date)+" "+formattedTime)},isAppointmentTimeWithinServiceAvailability=function(appointmentTime){return $scope.weeklyAvailabilityOnSelectedDate&&$scope.weeklyAvailabilityOnSelectedDate.length?_.find($scope.weeklyAvailabilityOnSelectedDate,function(availability){return!(moment(appointmentTime,"hh:mm a").isBefore(moment(availability.startTime,"hh:mm a"))||moment(availability.endTime,"hh:mm a").isBefore(moment(appointmentTime,"hh:mm a")))}):!$scope.allowedStartTime&&!$scope.allowedEndTime||!(moment(appointmentTime,"hh:mm a").isBefore(moment($scope.allowedStartTime,"hh:mm a"))||moment($scope.allowedEndTime,"hh:mm a").isBefore(moment(appointmentTime,"hh:mm a")))},filterTimingsBasedOnInput=function(enteredNumber,allowedList){var showTimes=[];return _.each(allowedList,function(time){(time.startsWith(enteredNumber)||1===time.indexOf(enteredNumber)&&0===time.indexOf(0))&&showTimes.push(time)}),0===showTimes.length?allowedList:showTimes};$scope.onKeyDownOnStartTime=function(){$scope.showStartTimes=filterTimingsBasedOnInput($scope.appointment.startTime,$scope.startTimes)},$scope.onKeyDownOnEndTime=function(){$scope.showEndTimes=filterTimingsBasedOnInput($scope.appointment.endTime,$scope.endTimes)},$scope.onSelectStartTime=function(data){$scope.warning.startTime=!isAppointmentTimeWithinServiceAvailability($scope.appointment.startTime),moment($scope.appointment.startTime,"hh:mm a",!0).isValid()&&($scope.appointment.endTime=moment($scope.appointment.startTime,"hh:mm a").add($scope.minDuration,"m").format("hh:mm a"),$scope.onSelectEndTime())};var isSelectedSlotOutOfRange=function(){return!(!$scope.appointment.startTime||$scope.warning.appointmentDate||$scope.warning.startTime||$scope.warning.endTime)&&(appointmentStartTime=$scope.appointment.startTime,appointmentEndTime=$scope.appointment.endTime,!(!$scope.weeklyAvailabilityOnSelectedDate||!$scope.weeklyAvailabilityOnSelectedDate.length||_.find($scope.weeklyAvailabilityOnSelectedDate,function(availability){return moment(availability.startTime,"hh:mm a")<=moment(appointmentStartTime,"hh:mm a")&&moment(appointmentEndTime,"hh:mm a")<=moment(availability.endTime,"hh:mm a")})));var appointmentStartTime,appointmentEndTime};$scope.onSelectEndTime=function(data){$scope.warning.endTime=!1,$scope.checkAvailability(),$scope.warning.endTime=!isAppointmentTimeWithinServiceAvailability($scope.appointment.endTime),$scope.warning.outOfRange=isSelectedSlotOutOfRange()};var triggerSlotCalculation=function(){$scope.appointment&&$scope.appointment.service&&$scope.appointment.date&&$scope.appointment.startTime&&$scope.appointment.endTime&&_.isEmpty($scope.selectedService.serviceTypes)&&function(){var startDateTime,endDateTime,availabilityObject,daysOfWeek=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],selectedService=$scope.selectedService,appointment=$scope.appointment;if(clearSlotsInfo(),_.isEmpty(selectedService.weeklyAvailability))moment(selectedService.startTime||"00:00","hh:mm a")<=moment(appointment.startTime,"hh:mm a")&&moment(appointment.endTime,"hh:mm a")<=moment(selectedService.endTime||"23:59","hh:mm a")&&(availabilityObject=selectedService);else{var availability=_.find(selectedService.weeklyAvailability,function(avb){return daysOfWeek[appointment.date.getDay()]===avb.dayOfWeek&&moment(avb.startTime,"hh:mm a")<=moment(appointment.startTime,"hh:mm a")&&moment(appointment.endTime,"hh:mm a")<=moment(avb.endTime,"hh:mm a")});availability&&((availabilityObject=availability).durationMins=selectedService.durationMins||$scope.minDuration)}availabilityObject&&($scope.maxAppointmentsLimit=availabilityObject.maxAppointmentsLimit||calculateMaxLoadFromDuration(availabilityObject),startDateTime=getDateTime(appointment.date,availabilityObject.startTime||"00:00"),endDateTime=getDateTime(appointment.date,availabilityObject.endTime||"23:59"),appointmentsServiceService.getServiceLoad(selectedService.uuid,startDateTime,endDateTime).then(function(response){$scope.currentLoad=response.data}))}()};$scope.responseMap=function(data){return _.map(data,function(patientInfo){return patientInfo.label=patientInfo.givenName+(patientInfo.familyName?" "+patientInfo.familyName:"")+" ("+patientInfo.identifier+")",patientInfo})};var clearAvailabilityInfo=function(){$scope.warning.appointmentDate=!1,$scope.warning.startTime=!1,$scope.warning.endTime=!1,$scope.warning.outOfRange=!1,clearSlotsInfo()};$scope.onSpecialityChange=function(){$scope.appointment.specialityUuid||delete $scope.appointment.specialityUuid,delete $scope.selectedService,delete $scope.appointment.service,delete $scope.appointment.serviceType,delete $scope.appointment.location,clearAvailabilityInfo()},$scope.onServiceChange=function(){clearAvailabilityInfo(),delete $scope.weeklyAvailabilityOnSelectedDate,$scope.appointment.service&&(angular.element("#service").css("border","1px solid #DDD"),angular.element("#service").css("background","#fff"),angular.element("#service").css("outline","0"),$scope.canSave=!0,setServiceDetails($scope.appointment.service).then(function(){$scope.onSelectStartTime()}))},$scope.onServiceTypeChange=function(){$scope.appointment.serviceType&&($scope.minDuration=$scope.appointment.serviceType.duration||$scope.minDuration,clearAvailabilityInfo(),$scope.onSelectStartTime())};var setServiceAvailableTimesForADate=function(date){$scope.allowedStartTime=$scope.selectedService.startTime||"12:00 am",$scope.allowedEndTime=$scope.selectedService.endTime||"11:59 pm",$scope.selectedService.weeklyAvailability&&$scope.selectedService.weeklyAvailability.length>0&&($scope.weeklyAvailabilityOnSelectedDate=function(date,weeklyAvailability){var dayOfWeek=moment(date).format("dddd").toUpperCase();return _.filter(weeklyAvailability,function(o){return o.dayOfWeek===dayOfWeek})}(date,$scope.selectedService.weeklyAvailability),$scope.weeklyAvailabilityOnSelectedDate&&0===$scope.weeklyAvailabilityOnSelectedDate.length&&($scope.allowedStartTime=void 0,$scope.allowedEndTime=void 0))};$scope.checkAvailability=function(){if($scope.warning.appointmentDate=!1,!$scope.isPastAppointment&&$scope.selectedService&&$scope.appointment.date){setServiceAvailableTimesForADate($scope.appointment.date);var allSlots,dayOfWeek=moment($scope.appointment.date).format("dddd").toUpperCase();_.isEmpty($scope.selectedService.weeklyAvailability)?allSlots=getAllSlots($scope.selectedService.startTime,$scope.selectedService.endTime,$scope.minDuration):(allSlots=getSlotsForWeeklyAvailability(dayOfWeek,$scope.selectedService.weeklyAvailability,$scope.minDuration),$scope.warning.appointmentDate=!function(dayOfWeek,weeklyAvailability){return _.find(weeklyAvailability,function(wA){return wA.dayOfWeek===dayOfWeek})}(dayOfWeek,$scope.selectedService.weeklyAvailability)),$scope.startTimes=allSlots.startTime,$scope.endTimes=allSlots.endTime,$scope.warning.endTime=!isAppointmentTimeWithinServiceAvailability($scope.appointment.endTime),$scope.warning.startTime=!isAppointmentTimeWithinServiceAvailability($scope.appointment.startTime),$scope.warning.outOfRange=isSelectedSlotOutOfRange(),triggerSlotCalculation()}};var setServiceDetails=function(service){return appointmentsServiceService.getService(service.uuid).then(function(response){$scope.selectedService=response.data,$scope.appointment.location=_.find(appointmentCreateConfig.locations,{uuid:$scope.selectedService.location.uuid}),$scope.minDuration=response.data.durationMins||Bahmni.Appointments.Constants.minDurationForAppointment})};$scope.continueWithoutSaving=function(){$scope.showConfirmationPopUp=!1,$state.go($scope.toStateConfig.toState,$scope.toStateConfig.toParams,{reload:!0}),ngDialog.close()},$scope.continueWithSaving=function(){saveAppointment($scope.validatedAppointment),ngDialog.close()},$scope.cancelTransition=function(){$scope.showConfirmationPopUp=!0,ngDialog.close()},$scope.displayConfirmationDialog=function(){ngDialog.openConfirm({template:"views/admin/appointmentServiceNavigationConfirmation.html",scope:$scope,closeByEscape:!0})},$scope.displayConflictConfirmationDialog=function(){ngDialog.openConfirm({template:"views/manage/appointmentConflictConfirmation.html",scope:$scope,closeByEscape:!0})},$scope.$on("$destroy",function(){cleanUpListenerStateChangeStart()});var getSlotsForWeeklyAvailability=function(dayOfWeek,weeklyAvailability,durationInMin){var slots={startTime:[],endTime:[]},dayAvailability=_.filter(weeklyAvailability,function(o){return o.dayOfWeek===dayOfWeek});return dayAvailability=_.sortBy(dayAvailability,"startTime"),_.each(dayAvailability,function(day){var allSlots=getAllSlots(day.startTime,day.endTime,durationInMin);slots.startTime=_.concat(slots.startTime,allSlots.startTime),slots.endTime=_.concat(slots.endTime,allSlots.endTime)}),slots},getAllSlots=function(startTimeString,endTimeString,durationInMin){startTimeString=_.isEmpty(startTimeString)?"00:00":startTimeString,endTimeString=_.isEmpty(endTimeString)?"23:59":endTimeString;for(var startTime=getFormattedTime(startTimeString),endTime=getFormattedTime(endTimeString),result=[],slots={startTime:[],endTime:[]},current=moment(startTime);current.valueOf()<=endTime.valueOf();)result.push(current.format("hh:mm a")),current.add(durationInMin,"minutes");return slots.startTime=_.slice(result,0,result.length-1),slots.endTime=_.slice(result,1),slots},getFormattedTime=function(time){return moment(time,"hh:mm a")},cleanUpListenerStateChangeStart=$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){!_.every(_.values($scope.appointment),function(value){return!value})&&$scope.showConfirmationPopUp&&(event.preventDefault(),ngDialog.close(),$scope.toStateConfig={toState:toState,toParams:toParams},$scope.displayConfirmationDialog())}),saveAppointment=function(appointment){return spinner.forPromise(appointmentsService.save(appointment).then(function(){messagingService.showMessage("info","APPOINTMENT_SAVE_SUCCESS"),$scope.showConfirmationPopUp=!1;var params=$state.params;params.viewDate=moment($scope.appointment.date).startOf("day").toDate(),params.isFilterOpen=!0,params.isSearchEnabled=params.isSearchEnabled&&$scope.isEditMode(),params.patient=void 0,$state.go("^",params,{reload:!0})}))},saveAppointmentContinue=function(appointment){return spinner.forPromise(appointmentsService.save(appointment).then(function(){messagingService.showMessage("info","APPOINTMENT_SAVE_SUCCESS"),$scope.showConfirmationPopUp=!1;var params=$state.params;params.isFilterOpen=!0,params.isSearchEnabled=params.isSearchEnabled&&$scope.isEditMode(),params.patient=$scope.appointment.patient,params.selectedAppointmentDate=$scope.appointment.date,params.selectedAppointmentBlock=$scope.selectedAppointmentBlock,$state.go("home.manage.appointments.list.new",params,{reload:!0})}))},wireAutocompleteEvents=function(){$("#endTimeID").bind("focus",function(){$("#endTimeID").autocomplete("search")});var $startTimeID=$("#startTimeID");$startTimeID.bind("focus",function(){$("#startTimeID").autocomplete("search")}),$startTimeID.bind("focusout",function(){$scope.onSelectStartTime()})};return $scope.validateDate=function(){var chosenDate=Bahmni.Common.Util.DateUtil.getDateWithoutTime($scope.appointment.date),today=new Date($scope.today),selectedDate=new Date(chosenDate);null!=chosenDate&&selectedDate.getTime()<today.getTime()||1970===selectedDate.getUTCFullYear()?($scope.invalidChosenDate=!0,angular.element("#date").css("border","2px solid #ff3434"),angular.element("#date").css("background","#ffcdcd")):($scope.invalidChosenDate=!1,angular.element("#date").css("border","1px solid #d1d1d1"),angular.element("#date").css("background","#fff"))},$scope.isEditMode=function(){return $scope.appointment.uuid},$scope.isEditAllowed=function(){return!$scope.isPastAppointment&&("Scheduled"===$scope.appointment.status||"CheckedIn"===$scope.appointment.status)},$scope.navigateToPreviousState=function(){$state.params.patient=void 0,$state.go("^",$state.params,{reload:!0})},function(){var selectedProvider,providers;wireAutocompleteEvents(),_.isEmpty(appointmentContext)||_.isEmpty(appointmentContext.appointment)||_.isEmpty(appointmentContext.appointment.provider)||(selectedProvider=appointmentContext.appointment.provider,providers=appointmentCreateConfig.providers,_.isUndefined(_.find(providers,function(provider){return selectedProvider.uuid===provider.uuid}))&&(appointmentContext.appointment.provider.person={display:appointmentContext.appointment.provider.name},appointmentCreateConfig.providers.push(appointmentContext.appointment.provider)));$scope.appointment=Bahmni.Appointments.AppointmentViewModel.create(appointmentContext.appointment||{appointmentKind:"Scheduled"},appointmentCreateConfig),$scope.selectedService=appointmentCreateConfig.selectedService,$scope.isPastAppointment=!!$scope.isEditMode()&&Bahmni.Common.Util.DateUtil.isBeforeDate($scope.appointment.date,moment().startOf("day")),$state.params.patient&&($scope.appointment.patient=$state.params.patient),$scope.appointment.date=$stateParams.selectedAppointmentDate||null,$scope.selectedAppointmentBlock=$stateParams.selectedAppointmentBlock,$scope.selectedAppointmentBlock&&($scope.appointment.startTime=$scope.selectedAppointmentBlock.startTime,$scope.appointment.endTime=$scope.selectedAppointmentBlock.endTime),$scope.appointment.patient&&$scope.onSelectPatient($scope.appointment.patient)}()}]),angular.module("bahmni.appointments").controller("AppointmentServiceController",["$scope","$q","spinner","$state","appointmentsServiceService","locationService","messagingService","specialityService","ngDialog","appService","appointmentServiceContext","confirmBox",function($scope,$q,spinner,$state,appointmentsServiceService,locationService,messagingService,specialityService,ngDialog,appService,appointmentServiceContext,confirmBox){$scope.showConfirmationPopUp=!0,$scope.enableSpecialities=appService.getAppDescriptor().getConfigValue("enableSpecialities"),$scope.enableServiceTypes=appService.getAppDescriptor().getConfigValue("enableServiceTypes"),$scope.enableCalendarView=appService.getAppDescriptor().getConfigValue("enableCalendarView"),$scope.colorsForAppointmentService=appService.getAppDescriptor().getConfigValue("colorsForAppointmentService");var serviceDetails=appointmentServiceContext?appointmentServiceContext.service:{};$scope.service=Bahmni.Appointments.AppointmentServiceViewModel.createFromResponse(serviceDetails),$scope.service.color=$scope.service.color||$scope.colorsForAppointmentService&&$scope.colorsForAppointmentService[0]||"#008000";var save=function(){if(clearValuesIfDisabledAndInvalid(),$scope.createServiceForm.$invalid)messagingService.showMessage("error","INVALID_SERVICE_FORM_ERROR_MESSAGE");else{var service=Bahmni.Appointments.AppointmentService.createFromUIObject($scope.service);appointmentsServiceService.save(service).then(function(){messagingService.showMessage("info","APPOINTMENT_SERVICE_SAVE_SUCCESS"),$scope.showConfirmationPopUp=!1,$state.go("home.admin.service")}),ngDialog.close()}},clearValuesIfDisabledAndInvalid=function(){var form=$scope.createServiceForm;form.serviceTime.$invalid&&$scope.hasWeeklyAvailability()&&(delete $scope.service.startTime,delete $scope.service.endTime,form.serviceTime.$setValidity("timeSequence",!0)),form.serviceMaxLoad.$invalid&&($scope.hasWeeklyAvailability()||$scope.hasServiceTypes())&&(delete $scope.service.maxAppointmentsLimit,form.serviceMaxLoad.$setValidity("min",!0)),form.serviceMaxLoad.$invalid&&$scope.hasServiceTypes()&&(delete $scope.service.maxAppointmentsLimit,form.serviceMaxLoad.$setValidity("min",!0))};$scope.hasWeeklyAvailability=function(){return $scope.service.weeklyAvailability.length>0},$scope.hasServiceTypes=function(){return $scope.service.serviceTypes.length>0};$scope.confirmSave=function(){if($scope.service.uuid){var childScope={message:"CONFIRM_EDIT_SERVICE_MESSAGE_KEY"};childScope.cancel=cancelSave,childScope.ok=save,confirmBox({scope:childScope,actions:[{name:"cancel",display:"CANCEL_KEY"},{name:"ok",display:"OK_KEY"}],className:"ngdialog-theme-default delete-program-popup"})}else save()};var cancelSave=function(closeDialog){closeDialog()};$scope.validateServiceName=function(){$scope.createServiceForm.name.$setValidity("uniqueServiceName",isServiceNameUnique($scope.service))};var isServiceNameUnique=function(service){return!service.name||!$scope.services.some(function(existingService){var isConflictingName=existingService.name.toLowerCase()===service.name.toLowerCase();return service.uuid?isConflictingName&&service.uuid!==existingService.uuid:isConflictingName})};$scope.continueWithoutSaving=function(){$scope.showConfirmationPopUp=!1,$state.go($scope.toStateConfig.toState,$scope.toStateConfig.toParams),ngDialog.close()},$scope.cancelTransition=function(){$scope.showConfirmationPopUp=!0,ngDialog.close()},$scope.displayConfirmationDialog=function(){ngDialog.openConfirm({template:"views/admin/appointmentServiceNavigationConfirmation.html",scope:$scope,closeByEscape:!0})};var promises,cleanUpListenerStateChangeStart=$scope.$on("$stateChangeStart",function(event,toState,toParams){$scope.showConfirmationPopUp&&(event.preventDefault(),ngDialog.close(),$scope.toStateConfig={toState:toState,toParams:toParams},$scope.displayConfirmationDialog())});return $scope.$on("$destroy",function(){cleanUpListenerStateChangeStart()}),(promises=[]).push(locationService.getAllByTag("Appointment Location").then(function(response){$scope.locations=response.data.results})),promises.push(appointmentsServiceService.getAllServices().then(function(response){$scope.services=response.data})),$scope.enableSpecialities&&promises.push(specialityService.getAllSpecialities().then(function(response){$scope.specialities=response.data})),spinner.forPromise($q.all(promises))}]),angular.module("bahmni.appointments").controller("AppointmentsDayCalendarController",["$scope","$rootScope","$state","uiCalendarConfig","appService","calendarViewPopUp","checkinPopUp",function($scope,$rootScope,$state,uiCalendarConfig,appService,calendarViewPopUp,checkinPopUp){$scope.eventSources=[];$scope.$watch("appointments",function(newValue,oldValue){newValue!==oldValue&&(_.isEmpty($scope.eventSources)||$scope.eventSources.splice(0,$scope.eventSources.length),_.isEmpty($scope.appointments.events)||$scope.eventSources.push($scope.appointments.events),$scope.uiConfig.calendar.resources=$scope.appointments.resources)}),function(){$scope.events=$scope.appointments.events,$scope.alertOnEventClick=function(event,jsEvent,view){calendarViewPopUp({scope:{appointments:event.appointments,checkinAppointment:function(patient,patientAppointment){checkinPopUp({scope:{patientAppointment:patientAppointment},className:"ngdialog-theme-default app-dialog-container"})},enableCreateAppointment:isSelectable()},className:"ngdialog-theme-default delete-program-popup app-dialog-container"})},$scope.alertOnDrop=function(event,delta,revertFunc,jsEvent,ui,view){$scope.alertMessage="Event Dropped to make dayDelta "+delta},$scope.alertOnResize=function(event,delta,revertFunc,jsEvent,ui,view){$scope.alertMessage="Event Resized to make dayDelta "+delta},$scope.addRemoveEventSource=function(sources,source){var canAdd=0;angular.forEach(sources,function(value,key){sources[key]===source&&(sources.splice(key,1),canAdd=1)}),0===canAdd&&sources.push(source)},$scope.remove=function(index){$scope.events.splice(index,1)},$scope.changeView=function(view,calendar){uiCalendarConfig.calendars[calendar].fullCalendar("changeView",view)};$scope.createAppointment=function(start,end,jsEvent,view,resource){if(_.find($rootScope.currentUser.privileges,function(privilege){return privilege.name===Bahmni.Appointments.Constants.privilegeManageAppointments})){var params=$state.params;params.appointment={startDateTime:start,endDateTime:end,appointmentKind:"Scheduled",provider:resource&&resource.provider},$state.go("home.manage.appointments.calendar.new",params,{reload:!1})}};var isSelectable=function(){return!Bahmni.Common.Util.DateUtil.isBeforeDate($scope.date,moment().startOf("day"))};$scope.uiConfig={calendar:{height:document.getElementsByClassName("app-calendar-container")[0].clientHeight,editable:!1,defaultDate:$scope.date,header:!1,timezone:"local",defaultView:"agendaDay",resources:$scope.appointments.resources,businessHours:{start:appService.getAppDescriptor().getConfigValue("startOfDay")||Bahmni.Appointments.Constants.defaultCalendarStartTime,end:appService.getAppDescriptor().getConfigValue("endOfDay")||Bahmni.Appointments.Constants.defaultCalendarEndTime},scrollTime:appService.getAppDescriptor().getConfigValue("startOfDay")||Bahmni.Appointments.Constants.defaultCalendarStartTime,groupByResource:!0,selectable:isSelectable(),select:$scope.createAppointment,slotLabelInterval:appService.getAppDescriptor().getConfigValue("calendarSlotLabelInterval")||Bahmni.Appointments.Constants.defaultCalendarSlotLabelInterval,slotDuration:appService.getAppDescriptor().getConfigValue("calendarSlotDuration")||Bahmni.Appointments.Constants.defaultCalendarSlotDuration,eventLimit:!0,allDaySlot:!1,allDayDefault:!1,eventClick:$scope.alertOnEventClick,eventDrop:$scope.alertOnDrop,eventResize:$scope.alertOnResize,eventRender:$scope.eventRender,schedulerLicenseKey:"GPL-My-Project-Is-Open-Source",slotLabelFormat:["HH:mm"]}},$scope.eventSources=[$scope.events]}()}]),angular.module("bahmni.appointments").controller("AllAppointmentsController",["$scope","$state","appService","$rootScope",function($scope,$state,appService,$rootScope){$scope.enableCalendarView=appService.getAppDescriptor().getConfigValue("enableCalendarView"),$scope.isSearchEnabled=!1,$scope.manageAppointmentPrivilege=Bahmni.Appointments.Constants.privilegeManageAppointments,$scope.navigateTo=function(viewName){$scope.currentTab=viewName;var path="home.manage.appointments."+viewName;$state.params.appointmentsData=$rootScope.appointmentsData,$state.go(path,$state.params,{reload:!1})},$scope.getCurrentAppointmentTabName=function(){return $state.current.tabName},$scope.$watch(function(){return $state.params.isSearchEnabled},function(isSearchEnabled){$scope.isSearchEnabled=isSearchEnabled},!0)}]),angular.module("bahmni.appointments").controller("AppointmentsCalendarViewController",["$scope","$state","$translate","spinner","appointmentsService","appointmentsFilter","$rootScope","appService",function($scope,$state,$translate,spinner,appointmentsService,appointmentsFilter,$rootScope,appService){$scope.appointmentBlocks=appService.getAppDescriptor().getConfigValue("appointmentBlocks");var parseAppointments=function(allAppointments){if(allAppointments){var appointments=allAppointments.filter(function(appointment){return"Cancelled"!==appointment.status}),resources=_.chain(appointments).filter(function(appointment){return!_.isEmpty(appointment.provider)}).map(function(appointment){return appointment.provider}).uniqBy("name").map(function(provider){return{id:provider.name,title:provider.name,provider:provider}}).sortBy(function(provider){return provider.id&&provider.id.toLowerCase()}).value();_.find(appointments,function(appointment){return _.isEmpty(appointment.provider)})&&resources.push({id:$translate.instant("NO_PROVIDER_COLUMN_KEY"),title:$translate.instant("NO_PROVIDER_COLUMN_KEY"),provider:{name:$translate.instant("NO_PROVIDER_COLUMN_KEY"),display:$translate.instant("NO_PROVIDER_COLUMN_KEY"),uuid:"no-provider-uuid"}});var events=[];appointments.reduce(function(result,appointment){var event={};event.resourceId=appointment.provider?appointment.provider.name:$translate.instant("NO_PROVIDER_COLUMN_KEY"),event.start=appointment.startDateTime,event.end=appointment.endDateTime,event.color=appointment.service.color,event.serviceName=appointment.service.name,event.blockName=$translate.instant(appointment.block);var existingEvent=_.find(result,event),patientName=appointment.patient.name+" ("+appointment.patient.identifier+")",isBedAssigned=appointment.additionalInfo&&appointment.additionalInfo.BED_NUMBER_KEY;return existingEvent?(existingEvent.title=[existingEvent.title,patientName].join("\n"),existingEvent.className="appointmentIcons multiplePatients"+(isBedAssigned?" bed-accom":""),existingEvent.appointments.push(appointment)):(event.title=patientName,event.className="appointmentIcons "+appointment.status+(isBedAssigned?" bed-accom":""),event.appointments=[],event.appointments.push(appointment),result.push(event)),result},events),$scope.providerAppointments={resources:resources,events:events},$scope.shouldReload=!0}};$scope.$watch(function(){return $state.params.filterParams},function(newValue,oldValue){if(newValue!==oldValue){var filteredAppointments=appointmentsFilter($scope.allAppointmentsForDay||$state.params.appointmentsData,$state.params.filterParams);filteredAppointments&&parseAppointments(filteredAppointments)}},!0),$scope.getAppointmentsForDate=function(viewDate){$state.params.viewDate=viewDate,$scope.shouldReload=!1;var params={forDate:viewDate};if($scope.$on("$stateChangeStart",function(event,toState,toParams){"list"==toState.tabName&&(toParams.doFetchAppointmentsData=!1)}),$state.params.doFetchAppointmentsData)return spinner.forPromise(appointmentsService.getAllAppointments(params).then(function(response){$scope.allAppointmentsForDay=response.data;var filteredAppointments=appointmentsFilter($scope.allAppointmentsForDay,$state.params.filterParams);return filteredAppointments=getAppointmentsBlock(filteredAppointments),$rootScope.appointmentsData=filteredAppointments,parseAppointments(filteredAppointments)}));var filteredAppointments=appointmentsFilter($state.params.appointmentsData,$state.params.filterParams);return $state.params.doFetchAppointmentsData=!0,parseAppointments(filteredAppointments)};var getAppointmentsBlock=function(appointments){return appointments=_.map(appointments,function(obj){var startTime=moment(obj.startDateTime).format("hh:mm a");return _.map($scope.appointmentBlocks,function(object){object.startTime==startTime&&(obj.block=object.name)}),obj})};return $scope.hasNoAppointments=function(){return _.isEmpty($scope.providerAppointments)||_.isEmpty($scope.providerAppointments.events)},$scope.startDate=$state.params.viewDate||moment().startOf("day").toDate(),$scope.$on("filterClosedOpen",function(event,args){$scope.isFilterOpen=args.filterViewStatus}),void($scope.isFilterOpen=$state.params.isFilterOpen)}]),angular.module("bahmni.appointments").controller("AppointmentsListViewController",["$scope","$state","$rootScope","$translate","$stateParams","spinner","appointmentsService","appService","appointmentsFilter","printer","checkinPopUp","confirmBox","ngDialog","messagingService",function($scope,$state,$rootScope,$translate,$stateParams,spinner,appointmentsService,appService,appointmentsFilter,printer,checkinPopUp,confirmBox,ngDialog,messagingService){$scope.enableSpecialities=appService.getAppDescriptor().getConfigValue("enableSpecialities"),$scope.enableServiceTypes=appService.getAppDescriptor().getConfigValue("enableServiceTypes"),$scope.allowedActions=appService.getAppDescriptor().getConfigValue("allowedActions")||[],$scope.allowedActionsByStatus=appService.getAppDescriptor().getConfigValue("allowedActionsByStatus")||{},$scope.colorsForListView=appService.getAppDescriptor().getConfigValue("colorsForListView")||{},$scope.manageAppointmentPrivilege=Bahmni.Appointments.Constants.privilegeManageAppointments,$scope.searchedPatient=!1,$scope.appointmentBlocks=appService.getAppDescriptor().getConfigValue("appointmentBlocks");var oldPatientData=[];$scope.$on("filterClosedOpen",function(event,args){$scope.isFilterOpen=args.filterViewStatus}),$scope.tableInfo=[{heading:"APPOINTMENT_PATIENT_ID",sortInfo:"patient.identifier",enable:!0},{heading:"APPOINTMENT_PATIENT_NAME",sortInfo:"patient.name",class:!0,enable:!0},{heading:"APPOINTMENT_DATE",sortInfo:"appointment.startDateTime",class:!0,enable:!1},{heading:"APPOINTMENT_BLOCK",sortInfo:"block",enable:!0},{heading:"APPOINTMENT_SERVICE_SPECIALITY_KEY",sortInfo:"service.speciality.name",enable:$scope.enableSpecialities},{heading:"APPOINTMENT_SERVICE",sortInfo:"service.name",class:!0,enable:!0},{heading:"APPOINTMENT_SERVICE_TYPE_FULL",sortInfo:"serviceType.name",class:!0,enable:$scope.enableServiceTypes},{heading:"APPOINTMENT_STATUS",sortInfo:"status",enable:!0},{heading:"APPOINTMENT_CREATE_NOTES",sortInfo:"comments",enable:!0}];$scope.getAppointmentsForDate=function(viewDate){$stateParams.viewDate=viewDate,$scope.selectedAppointment=void 0;var params={forDate:viewDate};$scope.$on("$stateChangeStart",function(event,toState,toParams){"calendar"==toState.tabName&&(toParams.doFetchAppointmentsData=!1)}),$state.params.doFetchAppointmentsData?spinner.forPromise(appointmentsService.getAllAppointments(params).then(function(response){$scope.appointments=response.data,$scope.filteredAppointments=appointmentsFilter($scope.appointments,$stateParams.filterParams),$scope.filteredAppointments=getAppointmentsBlock($scope.filteredAppointments),$rootScope.appointmentsData=$scope.filteredAppointments})):($scope.filteredAppointments=appointmentsFilter($state.params.appointmentsData,$stateParams.filterParams),$state.params.doFetchAppointmentsData=!0)};var getAppointmentsBlock=function(appointments){return appointments=_.map(appointments,function(obj){var startTime=moment(obj.startDateTime).format("hh:mm a");return _.map($scope.appointmentBlocks,function(object){object.startTime==startTime&&(obj.block=object.name)}),obj})};$scope.displaySearchedPatient=function(appointments){getAppointmentsBlock(appointments),oldPatientData=$scope.filteredAppointments,$scope.filteredAppointments=appointments.map(function(appointmet){return appointmet.date=appointmet.startDateTime,appointmet}),$scope.searchedPatient=!0,$scope.tableInfo[2].enable=!0,$stateParams.isFilterOpen=!1,$scope.isFilterOpen=!1,$stateParams.isSearchEnabled=!0},$scope.hasNoAppointments=function(){return _.isEmpty($scope.filteredAppointments)},$scope.goBackToPreviousView=function(){$scope.searchedPatient=!1,$scope.tableInfo[2].enable=!1,$scope.filteredAppointments=oldPatientData,$stateParams.isFilterOpen=!0,$scope.isFilterOpen=!0,$stateParams.isSearchEnabled=!1},$scope.isSelected=function(appointment){return $scope.selectedAppointment===appointment},$scope.select=function(appointment){$scope.isSelected(appointment)?$scope.selectedAppointment=void 0:$scope.selectedAppointment=appointment},$scope.isWalkIn=function(appointmentType){return"WalkIn"===appointmentType?"Yes":"No"},$scope.editAppointment=function(){var params=$stateParams;params.uuid=$scope.selectedAppointment.uuid,$state.go("home.manage.appointments.list.edit",params)},$scope.checkinAppointment=function(){var scope=$rootScope.$new();scope.message=$translate.instant("APPOINTMENT_STATUS_CHANGE_CONFIRM_MESSAGE",{toStatus:"CheckedIn"}),scope.action=_.partial(changeStatus,"CheckedIn",_),checkinPopUp({scope:scope,className:"ngdialog-theme-default app-dialog-container"})},$scope.$watch(function(){return $stateParams.filterParams},function(newValue,oldValue){newValue!==oldValue&&($scope.filteredAppointments=appointmentsFilter($scope.appointments||$state.params.appointmentsData,$stateParams.filterParams))},!0),$scope.sortAppointmentsBy=function(sortColumn){"additionalInfo"===sortColumn&&($scope.filteredAppointments=$scope.filteredAppointments.map(function(appointment){return appointment.additionalInformation=$scope.display(_.get(appointment,sortColumn)),appointment}),sortColumn="additionalInformation");var emptyObjects=_.filter($scope.filteredAppointments,function(appointment){return!_.property(sortColumn)(appointment)}),nonEmptyObjects=_.difference($scope.filteredAppointments,emptyObjects),sortedNonEmptyObjects=_.sortBy(nonEmptyObjects,function(appointment){return angular.isNumber(_.get(appointment,sortColumn))?_.get(appointment,sortColumn):_.get(appointment,sortColumn).toLowerCase()});$scope.reverseSort&&sortedNonEmptyObjects.reverse(),$scope.filteredAppointments=sortedNonEmptyObjects.concat(emptyObjects),$scope.sortColumn=sortColumn,$scope.reverseSort=!$scope.reverseSort},$scope.printPage=function(){var printTemplateUrl=appService.getAppDescriptor().getConfigValue("printListViewTemplateUrl")||"views/manage/list/listView.html";printer.print(printTemplateUrl,{searchedPatient:$scope.searchedPatient,filteredAppointments:$scope.filteredAppointments,startDate:$stateParams.viewDate,enableServiceTypes:$scope.enableServiceTypes,enableSpecialities:$scope.enableSpecialities})},$scope.undoCheckIn=function(){var scope={};scope.message=$translate.instant("APPOINTMENT_UNDO_CHECKIN_CONFIRM_MESSAGE"),scope.yes=function(closeConfirmBox){return appointmentsService.undoCheckIn($scope.selectedAppointment.uuid).then(function(response){ngDialog.close(),$scope.selectedAppointment.status=response.data.status;var message=$translate.instant("APPOINTMENT_STATUS_CHANGE_SUCCESS_MESSAGE",{toStatus:response.data.status});closeConfirmBox(),messagingService.showMessage("info",message)})},showPopUp(scope)};var changeStatus=function(toStatus,onDate,closeConfirmBox){var message=$translate.instant("APPOINTMENT_STATUS_CHANGE_SUCCESS_MESSAGE",{toStatus:toStatus});return appointmentsService.changeStatus($scope.selectedAppointment.uuid,toStatus,onDate).then(function(response){ngDialog.close(),$scope.selectedAppointment.status=response.data.status,closeConfirmBox(),messagingService.showMessage("info",message)})};$scope.confirmAction=function(toStatus){var scope={};scope.message=$translate.instant("APPOINTMENT_STATUS_CHANGE_CONFIRM_MESSAGE",{toStatus:toStatus}),scope.yes=_.partial(changeStatus,toStatus,void 0,_),showPopUp(scope)},$scope.display=function(jsonObj){return jsonObj=_.mapKeys(jsonObj,function(value,key){return $translate.instant(key)}),JSON.stringify(jsonObj||"").replace(/[{\"}]/g,"").replace(/[,]/g,",\t")};var showPopUp=function(popUpScope){popUpScope.no=function(closeConfirmBox){closeConfirmBox()},confirmBox({scope:popUpScope,actions:[{name:"yes",display:"YES_KEY"},{name:"no",display:"NO_KEY"}],className:"ngdialog-theme-default"})};$scope.isAllowedAction=function(action){return _.includes($scope.allowedActions,action)},$scope.isValidAction=function(action){if(!$scope.selectedAppointment)return!1;var status=$scope.selectedAppointment.status,allowedActions=$scope.allowedActionsByStatus.hasOwnProperty(status)?$scope.allowedActionsByStatus[status]:[];return _.includes(allowedActions,action)},$scope.searchedPatient=$stateParams.isSearchEnabled&&$stateParams.patient,$scope.startDate=$stateParams.viewDate||moment().startOf("day").toDate(),$scope.isFilterOpen=$stateParams.isFilterOpen}]),angular.module("bahmni.appointments").controller("AppointmentsSummaryController",["$scope","$state","$window","spinner","appointmentsService","appService",function($scope,$state,$window,spinner,appointmentsService,appService){$scope.periodStartDate=$scope.startDate,$scope.periodEndDate=$scope.endDate,$scope.minDay=Bahmni.Common.Util.DateUtil.addDays($scope.startDate,1),$scope.$watch("startDate",function(newValue,oldValue){newValue!=oldValue&&($scope.minDay=Bahmni.Common.Util.DateUtil.addDays($scope.startDate,1))}),$scope.getAppointmentsSummaryPeriod=function(startDate,endDate){$scope.periodStartDate=startDate,$scope.periodEndDate=endDate;var params={startDate:startDate,endDate:endDate};spinner.forPromise(appointmentsService.getAppointmentsSummary(params).then(function(response){$scope.appointments=response.data,setDatesInfo()}))},$scope.goToListView=function(date,service){var params={viewDate:moment(date).toDate(),filterParams:{statusList:_.without(Bahmni.Appointments.Constants.appointmentStatusList,"Cancelled")}};_.isUndefined(service)||(params.filterParams.serviceUuids=[service.uuid]),$state.go("home.manage.appointments.list",params)},$scope.isCurrentDate=function(date){return moment(date).format("YYYY-MM-DD")===moment().format("YYYY-MM-DD")},$scope.addDayToDate=function(initialDate){return Bahmni.Common.Util.DateUtil.addDays(initialDate,1)};var setDatesInfo=function(){$scope.weekDatesInfo=[];for(var i=$scope.periodStartDate;Bahmni.Common.Util.DateUtil.isBeforeDate(i,$scope.periodEndDate);i=Bahmni.Common.Util.DateUtil.addDays(i,1)){var weekDate={date:moment(i).format("YYYY-MM-DD")};weekDate.total=_.reduce($scope.appointments,function(total,appointment){var appointmentCount=appointment.appointmentCountMap[weekDate.date];return appointmentCount?{all:appointmentCount.allAppointmentsCount+total.all,missed:appointmentCount.missedAppointmentsCount+total.missed}:total},{all:0,missed:0}),$scope.weekDatesInfo.push(weekDate)}};$scope.viewDate=moment().startOf("day").toDate(),$scope.weekStartDate=moment($scope.viewDate).startOf("week").toDate(),$scope.weekEndDate=moment($scope.viewDate).endOf("week").toDate(),$scope.weekStart=appService.getAppDescriptor().getConfigValue("weekStart"),$scope.getAppointmentsSummaryPeriod($scope.weekStartDate,$scope.weekEndDate)}]),angular.module("bahmni.appointments").controller("AppointmentsFilterController",["$scope","$state","$rootScope","$q","$translate","appointmentsServiceService","spinner","ivhTreeviewMgr","providerService","appService",function($scope,$state,$rootScope,$q,$translate,appointmentsServiceService,spinner,ivhTreeviewMgr,providerService,appService){$scope.filterSelected=function(){$scope.filterSelectedValues=$scope.showSelected?{selected:!0}:void 0},$scope.expandFilter=function(){$state.params.isFilterOpen=!0,$scope.isFilterOpen=$state.params.isFilterOpen,$rootScope.$broadcast("filterClosedOpen",{filterViewStatus:$scope.isFilterOpen})},$scope.minimizeFilter=function(){$state.params.isFilterOpen=!1,$scope.isFilterOpen=$state.params.isFilterOpen,$rootScope.$broadcast("filterClosedOpen",{filterViewStatus:$scope.isFilterOpen})};var resetFilterParams=function(){$state.params.filterParams={serviceUuids:[],serviceTypeUuids:[],providerUuids:[],statusList:[]}};$scope.setSelectedSpecialities=function(selectedSpecialities){$scope.selectedSpecialities=selectedSpecialities},$scope.getCurrentAppointmentTabName=function(){return $state.current.tabName},$scope.resetFilter=function(){$scope.selectedSpecialities&&ivhTreeviewMgr.deselectAll($scope.selectedSpecialities,!1),$scope.selectedProviders=[],$scope.selectedStatusList=[],$scope.showSelected=!1,$scope.filterSelectedValues=void 0,$scope.searchText=void 0,resetFilterParams()},$scope.resetSearchText=function(){$scope.searchText=void 0},$scope.applyFilter=function(){resetFilterParams(),$scope.isSpecialityEnabled?($state.params.filterParams.serviceUuids=_.reduce($scope.selectedSpecialities,function(accumulator,speciality){return _.chain(speciality.children).filter(function(service){return service.selected}).map(function(service){return service.id}).value().concat(accumulator)},[]),$scope.isServiceTypeEnabled?$state.params.filterParams.serviceTypeUuids=_.reduce($scope.selectedSpecialities,function(accumulator,speciality){return _.reduce(speciality.children,function(accumulator,service){var serviceTypesForService=[];return service.selected||(serviceTypesForService=_.filter(service.children,function(serviceType){return serviceType.selected}).map(function(serviceType){return serviceType.id})),serviceTypesForService.concat(accumulator)},[]).concat(accumulator)},[]):$state.params.filterParams.serviceTypeUuids=[]):($state.params.filterParams.serviceUuids=_.chain($scope.selectedSpecialities).filter(function(service){return service.selected}).map(function(service){return service.id}).value(),$scope.isServiceTypeEnabled?$state.params.filterParams.serviceTypeUuids=$scope.selectedSpecialities.filter(function(service){return!service.selected}).reduce(function(accumulator,service){return accumulator.concat(service.children)},[]).filter(function(serviceType){return serviceType.selected}).reduce(function(accumulator,serviceType){return accumulator.concat(serviceType.id)},[]):$state.params.filterParams.serviceTypeUuids=[]),$state.params.filterParams.providerUuids=_.map($scope.selectedProviders,function(provider){return provider.uuid}),$state.params.filterParams.statusList=_.map($scope.selectedStatusList,function(status){return status.value})},$scope.isFilterApplied=function(){return _.find($state.params.filterParams,function(filterParam){return!_.isEmpty(filterParam)})},$scope.$watch(function(){return $state.params.isFilterOpen},function(isFilterHidden){$scope.isFilterOpen=isFilterHidden,$scope.isSearchEnabled=isFilterHidden},!0),$scope.$watch(function(){return $state.params.isSearchEnabled},function(isSearchEnabled){$scope.isSearchEnabled=isSearchEnabled},!0),$scope.$watch(function(){return $state.current.tabName},function(newValue,oldValue){newValue!==oldValue&&("calendar"===newValue?($scope.statusList=_.filter($scope.statusList,function(status){return"Cancelled"!==status.name}),$scope.selectedStatusList=_.filter($scope.selectedStatusList,function(status){return"Cancelled"!==status.name})):$scope.statusList=_.map(Bahmni.Appointments.Constants.appointmentStatusList,function(status){return{name:status,value:status}}))},!0),function(){$scope.isSpecialityEnabled=appService.getAppDescriptor().getConfigValue("enableSpecialities"),$scope.isServiceTypeEnabled=appService.getAppDescriptor().getConfigValue("enableServiceTypes"),$scope.isFilterOpen=$state.params.isFilterOpen,$scope.isSearchEnabled=$state.params.isSearchEnabled,$scope.statusList=_.map(Bahmni.Appointments.Constants.appointmentStatusList,function(status){return{name:status,value:status}}),$scope.selectedStatusList=_.filter($scope.statusList,function(status){return _.includes($state.params.filterParams.statusList,status.value)}),"calendar"===$state.current.tabName&&($scope.statusList=_.filter($scope.statusList,function(status){return"Cancelled"!==status.name}));spinner.forPromise($q.all([appointmentsServiceService.getAllServicesWithServiceTypes(),providerService.list({v:"custom:(display,person,uuid,retired,attributes:(attributeType:(display),value,voided))"})]).then(function(response){$scope.providers=_.filter(response[1].data.results,function(provider){return _.find(provider.attributes,function(attribute){return!attribute.voided&&!provider.retired&&attribute.value&&attribute.attributeType.display===Bahmni.Appointments.Constants.availableForAppointments})}).map(function(provider){return provider.name=provider.person.display,provider}),$scope.providers.push({name:$translate.instant("NO_PROVIDER_COLUMN_KEY"),display:$translate.instant("NO_PROVIDER_COLUMN_KEY"),uuid:"no-provider-uuid"}),$scope.isSpecialityEnabled?($scope.specialities=_.groupBy(response[0].data,function(service){return service.speciality.name||$translate.instant("NO_SPECIALITY_KEY")}),$scope.selectedSpecialities=_.map($scope.specialities,function(speciality,key){return{label:key,id:speciality[0].speciality.uuid||"",children:_.map(speciality,function(service){return{label:service.name,id:service.uuid,color:service.color,children:$scope.isServiceTypeEnabled?_.map(service.serviceTypes,function(serviceType){return{label:serviceType.name+" ["+serviceType.duration+" "+$translate.instant("PLACEHOLDER_SERVICE_TYPE_DURATION_MIN")+"]",id:serviceType.uuid}}):[]}})}})):$scope.selectedSpecialities=_.map(response[0].data,function(service){return{label:service.name,id:service.uuid,color:service.color,children:$scope.isServiceTypeEnabled?_.map(service.serviceTypes,function(serviceType){return{label:serviceType.name+" ["+serviceType.duration+" "+$translate.instant("PLACEHOLDER_SERVICE_TYPE_DURATION_MIN")+"]",id:serviceType.uuid}}):[]}}),$scope.selectedProviders=_.filter($scope.providers,function(provider){return _.includes($state.params.filterParams.providerUuids,provider.uuid)}),_.isEmpty($state.params.filterParams)||ivhTreeviewMgr.selectEach($scope.selectedSpecialities,$state.params.filterParams.serviceUuids)}))}()}]),angular.module("bahmni.appointments").filter("appointments",[function(){var filterAppointmentsByProviders=function(appointments,providerUuids){return _.isEmpty(providerUuids)?appointments:_.filter(appointments,function(appointment){return appointment.provider?appointment.provider&&_.includes(providerUuids,appointment.provider.uuid):_.includes(providerUuids,"no-provider-uuid")})},filterAppointmentsByStatus=function(appointments,statusList){return _.isEmpty(statusList)?appointments:_.filter(appointments,function(appointment){return _.includes(statusList,appointment.status)})};return function(appointments,filters){if(_.isEmpty(filters))return appointments;if(_.isEmpty(filters.serviceUuids)&&_.isEmpty(filters.serviceTypeUuids)){var appointmentsFilteredByProviders=filterAppointmentsByProviders(appointments,filters.providerUuids);return filterAppointmentsByStatus(appointmentsFilteredByProviders,filters.statusList)}var appointmentsFilteredByService=function(appointments,serviceUuids){return _.filter(appointments,function(appointment){return appointment.service&&_.includes(serviceUuids,appointment.service.uuid)})}(appointments,filters.serviceUuids),appointmentsFilteredByServiceType=function(appointments,serviceTypeUuids){return _.filter(appointments,function(appointment){return appointment.serviceType&&_.includes(serviceTypeUuids,appointment.serviceType.uuid)})}(appointments,filters.serviceTypeUuids),appointmentsFilteredBySpeciality=appointmentsFilteredByService.concat(appointmentsFilteredByServiceType);appointmentsFilteredByProviders=filterAppointmentsByProviders(appointmentsFilteredBySpeciality,filters.providerUuids);return filterAppointmentsByStatus(appointmentsFilteredByProviders,filters.statusList)}}]),Bahmni.Common.AuditLogEventDetails={USER_LOGIN_SUCCESS:{eventType:"USER_LOGIN_SUCCESS",message:"USER_LOGIN_SUCCESS_MESSAGE"},USER_LOGIN_FAILED:{eventType:"USER_LOGIN_FAILED",message:"USER_LOGIN_FAILED_MESSAGE"},USER_LOGOUT_SUCCESS:{eventType:"USER_LOGOUT_SUCCESS",message:"USER_LOGOUT_SUCCESS_MESSAGE"},OPEN_VISIT:{eventType:"OPEN_VISIT",message:"OPEN_VISIT_MESSAGE"},EDIT_VISIT:{eventType:"EDIT_VISIT",message:"EDIT_VISIT_MESSAGE"},CLOSE_VISIT:{eventType:"CLOSE_VISIT",message:"CLOSE_VISIT_MESSAGE"},CLOSE_VISIT_FAILED:{eventType:"CLOSE_VISIT_FAILED",message:"CLOSE_VISIT_FAILED_MESSAGE"},EDIT_ENCOUNTER:{eventType:"EDIT_ENCOUNTER",message:"EDIT_ENCOUNTER_MESSAGE"},VIEWED_REGISTRATION_PATIENT_SEARCH:{eventType:"VIEWED_REGISTRATION_PATIENT_SEARCH",message:"VIEWED_REGISTRATION_PATIENT_SEARCH_MESSAGE"},VIEWED_NEW_PATIENT_PAGE:{eventType:"VIEWED_NEW_PATIENT_PAGE",message:"VIEWED_NEW_PATIENT_PAGE_MESSAGE"},REGISTER_NEW_PATIENT:{eventType:"REGISTER_NEW_PATIENT",message:"REGISTER_NEW_PATIENT_MESSAGE"},EDIT_PATIENT_DETAILS:{eventType:"EDIT_PATIENT_DETAILS",message:"EDIT_PATIENT_DETAILS_MESSAGE"},ACCESSED_REGISTRATION_SECOND_PAGE:{eventType:"ACCESSED_REGISTRATION_SECOND_PAGE",message:"ACCESSED_REGISTRATION_SECOND_PAGE_MESSAGE"},VIEWED_PATIENT_DETAILS:{eventType:"VIEWED_PATIENT_DETAILS",message:"VIEWED_PATIENT_DETAILS_MESSAGE"},PRINT_PATIENT_STICKER:{eventType:"PRINT_PATIENT_STICKER",message:"PRINT_PATIENT_STICKER_MESSAGE"},VIEWED_CLINICAL_PATIENT_SEARCH:{eventType:"VIEWED_CLINICAL_PATIENT_SEARCH",message:"VIEWED_PATIENT_SEARCH_MESSAGE"},VIEWED_CLINICAL_DASHBOARD:{eventType:"VIEWED_CLINICAL_DASHBOARD",message:"VIEWED_CLINICAL_DASHBOARD_MESSAGE"},VIEWED_OBSERVATIONS_TAB:{eventType:"VIEWED_OBSERVATIONS_TAB",message:"VIEWED_OBSERVATIONS_TAB_MESSAGE"},VIEWED_DIAGNOSIS_TAB:{eventType:"VIEWED_DIAGNOSIS_TAB",message:"VIEWED_DIAGNOSIS_TAB_MESSAGE"},VIEWED_ALLERGY_TAB:{eventType:"VIEWED_ALLERGY_TAB",message:"VIEWED_ALLERGY_TAB_MESSAGE"},VIEWED_TREATMENT_TAB:{eventType:"VIEWED_TREATMENT_TAB",message:"VIEWED_TREATMENT_TAB_MESSAGE"},VIEWED_DISPOSITION_TAB:{eventType:"VIEWED_DISPOSITION_TAB",message:"VIEWED_DISPOSITION_TAB_MESSAGE"},VIEWED_DASHBOARD_SUMMARY:{eventType:"VIEWED_DASHBOARD_SUMMARY",message:"VIEWED_DASHBOARD_SUMMARY_MESSAGE"},VIEWED_ORDERS_TAB:{eventType:"VIEWED_ORDERS_TAB",message:"VIEWED_ORDERS_TAB_MESSAGE"},VIEWED_BACTERIOLOGY_TAB:{eventType:"VIEWED_BACTERIOLOGY_TAB",message:"VIEWED_BACTERIOLOGY_TAB_MESSAGE"},VIEWED_INVESTIGATION_TAB:{eventType:"VIEWED_INVESTIGATION_TAB",message:"VIEWED_INVESTIGATION_TAB_MESSAGE"},VIEWED_SUMMARY_PRINT:{eventType:"VIEWED_SUMMARY_PRINT",message:"VIEWED_SUMMARY_PRINT_MESSAGE"},VIEWED_VISIT_DASHBOARD:{eventType:"VIEWED_VISIT_DASHBOARD",message:"VIEWED_VISIT_DASHBOARD_MESSAGE"},VIEWED_VISIT_PRINT:{eventType:"VIEWED_VISIT_PRINT",message:"VIEWED_VISIT_PRINT_MESSAGE"},VIEWED_DASHBOARD_OBSERVATION:{eventType:"VIEWED_DASHBOARD_OBSERVATION",message:"VIEWED_DASHBOARD_OBSERVATION_MESSAGE"},VIEWED_PATIENTPROGRAM:{eventType:"VIEWED_PATIENTPROGRAM",message:"VIEWED_PATIENTPROGRAM_MESSAGE"},RUN_REPORT:{eventType:"RUN_REPORT",message:"RUN_REPORT_MESSAGE"}},angular.module("bahmni.common.logging").service("auditLogService",["$http","$translate","configurationService",function($http,$translate,configurationService){var DateUtil=Bahmni.Common.Util.DateUtil;this.getLogs=function(params){return params=params||{},$http.get(Bahmni.Common.Constants.auditLogUrl,{params:params}).then(function(response){return response.data.map(function(log){var date,localDate;log.dateCreated=(date=log.dateCreated,localDate=DateUtil.parseLongDateToServerFormat(date),DateUtil.getDateTimeInSpecifiedFormat(localDate,"MMMM Do, YYYY [at] HH:mm"));var entity=log.message?log.message.split("~")[1]:void 0;return log.params=entity?JSON.parse(entity):entity,log.message=log.message.split("~")[0],log.displayMessage=$translate.instant(log.message,log),log})})},this.log=function(patientUuid,eventType,messageParams,module){return configurationService.getConfigurations(["enableAuditLog"]).then(function(result){if(result.enableAuditLog){var params={};return params.patientUuid=patientUuid,params.eventType=Bahmni.Common.AuditLogEventDetails[eventType].eventType,params.message=Bahmni.Common.AuditLogEventDetails[eventType].message,params.message=messageParams?params.message+"~"+JSON.stringify(messageParams):params.message,params.module=module,$http.post(Bahmni.Common.Constants.auditLogUrl,params,{withCredentials:!0})}})}}]);